(async()=>{(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const u of document.querySelectorAll('link[rel="modulepreload"]'))a(u);new MutationObserver(u=>{for(const g of u)if(g.type==="childList")for(const R of g.addedNodes)R.tagName==="LINK"&&R.rel==="modulepreload"&&a(R)}).observe(document,{childList:!0,subtree:!0});function n(u){const g={};return u.integrity&&(g.integrity=u.integrity),u.referrerPolicy&&(g.referrerPolicy=u.referrerPolicy),u.crossOrigin==="use-credentials"?g.credentials="include":u.crossOrigin==="anonymous"?g.credentials="omit":g.credentials="same-origin",g}function a(u){if(u.ep)return;u.ep=!0;const g=n(u);fetch(u.href,g)}})();const o={DEPTH_BUFFER_BIT:256,STENCIL_BUFFER_BIT:1024,COLOR_BUFFER_BIT:16384,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,ZERO:0,ONE:1,SRC_COLOR:768,ONE_MINUS_SRC_COLOR:769,SRC_ALPHA:770,ONE_MINUS_SRC_ALPHA:771,DST_ALPHA:772,ONE_MINUS_DST_ALPHA:773,DST_COLOR:774,ONE_MINUS_DST_COLOR:775,SRC_ALPHA_SATURATE:776,FUNC_ADD:32774,BLEND_EQUATION:32777,BLEND_EQUATION_RGB:32777,BLEND_EQUATION_ALPHA:34877,FUNC_SUBTRACT:32778,FUNC_REVERSE_SUBTRACT:32779,BLEND_DST_RGB:32968,BLEND_SRC_RGB:32969,BLEND_DST_ALPHA:32970,BLEND_SRC_ALPHA:32971,CONSTANT_COLOR:32769,ONE_MINUS_CONSTANT_COLOR:32770,CONSTANT_ALPHA:32771,ONE_MINUS_CONSTANT_ALPHA:32772,BLEND_COLOR:32773,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,ARRAY_BUFFER_BINDING:34964,ELEMENT_ARRAY_BUFFER_BINDING:34965,STREAM_DRAW:35040,STATIC_DRAW:35044,DYNAMIC_DRAW:35048,BUFFER_SIZE:34660,BUFFER_USAGE:34661,CURRENT_VERTEX_ATTRIB:34342,FRONT:1028,BACK:1029,FRONT_AND_BACK:1032,CULL_FACE:2884,BLEND:3042,DITHER:3024,STENCIL_TEST:2960,DEPTH_TEST:2929,SCISSOR_TEST:3089,POLYGON_OFFSET_FILL:32823,SAMPLE_ALPHA_TO_COVERAGE:32926,SAMPLE_COVERAGE:32928,NO_ERROR:0,INVALID_ENUM:1280,INVALID_VALUE:1281,INVALID_OPERATION:1282,OUT_OF_MEMORY:1285,CW:2304,CCW:2305,LINE_WIDTH:2849,ALIASED_POINT_SIZE_RANGE:33901,ALIASED_LINE_WIDTH_RANGE:33902,CULL_FACE_MODE:2885,FRONT_FACE:2886,DEPTH_RANGE:2928,DEPTH_WRITEMASK:2930,DEPTH_CLEAR_VALUE:2931,DEPTH_FUNC:2932,STENCIL_CLEAR_VALUE:2961,STENCIL_FUNC:2962,STENCIL_FAIL:2964,STENCIL_PASS_DEPTH_FAIL:2965,STENCIL_PASS_DEPTH_PASS:2966,STENCIL_REF:2967,STENCIL_VALUE_MASK:2963,STENCIL_WRITEMASK:2968,STENCIL_BACK_FUNC:34816,STENCIL_BACK_FAIL:34817,STENCIL_BACK_PASS_DEPTH_FAIL:34818,STENCIL_BACK_PASS_DEPTH_PASS:34819,STENCIL_BACK_REF:36003,STENCIL_BACK_VALUE_MASK:36004,STENCIL_BACK_WRITEMASK:36005,VIEWPORT:2978,SCISSOR_BOX:3088,COLOR_CLEAR_VALUE:3106,COLOR_WRITEMASK:3107,UNPACK_ALIGNMENT:3317,PACK_ALIGNMENT:3333,MAX_TEXTURE_SIZE:3379,MAX_VIEWPORT_DIMS:3386,SUBPIXEL_BITS:3408,RED_BITS:3410,GREEN_BITS:3411,BLUE_BITS:3412,ALPHA_BITS:3413,DEPTH_BITS:3414,STENCIL_BITS:3415,POLYGON_OFFSET_UNITS:10752,POLYGON_OFFSET_FACTOR:32824,TEXTURE_BINDING_2D:32873,SAMPLE_BUFFERS:32936,SAMPLES:32937,SAMPLE_COVERAGE_VALUE:32938,SAMPLE_COVERAGE_INVERT:32939,COMPRESSED_TEXTURE_FORMATS:34467,DONT_CARE:4352,FASTEST:4353,NICEST:4354,GENERATE_MIPMAP_HINT:33170,BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DEPTH_COMPONENT:6402,ALPHA:6406,RGB:6407,RGBA:6408,LUMINANCE:6409,LUMINANCE_ALPHA:6410,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,FRAGMENT_SHADER:35632,VERTEX_SHADER:35633,MAX_VERTEX_ATTRIBS:34921,MAX_VERTEX_UNIFORM_VECTORS:36347,MAX_VARYING_VECTORS:36348,MAX_COMBINED_TEXTURE_IMAGE_UNITS:35661,MAX_VERTEX_TEXTURE_IMAGE_UNITS:35660,MAX_TEXTURE_IMAGE_UNITS:34930,MAX_FRAGMENT_UNIFORM_VECTORS:36349,SHADER_TYPE:35663,DELETE_STATUS:35712,LINK_STATUS:35714,VALIDATE_STATUS:35715,ATTACHED_SHADERS:35717,ACTIVE_UNIFORMS:35718,ACTIVE_ATTRIBUTES:35721,SHADING_LANGUAGE_VERSION:35724,CURRENT_PROGRAM:35725,NEVER:512,LESS:513,EQUAL:514,LEQUAL:515,GREATER:516,NOTEQUAL:517,GEQUAL:518,ALWAYS:519,KEEP:7680,REPLACE:7681,INCR:7682,DECR:7683,INVERT:5386,INCR_WRAP:34055,DECR_WRAP:34056,VENDOR:7936,RENDERER:7937,VERSION:7938,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987,TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,TEXTURE_2D:3553,TEXTURE:5890,TEXTURE_CUBE_MAP:34067,TEXTURE_BINDING_CUBE_MAP:34068,TEXTURE_CUBE_MAP_POSITIVE_X:34069,TEXTURE_CUBE_MAP_NEGATIVE_X:34070,TEXTURE_CUBE_MAP_POSITIVE_Y:34071,TEXTURE_CUBE_MAP_NEGATIVE_Y:34072,TEXTURE_CUBE_MAP_POSITIVE_Z:34073,TEXTURE_CUBE_MAP_NEGATIVE_Z:34074,MAX_CUBE_MAP_TEXTURE_SIZE:34076,TEXTURE0:33984,TEXTURE1:33985,TEXTURE2:33986,TEXTURE3:33987,TEXTURE4:33988,TEXTURE5:33989,TEXTURE6:33990,TEXTURE7:33991,TEXTURE8:33992,TEXTURE9:33993,TEXTURE10:33994,TEXTURE11:33995,TEXTURE12:33996,TEXTURE13:33997,TEXTURE14:33998,TEXTURE15:33999,TEXTURE16:34e3,TEXTURE17:34001,TEXTURE18:34002,TEXTURE19:34003,TEXTURE20:34004,TEXTURE21:34005,TEXTURE22:34006,TEXTURE23:34007,TEXTURE24:34008,TEXTURE25:34009,TEXTURE26:34010,TEXTURE27:34011,TEXTURE28:34012,TEXTURE29:34013,TEXTURE30:34014,TEXTURE31:34015,ACTIVE_TEXTURE:34016,REPEAT:10497,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,SAMPLER_2D:35678,SAMPLER_CUBE:35680,VERTEX_ATTRIB_ARRAY_ENABLED:34338,VERTEX_ATTRIB_ARRAY_SIZE:34339,VERTEX_ATTRIB_ARRAY_STRIDE:34340,VERTEX_ATTRIB_ARRAY_TYPE:34341,VERTEX_ATTRIB_ARRAY_NORMALIZED:34922,VERTEX_ATTRIB_ARRAY_POINTER:34373,VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:34975,IMPLEMENTATION_COLOR_READ_TYPE:35738,IMPLEMENTATION_COLOR_READ_FORMAT:35739,COMPILE_STATUS:35713,LOW_FLOAT:36336,MEDIUM_FLOAT:36337,HIGH_FLOAT:36338,LOW_INT:36339,MEDIUM_INT:36340,HIGH_INT:36341,FRAMEBUFFER:36160,RENDERBUFFER:36161,RGBA4:32854,RGB5_A1:32855,RGB565:36194,DEPTH_COMPONENT16:33189,STENCIL_INDEX:6401,STENCIL_INDEX8:36168,DEPTH_STENCIL:34041,RENDERBUFFER_WIDTH:36162,RENDERBUFFER_HEIGHT:36163,RENDERBUFFER_INTERNAL_FORMAT:36164,RENDERBUFFER_RED_SIZE:36176,RENDERBUFFER_GREEN_SIZE:36177,RENDERBUFFER_BLUE_SIZE:36178,RENDERBUFFER_ALPHA_SIZE:36179,RENDERBUFFER_DEPTH_SIZE:36180,RENDERBUFFER_STENCIL_SIZE:36181,FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:36048,FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:36049,FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL:36050,FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE:36051,COLOR_ATTACHMENT0:36064,DEPTH_ATTACHMENT:36096,STENCIL_ATTACHMENT:36128,DEPTH_STENCIL_ATTACHMENT:33306,NONE:0,FRAMEBUFFER_COMPLETE:36053,FRAMEBUFFER_INCOMPLETE_ATTACHMENT:36054,FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:36055,FRAMEBUFFER_INCOMPLETE_DIMENSIONS:36057,FRAMEBUFFER_UNSUPPORTED:36061,FRAMEBUFFER_BINDING:36006,RENDERBUFFER_BINDING:36007,MAX_RENDERBUFFER_SIZE:34024,INVALID_FRAMEBUFFER_OPERATION:1286,UNPACK_FLIP_Y_WEBGL:37440,UNPACK_PREMULTIPLY_ALPHA_WEBGL:37441,CONTEXT_LOST_WEBGL:37442,UNPACK_COLORSPACE_CONVERSION_WEBGL:37443,BROWSER_DEFAULT_WEBGL:37444,READ_BUFFER:3074,UNPACK_ROW_LENGTH:3314,UNPACK_SKIP_ROWS:3315,UNPACK_SKIP_PIXELS:3316,PACK_ROW_LENGTH:3330,PACK_SKIP_ROWS:3331,PACK_SKIP_PIXELS:3332,COLOR:6144,DEPTH:6145,STENCIL:6146,RED:6403,RGB8:32849,RGBA8:32856,RGB10_A2:32857,TEXTURE_BINDING_3D:32874,UNPACK_SKIP_IMAGES:32877,UNPACK_IMAGE_HEIGHT:32878,TEXTURE_3D:32879,TEXTURE_WRAP_R:32882,MAX_3D_TEXTURE_SIZE:32883,UNSIGNED_INT_2_10_10_10_REV:33640,MAX_ELEMENTS_VERTICES:33e3,MAX_ELEMENTS_INDICES:33001,TEXTURE_MIN_LOD:33082,TEXTURE_MAX_LOD:33083,TEXTURE_BASE_LEVEL:33084,TEXTURE_MAX_LEVEL:33085,MIN:32775,MAX:32776,DEPTH_COMPONENT24:33190,MAX_TEXTURE_LOD_BIAS:34045,TEXTURE_COMPARE_MODE:34892,TEXTURE_COMPARE_FUNC:34893,CURRENT_QUERY:34917,QUERY_RESULT:34918,QUERY_RESULT_AVAILABLE:34919,STREAM_READ:35041,STREAM_COPY:35042,STATIC_READ:35045,STATIC_COPY:35046,DYNAMIC_READ:35049,DYNAMIC_COPY:35050,MAX_DRAW_BUFFERS:34852,DRAW_BUFFER0:34853,DRAW_BUFFER1:34854,DRAW_BUFFER2:34855,DRAW_BUFFER3:34856,DRAW_BUFFER4:34857,DRAW_BUFFER5:34858,DRAW_BUFFER6:34859,DRAW_BUFFER7:34860,DRAW_BUFFER8:34861,DRAW_BUFFER9:34862,DRAW_BUFFER10:34863,DRAW_BUFFER11:34864,DRAW_BUFFER12:34865,DRAW_BUFFER13:34866,DRAW_BUFFER14:34867,DRAW_BUFFER15:34868,MAX_FRAGMENT_UNIFORM_COMPONENTS:35657,MAX_VERTEX_UNIFORM_COMPONENTS:35658,SAMPLER_3D:35679,SAMPLER_2D_SHADOW:35682,FRAGMENT_SHADER_DERIVATIVE_HINT:35723,PIXEL_PACK_BUFFER:35051,PIXEL_UNPACK_BUFFER:35052,PIXEL_PACK_BUFFER_BINDING:35053,PIXEL_UNPACK_BUFFER_BINDING:35055,FLOAT_MAT2x3:35685,FLOAT_MAT2x4:35686,FLOAT_MAT3x2:35687,FLOAT_MAT3x4:35688,FLOAT_MAT4x2:35689,FLOAT_MAT4x3:35690,SRGB:35904,SRGB8:35905,SRGB8_ALPHA8:35907,COMPARE_REF_TO_TEXTURE:34894,RGBA32F:34836,RGB32F:34837,RGBA16F:34842,RGB16F:34843,VERTEX_ATTRIB_ARRAY_INTEGER:35069,MAX_ARRAY_TEXTURE_LAYERS:35071,MIN_PROGRAM_TEXEL_OFFSET:35076,MAX_PROGRAM_TEXEL_OFFSET:35077,MAX_VARYING_COMPONENTS:35659,TEXTURE_2D_ARRAY:35866,TEXTURE_BINDING_2D_ARRAY:35869,R11F_G11F_B10F:35898,UNSIGNED_INT_10F_11F_11F_REV:35899,RGB9_E5:35901,UNSIGNED_INT_5_9_9_9_REV:35902,TRANSFORM_FEEDBACK_BUFFER_MODE:35967,MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS:35968,TRANSFORM_FEEDBACK_VARYINGS:35971,TRANSFORM_FEEDBACK_BUFFER_START:35972,TRANSFORM_FEEDBACK_BUFFER_SIZE:35973,TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN:35976,RASTERIZER_DISCARD:35977,MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS:35978,MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS:35979,INTERLEAVED_ATTRIBS:35980,SEPARATE_ATTRIBS:35981,TRANSFORM_FEEDBACK_BUFFER:35982,TRANSFORM_FEEDBACK_BUFFER_BINDING:35983,RGBA32UI:36208,RGB32UI:36209,RGBA16UI:36214,RGB16UI:36215,RGBA8UI:36220,RGB8UI:36221,RGBA32I:36226,RGB32I:36227,RGBA16I:36232,RGB16I:36233,RGBA8I:36238,RGB8I:36239,RED_INTEGER:36244,RGB_INTEGER:36248,RGBA_INTEGER:36249,SAMPLER_2D_ARRAY:36289,SAMPLER_2D_ARRAY_SHADOW:36292,SAMPLER_CUBE_SHADOW:36293,UNSIGNED_INT_VEC2:36294,UNSIGNED_INT_VEC3:36295,UNSIGNED_INT_VEC4:36296,INT_SAMPLER_2D:36298,INT_SAMPLER_3D:36299,INT_SAMPLER_CUBE:36300,INT_SAMPLER_2D_ARRAY:36303,UNSIGNED_INT_SAMPLER_2D:36306,UNSIGNED_INT_SAMPLER_3D:36307,UNSIGNED_INT_SAMPLER_CUBE:36308,UNSIGNED_INT_SAMPLER_2D_ARRAY:36311,DEPTH_COMPONENT32F:36012,DEPTH32F_STENCIL8:36013,FLOAT_32_UNSIGNED_INT_24_8_REV:36269,FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING:33296,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE:33297,FRAMEBUFFER_ATTACHMENT_RED_SIZE:33298,FRAMEBUFFER_ATTACHMENT_GREEN_SIZE:33299,FRAMEBUFFER_ATTACHMENT_BLUE_SIZE:33300,FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE:33301,FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE:33302,FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE:33303,FRAMEBUFFER_DEFAULT:33304,UNSIGNED_INT_24_8:34042,DEPTH24_STENCIL8:35056,UNSIGNED_NORMALIZED:35863,DRAW_FRAMEBUFFER_BINDING:36006,READ_FRAMEBUFFER:36008,DRAW_FRAMEBUFFER:36009,READ_FRAMEBUFFER_BINDING:36010,RENDERBUFFER_SAMPLES:36011,FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER:36052,MAX_COLOR_ATTACHMENTS:36063,COLOR_ATTACHMENT1:36065,COLOR_ATTACHMENT2:36066,COLOR_ATTACHMENT3:36067,COLOR_ATTACHMENT4:36068,COLOR_ATTACHMENT5:36069,COLOR_ATTACHMENT6:36070,COLOR_ATTACHMENT7:36071,COLOR_ATTACHMENT8:36072,COLOR_ATTACHMENT9:36073,COLOR_ATTACHMENT10:36074,COLOR_ATTACHMENT11:36075,COLOR_ATTACHMENT12:36076,COLOR_ATTACHMENT13:36077,COLOR_ATTACHMENT14:36078,COLOR_ATTACHMENT15:36079,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE:36182,MAX_SAMPLES:36183,HALF_FLOAT:5131,RG:33319,RG_INTEGER:33320,R8:33321,RG8:33323,R16F:33325,R32F:33326,RG16F:33327,RG32F:33328,R8I:33329,R8UI:33330,R16I:33331,R16UI:33332,R32I:33333,R32UI:33334,RG8I:33335,RG8UI:33336,RG16I:33337,RG16UI:33338,RG32I:33339,RG32UI:33340,VERTEX_ARRAY_BINDING:34229,R8_SNORM:36756,RG8_SNORM:36757,RGB8_SNORM:36758,RGBA8_SNORM:36759,SIGNED_NORMALIZED:36764,COPY_READ_BUFFER:36662,COPY_WRITE_BUFFER:36663,COPY_READ_BUFFER_BINDING:36662,COPY_WRITE_BUFFER_BINDING:36663,UNIFORM_BUFFER:35345,UNIFORM_BUFFER_BINDING:35368,UNIFORM_BUFFER_START:35369,UNIFORM_BUFFER_SIZE:35370,MAX_VERTEX_UNIFORM_BLOCKS:35371,MAX_FRAGMENT_UNIFORM_BLOCKS:35373,MAX_COMBINED_UNIFORM_BLOCKS:35374,MAX_UNIFORM_BUFFER_BINDINGS:35375,MAX_UNIFORM_BLOCK_SIZE:35376,MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS:35377,MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS:35379,UNIFORM_BUFFER_OFFSET_ALIGNMENT:35380,ACTIVE_UNIFORM_BLOCKS:35382,UNIFORM_TYPE:35383,UNIFORM_SIZE:35384,UNIFORM_BLOCK_INDEX:35386,UNIFORM_OFFSET:35387,UNIFORM_ARRAY_STRIDE:35388,UNIFORM_MATRIX_STRIDE:35389,UNIFORM_IS_ROW_MAJOR:35390,UNIFORM_BLOCK_BINDING:35391,UNIFORM_BLOCK_DATA_SIZE:35392,UNIFORM_BLOCK_ACTIVE_UNIFORMS:35394,UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES:35395,UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER:35396,UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER:35398,INVALID_INDEX:4294967295,MAX_VERTEX_OUTPUT_COMPONENTS:37154,MAX_FRAGMENT_INPUT_COMPONENTS:37157,MAX_SERVER_WAIT_TIMEOUT:37137,OBJECT_TYPE:37138,SYNC_CONDITION:37139,SYNC_STATUS:37140,SYNC_FLAGS:37141,SYNC_FENCE:37142,SYNC_GPU_COMMANDS_COMPLETE:37143,UNSIGNALED:37144,SIGNALED:37145,ALREADY_SIGNALED:37146,TIMEOUT_EXPIRED:37147,CONDITION_SATISFIED:37148,WAIT_FAILED:37149,SYNC_FLUSH_COMMANDS_BIT:1,VERTEX_ATTRIB_ARRAY_DIVISOR:35070,ANY_SAMPLES_PASSED:35887,ANY_SAMPLES_PASSED_CONSERVATIVE:36202,SAMPLER_BINDING:35097,RGB10_A2UI:36975,INT_2_10_10_10_REV:36255,TRANSFORM_FEEDBACK:36386,TRANSFORM_FEEDBACK_PAUSED:36387,TRANSFORM_FEEDBACK_ACTIVE:36388,TRANSFORM_FEEDBACK_BINDING:36389,TEXTURE_IMMUTABLE_FORMAT:37167,MAX_ELEMENT_INDEX:36203,TEXTURE_IMMUTABLE_LEVELS:33503,TIMEOUT_IGNORED:-1,MAX_CLIENT_WAIT_TIMEOUT_WEBGL:37447,QUERY_COUNTER_BITS_EXT:34916,TIME_ELAPSED_EXT:35007,TIMESTAMP_EXT:36392,GPU_DISJOINT_EXT:36795,TEXTURE_MAX_ANISOTROPY_EXT:34046,MAX_TEXTURE_MAX_ANISOTROPY_EXT:34047,UNMASKED_VENDOR_WEBGL:37445,UNMASKED_RENDERER_WEBGL:37446,COMPLETION_STATUS_KHR:37297,COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_EXT:33778,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_SRGB_S3TC_DXT1_EXT:35916,COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT:35917,COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT:35918,COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT:35919,COMPRESSED_R11_EAC:37488,COMPRESSED_SIGNED_R11_EAC:37489,COMPRESSED_RG11_EAC:37490,COMPRESSED_SIGNED_RG11_EAC:37491,COMPRESSED_RGB8_ETC2:37492,COMPRESSED_SRGB8_ETC2:37493,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:37494,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:37495,COMPRESSED_RGBA8_ETC2_EAC:37496,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:37497,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGBA_ASTC_4x4_KHR:37808,COMPRESSED_RGBA_ASTC_5x4_KHR:37809,COMPRESSED_RGBA_ASTC_5x5_KHR:37810,COMPRESSED_RGBA_ASTC_6x5_KHR:37811,COMPRESSED_RGBA_ASTC_6x6_KHR:37812,COMPRESSED_RGBA_ASTC_8x5_KHR:37813,COMPRESSED_RGBA_ASTC_8x6_KHR:37814,COMPRESSED_RGBA_ASTC_8x8_KHR:37815,COMPRESSED_RGBA_ASTC_10x5_KHR:37816,COMPRESSED_RGBA_ASTC_10x6_KHR:37817,COMPRESSED_RGBA_ASTC_10x8_KHR:37818,COMPRESSED_RGBA_ASTC_10x10_KHR:37819,COMPRESSED_RGBA_ASTC_12x10_KHR:37820,COMPRESSED_RGBA_ASTC_12x12_KHR:37821,COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:37840,COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:37841,COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:37842,COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:37843,COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:37844,COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:37845,COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:37846,COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:37847,COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:37848,COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:37849,COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:37850,COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:37851,COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:37852,COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:37853},Yt={[o.BYTE]:1,[o.UNSIGNED_BYTE]:1,[o.SHORT]:2,[o.UNSIGNED_SHORT]:2,[o.INT]:4,[o.UNSIGNED_INT]:4,[o.FLOAT]:4},bi={[o.R8]:[o.RED,o.UNSIGNED_BYTE],[o.R8_SNORM]:[o.RED,o.BYTE],[o.R16F]:[o.RED,o.FLOAT],[o.R32F]:[o.RED,o.FLOAT],[o.R8UI]:[o.RED_INTEGER,o.UNSIGNED_BYTE],[o.R8I]:[o.RED_INTEGER,o.BYTE],[o.R16UI]:[o.RED_INTEGER,o.UNSIGNED_SHORT],[o.R16I]:[o.RED_INTEGER,o.SHORT],[o.R32UI]:[o.RED_INTEGER,o.UNSIGNED_INT],[o.R32I]:[o.RED_INTEGER,o.INT],[o.RG8]:[o.RG,o.UNSIGNED_BYTE],[o.RG8_SNORM]:[o.RG,o.BYTE],[o.RG16F]:[o.RG,o.FLOAT],[o.RG32F]:[o.RG,o.FLOAT],[o.RG8UI]:[o.RG_INTEGER,o.UNSIGNED_BYTE],[o.RG8I]:[o.RG_INTEGER,o.BYTE],[o.RG16UI]:[o.RG_INTEGER,o.UNSIGNED_SHORT],[o.RG16I]:[o.RG_INTEGER,o.SHORT],[o.RG32UI]:[o.RG_INTEGER,o.UNSIGNED_INT],[o.RG32I]:[o.RG_INTEGER,o.INT],[o.RGB8]:[o.RGB,o.UNSIGNED_BYTE],[o.SRGB8]:[o.RGB,o.UNSIGNED_BYTE],[o.RGB565]:[o.RGB,o.UNSIGNED_SHORT_5_6_5],[o.RGB8_SNORM]:[o.RGB,o.BYTE],[o.R11F_G11F_B10F]:[o.RGB,o.UNSIGNED_INT_10F_11F_11F_REV],[o.RGB9_E5]:[o.RGB,o.UNSIGNED_INT_5_9_9_9_REV],[o.RGB16F]:[o.RGB,o.FLOAT],[o.RGB32F]:[o.RGB,o.FLOAT],[o.RGB8UI]:[o.RGB_INTEGER,o.UNSIGNED_BYTE],[o.RGB8I]:[o.RGB_INTEGER,o.BYTE],[o.RGB16UI]:[o.RGB_INTEGER,o.UNSIGNED_SHORT],[o.RGB16I]:[o.RGB_INTEGER,o.SHORT],[o.RGB32UI]:[o.RGB_INTEGER,o.UNSIGNED_INT],[o.RGB32I]:[o.RGB_INTEGER,o.INT],[o.RGBA8]:[o.RGBA,o.UNSIGNED_BYTE],[o.SRGB8_ALPHA8]:[o.RGBA,o.UNSIGNED_BYTE],[o.RGBA8_SNORM]:[o.RGBA,o.BYTE],[o.RGB5_A1]:[o.RGBA,o.UNSIGNED_SHORT_5_5_5_1],[o.RGBA4]:[o.RGBA,o.UNSIGNED_SHORT_4_4_4_4],[o.RGB10_A2]:[o.RGBA,o.UNSIGNED_INT_2_10_10_10_REV],[o.RGBA16F]:[o.RGBA,o.FLOAT],[o.RGBA32F]:[o.RGBA,o.FLOAT],[o.RGBA8UI]:[o.RGBA_INTEGER,o.UNSIGNED_BYTE],[o.RGBA8I]:[o.RGBA_INTEGER,o.BYTE],[o.RGB10_A2UI]:[o.RGBA_INTEGER,o.UNSIGNED_INT_2_10_10_10_REV],[o.RGBA16UI]:[o.RGBA_INTEGER,o.UNSIGNED_SHORT],[o.RGBA16I]:[o.RGBA_INTEGER,o.SHORT],[o.RGBA32I]:[o.RGBA_INTEGER,o.INT],[o.RGBA32UI]:[o.RGBA_INTEGER,o.UNSIGNED_INT],[o.DEPTH_COMPONENT16]:[o.DEPTH_COMPONENT,o.UNSIGNED_SHORT],[o.DEPTH_COMPONENT24]:[o.DEPTH_COMPONENT,o.UNSIGNED_INT],[o.DEPTH_COMPONENT32F]:[o.DEPTH_COMPONENT,o.FLOAT],[o.DEPTH24_STENCIL8]:[o.DEPTH_STENCIL,o.UNSIGNED_INT_24_8],[o.DEPTH32F_STENCIL8]:[o.DEPTH_STENCIL,o.FLOAT_32_UNSIGNED_INT_24_8_REV]},$t={[o.COMPRESSED_RGB_S3TC_DXT1_EXT]:!0,[o.COMPRESSED_RGBA_S3TC_DXT1_EXT]:!0,[o.COMPRESSED_RGBA_S3TC_DXT3_EXT]:!0,[o.COMPRESSED_RGBA_S3TC_DXT5_EXT]:!0,[o.COMPRESSED_SRGB_S3TC_DXT1_EXT]:!0,[o.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT]:!0,[o.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT]:!0,[o.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT]:!0,[o.COMPRESSED_R11_EAC]:!0,[o.COMPRESSED_SIGNED_R11_EAC]:!0,[o.COMPRESSED_RG11_EAC]:!0,[o.COMPRESSED_SIGNED_RG11_EAC]:!0,[o.COMPRESSED_RGB8_ETC2]:!0,[o.COMPRESSED_SRGB8_ETC2]:!0,[o.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2]:!0,[o.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2]:!0,[o.COMPRESSED_RGBA8_ETC2_EAC]:!0,[o.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC]:!0,[o.COMPRESSED_RGBA_ASTC_4x4_KHR]:!0,[o.COMPRESSED_RGBA_ASTC_5x4_KHR]:!0,[o.COMPRESSED_RGBA_ASTC_5x5_KHR]:!0,[o.COMPRESSED_RGBA_ASTC_6x5_KHR]:!0,[o.COMPRESSED_RGBA_ASTC_6x6_KHR]:!0,[o.COMPRESSED_RGBA_ASTC_8x5_KHR]:!0,[o.COMPRESSED_RGBA_ASTC_8x6_KHR]:!0,[o.COMPRESSED_RGBA_ASTC_8x8_KHR]:!0,[o.COMPRESSED_RGBA_ASTC_10x5_KHR]:!0,[o.COMPRESSED_RGBA_ASTC_10x6_KHR]:!0,[o.COMPRESSED_RGBA_ASTC_10x8_KHR]:!0,[o.COMPRESSED_RGBA_ASTC_10x10_KHR]:!0,[o.COMPRESSED_RGBA_ASTC_12x10_KHR]:!0,[o.COMPRESSED_RGBA_ASTC_12x12_KHR]:!0,[o.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR]:!0,[o.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR]:!0,[o.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR]:!0,[o.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR]:!0,[o.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR]:!0,[o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR]:!0,[o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR]:!0,[o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR]:!0,[o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR]:!0,[o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR]:!0,[o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR]:!0,[o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR]:!0,[o.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR]:!0,[o.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR]:!0,[o.COMPRESSED_RGB_PVRTC_4BPPV1_IMG]:!0,[o.COMPRESSED_RGB_PVRTC_2BPPV1_IMG]:!0,[o.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG]:!0,[o.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG]:!0},se={},qt=new Array(1),nt={},Fi={[o.UNSIGNED_BYTE]:{[o.RED]:o.R8,[o.RG]:o.RG8,[o.RGB]:o.RGB8,[o.RGBA]:o.RGBA8},[o.UNSIGNED_SHORT]:{[o.DEPTH_COMPONENT]:o.DEPTH_COMPONENT16},[o.FLOAT]:{[o.RED]:o.R16F,[o.RG]:o.RG16F,[o.RGB]:o.RGB16F,[o.RGBA]:o.RGBA16F,[o.DEPTH_COMPONENT]:o.DEPTH_COMPONENT32F}};class Ba{constructor(e,n,a){if(this.gl=e,this.texture=null,this.appState=n,this.compressed=$t[a.internalFormat],a.format!==void 0&&(console.warn("Cubemap option 'format' is deprecated and will be removed. Use 'internalFormat' with a sized format instead."),this.compressed=!!$t[a.format],a.type===void 0&&(a.type=a.format===o.DEPTH_COMPONENT?o.UNSIGNED_SHORT:o.UNSIGNED_BYTE),a.internalFormat===void 0&&(this.compressed?a.internalFormat=a.format:a.internalFormat=Fi[a.type][a.format])),this.compressed)this.internalFormat=a.internalFormat,this.format=a.internalFormat,this.type=o.UNSIGNED_BYTE;else{this.internalFormat=a.internalFormat!==void 0?a.internalFormat:o.RGBA8;let O=bi[this.internalFormat];this.format=O[0],this.type=a.type!==void 0?a.type:O[1]}this.currentUnit=-1;let u=Array.isArray(a.negX),g=u?a.negX[0]:a.negX,{width:R=g.width,height:t=g.height,flipY:h=!1,premultiplyAlpha:l=!1,minFilter:b=g?o.LINEAR_MIPMAP_NEAREST:o.NEAREST,magFilter:f=g?o.LINEAR:o.NEAREST,wrapS:y=o.REPEAT,wrapT:G=o.REPEAT,compareMode:m=o.NONE,compareFunc:X=o.LEQUAL,minLOD:M=null,maxLOD:V=null,baseLevel:H=null,maxLevel:F=null,maxAnisotropy:N=1}=a;this.width=R,this.height=t,this.flipY=h,this.premultiplyAlpha=l,this.minFilter=b,this.magFilter=f,this.wrapS=y,this.wrapT=G,this.compareMode=m,this.compareFunc=X,this.minLOD=M,this.maxLOD=V,this.baseLevel=H,this.maxLevel=F,this.maxAnisotropy=Math.min(N,se.MAX_TEXTURE_ANISOTROPY),this.mipmaps=b===o.LINEAR_MIPMAP_NEAREST||b===o.LINEAR_MIPMAP_LINEAR,this.miplevelsProvided=u&&a.negX.length>1,this.levels=this.mipmaps?Math.floor(Math.log2(Math.min(this.width,this.height)))+1:1,this.restore(a)}restore(e=nt){this.texture=this.gl.createTexture(),this.currentUnit!==-1&&(this.appState.textures[this.currentUnit]=null),this.bind(0),this.gl.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_MAG_FILTER,this.magFilter),this.gl.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_MIN_FILTER,this.minFilter),this.gl.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_WRAP_S,this.wrapS),this.gl.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_WRAP_T,this.wrapT),this.gl.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_COMPARE_FUNC,this.compareFunc),this.gl.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_COMPARE_MODE,this.compareMode),this.baseLevel!==null&&this.gl.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_BASE_LEVEL,this.baseLevel),this.maxLevel!==null&&this.gl.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_MAX_LEVEL,this.maxLevel),this.minLOD!==null&&this.gl.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_MIN_LOD,this.minLOD),this.maxLOD!==null&&this.gl.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_MAX_LOD,this.maxLOD),this.maxAnisotropy>1&&this.gl.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_MAX_ANISOTROPY_EXT,this.maxAnisotropy),this.gl.texStorage2D(o.TEXTURE_CUBE_MAP,this.levels,this.internalFormat,this.width,this.height);let{negX:n,posX:a,negY:u,posY:g,negZ:R,posZ:t}=e;return n&&(this.faceData(o.TEXTURE_CUBE_MAP_NEGATIVE_X,n),this.faceData(o.TEXTURE_CUBE_MAP_POSITIVE_X,a),this.faceData(o.TEXTURE_CUBE_MAP_NEGATIVE_Y,u),this.faceData(o.TEXTURE_CUBE_MAP_POSITIVE_Y,g),this.faceData(o.TEXTURE_CUBE_MAP_NEGATIVE_Z,R),this.faceData(o.TEXTURE_CUBE_MAP_POSITIVE_Z,t)),this.mipmaps&&!this.miplevelsProvided&&this.gl.generateMipmap(o.TEXTURE_CUBE_MAP),this}delete(){return this.texture&&(this.gl.deleteTexture(this.texture),this.texture=null,this.appState.textures[this.currentUnit]=null,this.currentUnit=-1),this}faceData(e,n){Array.isArray(n)||(qt[0]=n,n=qt);let a=this.mipmaps?n.length:1,u=this.width,g=this.height,R;if(this.gl.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,this.flipY),this.gl.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.premultiplyAlpha),this.compressed)for(R=0;R<a;++R)this.gl.compressedTexSubImage2D(e,R,0,0,u,g,this.format,n[R]),u=Math.max(u>>1,1),g=Math.max(g>>1,1);else for(R=0;R<a;++R)this.gl.texSubImage2D(e,R,0,0,u,g,this.format,this.type,n[R]),u=Math.max(u>>1,1),g=Math.max(g>>1,1);return this}bind(e){let n=this.appState.textures[e];return this.appState.activeTexture!==e&&(this.gl.activeTexture(o.TEXTURE0+e),this.appState.activeTexture=e),n!==this&&(n&&(n.currentUnit=-1),this.currentUnit!==-1&&(this.appState.textures[this.currentUnit]=null),this.gl.bindTexture(o.TEXTURE_CUBE_MAP,this.texture),this.appState.textures[e]=this,this.currentUnit=e),this}}class Ga{constructor(e,n,a,u=null,g){this.gl=e,this.currentProgram=a,this.drawPrimitive=o.TRIANGLES,this.currentVertexArray=u,this.currentTransformFeedback=null,this.appState=n,this.uniformIndices={},this.uniformNames=new Array(se.MAX_UNIFORMS),this.uniformValues=new Array(se.MAX_UNIFORMS),this.uniformCount=0,this.uniformBuffers=new Array(se.MAX_UNIFORM_BUFFERS),this.uniformBlockNames=new Array(se.MAX_UNIFORM_BUFFERS),this.uniformBlockCount=0,this.textures=new Array(se.MAX_TEXTURE_UNITS),this.textureCount=0,this.offsets=new Int32Array(1),this.numElements=new Int32Array(1),this.numInstances=new Int32Array(1),this.baseVertices=new Int32Array(1),this.baseInstances=new Uint32Array(1),this.hasBaseInstancesOrBaseVertices=!1,this.missingExtensionWarningDispatched=!1,this.numDraws=1,this.drawCountsFromVertexArray=!0,g!==void 0&&(console.warn("Primitive argument to 'App.createDrawCall' is deprecated and will be removed. Use 'DrawCall.primitive' instead."),this.primitive(g))}primitive(e){return this.drawPrimitive=e,this}transformFeedback(e){return this.currentTransformFeedback=e,this}uniform(e,n){let a=this.uniformIndices[e];return a===void 0&&(a=this.uniformCount++,this.uniformIndices[e]=a,this.uniformNames[a]=e),this.uniformValues[a]=n,this}texture(e,n){let a=this.currentProgram.samplers[e];return this.textures[a]=n,this}uniformBlock(e,n){let a=this.currentProgram.uniformBlocks[e];return this.uniformBuffers[a]=n,this}drawRanges(...e){this.numDraws=e.length,this.offsets.length<this.numDraws&&(this.offsets=new Int32Array(this.numDraws)),this.numElements.length<this.numDraws&&(this.numElements=new Int32Array(this.numDraws)),this.numInstances.length<this.numDraws&&(this.numInstances=new Int32Array(this.numDraws)),this.baseInstances.length<this.numDraws&&(this.baseInstances=new Uint32Array(this.numDraws)),this.baseVertices.length<this.numDraws&&(this.baseVertices=new Int32Array(this.numDraws));for(let n=0;n<this.numDraws;++n){let a=e[n];this.offsets[n]=a[0],this.numElements[n]=a[1],this.numInstances[n]=a[2]||1,this.baseInstances[n]=a[3]||0,this.baseVertices[n]=a[4]||0,this.hasBaseVertices=this.hasBaseVertices||this.baseVertices[n],this.hasBaseInstances=this.hasBaseInstances||this.baseInstances[n],this.hasBaseInstancesOrBaseVertices=this.hasBaseInstances||this.hasBaseVertices}return this.drawCountsFromVertexArray=!1,this}draw(){let e=this.uniformNames,n=this.uniformValues,a=this.uniformBuffers,u=this.currentProgram.uniformBlockCount,g=this.textures,R=this.currentProgram.samplerCount,t=!1;this.currentProgram.bind(),this.currentVertexArray&&(this.currentVertexArray.bind(),t=this.currentVertexArray.indexed,this.drawCountsFromVertexArray&&(this.numElements[0]=this.currentVertexArray.numElements,this.numInstances[0]=this.currentVertexArray.numInstances));for(let h=0;h<this.uniformCount;++h)this.currentProgram.uniform(e[h],n[h]);for(let h=0;h<u;++h)a[h].bind(h);for(let h=0;h<R;++h)g[h].bind(h);if(this.currentTransformFeedback?(this.currentTransformFeedback.bind(),this.gl.beginTransformFeedback(this.drawPrimitive)):this.appState.transformFeedback&&(this.gl.bindTransformFeedback(o.TRANSFORM_FEEDBACK,null),this.appState.transformFeedback=null),this.hasBaseInstancesOrBaseVertices&&!(se.DRAW_INSTANCED_BASE_VERTEX_BASE_INSTANCE||se.MULTI_DRAW_INSTANCED_BASE_VERTEX_BASE_INSTANCE)&&!this.missingExtensionWarningDispatched&&(console.warn("DrawCall.draw 'baseInstances' or 'baseVertices' have been set but supporting WebGL extensions are not available; Without 'WEBGL_multidraw_instanced_base_vertex_base_instance' or 'WEBGL_draw_instanced_base_vertex_base_instance' are needed for optimal performance."),this.missingExtensionWarningDispatched=!0),se.MULTI_DRAW_INSTANCED_BASE_VERTEX_BASE_INSTANCE){let h=this.appState.extensions.multiDrawInstancedBaseVertexBaseInstance;t?h.multiDrawElementsInstancedBaseVertexBaseInstanceWEBGL(this.drawPrimitive,this.numElements,0,this.currentVertexArray.indexType,this.offsets,0,this.numInstances,0,this.baseVertices,0,this.baseInstances,0,this.numDraws):h.multiDrawArraysInstancedBaseInstanceWEBGL(this.drawPrimitive,this.offsets,0,this.numElements,0,this.numInstances,0,this.baseInstances,0,this.numDraws)}else if(this.hasBaseInstancesOrBaseVertices&&se.DRAW_INSTANCED_BASE_VERTEX_BASE_INSTANCE){let h=this.appState.extensions.drawInstancedBaseVertexBaseInstance;if(t)for(let l=0;l<this.numDraws;++l)h.drawElementsInstancedBaseVertexBaseInstanceWEBGL(this.drawPrimitive,this.numElements[l],this.currentVertexArray.indexType,this.offsets[l],this.numInstances[l],this.baseVertices[l],this.baseInstances[l]);else for(let l=0;l<this.numDraws;++l)h.drawArraysInstancedBaseInstanceWEBGL(this.drawPrimitive,this.offsets[l],this.numElements[l],this.numInstances[l],this.baseInstances[l])}else if(se.MULTI_DRAW_INSTANCED&&!this.hasBaseInstancesOrBaseVertices){let h=this.appState.extensions.multiDrawInstanced;t?h.multiDrawElementsInstancedWEBGL(this.drawPrimitive,this.numElements,0,this.currentVertexArray.indexType,this.offsets,0,this.numInstances,0,this.numDraws):h.multiDrawArraysInstancedWEBGL(this.drawPrimitive,this.offsets,0,this.numElements,0,this.numInstances,0,this.numDraws)}else if(t)for(let h=0;h<this.numDraws;++h)this.hasBaseInstances&&this.currentVertexArray&&this.currentVertexArray.baseOffsetInstanceAttributeBuffers(this.baseInstances[h]),this.gl.drawElementsInstanced(this.drawPrimitive,this.numElements[h],this.currentVertexArray.indexType,this.offsets[h],this.numInstances[h]);else for(let h=0;h<this.numDraws;++h)this.hasBaseInstances&&this.currentVertexArray&&this.currentVertexArray.baseOffsetInstanceAttributeBuffers(this.baseInstances[h]),this.gl.drawArraysInstanced(this.drawPrimitive,this.offsets[h],this.numElements[h],this.numInstances[h]);return this.currentTransformFeedback&&this.gl.endTransformFeedback(),this}}class yt{constructor(e,n,a,u,g=u.width,R=u.height,t,h,l=nt){if(this.gl=e,this.binding=a,this.texture=null,this.width=g||0,this.height=R||0,this.depth=t||0,this.is3D=h,this.appState=n,this.compressed=!!$t[l.internalFormat],l.format!==void 0&&(console.warn("Texture option 'format' is deprecated and will be removed. Use 'internalFormat' with a sized format instead."),this.compressed=!!$t[l.format],l.type===void 0&&(l.type=l.format===o.DEPTH_COMPONENT?o.UNSIGNED_SHORT:o.UNSIGNED_BYTE),l.internalFormat===void 0&&(this.compressed?l.internalFormat=l.format:l.internalFormat=Fi[l.type][l.format])),this.compressed)this.internalFormat=l.internalFormat,this.format=this.internalFormat,this.type=o.UNSIGNED_BYTE;else{this.internalFormat=l.internalFormat!==void 0?l.internalFormat:o.RGBA8;let I=bi[this.internalFormat];this.format=I[0],this.type=l.type!==void 0?l.type:I[1]}this.currentUnit=-1;let{minFilter:b=u?o.LINEAR_MIPMAP_NEAREST:o.NEAREST,magFilter:f=u?o.LINEAR:o.NEAREST,wrapS:y=o.REPEAT,wrapT:G=o.REPEAT,wrapR:m=o.REPEAT,compareMode:X=o.NONE,compareFunc:M=o.LEQUAL,minLOD:V=null,maxLOD:H=null,baseLevel:F=null,maxLevel:N=null,maxAnisotropy:O=1,flipY:p=!1,premultiplyAlpha:A=!1}=l;this.minFilter=b,this.magFilter=f,this.wrapS=y,this.wrapT=G,this.wrapR=m,this.compareMode=X,this.compareFunc=M,this.minLOD=V,this.maxLOD=H,this.baseLevel=F,this.maxLevel=N,this.maxAnisotropy=Math.min(O,se.MAX_TEXTURE_ANISOTROPY),this.flipY=p,this.premultiplyAlpha=A,this.mipmaps=b===o.LINEAR_MIPMAP_NEAREST||b===o.LINEAR_MIPMAP_LINEAR,this.restore(u)}restore(e){return this.texture=null,this.resize(this.width,this.height,this.depth),e&&this.data(e),this}resize(e,n,a){if(a=a||0,this.texture&&e===this.width&&n===this.height&&a===this.depth)return this;this.gl.deleteTexture(this.texture),this.currentUnit!==-1&&(this.appState.textures[this.currentUnit]=null),this.texture=this.gl.createTexture(),this.bind(Math.max(this.currentUnit,0)),this.width=e,this.height=n,this.depth=a,this.gl.texParameteri(this.binding,o.TEXTURE_MIN_FILTER,this.minFilter),this.gl.texParameteri(this.binding,o.TEXTURE_MAG_FILTER,this.magFilter),this.gl.texParameteri(this.binding,o.TEXTURE_WRAP_S,this.wrapS),this.gl.texParameteri(this.binding,o.TEXTURE_WRAP_T,this.wrapT),this.gl.texParameteri(this.binding,o.TEXTURE_WRAP_R,this.wrapR),this.gl.texParameteri(this.binding,o.TEXTURE_COMPARE_FUNC,this.compareFunc),this.gl.texParameteri(this.binding,o.TEXTURE_COMPARE_MODE,this.compareMode),this.minLOD!==null&&this.gl.texParameterf(this.binding,o.TEXTURE_MIN_LOD,this.minLOD),this.maxLOD!==null&&this.gl.texParameterf(this.binding,o.TEXTURE_MAX_LOD,this.maxLOD),this.baseLevel!==null&&this.gl.texParameteri(this.binding,o.TEXTURE_BASE_LEVEL,this.baseLevel),this.maxLevel!==null&&this.gl.texParameteri(this.binding,o.TEXTURE_MAX_LEVEL,this.maxLevel),this.maxAnisotropy>1&&this.gl.texParameteri(this.binding,o.TEXTURE_MAX_ANISOTROPY_EXT,this.maxAnisotropy);let u;return this.is3D?(this.mipmaps?u=Math.floor(Math.log2(Math.max(Math.max(this.width,this.height),this.depth)))+1:u=1,this.gl.texStorage3D(this.binding,u,this.internalFormat,this.width,this.height,this.depth)):(this.mipmaps?u=Math.floor(Math.log2(Math.max(this.width,this.height)))+1:u=1,this.gl.texStorage2D(this.binding,u,this.internalFormat,this.width,this.height)),this}data(e){Array.isArray(e)||(qt[0]=e,e=qt);let n=this.mipmaps?e.length:1,a=this.width,u=this.height,g=this.depth,R=this.mipmaps&&e.length===1,t;if(this.bind(Math.max(this.currentUnit,0)),this.gl.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,this.flipY),this.gl.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.premultiplyAlpha),this.compressed)if(this.is3D)for(t=0;t<n;++t)this.gl.compressedTexSubImage3D(this.binding,t,0,0,0,a,u,g,this.format,e[t]),a=Math.max(a>>1,1),u=Math.max(u>>1,1),g=Math.max(g>>1,1);else for(t=0;t<n;++t)this.gl.compressedTexSubImage2D(this.binding,t,0,0,a,u,this.format,e[t]),a=Math.max(a>>1,1),u=Math.max(u>>1,1);else if(this.is3D)for(t=0;t<n;++t)this.gl.texSubImage3D(this.binding,t,0,0,0,a,u,g,this.format,this.type,e[t]),a=Math.max(a>>1,1),u=Math.max(u>>1,1),g=Math.max(g>>1,1);else for(t=0;t<n;++t)this.gl.texSubImage2D(this.binding,t,0,0,a,u,this.format,this.type,e[t]),a=Math.max(a>>1,1),u=Math.max(u>>1,1);return R&&this.gl.generateMipmap(this.binding),this}delete(){return this.texture&&(this.gl.deleteTexture(this.texture),this.texture=null,this.currentUnit!==-1&&this.appState.textures[this.currentUnit]===this&&(this.appState.textures[this.currentUnit]=null,this.currentUnit=-1)),this}bind(e){let n=this.appState.textures[e];return this.appState.activeTexture!==e&&(this.gl.activeTexture(o.TEXTURE0+e),this.appState.activeTexture=e),n!==this&&(n&&(n.currentUnit=-1),this.currentUnit!==-1&&(this.appState.textures[this.currentUnit]=null),this.gl.bindTexture(this.binding,this.texture),this.appState.textures[e]=this,this.currentUnit=e),this}}class zr{constructor(e,n,a,u,g=0){this.gl=e,this.renderbuffer=null,this.width=n,this.height=a,this.internalFormat=u,this.samples=g,this.restore()}restore(){return this.renderbuffer=this.gl.createRenderbuffer(),this.resize(this.width,this.height),this}resize(e,n){return this.width=e,this.height=n,this.gl.bindRenderbuffer(o.RENDERBUFFER,this.renderbuffer),this.gl.renderbufferStorageMultisample(o.RENDERBUFFER,this.samples,this.internalFormat,this.width,this.height),this.gl.bindRenderbuffer(o.RENDERBUFFER,null),this}delete(){return this.gl.deleteRenderbuffer(this.renderbuffer),this.renderbuffer=null,this}}class Va{constructor(e,n){this.gl=e,this.framebuffer=null,this.appState=n,this.numColorTargets=0,this.colorAttachments=[],this.colorAttachmentEnums=[],this.colorAttachmentTargets=[],this.depthAttachment=null,this.depthAttachmentTarget=null,this.width=0,this.height=0,this.restore()}restore(){let e=this.appState.framebuffers;for(let n in e)e[n]===this&&(e[n]=null);return this.framebuffer=this.gl.createFramebuffer(),this}colorTarget(e,n,a=n.is3D?0:o.TEXTURE_2D){if(e>=this.numColorTargets){let R=e+1;this.colorAttachmentEnums.length=R,this.colorAttachments.length=R,this.colorAttachmentTargets.length=R;for(let t=this.numColorTargets;t<R-1;++t)this.colorAttachmentEnums[t]=o.NONE,this.colorAttachments[t]=null,this.colorAttachmentTargets[t]=0;this.numColorTargets=R}this.colorAttachmentEnums[e]=o.COLOR_ATTACHMENT0+e,this.colorAttachments[e]=n,this.colorAttachmentTargets[e]=a;let u=this.bindAndCaptureState(),g=this.appState.drawFramebufferBinding;return n instanceof zr?this.gl.framebufferRenderbuffer(g,this.colorAttachmentEnums[e],o.RENDERBUFFER,n.renderbuffer):n.is3D?this.gl.framebufferTextureLayer(g,this.colorAttachmentEnums[e],n.texture,0,a):this.gl.framebufferTexture2D(g,this.colorAttachmentEnums[e],a,n.texture,0),this.gl.drawBuffers(this.colorAttachmentEnums),this.width=n.width,this.height=n.height,this.restoreState(u),this}depthTarget(e,n=e.is3D?0:o.TEXTURE_2D){let a=this.bindAndCaptureState(),u=this.appState.drawFramebufferBinding;return this.depthAttachment=e,this.depthAttachmentTarget=n,e instanceof zr?this.gl.framebufferRenderbuffer(u,o.DEPTH_ATTACHMENT,o.RENDERBUFFER,e.renderbuffer):e.is3D?this.gl.framebufferTextureLayer(u,o.DEPTH_ATTACHMENT,e.texture,0,n):this.gl.framebufferTexture2D(u,o.DEPTH_ATTACHMENT,n,e.texture,0),this.width=e.width,this.height=e.height,this.restoreState(a),this}resize(e=this.gl.drawingBufferWidth,n=this.gl.drawingBufferHeight){let a=this.bindAndCaptureState(),u=this.appState.drawFramebufferBinding;for(let g=0;g<this.numColorTargets;++g){let R=this.colorAttachments[g];R&&(R.resize(e,n),R instanceof yt&&(R.is3D?this.gl.framebufferTextureLayer(u,this.colorAttachmentEnums[g],R.texture,0,this.colorAttachmentTargets[g]):this.gl.framebufferTexture2D(u,this.colorAttachmentEnums[g],this.colorAttachmentTargets[g],R.texture,0)))}return this.depthAttachment&&(this.depthAttachment.resize(e,n),this.depthAttachment instanceof yt&&(this.depthAttachment.is3D?this.gl.framebufferTextureLayer(u,o.DEPTH_ATTACHMENT,this.depthAttachment.texture,0,this.depthAttachmentTarget):this.gl.framebufferTexture2D(u,o.DEPTH_ATTACHMENT,this.depthAttachmentTarget,this.depthAttachment.texture,0))),this.width=e,this.height=n,this.restoreState(a),this}delete(){if(this.framebuffer){this.gl.deleteFramebuffer(this.framebuffer),this.framebuffer=null;let e=this.appState.framebuffers;for(let n in e)e[n]===this&&(this.gl.bindFramebuffer(n,null),e[n]=null)}return this}getStatus(){let e=this.bindAndCaptureState(),n=this.appState.drawFramebufferBinding,a=this.gl.checkFramebufferStatus(n);return this.restoreState(e),a}bindForDraw(){let e=this.appState.drawFramebufferBinding,n=this.appState.framebuffers;return n[e]!==this&&(this.gl.bindFramebuffer(e,this.framebuffer),n[e]=this),this}bindForRead(){let e=this.appState.readFramebufferBinding,n=this.appState.framebuffers;return n[e]!==this&&(this.gl.bindFramebuffer(e,this.framebuffer),n[e]=this),this}bindAndCaptureState(){let e=this.appState.drawFramebufferBinding,n=this.appState.framebuffers[e];return n!==this&&this.gl.bindFramebuffer(e,this.framebuffer),n}restoreState(e){if(e!==this){let n=this.appState.drawFramebufferBinding;this.gl.bindFramebuffer(n,e?e.framebuffer:null)}return this}get colorTextures(){return console.error("Framebuffer.colorTextures is deprecated and will be removed. Please use Framebuffer.colorAttachments."),this.colorAttachments}get depthTexture(){return console.error("Framebuffer.depthTexture is deprecated and will be removed. Please use Framebuffer.depthAttachment."),this.depthAttachment}}class vt{constructor(e,n,a,u){this.gl=e,this.appState=n,this.shader=null,this.type=a,this.source=u.trim(),this.restore()}restore(){return this.shader=this.gl.createShader(this.type),this.gl.shaderSource(this.shader,this.source),this.gl.compileShader(this.shader),this}translatedSource(){return se.DEBUG_SHADERS?this.appState.extensions.debugShaders.getTranslatedShaderSource(this.shader):"(Unavailable)"}delete(){return this.shader&&(this.gl.deleteShader(this.shader),this.shader=null),this}checkCompilation(){if(!this.gl.getShaderParameter(this.shader,o.COMPILE_STATUS)){let e,n;for(console.error(this.gl.getShaderInfoLog(this.shader)),n=this.source.split(`
`),e=0;e<n.length;++e)console.error(`${e+1}: ${n[e]}`)}return this}}const ce={};ce[o.BOOL]="uniform1i";ce[o.INT]="uniform1i";ce[o.SAMPLER_2D]="uniform1i";ce[o.INT_SAMPLER_2D]="uniform1i";ce[o.UNSIGNED_INT_SAMPLER_2D]="uniform1i";ce[o.SAMPLER_2D_SHADOW]="uniform1i";ce[o.SAMPLER_2D_ARRAY]="uniform1i";ce[o.INT_SAMPLER_2D_ARRAY]="uniform1i";ce[o.UNSIGNED_INT_SAMPLER_2D_ARRAY]="uniform1i";ce[o.SAMPLER_2D_ARRAY_SHADOW]="uniform1i";ce[o.SAMPLER_CUBE]="uniform1i";ce[o.INT_SAMPLER_CUBE]="uniform1i";ce[o.UNSIGNED_INT_SAMPLER_CUBE]="uniform1i";ce[o.SAMPLER_CUBE_SHADOW]="uniform1i";ce[o.SAMPLER_3D]="uniform1i";ce[o.INT_SAMPLER_3D]="uniform1i";ce[o.UNSIGNED_INT_SAMPLER_3D]="uniform1i";ce[o.UNSIGNED_INT]="uniform1ui";ce[o.FLOAT]="uniform1f";ce[o.FLOAT_VEC2]="uniform2f";ce[o.FLOAT_VEC3]="uniform3f";ce[o.FLOAT_VEC4]="uniform4f";ce[o.INT_VEC2]="uniform2i";ce[o.INT_VEC3]="uniform3i";ce[o.INT_VEC4]="uniform4i";ce[o.UNSIGNED_INT_VEC2]="uniform2ui";ce[o.UNSIGNED_INT_VEC3]="uniform3ui";ce[o.UNSIGNED_INT_VEC4]="uniform4ui";ce[o.BOOL_VEC2]="uniform2i";ce[o.BOOL_VEC3]="uniform3i";ce[o.BOOL_VEC4]="uniform4i";ce[o.FLOAT_MAT2]="uniformMatrix2fv";ce[o.FLOAT_MAT3]="uniformMatrix3fv";ce[o.FLOAT_MAT4]="uniformMatrix4fv";ce[o.FLOAT_MAT2x3]="uniformMatrix2x3fv";ce[o.FLOAT_MAT2x4]="uniformMatrix2x4fv";ce[o.FLOAT_MAT3x2]="uniformMatrix3x2fv";ce[o.FLOAT_MAT3x4]="uniformMatrix3x4fv";ce[o.FLOAT_MAT4x2]="uniformMatrix4x2fv";ce[o.FLOAT_MAT4x3]="uniformMatrix4x3fv";const ue={};ue[o.BOOL]=1;ue[o.INT]=1;ue[o.SAMPLER_2D]=1;ue[o.INT_SAMPLER_2D]=1;ue[o.UNSIGNED_INT_SAMPLER_2D]=1;ue[o.SAMPLER_2D_SHADOW]=1;ue[o.SAMPLER_2D_ARRAY]=1;ue[o.INT_SAMPLER_2D_ARRAY]=1;ue[o.UNSIGNED_INT_SAMPLER_2D_ARRAY]=1;ue[o.SAMPLER_2D_ARRAY_SHADOW]=1;ue[o.SAMPLER_CUBE]=1;ue[o.INT_SAMPLER_CUBE]=1;ue[o.UNSIGNED_INT_SAMPLER_CUBE]=1;ue[o.SAMPLER_CUBE_SHADOW]=1;ue[o.SAMPLER_3D]=1;ue[o.INT_SAMPLER_3D]=1;ue[o.UNSIGNED_INT_SAMPLER_3D]=1;ue[o.UNSIGNED_INT]=1;ue[o.FLOAT]=1;ue[o.FLOAT_VEC2]=2;ue[o.FLOAT_VEC3]=3;ue[o.FLOAT_VEC4]=4;ue[o.INT_VEC2]=2;ue[o.INT_VEC3]=3;ue[o.INT_VEC4]=4;ue[o.UNSIGNED_INT_VEC2]=2;ue[o.UNSIGNED_INT_VEC3]=3;ue[o.UNSIGNED_INT_VEC4]=4;ue[o.BOOL_VEC2]=2;ue[o.BOOL_VEC3]=3;ue[o.BOOL_VEC4]=4;ue[o.FLOAT_MAT2]=4;ue[o.FLOAT_MAT3]=9;ue[o.FLOAT_MAT4]=16;ue[o.FLOAT_MAT2x3]=6;ue[o.FLOAT_MAT2x4]=8;ue[o.FLOAT_MAT3x2]=6;ue[o.FLOAT_MAT3x4]=12;ue[o.FLOAT_MAT4x2]=8;ue[o.FLOAT_MAT4x3]=12;const Ee={};Ee[o.INT]=Int32Array;Ee[o.SAMPLER_2D]=Int32Array;Ee[o.INT_SAMPLER_2D]=Int32Array;Ee[o.UNSIGNED_INT_SAMPLER_2D]=Int32Array;Ee[o.SAMPLER_2D_SHADOW]=Int32Array;Ee[o.SAMPLER_2D_ARRAY]=Int32Array;Ee[o.INT_SAMPLER_2D_ARRAY]=Int32Array;Ee[o.UNSIGNED_INT_SAMPLER_2D_ARRAY]=Int32Array;Ee[o.SAMPLER_2D_ARRAY_SHADOW]=Int32Array;Ee[o.SAMPLER_CUBE]=Int32Array;Ee[o.INT_SAMPLER_CUBE]=Int32Array;Ee[o.UNSIGNED_INT_SAMPLER_CUBE]=Int32Array;Ee[o.SAMPLER_CUBE_SHADOW]=Int32Array;Ee[o.SAMPLER_3D]=Int32Array;Ee[o.INT_SAMPLER_3D]=Int32Array;Ee[o.UNSIGNED_INT_SAMPLER_3D]=Int32Array;Ee[o.UNSIGNED_INT]=Uint32Array;Ee[o.FLOAT]=Float32Array;Ee[o.FLOAT_VEC2]=Float32Array;Ee[o.FLOAT_VEC3]=Float32Array;Ee[o.FLOAT_VEC4]=Float32Array;Ee[o.INT_VEC2]=Int32Array;Ee[o.INT_VEC3]=Int32Array;Ee[o.INT_VEC4]=Int32Array;Ee[o.UNSIGNED_INT_VEC2]=Uint32Array;Ee[o.UNSIGNED_INT_VEC3]=Uint32Array;Ee[o.UNSIGNED_INT_VEC4]=Uint32Array;class Cn{constructor(e,n,a){this.gl=e,this.handle=n,this.glFuncName=ce[a],this.cache=a===o.BOOL?!1:0}set(e){this.cache!==e&&(this.gl[this.glFuncName](this.handle,e),this.cache=e)}}class xn{constructor(e,n,a,u){this.gl=e,this.handle=n,this.glFuncName=ce[a]+"v",this.count=u,this.cache=new Ee[a](ue[a]*u)}set(e){for(let n=0,a=e.length;n<a;++n)if(this.cache[n]!==e[n]){this.gl[this.glFuncName](this.handle,e),this.cache.set(e);return}}}class Un{constructor(e,n,a,u){this.gl=e,this.handle=n,this.glFuncName=ce[a]+"v",this.count=u,this.cache=new Array(ue[a]*u).fill(!1)}set(e){for(let n=0,a=e.length;n<a;++n)if(this.cache[n]!==e[n]){this.gl[this.glFuncName](this.handle,e);for(let u=n;u<a;u++)this.cache[u]=e[u];return}}}class Ha{constructor(e,n,a,u){this.gl=e,this.handle=n,this.glFuncName=ce[a],this.count=u,this.cache=new Float32Array(ue[a]*u)}set(e){for(let n=0,a=e.length;n<a;++n)if(this.cache[n]!==e[n]){this.gl[this.glFuncName](this.handle,!1,e),this.cache.set(e);return}}}class Dn{constructor(e,n,a,u,g,R,t){this.gl=e,this.appState=n,this.program=null,this.transformFeedbackVaryings=g||null,this.transformFeedbackMode=t||o.SEPARATE_ATTRIBS,this.attributeLocations=R||null,this.uniforms={},this.uniformBlocks={},this.uniformBlockCount=0,this.samplers={},this.samplerCount=0,this.vertexSource=null,this.vertexShader=null,this.fragmentSource=null,this.fragmentShader=null,this.linked=!1,typeof a=="string"?this.vertexSource=a:this.vertexShader=a,typeof u=="string"?this.fragmentSource=u:this.fragmentShader=u,this.initialize()}restore(){return this.initialize(),this.link(),this.checkLinkage(),this}translatedVertexSource(){if(this.vertexShader)return this.vertexShader.translatedSource();{let e=new vt(this.gl,this.appState,o.VERTEX_SHADER,this.vertexSource),n=e.translatedSource();return e.delete(),n}}translatedFragmentSource(){if(this.fragmentShader)return this.fragmentShader.translatedSource();{let e=new vt(this.gl,this.appState,o.FRAGMENT_SHADER,this.fragmentSource),n=e.translatedSource();return e.delete(),n}}delete(){return this.program&&(this.gl.deleteProgram(this.program),this.program=null,this.appState.program===this&&(this.gl.useProgram(null),this.appState.program=null)),this}initialize(){return this.appState.program===this&&(this.gl.useProgram(null),this.appState.program=null),this.linked=!1,this.uniformBlockCount=0,this.samplerCount=0,this.vertexSource&&(this.vertexShader=new vt(this.gl,this.appState,o.VERTEX_SHADER,this.vertexSource)),this.fragmentSource&&(this.fragmentShader=new vt(this.gl,this.appState,o.FRAGMENT_SHADER,this.fragmentSource)),this.program=this.gl.createProgram(),this}link(){if(this.gl.attachShader(this.program,this.vertexShader.shader),this.gl.attachShader(this.program,this.fragmentShader.shader),this.transformFeedbackVaryings&&this.gl.transformFeedbackVaryings(this.program,this.transformFeedbackVaryings,this.transformFeedbackMode),this.attributeLocations)for(let e in this.attributeLocations)this.gl.bindAttribLocation(this.program,this.attributeLocations[e],e);return this.gl.linkProgram(this.program),this}checkCompletion(){return se.PARALLEL_SHADER_COMPILE?this.gl.getProgramParameter(this.program,o.COMPLETION_STATUS_KHR):!0}checkLinkage(){return this.linked?this:(this.gl.getProgramParameter(this.program,o.LINK_STATUS)?(this.linked=!0,this.initVariables()):(console.error(this.gl.getProgramInfoLog(this.program)),this.vertexShader.checkCompilation(),this.fragmentShader.checkCompilation()),this.vertexSource&&(this.vertexShader.delete(),this.vertexShader=null),this.fragmentSource&&(this.fragmentShader.delete(),this.fragmentShader=null),this)}initVariables(){this.bind();let e=this.gl.getProgramParameter(this.program,o.ACTIVE_UNIFORMS),n;for(let u=0;u<e;++u){let g=this.gl.getActiveUniform(this.program,u),R=this.gl.getUniformLocation(this.program,g.name),t=null,h=g.type,l=g.size;switch(h){case o.SAMPLER_2D:case o.INT_SAMPLER_2D:case o.UNSIGNED_INT_SAMPLER_2D:case o.SAMPLER_2D_SHADOW:case o.SAMPLER_2D_ARRAY:case o.INT_SAMPLER_2D_ARRAY:case o.UNSIGNED_INT_SAMPLER_2D_ARRAY:case o.SAMPLER_2D_ARRAY_SHADOW:case o.SAMPLER_CUBE:case o.INT_SAMPLER_CUBE:case o.UNSIGNED_INT_SAMPLER_CUBE:case o.SAMPLER_CUBE_SHADOW:case o.SAMPLER_3D:case o.INT_SAMPLER_3D:case o.UNSIGNED_INT_SAMPLER_3D:n=this.samplerCount++,this.samplers[g.name]=n,this.gl.uniform1i(R,n);break;case o.INT:case o.UNSIGNED_INT:case o.FLOAT:t=l>1?xn:Cn;break;case o.BOOL:t=l>1?Un:Cn;break;case o.FLOAT_VEC2:case o.INT_VEC2:case o.UNSIGNED_INT_VEC2:case o.FLOAT_VEC3:case o.INT_VEC3:case o.UNSIGNED_INT_VEC3:case o.FLOAT_VEC4:case o.INT_VEC4:case o.UNSIGNED_INT_VEC4:t=xn;break;case o.BOOL_VEC2:case o.BOOL_VEC3:case o.BOOL_VEC4:t=Un;break;case o.FLOAT_MAT2:case o.FLOAT_MAT3:case o.FLOAT_MAT4:case o.FLOAT_MAT2x3:case o.FLOAT_MAT2x4:case o.FLOAT_MAT3x2:case o.FLOAT_MAT3x4:case o.FLOAT_MAT4x2:case o.FLOAT_MAT4x3:t=Ha;break;default:console.error("Unrecognized type for uniform ",g.name);break}t&&(this.uniforms[g.name]=new t(this.gl,R,h,l))}let a=this.gl.getProgramParameter(this.program,o.ACTIVE_UNIFORM_BLOCKS);for(let u=0;u<a;++u){let g=this.gl.getActiveUniformBlockName(this.program,u),R=this.gl.getUniformBlockIndex(this.program,g),t=this.uniformBlockCount++;this.gl.uniformBlockBinding(this.program,R,t),this.uniformBlocks[g]=t}}uniform(e,n){return this.uniforms[e]&&this.uniforms[e].set(n),this}bind(){return this.appState.program!==this&&(this.gl.useProgram(this.program),this.appState.program=this),this}}class Li{constructor(e,n){this.gl=e,this.query=null,this.target=n,this.active=!1,this.result=null,this.restore()}restore(){return this.query=this.gl.createQuery(),this.active=!1,this.result=null,this}begin(){return this.active||(this.gl.beginQuery(this.target,this.query),this.result=null),this}end(){return this.active||(this.gl.endQuery(this.target),this.active=!0),this}ready(){return this.active&&this.gl.getQueryParameter(this.query,o.QUERY_RESULT_AVAILABLE)?(this.active=!1,this.result=Number(this.gl.getQueryParameter(this.query,o.QUERY_RESULT)),!0):!1}delete(){return this.query&&(this.gl.deleteQuery(this.query),this.query=null),this}}class ka{constructor(e){this.gl=e,this.cpuTimer=window.performance||window.Date,this.gpuTimerQuery=null,this.cpuStartTime=0,this.cpuTime=0,this.gpuTime=0,this.restore()}restore(){return se.GPU_TIMER&&(this.gpuTimerQuery?this.gpuTimerQuery.restore():this.gpuTimerQuery=new Li(this.gl,o.TIME_ELAPSED_EXT)),this.cpuStartTime=0,this.cpuTime=0,this.gpuTime=0,this}start(){return se.GPU_TIMER?this.gpuTimerQuery.active||(this.gpuTimerQuery.begin(),this.cpuStartTime=this.cpuTimer.now()):this.cpuStartTime=this.cpuTimer.now(),this}end(){return se.GPU_TIMER?this.gpuTimerQuery.active||(this.gpuTimerQuery.end(),this.cpuTime=this.cpuTimer.now()-this.cpuStartTime):this.cpuTime=this.cpuTimer.now()-this.cpuStartTime,this}ready(){if(se.GPU_TIMER){if(!this.gpuTimerQuery.active)return!1;var e=this.gpuTimerQuery.ready(),n=this.gl.getParameter(o.GPU_DISJOINT_EXT);return e&&!n?(this.gpuTime=this.gpuTimerQuery.result/1e6,!0):!1}else return!!this.cpuStartTime}delete(){return this.gpuTimerQuery&&(this.gpuTimerQuery.delete(),this.gpuTimerQuery=null),this}}class Xa{constructor(e,n){this.gl=e,this.appState=n,this.transformFeedback=null,this.restore()}restore(){return this.appState.transformFeedback===this&&(this.appState.transformFeedback=null),this.transformFeedback=this.gl.createTransformFeedback(),this}feedbackBuffer(e,n){return this.gl.bindTransformFeedback(o.TRANSFORM_FEEDBACK,this.transformFeedback),this.gl.bindBufferBase(o.TRANSFORM_FEEDBACK_BUFFER,e,n.buffer),this.gl.bindTransformFeedback(o.TRANSFORM_FEEDBACK,null),this.gl.bindBufferBase(o.TRANSFORM_FEEDBACK_BUFFER,e,null),this}delete(){return this.transformFeedback&&(this.gl.deleteTransformFeedback(this.transformFeedback),this.transformFeedback=null,this.appState.transformFeedback===this&&(this.gl.bindTransformFeedback(o.TRANSFORM_FEEDBACK,null),this.appState.transformFeedback=null)),this}bind(){return this.appState.transformFeedback!==this&&(this.gl.bindTransformFeedback(o.TRANSFORM_FEEDBACK,this.transformFeedback),this.appState.transformFeedback=this),this}}class Wa{constructor(e,n,a,u=e.DYNAMIC_DRAW){this.gl=e,this.buffer=null,this.dataViews={},this.offsets=new Array(a.length),this.sizes=new Array(a.length),this.types=new Array(a.length),this.size=0,this.usage=u,this.appState=n,this.currentBase=-1;for(let g=0,R=a.length;g<R;++g){let t=a[g];switch(t){case o.FLOAT:case o.INT:case o.UNSIGNED_INT:case o.BOOL:this.offsets[g]=this.size,this.sizes[g]=1,t===o.INT?this.types[g]=o.INT:t===o.UNSIGNED_INT?this.types[g]=o.UNSIGNED_INT:this.types[g]=o.FLOAT,this.size++;break;case o.FLOAT_VEC2:case o.INT_VEC2:case o.UNSIGNED_INT_VEC2:case o.BOOL_VEC2:this.size+=this.size%2,this.offsets[g]=this.size,this.sizes[g]=2,t===o.INT_VEC2?this.types[g]=o.INT:t===o.UNSIGNED_INT_VEC2?this.types[g]=o.UNSIGNED_INT:this.types[g]=o.FLOAT,this.size+=2;break;case o.FLOAT_VEC3:case o.INT_VEC3:case o.UNSIGNED_INT_VEC3:case o.BOOL_VEC3:case o.FLOAT_VEC4:case o.INT_VEC4:case o.UNSIGNED_INT_VEC4:case o.BOOL_VEC4:this.size+=(4-this.size%4)%4,this.offsets[g]=this.size,this.sizes[g]=4,t===o.INT_VEC4||t===o.INT_VEC3?this.types[g]=o.INT:t===o.UNSIGNED_INT_VEC4||t===o.UNSIGNED_INT_VEC3?this.types[g]=o.UNSIGNED_INT:this.types[g]=o.FLOAT,this.size+=4;break;case o.FLOAT_MAT2:case o.FLOAT_MAT2x3:case o.FLOAT_MAT2x4:this.size+=(4-this.size%4)%4,this.offsets[g]=this.size,this.sizes[g]=8,this.types[g]=o.FLOAT,this.size+=8;break;case o.FLOAT_MAT3:case o.FLOAT_MAT3x2:case o.FLOAT_MAT3x4:this.size+=(4-this.size%4)%4,this.offsets[g]=this.size,this.sizes[g]=12,this.types[g]=o.FLOAT,this.size+=12;break;case o.FLOAT_MAT4:case o.FLOAT_MAT4x2:case o.FLOAT_MAT4x3:this.size+=(4-this.size%4)%4,this.offsets[g]=this.size,this.sizes[g]=16,this.types[g]=o.FLOAT,this.size+=16;break;default:console.error("Unsupported type for uniform buffer.")}}this.size+=(4-this.size%4)%4,this.data=new Float32Array(this.size),this.dataViews[o.FLOAT]=this.data,this.dataViews[o.INT]=new Int32Array(this.data.buffer),this.dataViews[o.UNSIGNED_INT]=new Uint32Array(this.data.buffer),this.dirtyStart=this.size,this.dirtyEnd=0,this.restore()}restore(){return this.currentBase!==-1&&this.appState.uniformBuffers[this.currentBase]===this&&(this.appState.uniformBuffers[this.currentBase]=null),this.buffer=this.gl.createBuffer(),this.gl.bindBuffer(o.UNIFORM_BUFFER,this.buffer),this.gl.bufferData(o.UNIFORM_BUFFER,this.size*4,this.usage),this.gl.bindBuffer(o.UNIFORM_BUFFER,null),this}set(e,n){let a=this.dataViews[this.types[e]],u=this.offsets[e],g=this.sizes[e];return this.sizes[e]===1?a[u]=n:a.set(n,u),u<this.dirtyStart&&(this.dirtyStart=u),this.dirtyEnd<u+g&&(this.dirtyEnd=u+g),this}update(){if(this.dirtyStart>=this.dirtyEnd)return this;let e=this.data.subarray(this.dirtyStart,this.dirtyEnd),n=this.dirtyStart*4;return this.gl.bindBuffer(this.gl.UNIFORM_BUFFER,this.buffer),this.gl.bufferSubData(this.gl.UNIFORM_BUFFER,n,e),this.gl.bindBuffer(this.gl.UNIFORM_BUFFER,null),this.dirtyStart=this.size,this.dirtyEnd=0,this}delete(){return this.buffer&&(this.gl.deleteBuffer(this.buffer),this.buffer=null,this.currentBase!==-1&&this.appState.uniformBuffers[this.currentBase]===this&&(this.appState.uniformBuffers[this.currentBase]=null),this.currentBase=-1),this}bind(e){let n=this.appState.uniformBuffers[e];return n!==this&&(n&&(n.currentBase=-1),this.currentBase!==-1&&(this.appState.uniformBuffers[this.currentBase]=null),this.gl.bindBufferBase(this.gl.UNIFORM_BUFFER,e,this.buffer),this.appState.uniformBuffers[e]=this,this.currentBase=e),this}}class Ya{constructor(e,n){this.gl=e,this.appState=n,this.vertexArray=null,this.indexType=null,this.indexed=!1,this.numElements=0,this.numInstances=1,this.offsets=0,this.numDraws=1,this.instanceAttributeBuffers={}}restore(){return this.appState.vertexArray===this&&(this.appState.vertexArray=null),this.vertexArray!==null&&(this.vertexArray=this.gl.createVertexArray()),this}vertexAttributeBuffer(e,n,a=nt){return this.attributeBuffer(e,n,a,!1),this}instanceAttributeBuffer(e,n,a=nt){return this.attributeBuffer(e,n,a,!0),this.instanceAttributeBuffers[e]={vertexBuffer:n,options:a},this}baseOffsetInstanceAttributeBuffers(e=0){Object.entries(this.instanceAttributeBuffers).forEach(([n,{vertexBuffer:a,options:u}])=>{this.attributeBuffer(Number(n),a,u,!0,e)})}indexBuffer(e){return this.vertexArray===null&&(this.vertexArray=this.gl.createVertexArray()),this.bind(),this.gl.bindBuffer(o.ELEMENT_ARRAY_BUFFER,e.buffer),this.numElements=e.numItems*3,this.indexType=e.type,this.indexed=!0,this}delete(){return this.vertexArray&&(this.gl.deleteVertexArray(this.vertexArray),this.vertexArray=null,this.appState.vertexArray===this&&(this.gl.bindVertexArray(null),this.appState.vertexArray=null)),this}bind(){return this.appState.vertexArray!==this&&(this.gl.bindVertexArray(this.vertexArray),this.appState.vertexArray=this),this}attributeBuffer(e,n,a={},u,g=0){this.vertexArray===null&&(this.vertexArray=this.gl.createVertexArray()),this.bind(),this.gl.bindBuffer(o.ARRAY_BUFFER,n.buffer);let{type:R=n.type,size:t=n.itemSize,stride:h=0,offset:l=0,normalized:b=!1,integer:f=!!(n.integer&&!b)}=a,y=n.numColumns;h===0&&(h=y*t*Yt[R]);let G=Math.ceil((n.byteLength-l)/h);for(let m=0;m<y;++m)f?this.gl.vertexAttribIPointer(e+m,t,R,h,l+m*t*Yt[R]+g*h):this.gl.vertexAttribPointer(e+m,t,R,b,h,l+m*t*Yt[R]+g*h),u&&this.gl.vertexAttribDivisor(e+m,1),this.gl.enableVertexAttribArray(e+m);return this.numDraws===1&&(u?this.numInstances=G:this.indexed||(this.numElements=G)),this.gl.bindBuffer(o.ARRAY_BUFFER,null),this}}const za={[o.BYTE]:!0,[o.UNSIGNED_BYTE]:!0,[o.SHORT]:!0,[o.UNSIGNED_SHORT]:!0,[o.INT]:!0,[o.UNSIGNED_INT]:!0};class Vt{constructor(e,n,a,u,g,R=e.STATIC_DRAW,t){let h;switch(a){case o.FLOAT_MAT4:case o.FLOAT_MAT4x2:case o.FLOAT_MAT4x3:h=4;break;case o.FLOAT_MAT3:case o.FLOAT_MAT3x2:case o.FLOAT_MAT3x4:h=3;break;case o.FLOAT_MAT2:case o.FLOAT_MAT2x3:case o.FLOAT_MAT2x4:h=2;break;default:h=1}switch(a){case o.FLOAT_MAT4:case o.FLOAT_MAT3x4:case o.FLOAT_MAT2x4:u=4,a=o.FLOAT;break;case o.FLOAT_MAT3:case o.FLOAT_MAT4x3:case o.FLOAT_MAT2x3:u=3,a=o.FLOAT;break;case o.FLOAT_MAT2:case o.FLOAT_MAT3x2:case o.FLOAT_MAT4x2:u=2,a=o.FLOAT;break}let l,b;typeof g=="number"?(l=g,a&&(g*=Yt[a]),b=g):(l=g.length,b=g.byteLength),this.gl=e,this.buffer=null,this.appState=n,this.type=a,this.itemSize=u,this.numItems=a?l/(u*h):b/u,this.numColumns=h,this.byteLength=b,this.usage=R,this.indexArray=!!t,this.integer=!!za[this.type],this.binding=this.indexArray?o.ELEMENT_ARRAY_BUFFER:o.ARRAY_BUFFER,this.restore(g)}restore(e){return e||(e=this.byteLength),this.appState.vertexArray&&(this.gl.bindVertexArray(null),this.appState.vertexArray=null),this.buffer=this.gl.createBuffer(),this.gl.bindBuffer(this.binding,this.buffer),this.gl.bufferData(this.binding,e,this.usage),this.gl.bindBuffer(this.binding,null),this}data(e,n=0){return this.appState.vertexArray&&(this.gl.bindVertexArray(null),this.appState.vertexArray=null),this.gl.bindBuffer(this.binding,this.buffer),this.gl.bufferSubData(this.binding,n,e),this.gl.bindBuffer(this.binding,null),this}delete(){return this.buffer&&(this.gl.deleteBuffer(this.buffer),this.buffer=null),this}}class ja{constructor(e){this.gl=e,this.canvas=e.canvas,this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this.viewportX=0,this.viewportY=0,this.viewportWidth=0,this.viewportHeight=0,this.currentDrawCalls=null,this.emptyFragmentShader=null,this.state={program:null,vertexArray:null,transformFeedback:null,activeTexture:-1,textures:new Array(se.MAX_TEXTURE_UNITS),uniformBuffers:new Array(se.MAX_UNIFORM_BUFFERS),freeUniformBufferBases:[],framebuffers:{},drawFramebufferBinding:o.DRAW_FRAMEBUFFER,readFramebufferBinding:o.READ_FRAMEBUFFER,extensions:{}},this.clearBits=this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT|this.gl.STENCIL_BUFFER_BIT,this.cpuTime=0,this.gpuTime=0,this.viewport(0,0,this.width,this.height),this.contextLostExt=null,this.contextLostListener=null,this.contextRestoredListener=null,this.contextRestoredHandler=null,this.initExtensions()}loseContext(){return this.contextLostExt&&this.contextLostExt.loseContext(),this}restoreContext(){return this.contextLostExt&&this.contextLostExt.restoreContext(),this}onContextRestored(e){return this.contextRestoredHandler=e,this.initContextListeners(),this}enable(e){return this.gl.enable(e),this}disable(e){return this.gl.disable(e),this}colorMask(e,n,a,u){return this.gl.colorMask(e,n,a,u),this}clearColor(e,n,a,u){return this.gl.clearColor(e,n,a,u),this}clearMask(e){return this.clearBits=e,this}clear(){return this.gl.clear(this.clearBits),this}drawFramebuffer(e){return e.bindForDraw(),this}readFramebuffer(e){return e.bindForRead(),this}defaultDrawFramebuffer(){let e=this.state.drawFramebufferBinding;return this.state.framebuffers[e]!==null&&(this.gl.bindFramebuffer(e,null),this.state.framebuffers[e]=null),this}defaultReadFramebuffer(){let e=this.state.readFramebufferBinding;return this.state.framebuffers[e]!==null&&(this.gl.bindFramebuffer(e,null),this.state.framebuffers[e]=null),this}blitFramebuffer(e,n=nt){let a=this.state.readFramebufferBinding,u=this.state.drawFramebufferBinding,g=this.state.framebuffers[a],R=this.state.framebuffers[u],t=g?g.width:this.width,h=g?g.height:this.height,l=R?R.width:this.width,b=R?R.height:this.height,{srcStartX:f=0,srcStartY:y=0,srcEndX:G=t,srcEndY:m=h,dstStartX:X=0,dstStartY:M=0,dstEndX:V=l,dstEndY:H=b,filter:F=o.NEAREST}=n;return this.gl.blitFramebuffer(f,y,G,m,X,M,V,H,e,F),this}depthRange(e,n){return this.gl.depthRange(e,n),this}depthMask(e){return this.gl.depthMask(e),this}depthFunc(e){return this.gl.depthFunc(e),this}blendFunc(e,n){return this.gl.blendFunc(e,n),this}blendFuncSeparate(e,n,a,u){return this.gl.blendFuncSeparate(e,n,a,u),this}blendEquation(e){return this.gl.blendEquation(e),this}stencilMask(e){return this.gl.stencilMask(e),this}stencilMaskSeparate(e,n){return this.gl.stencilMaskSeparate(e,n),this}stencilFunc(e,n,a){return this.gl.stencilFunc(e,n,a),this}stencilFuncSeparate(e,n,a,u){return this.gl.stencilFuncSeparate(e,n,a,u),this}stencilOp(e,n,a){return this.gl.stencilOp(e,n,a),this}stencilOpSeparate(e,n,a,u){return this.gl.stencilOpSeparate(e,n,a,u),this}scissor(e,n,a,u){return this.gl.scissor(e,n,a,u),this}polygonOffset(e,n){return this.gl.polygonOffset(e,n),this}readPixel(e,n,a,u=nt){let{format:g=o.RGBA,type:R=o.UNSIGNED_BYTE}=u;return this.gl.readPixels(e,n,1,1,g,R,a),this}viewport(e,n,a,u){return(this.viewportWidth!==a||this.viewportHeight!==u||this.viewportX!==e||this.viewportY!==n)&&(this.viewportX=e,this.viewportY=n,this.viewportWidth=a,this.viewportHeight=u,this.gl.viewport(e,n,this.viewportWidth,this.viewportHeight)),this}defaultViewport(){return this.viewport(0,0,this.width,this.height),this}resize(e,n){return this.canvas.width=e,this.canvas.height=n,this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this.viewport(0,0,this.width,this.height),this}createProgram(e,n,a={}){let{transformFeedbackVaryings:u,attributeLocations:g,transformFeedbackMode:R}=a;return new Dn(this.gl,this.state,e,n,u,g,R).link().checkLinkage()}createPrograms(...e){return new Promise((n,a)=>{let u=e.length,g=new Array(u),R=new Array(u),t=u;for(let l=0;l<u;++l){let b=e[l],f=b[0],y=b[1],G=b[2]||{},{transformFeedbackVaryings:m,attributeLocations:X,transformFeedbackMode:M}=G;g[l]=new Dn(this.gl,this.state,f,y,m,X,M),R[l]=g[l]}for(let l=0;l<u;++l)g[l].link();let h=()=>{let l=0;for(let b=0;b<t;++b)if(R[b].checkCompletion())if(R[b].checkLinkage(),R[b].linked)++l;else{a(new Error("Program linkage failed"));return}else R[b-l]=R[b];t-=l,t===0?n(g):requestAnimationFrame(h)};h()})}restorePrograms(...e){return new Promise((n,a)=>{let u=e.length,g=e.slice(),R=u;for(let h=0;h<u;++h)e[h].initialize();for(let h=0;h<u;++h)e[h].link();for(let h=0;h<u;++h)e[h].checkCompletion();let t=()=>{let h=0;for(let l=0;l<R;++l)if(g[l].checkCompletion())if(g[l].checkLinkage(),g[l].linked)++h;else{a(new Error("Program linkage failed"));return}else g[l-h]=g[l];R-=h,R===0?n():requestAnimationFrame(t)};t()})}createShader(e,n){return new vt(this.gl,this.state,e,n)}createVertexArray(){return new Ya(this.gl,this.state)}createTransformFeedback(){return new Xa(this.gl,this.state)}createVertexBuffer(e,n,a,u){return new Vt(this.gl,this.state,e,n,a,u)}createMatrixBuffer(e,n,a){return new Vt(this.gl,this.state,e,0,n,a)}createInterleavedBuffer(e,n,a){return new Vt(this.gl,this.state,null,e,n,a)}createIndexBuffer(e,n,a,u){return ArrayBuffer.isView(n)&&(u=a,a=n,n=3),new Vt(this.gl,this.state,e,n,a,u,!0)}createUniformBuffer(e,n){return new Wa(this.gl,this.state,e,n)}createTexture2D(e,n,a,u){return typeof e=="number"?(u=a,a=n,n=e,e=null):a===void 0&&(u=n,n=e.width,a=e.height),new yt(this.gl,this.state,this.gl.TEXTURE_2D,e,n,a,void 0,!1,u)}createTextureArray(e,n,a,u,g){return typeof e=="number"&&(g=u,u=a,a=n,n=e,e=null),new yt(this.gl,this.state,this.gl.TEXTURE_2D_ARRAY,e,n,a,u,!0,g)}createTexture3D(e,n,a,u,g){return typeof e=="number"&&(g=u,u=a,a=n,n=e,e=null),new yt(this.gl,this.state,this.gl.TEXTURE_3D,e,n,a,u,!0,g)}createCubemap(e){return new Ba(this.gl,this.state,e)}createRenderbuffer(e,n,a,u=0){return new zr(this.gl,e,n,a,u)}createFramebuffer(){return new Va(this.gl,this.state)}createQuery(e){return new Li(this.gl,e)}createTimer(){return new ka(this.gl)}createDrawCall(e,n,a){return new Ga(this.gl,this.state,e,n,a)}initExtensions(){this.gl.getExtension("EXT_color_buffer_float"),this.gl.getExtension("OES_texture_float_linear"),this.gl.getExtension("WEBGL_compressed_texture_s3tc"),this.gl.getExtension("WEBGL_compressed_texture_s3tc_srgb"),this.gl.getExtension("WEBGL_compressed_texture_etc"),this.gl.getExtension("WEBGL_compressed_texture_astc"),this.gl.getExtension("WEBGL_compressed_texture_pvrtc"),this.gl.getExtension("EXT_disjoint_timer_query_webgl2"),this.gl.getExtension("EXT_disjoint_timer_query"),this.gl.getExtension("EXT_texture_filter_anisotropic"),this.state.extensions.debugShaders=this.gl.getExtension("WEBGL_debug_shaders"),this.contextLostExt=this.gl.getExtension("WEBGL_lose_context"),this.gl.getExtension("KHR_parallel_shader_compile"),this.state.extensions.multiDrawInstanced=this.gl.getExtension("WEBGL_multi_draw_instanced"),this.state.extensions.drawInstancedBaseVertexBaseInstance=this.gl.getExtension("WEBGL_draw_instanced_base_vertex_base_instance"),this.state.extensions.multiDrawInstancedBaseVertexBaseInstance=this.gl.getExtension("WEBGL_multi_draw_instanced_base_vertex_base_instance")}initContextListeners(){this.contextRestoredHandler?(this.contextLostListener=e=>{e.preventDefault()},this.contextRestoredListener=()=>{this.initExtensions(),this.contextRestoredHandler()},this.canvas.addEventListener("webglcontextlost",this.contextLostListener),this.canvas.addEventListener("webglcontextrestored",this.contextRestoredListener)):(this.canvas.removeEventListener("webglcontextlost",this.contextLostListener),this.canvas.removeEventListener("webglcontextrestored",this.contextRestoredListener),this.contextLostListener=null,this.contextRestoredListener=null)}depthTest(){return console.warn("App.depthTest is deprecated. Use App.enable(PicoGL.DEPTH_TEST) instead."),this.enable(o.DEPTH_TEST),this}noDepthTest(){return console.warn("App.noDepthTest is deprecated. Use App.disable(PicoGL.DEPTH_TEST) instead."),this.disable(o.DEPTH_TEST),this}blend(){return console.warn("App.blend is deprecated. Use App.enable(PicoGL.BLEND) instead."),this.enable(o.BLEND),this}noBlend(){return console.warn("App.noBlend is deprecated. Use App.disable(PicoGL.BLEND) instead."),this.disable(o.BLEND),this}stencilTest(){return console.warn("App.stencilTest is deprecated. Use App.enable(PicoGL.STENCIL_TEST) instead."),this.enable(o.STENCIL_TEST),this}noStencilTest(){return console.warn("App.noStencilTest is deprecated. Use App.disable(PicoGL.STENCIL_TEST) instead."),this.disable(o.STENCIL_TEST),this}scissorTest(){return console.warn("App.scissorTest is deprecated. Use App.enable(PicoGL.SCISSOR_TEST) instead."),this.enable(o.SCISSOR_TEST),this}noScissorTest(){return console.warn("App.noScissorTest is deprecated. Use App.disable(PicoGL.SCISSOR_TEST) instead."),this.disable(o.SCISSOR_TEST),this}rasterize(){return console.warn("App.noRasterize is deprecated. Use App.disable(PicoGL.RASTERIZER_DISCARD) instead."),this.disable(o.RASTERIZER_DISCARD),this}noRasterize(){return console.warn("App.rasterize is deprecated. Use App.enable(PicoGL.RASTERIZER_DISCARD) instead."),this.enable(o.RASTERIZER_DISCARD),this}cullBackfaces(){return console.warn("App.cullBackfaces is deprecated. Use App.enable(PicoGL.CULL_FACE) instead."),this.enable(o.CULL_FACE),this}drawBackfaces(){return console.warn("App.drawBackfaces is deprecated. Use App.disable(PicoGL.CULL_FACE) instead."),this.disable(o.CULL_FACE),this}}let wn=!1;const oe=Object.assign({version:"0.17.9",WEBGL_INFO:se,createApp(r,e){return r.tagName==="CANVAS"&&(r=r.getContext("webgl2",e)),wn||(se.MAX_TEXTURE_UNITS=r.getParameter(o.MAX_COMBINED_TEXTURE_IMAGE_UNITS),se.MAX_UNIFORM_BUFFERS=r.getParameter(o.MAX_UNIFORM_BUFFER_BINDINGS),se.MAX_UNIFORMS=Math.min(r.getParameter(o.MAX_VERTEX_UNIFORM_VECTORS),r.getParameter(o.MAX_FRAGMENT_UNIFORM_VECTORS)),se.SAMPLES=r.getParameter(o.SAMPLES),se.VENDOR="(Unknown)",se.RENDERER="(Unknown)",se.FLOAT_RENDER_TARGETS=!!r.getExtension("EXT_color_buffer_float"),se.LINEAR_FLOAT_TEXTURES=!!r.getExtension("OES_texture_float_linear"),se.S3TC_TEXTURES=!!r.getExtension("WEBGL_compressed_texture_s3tc"),se.S3TC_SRGB_TEXTURES=!!r.getExtension("WEBGL_compressed_texture_s3tc_srgb"),se.ETC_TEXTURES=!!r.getExtension("WEBGL_compressed_texture_etc"),se.ASTC_TEXTURES=!!r.getExtension("WEBGL_compressed_texture_astc"),se.PVRTC_TEXTURES=!!r.getExtension("WEBGL_compressed_texture_pvrtc"),se.LOSE_CONTEXT=!!r.getExtension("WEBGL_lose_context"),se.DEBUG_SHADERS=!!r.getExtension("WEBGL_debug_shaders"),se.GPU_TIMER=!!(r.getExtension("EXT_disjoint_timer_query_webgl2")||r.getExtension("EXT_disjoint_timer_query")),se.TEXTURE_ANISOTROPY=!!r.getExtension("EXT_texture_filter_anisotropic"),se.MAX_TEXTURE_ANISOTROPY=se.TEXTURE_ANISOTROPY?r.getParameter(o.MAX_TEXTURE_MAX_ANISOTROPY_EXT):1,se.DEBUG_RENDERER_INFO=!!r.getExtension("WEBGL_debug_renderer_info"),se.DEBUG_RENDERER_INFO&&(se.VENDOR=r.getParameter(o.UNMASKED_VENDOR_WEBGL),se.RENDERER=r.getParameter(o.UNMASKED_RENDERER_WEBGL)),se.PARALLEL_SHADER_COMPILE=!!r.getExtension("KHR_parallel_shader_compile"),se.MULTI_DRAW_INSTANCED=!!r.getExtension("WEBGL_multi_draw_instanced"),se.DRAW_INSTANCED_BASE_VERTEX_BASE_INSTANCE=!!r.getExtension("WEBGL_draw_instanced_base_vertex_base_instance"),se.MULTI_DRAW_INSTANCED_BASE_VERTEX_BASE_INSTANCE=!!r.getExtension("WEBGL_multi_draw_instanced_base_vertex_base_instance"),wn=!0),new ja(r)}},o);var xe=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Ka(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var le={},$a={get exports(){return le},set exports(r){le=r}},Zt={},qa={get exports(){return Zt},set exports(r){Zt=r}},Mn;function Za(){return Mn||(Mn=1,function(r,e){(function(n,a){r.exports=a()})(xe,function(){var n={isEqual:!0,isMatchingKey:!0,isPromise:!0,maxSize:!0,onCacheAdd:!0,onCacheChange:!0,onCacheHit:!0,transformKey:!0},a=Array.prototype.slice;function u(f){var y=f.length;return y?y===1?[f[0]]:y===2?[f[0],f[1]]:y===3?[f[0],f[1],f[2]]:a.call(f,0):[]}function g(f){var y={};for(var G in f)n[G]||(y[G]=f[G]);return y}function R(f){return typeof f=="function"&&f.isMemoized}function t(f,y){return f===y||f!==f&&y!==y}function h(f,y){var G={};for(var m in f)G[m]=f[m];for(var m in y)G[m]=y[m];return G}var l=function(){function f(y){this.keys=[],this.values=[],this.options=y;var G=typeof y.isMatchingKey=="function";G?this.getKeyIndex=this._getKeyIndexFromMatchingKey:y.maxSize>1?this.getKeyIndex=this._getKeyIndexForMany:this.getKeyIndex=this._getKeyIndexForSingle,this.canTransformKey=typeof y.transformKey=="function",this.shouldCloneArguments=this.canTransformKey||G,this.shouldUpdateOnAdd=typeof y.onCacheAdd=="function",this.shouldUpdateOnChange=typeof y.onCacheChange=="function",this.shouldUpdateOnHit=typeof y.onCacheHit=="function"}return Object.defineProperty(f.prototype,"size",{get:function(){return this.keys.length},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"snapshot",{get:function(){return{keys:u(this.keys),size:this.size,values:u(this.values)}},enumerable:!1,configurable:!0}),f.prototype._getKeyIndexFromMatchingKey=function(y){var G=this.options,m=G.isMatchingKey,X=G.maxSize,M=this.keys,V=M.length;if(!V)return-1;if(m(M[0],y))return 0;if(X>1){for(var H=1;H<V;H++)if(m(M[H],y))return H}return-1},f.prototype._getKeyIndexForMany=function(y){var G=this.options.isEqual,m=this.keys,X=m.length;if(!X)return-1;if(X===1)return this._getKeyIndexForSingle(y);var M=y.length,V,H;if(M>1){for(var F=0;F<X;F++)if(V=m[F],V.length===M){for(H=0;H<M&&G(V[H],y[H]);H++);if(H===M)return F}}else for(var F=0;F<X;F++)if(V=m[F],V.length===M&&G(V[0],y[0]))return F;return-1},f.prototype._getKeyIndexForSingle=function(y){var G=this.keys;if(!G.length)return-1;var m=G[0],X=m.length;if(y.length!==X)return-1;var M=this.options.isEqual;if(X>1){for(var V=0;V<X;V++)if(!M(m[V],y[V]))return-1;return 0}return M(m[0],y[0])?0:-1},f.prototype.orderByLru=function(y,G,m){for(var X=this.keys,M=this.values,V=X.length,H=m;H--;)X[H+1]=X[H],M[H+1]=M[H];X[0]=y,M[0]=G;var F=this.options.maxSize;V===F&&m===V?(X.pop(),M.pop()):m>=F&&(X.length=M.length=F)},f.prototype.updateAsyncCache=function(y){var G=this,m=this.options,X=m.onCacheChange,M=m.onCacheHit,V=this.keys[0],H=this.values[0];this.values[0]=H.then(function(F){return G.shouldUpdateOnHit&&M(G,G.options,y),G.shouldUpdateOnChange&&X(G,G.options,y),F},function(F){var N=G.getKeyIndex(V);throw N!==-1&&(G.keys.splice(N,1),G.values.splice(N,1)),F})},f}();function b(f,y){if(y===void 0&&(y={}),R(f))return b(f.fn,h(f.options,y));if(typeof f!="function")throw new TypeError("You must pass a function to `memoize`.");var G=y.isEqual,m=G===void 0?t:G,X=y.isMatchingKey,M=y.isPromise,V=M===void 0?!1:M,H=y.maxSize,F=H===void 0?1:H,N=y.onCacheAdd,O=y.onCacheChange,p=y.onCacheHit,A=y.transformKey,I=h({isEqual:m,isMatchingKey:X,isPromise:V,maxSize:F,onCacheAdd:N,onCacheChange:O,onCacheHit:p,transformKey:A},g(y)),P=new l(I),U=P.keys,c=P.values,E=P.canTransformKey,_=P.shouldCloneArguments,i=P.shouldUpdateOnAdd,s=P.shouldUpdateOnChange,d=P.shouldUpdateOnHit,T=function(){var L=_?u(arguments):arguments;E&&(L=A(L));var C=U.length?P.getKeyIndex(L):-1;if(C!==-1)d&&p(P,I,T),C&&(P.orderByLru(U[C],c[C],C),s&&O(P,I,T));else{var Y=f.apply(this,arguments),v=_?L:u(arguments);P.orderByLru(v,Y,U.length),V&&P.updateAsyncCache(T),i&&N(P,I,T),s&&O(P,I,T)}return c[0]};return T.cache=P,T.fn=f,T.isMemoized=!0,T.options=I,T}return b})}(qa)),Zt}var St={},Ja={get exports(){return St},set exports(r){St=r}},Bn;function Qa(){return Bn||(Bn=1,function(r,e){(function(n,a){a(e)})(xe,function(n){var a=typeof WeakMap=="function",u=Object.keys;function g(c,E){return c===E||c!==c&&E!==E}function R(c){return c.constructor===Object||c.constructor==null}function t(c){return!!c&&typeof c.then=="function"}function h(c){return!!(c&&c.$$typeof)}function l(){var c=[];return{delete:function(E){for(var _=0;_<c.length;++_)if(c[_][0]===E){c.splice(_,1);return}},get:function(E){for(var _=0;_<c.length;++_)if(c[_][0]===E)return c[_][1]},set:function(E,_){for(var i=0;i<c.length;++i)if(c[i][0]===E){c[i][1]=_;return}c.push([E,_])}}}var b=function(c){return c?function(){return new WeakMap}:l}(a);function f(c){return function(_){var i=c||_;return function(d,T,L,C,Y,v,S){S===void 0&&(S=b());var w=!!d&&typeof d=="object",k=!!T&&typeof T=="object";if(w!==k)return!1;if(!w&&!k)return i(d,T,S);var q=S.get(d);if(q&&S.get(T))return q===T;S.set(d,T),S.set(T,d);var W=i(d,T,S);return S.delete(d),S.delete(T),W}}}function y(c,E,_,i){var s=c.length;if(E.length!==s)return!1;for(;s-- >0;)if(!_(c[s],E[s],s,s,c,E,i))return!1;return!0}function G(c,E,_,i){var s=c.size===E.size;if(s&&c.size){var d={},T=0;c.forEach(function(L,C){if(s){var Y=!1,v=0;E.forEach(function(S,w){!Y&&!d[v]&&(Y=_(C,w,T,v,c,E,i)&&_(L,S,C,w,c,E,i),Y&&(d[v]=!0)),v++}),T++,s=Y}})}return s}var m="_owner",X=Function.prototype.bind.call(Function.prototype.call,Object.prototype.hasOwnProperty);function M(c,E,_,i){var s=u(c),d=s.length;if(u(E).length!==d)return!1;if(d)for(var T=void 0;d-- >0;){if(T=s[d],T===m){var L=h(c),C=h(E);if((L||C)&&L!==C)return!1}if(!X(E,T)||!_(c[T],E[T],T,T,c,E,i))return!1}return!0}var V=function(){return/foo/g.flags==="g"?function(E,_){return E.source===_.source&&E.flags===_.flags}:function(E,_){return E.source===_.source&&E.global===_.global&&E.ignoreCase===_.ignoreCase&&E.multiline===_.multiline&&E.unicode===_.unicode&&E.sticky===_.sticky&&E.lastIndex===_.lastIndex}}();function H(c,E,_,i){var s=c.size===E.size;if(s&&c.size){var d={};c.forEach(function(T,L){if(s){var C=!1,Y=0;E.forEach(function(v,S){!C&&!d[Y]&&(C=_(T,v,L,S,c,E,i),C&&(d[Y]=!0)),Y++}),s=C}})}return s}var F=typeof Map=="function",N=typeof Set=="function",O=Object.prototype.valueOf;function p(c){var E=typeof c=="function"?c(_):function(i,s,d,T,L,C,Y){return _(i,s,Y)};function _(i,s,d){if(i===s)return!0;if(i&&s&&typeof i=="object"&&typeof s=="object"){if(R(i)&&R(s))return M(i,s,E,d);var T=Array.isArray(i),L=Array.isArray(s);return T||L?T===L&&y(i,s,E,d):(T=i instanceof Date,L=s instanceof Date,T||L?T===L&&g(i.getTime(),s.getTime()):(T=i instanceof RegExp,L=s instanceof RegExp,T||L?T===L&&V(i,s):t(i)||t(s)?i===s:F&&(T=i instanceof Map,L=s instanceof Map,T||L)?T===L&&G(i,s,E,d):N&&(T=i instanceof Set,L=s instanceof Set,T||L)?T===L&&H(i,s,E,d):i.valueOf!==O||s.valueOf!==O?g(i.valueOf(),s.valueOf()):M(i,s,E,d)))}return i!==i&&s!==s}return _}var A=p(),I=p(function(){return g}),P=p(f()),U=p(f(g));n.circularDeepEqual=P,n.circularShallowEqual=U,n.createCustomEqual=p,n.deepEqual=A,n.sameValueZeroEqual=g,n.shallowEqual=I,Object.defineProperty(n,"__esModule",{value:!0})})}(Ja,St)),St}(function(r,e){(function(n,a){r.exports=a(Za(),Qa())})(xe,function(n,a){function u(){return u=Object.assign?Object.assign.bind():function(D){for(var B=1;B<arguments.length;B++){var z=arguments[B];for(var Q in z)Object.prototype.hasOwnProperty.call(z,Q)&&(D[Q]=z[Q])}return D},u.apply(this,arguments)}function g(D,B){if(D==null)return{};var z={},Q=Object.keys(D),re,te;for(te=0;te<Q.length;te++)re=Q[te],!(B.indexOf(re)>=0)&&(z[re]=D[re]);return z}var R={isDeepEqual:!1,isPromise:!1,isReact:!1,isSerialized:!1,isShallowEqual:!1,matchesArg:void 0,matchesKey:void 0,maxAge:void 0,maxArgs:void 0,maxSize:1,onExpire:void 0,profileName:void 0,serializer:void 0,updateCacheForKey:void 0,transformArgs:void 0,updateExpire:!1};function t(){for(var D=arguments.length,B=new Array(D),z=0;z<D;z++)B[z]=arguments[z];return B.reduce(function(Q,re){if(typeof Q=="function")return typeof re=="function"?function(){Q.apply(this,arguments),re.apply(this,arguments)}:Q;if(typeof re=="function")return re})}function h(){for(var D=arguments.length,B=new Array(D),z=0;z<D;z++)B[z]=arguments[z];return B.reduce(function(Q,re){if(typeof Q=="function")return typeof re=="function"?function(){return Q(re.apply(this,arguments))}:Q;if(typeof re=="function")return re})}function l(D,B){for(var z=0;z<D.length;z++)if(D[z].key===B)return z;return-1}function b(D,B){var z=typeof B=="function"?B:function(Q,re){for(var te=0;te<re.length;te++)if(!D(Q[te],re[te]))return!1;return!0};return function(Q,re){for(var te=0;te<Q.length;te++)if(Q[te].length===re.length&&z(Q[te],re))return te;return-1}}function f(D,B){return!B||B===R?D:u({},D,B,{onCacheAdd:t(D.onCacheAdd,B.onCacheAdd),onCacheChange:t(D.onCacheChange,B.onCacheChange),onCacheHit:t(D.onCacheHit,B.onCacheHit),transformArgs:h(D.transformArgs,B.transformArgs)})}function y(D){return typeof D=="function"&&D.isMoized}function G(D,B,z){try{var Q=z||B||"anonymous";Object.defineProperty(D,"name",{configurable:!0,enumerable:!1,value:"moized("+Q+")",writable:!0})}catch{}}function m(D,B,z){var Q=l(D,B);Q!==-1&&(clearTimeout(D[Q].timeoutId),z&&D.splice(Q,1))}function X(D,B){var z=setTimeout(D,B);return typeof z.unref=="function"&&z.unref(),z}function M(D,B,z,Q){var re=B.maxAge;return function te(ee,ae,fe){var _e=ee.keys[0];if(l(D,_e)===-1){var de=function(){var pe=b(z,Q),ve=pe(ee.keys,_e),Fe=ee.values[ve];~ve&&(ee.keys.splice(ve,1),ee.values.splice(ve,1),typeof B.onCacheChange=="function"&&B.onCacheChange(ee,ae,fe)),m(D,_e,!0),typeof B.onExpire=="function"&&B.onExpire(_e)===!1&&(ee.keys.unshift(_e),ee.values.unshift(Fe),te(ee,ae,fe),typeof B.onCacheChange=="function"&&B.onCacheChange(ee,ae,fe))};D.push({expirationMethod:de,key:_e,timeoutId:X(de,re)})}}}function V(D,B){return function(Q){var re=Q.keys[0],te=l(D,re);~te&&(m(D,re,!1),D[te].timeoutId=X(D[te].expirationMethod,B.maxAge))}}function H(D,B,z,Q){var re=typeof B.maxAge=="number"&&isFinite(B.maxAge)?M(D,B,z,Q):void 0;return{onCacheAdd:re,onCacheHit:re&&B.updateExpire?V(D,B):void 0}}var F={anonymousProfileNameCounter:1,isCollectingStats:!1,profiles:{}},N=!1;function O(D){D?delete F.profiles[D]:F.profiles={}}function p(D){D===void 0&&(D=!0),F.isCollectingStats=D}function A(D){var B=D.profileName;return function(){B&&!F.profiles[B]&&(F.profiles[B]={calls:0,hits:0}),F.profiles[B].calls++}}function I(D){return function(){var B=F.profiles,z=D.profileName;B[z]||(B[z]={calls:0,hits:0}),B[z].calls++,B[z].hits++}}function P(D){return D.displayName||D.name||"Anonymous "+F.anonymousProfileNameCounter++}function U(D,B){return D?(B/D*100).toFixed(4)+"%":"0.0000%"}function c(D){!F.isCollectingStats&&!N&&(console.warn('Stats are not currently being collected, please run "collectStats" to enable them.'),N=!0);var B=F.profiles;if(D){if(!B[D])return{calls:0,hits:0,usage:"0.0000%"};var z=B[D];return u({},z,{usage:U(z.calls,z.hits)})}var Q=Object.keys(F.profiles).reduce(function(re,te){return re.calls+=B[te].calls,re.hits+=B[te].hits,re},{calls:0,hits:0});return u({},Q,{profiles:Object.keys(B).reduce(function(re,te){return re[te]=c(te),re},{}),usage:U(Q.calls,Q.hits)})}function E(D){return F.isCollectingStats?{onCacheAdd:A(D),onCacheHit:I(D)}:{}}var _={arguments:!0,callee:!0,caller:!0,constructor:!0,length:!0,name:!0,prototype:!0};function i(D,B,z){z===void 0&&(z=[]),Object.getOwnPropertyNames(D).forEach(function(Q){if(!_[Q]&&z.indexOf(Q)===-1){var re=Object.getOwnPropertyDescriptor(D,Q);re.get||re.set?Object.defineProperty(B,Q,re):B[Q]=D[Q]}})}function s(D,B){var z=B.expirations,Q=D.options,re=b(Q.isEqual,Q.isMatchingKey),te=D;te.clear=function(){var ee=te._microMemoizeOptions.onCacheChange,ae=te.cache;return ae.keys.length=0,ae.values.length=0,ee&&ee(ae,te.options,te),!0},te.clearStats=function(){O(te.options.profileName)},te.get=function(ee){var ae=te._microMemoizeOptions.transformKey,fe=te.cache,_e=ae?ae(ee):ee,de=re(fe.keys,_e);return de!==-1?te.apply(this,ee):void 0},te.getStats=function(){return c(te.options.profileName)},te.has=function(ee){var ae=te._microMemoizeOptions.transformKey,fe=ae?ae(ee):ee;return re(te.cache.keys,fe)!==-1},te.keys=function(){return te.cacheSnapshot.keys},te.remove=function(ee){var ae=te._microMemoizeOptions,fe=ae.onCacheChange,_e=ae.transformKey,de=te.cache,me=re(de.keys,_e?_e(ee):ee);if(me===-1)return!1;var pe=de.keys[me];return de.keys.splice(me,1),de.values.splice(me,1),fe&&fe(de,te.options,te),m(z,pe,!0),!0},te.set=function(ee,ae){var fe=te._microMemoizeOptions,_e=te.cache,de=te.options,me=fe.onCacheAdd,pe=fe.onCacheChange,ve=fe.transformKey,Fe=ve?ve(ee):ee,ye=re(_e.keys,Fe);if(ye===-1){var Ie=de.maxSize-1;_e.size>Ie&&(_e.keys.length=Ie,_e.values.length=Ie),_e.keys.unshift(Fe),_e.values.unshift(ae),de.isPromise&&_e.updateAsyncCache(te),me&&me(_e,de,te),pe&&pe(_e,de,te)}else{var Ke=_e.keys[ye];_e.values[ye]=ae,ye>0&&_e.orderByLru(Ke,ae,ye),de.isPromise&&_e.updateAsyncCache(te),typeof pe=="function"&&pe(_e,de,te)}},te.values=function(){return te.cacheSnapshot.values}}function d(D,B){var z=B.expirations,Q=B.options,re=B.originalFunction,te=D.options;Object.defineProperties(D,{_microMemoizeOptions:{configurable:!0,get:function(){return te}},cacheSnapshot:{configurable:!0,get:function(){var fe=D.cache;return{keys:fe.keys.slice(0),size:fe.size,values:fe.values.slice(0)}}},expirations:{configurable:!0,get:function(){return z}},expirationsSnapshot:{configurable:!0,get:function(){return z.slice(0)}},isMoized:{configurable:!0,get:function(){return!0}},options:{configurable:!0,get:function(){return Q}},originalFunction:{configurable:!0,get:function(){return re}}});var ee=D;i(re,ee)}function T(D,B){return s(D,B),d(D,B),D}var L=typeof Symbol=="function"&&Symbol.for?Symbol.for("react.element"):60103;function C(D,B,z){var Q=D(u({maxArgs:2,isShallowEqual:!0},z,{isReact:!1}));B.displayName||(B.displayName=B.name||"Component");function re(te,ee,ae){this.props=te,this.context=ee,this.updater=ae,this.MoizedComponent=Q(B)}return re.prototype.isReactComponent={},re.prototype.render=function(){return{$$typeof:L,type:this.MoizedComponent,props:this.props,ref:null,key:null,_owner:null}},i(B,re,["contextType","contextTypes"]),re.displayName="Moized("+(B.displayName||B.name||"Component")+")",G(re,B.name,z.profileName),re}function Y(D){return function(B){if(D>=B.length)return B;if(D===0)return[];if(D===1)return[B[0]];if(D===2)return[B[0],B[1]];if(D===3)return[B[0],B[1],B[2]];for(var z=[],Q=0;Q<D;Q++)z[Q]=B[Q];return z}}function v(D,B){for(var z=D.length,Q=0;Q<z;++Q)if(D[Q]===B)return Q+1;return 0}function S(){var D=[],B=[];return function(Q,re){var te=typeof re;if(te==="function"||te==="symbol")return re.toString();if(typeof re=="object"){if(D.length){var ee=v(D,this);ee===0?D[D.length]=this:(D.splice(ee),B.splice(ee)),B[B.length]=Q;var ae=v(D,re);if(ae!==0)return"[ref="+(B.slice(0,ae).join(".")||".")+"]"}else D[0]=re,B[0]=Q;return re}return""+re}}function w(D){var B=typeof D;return D&&(B==="object"||B==="function")?JSON.stringify(D,S()):D}function k(D){for(var B="|",z=0;z<D.length;z++)B+=w(D[z])+"|";return[B]}function q(D){return typeof D.serializer=="function"?D.serializer:k}function W(D,B){return D[0]===B[0]}function j(D){if(typeof D=="function")return function(B,z,Q){return D(Q.cache,Q.options,Q)}}function $(D){return D.matchesArg||D.isDeepEqual&&a.deepEqual||D.isShallowEqual&&a.shallowEqual||a.sameValueZeroEqual}function ne(D){return D.matchesKey||D.isSerialized&&W||void 0}function J(D){return h(D.isSerialized&&q(D),typeof D.transformArgs=="function"&&D.transformArgs,typeof D.maxArgs=="number"&&Y(D.maxArgs))}function ie(D){var B=D.options.updateCacheForKey,z=function(){for(var re=arguments.length,te=new Array(re),ee=0;ee<re;ee++)te[ee]=arguments[ee];if(!B(te))return D.apply(this,te);var ae=D.fn.apply(this,te);return D.set(te,ae),ae};return i(D,z),z}var x=["matchesArg","isDeepEqual","isPromise","isReact","isSerialized","isShallowEqual","matchesKey","maxAge","maxArgs","maxSize","onCacheAdd","onCacheChange","onCacheHit","onExpire","profileName","serializer","updateCacheForKey","transformArgs","updateExpire"],K=function D(B,z){var Q=z||R;if(y(B)){var re=B.originalFunction,te=f(B.options,Q);return D(re,te)}if(typeof B=="object")return function(_t,gr){if(typeof _t=="function"){var dt=f(B,gr);return D(_t,dt)}var mr=f(B,_t);return D(mr)};if(Q.isReact)return C(D,B,Q);var ee=u({},R,Q,{maxAge:typeof Q.maxAge=="number"&&Q.maxAge>=0?Q.maxAge:R.maxAge,maxArgs:typeof Q.maxArgs=="number"&&Q.maxArgs>=0?Q.maxArgs:R.maxArgs,maxSize:typeof Q.maxSize=="number"&&Q.maxSize>=0?Q.maxSize:R.maxSize,profileName:Q.profileName||P(B)}),ae=[];ee.matchesArg,ee.isDeepEqual;var fe=ee.isPromise;ee.isReact,ee.isSerialized,ee.isShallowEqual,ee.matchesKey,ee.maxAge,ee.maxArgs;var _e=ee.maxSize,de=ee.onCacheAdd,me=ee.onCacheChange,pe=ee.onCacheHit;ee.onExpire,ee.profileName,ee.serializer;var ve=ee.updateCacheForKey;ee.transformArgs,ee.updateExpire;var Fe=g(ee,x),ye=$(ee),Ie=ne(ee),Ke=H(ae,ee,ye,Ie),Bt=E(ee),dr=J(ee),Er=u({},Fe,{isEqual:ye,isMatchingKey:Ie,isPromise:fe,maxSize:_e,onCacheAdd:j(t(de,Ke.onCacheAdd,Bt.onCacheAdd)),onCacheChange:j(me),onCacheHit:j(t(pe,Ke.onCacheHit,Bt.onCacheHit)),transformKey:dr}),Gt=n(B,Er),$e=T(Gt,{expirations:ae,options:ee,originalFunction:B});return ve&&($e=ie($e)),G($e,B.name,Q.profileName),$e};K.clearStats=O,K.collectStats=p,K.compose=function(){return h.apply(void 0,arguments)||K},K.deep=K({isDeepEqual:!0}),K.getStats=c,K.infinite=K({maxSize:1/0}),K.isCollectingStats=function(){return F.isCollectingStats},K.isMoized=function(B){return typeof B=="function"&&!!B.isMoized},K.matchesArg=function(D){return K({matchesArg:D})},K.matchesKey=function(D){return K({matchesKey:D})};function Z(D,B){if(B===!0)return K({maxAge:D,updateExpire:B});if(typeof B=="object"){var z=B.onExpire,Q=B.updateExpire;return K({maxAge:D,onExpire:z,updateExpire:Q})}return K(typeof B=="function"?{maxAge:D,onExpire:B,updateExpire:!0}:{maxAge:D})}return K.maxAge=Z,K.maxArgs=function(D){return K({maxArgs:D})},K.maxSize=function(D){return K({maxSize:D})},K.profile=function(D){return K({profileName:D})},K.promise=K({isPromise:!0,updateExpire:!0}),K.react=K({isReact:!0}),K.serialize=K({isSerialized:!0}),K.serializeWith=function(D){return K({isSerialized:!0,serializer:D})},K.shallow=K({isShallowEqual:!0}),K.transformArgs=function(D){return K({transformArgs:D})},K.updateCacheForKey=function(D){return K({updateCacheForKey:D})},Object.defineProperty(K,"default",{configurable:!1,enumerable:!1,value:K,writable:!1}),K})})($a);var eo=`#version 300 es
precision highp float;
precision highp int;

layout(location=0) in vec3 currentPosition;
layout(location=1) in vec4 currentColor;
layout(location=2) in float currentSize;
layout(location=3) in float currentEmphasis;
layout(location=4) in vec3 targetPosition;
layout(location=5) in vec4 targetColor;
layout(location=6) in float targetSize;
layout(location=7) in float targetEmphasis;

layout(location=8) in uint vertexPosition;

out vec3 vTargetPosition;
out vec3 vUpdatedPosition;
out vec4 vUpdatedColor;
out float vUpdatedSize;
out float vUpdatedEmphasis;

uniform float uMixRatio;
uniform vec2 mousePosition;
uniform vec2 bufferDimensions;

flat out int vertexID;
flat out vec2 uv;

float bump(float x, float q, float w) {
  float clamped_x = clamp(x/w, -0.5, 0.5);
  float y = pow(exp(1.0 - 1.0 / (1.0 - pow(2.0*clamped_x, 2.0))), q);
  return y;
}

void main() {
  vTargetPosition = targetPosition;
  float nearness = bump(length(mousePosition - currentPosition.xy), 100.0, 20.0);
  float mixRatio = uMixRatio;
  vUpdatedSize = mix(currentSize, targetSize, mixRatio);

  
  vec3 delta = targetPosition - currentPosition;
  float distance = length(delta);

  vUpdatedPosition = currentPosition + normalize(delta)*min(0.005, distance/200.0);
  vUpdatedPosition = mix(currentPosition, targetPosition, mixRatio);
  vUpdatedColor = mix(currentColor, targetColor, mixRatio);
  vUpdatedEmphasis = mix(currentEmphasis, targetEmphasis, mixRatio);

  uint v = uint(gl_VertexID);
  
  vertexID = int(v);
  
  uv = vec2(
    float(int(v) % int(bufferDimensions.x)),
    float(int(v) / int(bufferDimensions.x))
  );
  
  uv = uv / float(bufferDimensions);
  uv += vec2(0.5/bufferDimensions.x, 0.5/bufferDimensions.y);
  
  
  
  
  gl_Position = vec4(uv*2.0 - 1.0, 0.0, 1.0);
  gl_PointSize = 1.0;
  
}`,to=`#version 300 es
precision highp float;
precision highp int;

in vec3 vUpdatedPosition;
in vec3 vTargetPosition;
in vec4 vUpdatedColor;
in float vUpdatedSize;
in float vUpdatedEmphasis;

flat in int vertexID;

layout(location = 1) out vec4 position;
layout(location = 2) out vec4 color;
layout(location = 3) out vec4 size;
layout(location = 4) out vec4 emphasis;

uniform vec2 bufferDimensions;

void main() {
  position = vec4(vUpdatedPosition, 1.0);
  
  
  
  

  color = vUpdatedColor;
  size = vec4(vUpdatedSize,0,0,1);
  emphasis = vec4(vUpdatedEmphasis,0,0,1);
}`,ro=`#version 300 es
precision highp float;
precision highp int;

layout(location=0) in ivec2 edgeIndices;
layout(location=1) in vec3 segmentOffset;

out vec4 color;

out vec4 position;
out float size;
flat out vec2 edgeDirection;
flat out float edgeLength;
flat out float edgeLength2D;
out float isSource;
out float isTarget;
out float emphasis;
out float v;
out float y;

uniform vec2 mousePosition;

uniform cameras {
  mat4 projection;
  mat4 view;
  mat4 orthoFixedProjection;
  mat4 orthoFixedView;
  mat4 orthoZoomedProjection;
  mat4 orthoZoomedView;
};

struct CameraMatrices {
  mat4 projection;
  mat4 view;
  mat4 orthoFixedProjection;
  mat4 orthoFixedView;
  mat4 orthoZoomedProjection;
  mat4 orthoZoomedView;
};

struct NodeGeometryBundle {
  vec3 globalNDC;
  vec4 globalClipPosition;
  vec4 orthoFixedClipPosition;
  vec4 orthoZoomedClipPosition;
  vec4 orthographicClipPosition;
};

NodeGeometryBundle nodeGeometry(
  in vec3 nodePosition,
  in vec3 vertexPosition,
  float scale,
  in CameraMatrices cam
) {
  vec4 globalClipPosition = cam.projection * cam.view * vec4(nodePosition, 1.0);
  vec3 globalNDC = globalClipPosition.xyz / globalClipPosition.w;

  vec4 orthoFixedClipPosition = cam.orthoFixedProjection * cam.orthoFixedView * vec4(vertexPosition*scale, 1.0);
  vec3 orthoFixedNDC = orthoFixedClipPosition.xyz / orthoFixedClipPosition.w;
  
  vec4 orthoZoomedClipPosition = cam.orthoZoomedProjection * cam.orthoZoomedView * vec4(vertexPosition*scale, 1.0)*0.5;
  vec3 orthoZoomedNDC = orthoZoomedClipPosition.xyz / orthoZoomedClipPosition.w;

  vec3 localNDC = mix(orthoZoomedNDC, orthoFixedNDC, 0.5);

  
  vec3 orthographicNDC = vec3(localNDC.xy + globalNDC.xy, globalNDC.z + (localNDC.z - 0.99)*0.2 );
  
  vec4 orthographicClipPosition = vec4(orthographicNDC * globalClipPosition.w, globalClipPosition.w);
  
  return NodeGeometryBundle(
    globalNDC,
    globalClipPosition,
    orthoFixedClipPosition,
    orthoZoomedClipPosition,
    orthographicClipPosition
  );
}

ivec2 getTextureIndex(int index, ivec2 textureDimensions) {
  int textureLength = textureDimensions.x * textureDimensions.y;
  

  
  int x = index % textureDimensions.x;
  int y = index / textureDimensions.x;

  return ivec2(x,y);
}

uniform sampler2D positionTexture;
uniform sampler2D colorTexture;
uniform sampler2D sizeTexture;
uniform sampler2D emphasisTexture;
uniform ivec2 textureDimensions;

uniform bool selected;
uniform bool hovered;

vec3 desaturate(vec3 color, float amount) {
  float average = (color.r + color.g + color.b) / 3.0;
  return mix(color, vec3(average), amount);
}

vec4 edgeGeometry(
  in vec3 nodePosition,
  in vec3 vertexPosition,
  in vec2 edgeDirection,
  float scale,
  float flatness,
  in CameraMatrices cam
) {
  vec2 edgePerpendicular = vec2(-edgeDirection.y, edgeDirection.x)*scale/3.0;
  vec4 position = cam.projection * cam.view * vec4(nodePosition, 1.0);
  vec4 positionNDC = position / position.w;
  
  

  vec4 positionClip = vec4(position.xy + vertexPosition.y*1.0 * edgePerpendicular, position.zw);

  vec4 positionFixedStrokeNDC = positionNDC + vec4(vertexPosition.y * edgePerpendicular, 0.0, 0.0);
  vec4 positionFixedStrokeClip = positionFixedStrokeNDC * position.w;

  
  return mix(positionFixedStrokeClip, positionClip, 1.0-flatness);
}

float bump(float x, float q, float w) {
  float clamped_x = clamp(x/w, -0.5, 0.5);
  float y = pow(exp(1.0 - 1.0 / (1.0 - pow(2.0*clamped_x, 2.0))), q);
  return y;
}

void main() {
  isSource = segmentOffset.x;
  isTarget = 1.0-segmentOffset.x;
  
  float sourceEmphasis = texelFetch(emphasisTexture, getTextureIndex(edgeIndices.x, textureDimensions), 0).r;
  float targetEmphasis = texelFetch(emphasisTexture, getTextureIndex(edgeIndices.y, textureDimensions), 0).r;

  emphasis = max(sourceEmphasis, targetEmphasis);
  
  position = vec4(0);
  vec3 vertexOffset = segmentOffset + vec3(0.0, -0.5, 0.0);

  vec3 sourceNodePosition = texelFetch(positionTexture, getTextureIndex(edgeIndices.x, textureDimensions), 0).xyz;
  vec3 targetNodePosition = texelFetch(positionTexture, getTextureIndex(edgeIndices.y, textureDimensions), 0).xyz;
  vec3 nodePosition = sourceNodePosition*isSource + targetNodePosition*isTarget;
  
  float sourceSize = texelFetch(sizeTexture, getTextureIndex(edgeIndices.x, textureDimensions), 0).r;
  float targetSize = texelFetch(sizeTexture, getTextureIndex(edgeIndices.y, textureDimensions), 0).r;

  size = sourceSize*isSource + targetSize*isTarget;
  size *= mix(0.3, 0.1, emphasis);
  
  vec4 targetPositionClip = projection * view * vec4(targetNodePosition, 1.0);
  vec4 sourcePositionClip = projection * view * vec4(sourceNodePosition, 1.0);
  
  edgeDirection = normalize(targetPositionClip.xyz/targetPositionClip.w - sourcePositionClip.xyz/sourcePositionClip.w).xy;
  edgeLength = length(targetNodePosition.xyz - sourceNodePosition.xyz);
  edgeLength2D = length((targetPositionClip.xy/targetPositionClip.w - sourcePositionClip.xy/sourcePositionClip.w));

  position = edgeGeometry(
    nodePosition,
    vertexOffset,
    edgeDirection,
    size,
    mix(0.5, 1.0, emphasis),
    CameraMatrices(
      projection,
      view,
      orthoFixedProjection,
      orthoFixedView,
      orthoZoomedProjection,
      orthoZoomedView
    )
  );

  
  position.z += 0.01 * position.w * bump(vertexOffset.x, 4.0, 0.125);

  vec4 sourceColor = texelFetch(colorTexture, getTextureIndex(edgeIndices.x, textureDimensions), 0);
  vec4 targetColor = texelFetch(colorTexture, getTextureIndex(edgeIndices.y, textureDimensions), 0);
  color += sourceColor*isSource;
  color += targetColor*isTarget;

  
  color.rgb = desaturate(color.rgb, 1.0-emphasis);
  color.a *= mix(0.25, 1.0, emphasis);

  
  
  
  

  
  

  gl_Position = position;
  y = vertexOffset.y;
  v = segmentOffset.y;

  float distance = length(mousePosition - position.xy);
  
}`,no=`#version 300 es
precision highp float;

in vec4 color;
in vec4 position;
in float emphasis;
in float size;
flat in vec2 edgeDirection;
flat in float edgeLength;
flat in float edgeLength2D;
in float isTarget;
in float isSource;
in float y;

out vec4 fragColor;

const float PI = 3.1415926535897932384626433832795;
const float freq = 1.0;

uniform float time;

float bump(float x, float q, float w) {
  float clamped_x = clamp(x/w, -0.5, 0.5);
  float y = pow(exp(1.0 - 1.0 / (1.0 - pow(2.0*clamped_x, 2.0))), q);
  return y;
}
float sdEgg( in vec2 p, in float ra, in float rb )
{
    const float k = sqrt(3.0);
    p.x = abs(p.x);
    float r = ra - rb;
    return ((p.y<0.0)       ? length(vec2(p.x,  p.y    )) - r :
            (k*(p.x+r)<p.y) ? length(vec2(p.x,  p.y-k*r)) :
                              length(vec2(p.x+r,p.y    )) - 2.0*r) - rb;
}

float sdEquilateralTriangle( in vec2 p )
{
    const float k = sqrt(3.0);
    p.x = abs(p.x) - 1.0;
    p.y = p.y + 1.0/k;
    if( p.x+k*p.y>0.0 ) p = vec2(p.x-k*p.y,-k*p.x-p.y)/2.0;
    p.x -= clamp( p.x, -2.0, 0.0 );
    return -length(p)*sign(p.y);
}

float wave(float t, float freq){ return pow(sin(t * freq * PI), 2.0); }
void main() {
  float u = isTarget;
  
  
  
  float d = sdEquilateralTriangle(vec2(y*4.0, (isSource-0.5)*edgeLength2D*10.0/size));
  float triangle = d < 0.0 ? 1.0 : 0.0;

  fragColor = color;
  
  
  
  
  
  
  fragColor.a *= bump(y, 1.0, 1.0);

  
  fragColor.a *= mix(1.0, wave(u + time/20.0, 50.0), mix(0.1, 1.0, emphasis));
  
  
  

  
  fragColor.a = min(1.0-triangle/3.0, fragColor.a);
  
  fragColor.a *= mix(0.5, 1.0, emphasis);
  
  
  fragColor.rgb *= mix(1.0, bump(position.x/position.w, 2.0, 1.0), 0.5);

  
  
}`,io=`#version 300 es
precision highp float;
precision highp int;

layout(location=0) in vec3 vertexPosition;
layout(location=1) in vec3 vertexNormal;

uniform cameras {
  mat4 projection;
  mat4 view;
  mat4 orthoFixedProjection;
  mat4 orthoFixedView;
  mat4 orthoZoomedProjection;
  mat4 orthoZoomedView;
};

struct CameraMatrices {
  mat4 projection;
  mat4 view;
  mat4 orthoFixedProjection;
  mat4 orthoFixedView;
  mat4 orthoZoomedProjection;
  mat4 orthoZoomedView;
};

struct NodeGeometryBundle {
  vec3 globalNDC;
  vec4 globalClipPosition;
  vec4 orthoFixedClipPosition;
  vec4 orthoZoomedClipPosition;
  vec4 orthographicClipPosition;
};

NodeGeometryBundle nodeGeometry(
  in vec3 nodePosition,
  in vec3 vertexPosition,
  float scale,
  in CameraMatrices cam
) {
  vec4 globalClipPosition = cam.projection * cam.view * vec4(nodePosition, 1.0);
  vec3 globalNDC = globalClipPosition.xyz / globalClipPosition.w;

  vec4 orthoFixedClipPosition = cam.orthoFixedProjection * cam.orthoFixedView * vec4(vertexPosition*scale, 1.0);
  vec3 orthoFixedNDC = orthoFixedClipPosition.xyz / orthoFixedClipPosition.w;
  
  vec4 orthoZoomedClipPosition = cam.orthoZoomedProjection * cam.orthoZoomedView * vec4(vertexPosition*scale, 1.0)*0.5;
  vec3 orthoZoomedNDC = orthoZoomedClipPosition.xyz / orthoZoomedClipPosition.w;

  vec3 localNDC = mix(orthoZoomedNDC, orthoFixedNDC, 0.5);

  
  vec3 orthographicNDC = vec3(localNDC.xy + globalNDC.xy, globalNDC.z + (localNDC.z - 0.99)*0.2 );
  
  vec4 orthographicClipPosition = vec4(orthographicNDC * globalClipPosition.w, globalClipPosition.w);
  
  return NodeGeometryBundle(
    globalNDC,
    globalClipPosition,
    orthoFixedClipPosition,
    orthoZoomedClipPosition,
    orthographicClipPosition
  );
}

ivec2 getTextureIndex(int index, ivec2 textureDimensions) {
  int textureLength = textureDimensions.x * textureDimensions.y;
  

  
  int x = index % textureDimensions.x;
  int y = index / textureDimensions.x;

  return ivec2(x,y);
}

uniform vec2 mousePosition;

uniform int selectedIndex;
uniform vec4 selectedColor;

uniform sampler2D positionTexture;
uniform sampler2D colorTexture;
uniform sampler2D sizeTexture;
uniform sampler2D emphasisTexture;

uniform ivec2 textureDimensions;

#ifdef PICKER
  flat out vec4 color;
#else
  out vec4 color;
#endif

out vec3 position;
out vec3 normal;

float bump(float x, float q, float w) {
  float clamped_x = clamp(x/w, -0.5, 0.5);
  float y = pow(exp(1.0 - 1.0 / (1.0 - pow(2.0*clamped_x, 2.0))), q);
  return y;
}

void main() {
  int id = gl_InstanceID;
  
  vec3 nodePosition = texelFetch(positionTexture, getTextureIndex(id, textureDimensions), 0).xyz;
  vec4 nodeColor = texelFetch(colorTexture, getTextureIndex(id, textureDimensions), 0);
  float nodeSize = texelFetch(sizeTexture, getTextureIndex(id, textureDimensions), 0).r;
  float nodeEmphasis = texelFetch(emphasisTexture, getTextureIndex(id, textureDimensions), 0).r;

  float scale = nodeSize;
  float isSelected = float(gl_InstanceID == selectedIndex);
  scale *= mix(1.0, 1.1, isSelected);
  
  #ifdef PICKER
    scale *= 1.25;
  #endif

  NodeGeometryBundle geo = nodeGeometry(
    nodePosition,
    vertexPosition,
    scale,
    CameraMatrices(
      projection,
      view,
      orthoFixedProjection,
      orthoFixedView,
      orthoZoomedProjection,
      orthoZoomedView
    )
  );
  
  
  float distance = length(geo.globalNDC.xy - mousePosition);
  float nearness = bump(distance, 2.0, 1.0);

  vec4 clipPosition = geo.orthographicClipPosition;
  
  
  

  
  #ifdef PICKER
    color = instanceIdToColor();
  #else
    color = mix(nodeColor, selectedColor, float(gl_InstanceID == selectedIndex));
  #endif

  normal = mat3(orthoFixedView) * vertexNormal;
  gl_Position = clipPosition;
}`,ao=`#version 300 es
precision highp float;
in vec4 color;
in vec3 normal;

in vec3 position;
out vec4 fragColor;

void main() {
  
  
  const vec3 lightDirection = normalize(vec3(0.0, 0.0, 1.0));
  float light = dot(normal, lightDirection);
  

  
  fragColor = vec4(color.xyz*light, color.a);
  
}`,oo=`#version 300 es
precision lowp float;

vec4 instanceIdToColor() {
  int instanceId = gl_InstanceID+1;
  float r = float(instanceId & 0x0000FF) / 255.0;
  float g = float((instanceId & 0x00FF00) >> 8) / 255.0;
  float b = float((instanceId & 0xFF0000) >> 16) / 255.0;

  return vec4(r, g, b, 1.0);
}

#define PICKER
layout(location=0) in vec3 vertexPosition;
layout(location=1) in vec3 vertexNormal;

uniform cameras {
  mat4 projection;
  mat4 view;
  mat4 orthoFixedProjection;
  mat4 orthoFixedView;
  mat4 orthoZoomedProjection;
  mat4 orthoZoomedView;
};

struct CameraMatrices {
  mat4 projection;
  mat4 view;
  mat4 orthoFixedProjection;
  mat4 orthoFixedView;
  mat4 orthoZoomedProjection;
  mat4 orthoZoomedView;
};

struct NodeGeometryBundle {
  vec3 globalNDC;
  vec4 globalClipPosition;
  vec4 orthoFixedClipPosition;
  vec4 orthoZoomedClipPosition;
  vec4 orthographicClipPosition;
};

NodeGeometryBundle nodeGeometry(
  in vec3 nodePosition,
  in vec3 vertexPosition,
  float scale,
  in CameraMatrices cam
) {
  vec4 globalClipPosition = cam.projection * cam.view * vec4(nodePosition, 1.0);
  vec3 globalNDC = globalClipPosition.xyz / globalClipPosition.w;

  vec4 orthoFixedClipPosition = cam.orthoFixedProjection * cam.orthoFixedView * vec4(vertexPosition*scale, 1.0);
  vec3 orthoFixedNDC = orthoFixedClipPosition.xyz / orthoFixedClipPosition.w;
  
  vec4 orthoZoomedClipPosition = cam.orthoZoomedProjection * cam.orthoZoomedView * vec4(vertexPosition*scale, 1.0)*0.5;
  vec3 orthoZoomedNDC = orthoZoomedClipPosition.xyz / orthoZoomedClipPosition.w;

  vec3 localNDC = mix(orthoZoomedNDC, orthoFixedNDC, 0.5);

  
  vec3 orthographicNDC = vec3(localNDC.xy + globalNDC.xy, globalNDC.z + (localNDC.z - 0.99)*0.2 );
  
  vec4 orthographicClipPosition = vec4(orthographicNDC * globalClipPosition.w, globalClipPosition.w);
  
  return NodeGeometryBundle(
    globalNDC,
    globalClipPosition,
    orthoFixedClipPosition,
    orthoZoomedClipPosition,
    orthographicClipPosition
  );
}

ivec2 getTextureIndex(int index, ivec2 textureDimensions) {
  int textureLength = textureDimensions.x * textureDimensions.y;
  

  
  int x = index % textureDimensions.x;
  int y = index / textureDimensions.x;

  return ivec2(x,y);
}

uniform vec2 mousePosition;

uniform int selectedIndex;
uniform vec4 selectedColor;

uniform sampler2D positionTexture;
uniform sampler2D colorTexture;
uniform sampler2D sizeTexture;
uniform sampler2D emphasisTexture;

uniform ivec2 textureDimensions;

#ifdef PICKER
  flat out vec4 color;
#else
  out vec4 color;
#endif

out vec3 position;
out vec3 normal;

float bump(float x, float q, float w) {
  float clamped_x = clamp(x/w, -0.5, 0.5);
  float y = pow(exp(1.0 - 1.0 / (1.0 - pow(2.0*clamped_x, 2.0))), q);
  return y;
}

void main() {
  int id = gl_InstanceID;
  
  vec3 nodePosition = texelFetch(positionTexture, getTextureIndex(id, textureDimensions), 0).xyz;
  vec4 nodeColor = texelFetch(colorTexture, getTextureIndex(id, textureDimensions), 0);
  float nodeSize = texelFetch(sizeTexture, getTextureIndex(id, textureDimensions), 0).r;
  float nodeEmphasis = texelFetch(emphasisTexture, getTextureIndex(id, textureDimensions), 0).r;

  float scale = nodeSize;
  float isSelected = float(gl_InstanceID == selectedIndex);
  scale *= mix(1.0, 1.1, isSelected);
  
  #ifdef PICKER
    scale *= 1.25;
  #endif

  NodeGeometryBundle geo = nodeGeometry(
    nodePosition,
    vertexPosition,
    scale,
    CameraMatrices(
      projection,
      view,
      orthoFixedProjection,
      orthoFixedView,
      orthoZoomedProjection,
      orthoZoomedView
    )
  );
  
  
  float distance = length(geo.globalNDC.xy - mousePosition);
  float nearness = bump(distance, 2.0, 1.0);

  vec4 clipPosition = geo.orthographicClipPosition;
  
  
  

  
  #ifdef PICKER
    color = instanceIdToColor();
  #else
    color = mix(nodeColor, selectedColor, float(gl_InstanceID == selectedIndex));
  #endif

  normal = mat3(orthoFixedView) * vertexNormal;
  gl_Position = clipPosition;
}`,so=`#version 300 es
precision lowp float;

flat in vec4 color;
out vec4 fragColor;

void main() {
  fragColor = color;
}`;function co(r,e,n,a,u,g){r===void 0&&(r=1),e===void 0&&(e=r),n===void 0&&(n=r),a===void 0&&(a=1),u===void 0&&(u=a),g===void 0&&(g=a);var R=0,t=[],h=[],l=[],b=[];function f(y,G,m,X,M,V,H,F,N,O){for(var p=R,A=0;A<=H;A++)for(var I=0;I<=V;I++){var P=t[R]=[0,0,0];P[y]=(-X/2+I*X/V)*N,P[G]=(-M/2+A*M/H)*O,P[m]=F;var U=h[R]=[0,0,0];U[y]=0,U[G]=0,U[m]=F/Math.abs(F);var c=l[R]=[0,0];c[0]=I/V,c[1]=1-A/H,++R}for(var A=0;A<H;A++)for(var I=0;I<V;I++){var E=p+A*(V+1)+I;b.push([E,E+V+1,E+V+2]),b.push([E,E+V+2,E+1])}}return f(0,1,2,r,e,a,u,n/2,1,-1),f(0,1,2,r,e,a,u,-n/2,-1,-1),f(2,1,0,n,e,g,u,-r/2,1,-1),f(2,1,0,n,e,g,u,r/2,-1,-1),f(0,2,1,r,n,a,g,e/2,1,1),f(0,2,1,r,n,a,g,-e/2,1,-1),{positions:t,normals:h,uvs:l,cells:b}}var uo=co,lo=1e-6,fo=function(r,e,n){for(var a=e.length,u=new Array(a),g=n===void 0?lo:n,R=0;R<a;++R)u[R]=[0,0,0];for(var R=0;R<r.length;++R)for(var t=r[R],h=0,l=t[t.length-1],b=t[0],f=0;f<t.length;++f){h=l,l=b,b=t[(f+1)%t.length];for(var y=e[h],G=e[l],m=e[b],X=new Array(3),M=0,V=new Array(3),H=0,F=0;F<3;++F)X[F]=y[F]-G[F],M+=X[F]*X[F],V[F]=m[F]-G[F],H+=V[F]*V[F];if(M*H>g)for(var N=u[l],O=1/Math.sqrt(M*H),F=0;F<3;++F){var p=(F+1)%3,A=(F+2)%3;N[F]+=O*(V[p]*X[A]-V[A]*X[p])}}for(var R=0;R<a;++R){for(var N=u[R],I=0,F=0;F<3;++F)I+=N[F]*N[F];if(I>g)for(var O=1/Math.sqrt(I),F=0;F<3;++F)N[F]*=O;else for(var F=0;F<3;++F)N[F]=0}return u};function Ci(r,e,n){var a=r[n]|0;if(a<=0)return[];var u=new Array(a),g;if(n===r.length-1)for(g=0;g<a;++g)u[g]=e;else for(g=0;g<a;++g)u[g]=Ci(r,e,n+1);return u}function ho(r,e){var n,a;for(n=new Array(r),a=0;a<r;++a)n[a]=e;return n}function _o(r,e){switch(typeof e>"u"&&(e=0),typeof r){case"number":if(r>0)return ho(r|0,e);break;case"object":if(typeof r.length=="number")return Ci(r,e,0);break}return[]}var Eo=_o,Ar=Eo;function Xe(r,e,n){return r+(n+1)*e}function go(r,e,n,a,u){n=n||[0,0],(!a||a.length<n.length)&&(a=Ar(n.length),n.length>0&&(a[0]=1)),(!u||u.length<n.length)&&(u=Ar(n.length),n.length>1&&(u[1]=1));var g=[],R=Ar([(r+1)*(e+1),n.length]),t,h,l,b,f=n.length;for(h=0;h<e;++h)for(t=0;t<r;++t)g.push([Xe(t,h,r),Xe(t+1,h,r),Xe(t,h+1,r)]),g.push([Xe(t+1,h,r),Xe(t+1,h+1,r),Xe(t,h+1,r)]);for(h=0;h<=e;++h)for(t=0;t<=r;++t)for(b=R[Xe(t,h,r)],l=0;l<f;++l)b[l]=n[l]+a[l]*t+u[l]*h;return{positions:R,cells:g}}var mo=go;const po=le(()=>he().createProgram(io,ao)),To=le(()=>he().createProgram(oo,so)),Ao=le.infinite(()=>{const r=uo(1),e=r.positions,n=r.cells,a=fo(n,e),u=he().createVertexBuffer(oe.FLOAT,3,new Float32Array(e.flat())),g=he().createIndexBuffer(oe.UNSIGNED_SHORT,new Uint16Array(n.flat())),R=he().createVertexBuffer(oe.FLOAT,3,new Float32Array(a.flat()));return he().createVertexArray().vertexAttributeBuffer(0,u).vertexAttributeBuffer(1,R).indexBuffer(g)}),xi=()=>{const r=Ao(),e=Mt().current;return r.instanceAttributeBuffer(3,e)},Gn=le.infinite(r=>{const e=he(),n=e.width,a=e.height;let u=e.createTexture2D(n,a,{internalFormat:oe.RGBA8,minFilter:oe.NEAREST,magFilter:oe.NEAREST}),g=e.createRenderbuffer(n,a,oe.DEPTH_COMPONENT16);return e.createFramebuffer().colorTarget(0,u).depthTarget(g)});class vo{constructor(e,n){this.A=e,this.B=n,this._current=e}swap(){this._current=this.current===this.A?this.B:this.A}get current(){return this._current}get other(){return this._current===this.A?this.B:this.A}}const Ro=le.infinite(()=>{he();const r=Gn("A"),e=Gn("B");return new vo(r,e)}),yo=le.infinite(()=>{const r=To(),e=xi();return he().createDrawCall(r,e).primitive(oe.TRIANGLES)}),So=le.infinite(()=>{const r=po(),e=xi();return he().createDrawCall(r,e).primitive(oe.TRIANGLES)}),Io=le(()=>he().createProgram(ro,no)),Ui=20,Di=1,Jt=mo(Ui,Di);Jt.positions=Jt.positions.map(([r,e])=>[r/Ui,e/Di]);le.infinite(r=>{const e=new Uint32Array(r.flat());return he().createIndexBuffer(oe.UNSIGNED_INT,e)});const Po=le.infinite(r=>{const e=new Int32Array(r.flat());return he().createVertexBuffer(oe.INT,2,e)}),No=le.infinite(()=>he().createVertexBuffer(oe.FLOAT,2,new Float32Array(Jt.positions.flat()))),Oo=le.infinite(()=>he().createIndexBuffer(oe.UNSIGNED_SHORT,new Uint16Array(Jt.cells.flat()))),bo=le.infinite(()=>he().createVertexArray()),Fo=r=>{const e=bo(),n=Po(r),a=No(),u=Oo();return e.instanceAttributeBuffer(0,n).vertexAttributeBuffer(1,a).indexBuffer(u)};let wi;const Lo=r=>{wi=r},Mi=()=>Fo(wi),Co=le.infinite(()=>{const r=Io();r.program.id="edge-visualizer-program";const e=Mi();return he().createDrawCall(r,e).primitive(oe.TRIANGLES)}),Bi=Symbol("Comlink.proxy"),xo=Symbol("Comlink.endpoint"),Uo=Symbol("Comlink.releaseProxy"),jr=Symbol("Comlink.thrown"),Gi=r=>typeof r=="object"&&r!==null||typeof r=="function",Do={canHandle:r=>Gi(r)&&r[Bi],serialize(r){const{port1:e,port2:n}=new MessageChannel;return Hi(r,e),[n,[n]]},deserialize(r){return r.start(),or(r)}},wo={canHandle:r=>Gi(r)&&jr in r,serialize({value:r}){let e;return r instanceof Error?e={isError:!0,value:{message:r.message,name:r.name,stack:r.stack}}:e={isError:!1,value:r},[e,[]]},deserialize(r){throw r.isError?Object.assign(new Error(r.value.message),r.value):r.value}},Vi=new Map([["proxy",Do],["throw",wo]]);function Hi(r,e=self){e.addEventListener("message",function n(a){if(!a||!a.data)return;const{id:u,type:g,path:R}=Object.assign({path:[]},a.data),t=(a.data.argumentList||[]).map(Ye);let h;try{const l=R.slice(0,-1).reduce((f,y)=>f[y],r),b=R.reduce((f,y)=>f[y],r);switch(g){case"GET":h=b;break;case"SET":l[R.slice(-1)[0]]=Ye(a.data.value),h=!0;break;case"APPLY":h=b.apply(l,t);break;case"CONSTRUCT":{const f=new b(...t);h=Ot(f)}break;case"ENDPOINT":{const{port1:f,port2:y}=new MessageChannel;Hi(r,y),h=Go(f,[f])}break;case"RELEASE":h=void 0;break;default:return}}catch(l){h={value:l,[jr]:0}}Promise.resolve(h).catch(l=>({value:l,[jr]:0})).then(l=>{const[b,f]=gn(l);e.postMessage(Object.assign(Object.assign({},b),{id:u}),f),g==="RELEASE"&&(e.removeEventListener("message",n),ki(e))})}),e.start&&e.start()}function Mo(r){return r.constructor.name==="MessagePort"}function ki(r){Mo(r)&&r.close()}function or(r,e){return Kr(r,[],e)}function Ht(r){if(r)throw new Error("Proxy has been released and is not useable")}function Kr(r,e=[],n=function(){}){let a=!1;const u=new Proxy(n,{get(g,R){if(Ht(a),R===Uo)return()=>qe(r,{type:"RELEASE",path:e.map(t=>t.toString())}).then(()=>{ki(r),a=!0});if(R==="then"){if(e.length===0)return{then:()=>u};const t=qe(r,{type:"GET",path:e.map(h=>h.toString())}).then(Ye);return t.then.bind(t)}return Kr(r,[...e,R])},set(g,R,t){Ht(a);const[h,l]=gn(t);return qe(r,{type:"SET",path:[...e,R].map(b=>b.toString()),value:h},l).then(Ye)},apply(g,R,t){Ht(a);const h=e[e.length-1];if(h===xo)return qe(r,{type:"ENDPOINT"}).then(Ye);if(h==="bind")return Kr(r,e.slice(0,-1));const[l,b]=Vn(t);return qe(r,{type:"APPLY",path:e.map(f=>f.toString()),argumentList:l},b).then(Ye)},construct(g,R){Ht(a);const[t,h]=Vn(R);return qe(r,{type:"CONSTRUCT",path:e.map(l=>l.toString()),argumentList:t},h).then(Ye)}});return u}function Bo(r){return Array.prototype.concat.apply([],r)}function Vn(r){const e=r.map(gn);return[e.map(n=>n[0]),Bo(e.map(n=>n[1]))]}const Xi=new WeakMap;function Go(r,e){return Xi.set(r,e),r}function Ot(r){return Object.assign(r,{[Bi]:!0})}function gn(r){for(const[e,n]of Vi)if(n.canHandle(r)){const[a,u]=n.serialize(r);return[{type:"HANDLER",name:e,value:a},u]}return[{type:"RAW",value:r},Xi.get(r)||[]]}function Ye(r){switch(r.type){case"HANDLER":return Vi.get(r.name).deserialize(r.value);case"RAW":return r.value}}function qe(r,e,n){return new Promise(a=>{const u=Vo();r.addEventListener("message",function g(R){!R.data||!R.data.id||R.data.id!==u||(r.removeEventListener("message",g),a(R.data))}),r.start&&r.start(),r.postMessage(Object.assign({id:u},e),n)})}function Vo(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}var Ho=typeof global=="object"&&global&&global.Object===Object&&global;const ko=Ho;var Xo=typeof self=="object"&&self&&self.Object===Object&&self,Wo=ko||Xo||Function("return this")();const Dt=Wo;var Yo=Dt.Symbol;const Qt=Yo;var Wi=Object.prototype,zo=Wi.hasOwnProperty,jo=Wi.toString,mt=Qt?Qt.toStringTag:void 0;function Ko(r){var e=zo.call(r,mt),n=r[mt];try{r[mt]=void 0;var a=!0}catch{}var u=jo.call(r);return a&&(e?r[mt]=n:delete r[mt]),u}var $o=Object.prototype,qo=$o.toString;function Zo(r){return qo.call(r)}var Jo="[object Null]",Qo="[object Undefined]",Hn=Qt?Qt.toStringTag:void 0;function Yi(r){return r==null?r===void 0?Qo:Jo:Hn&&Hn in Object(r)?Ko(r):Zo(r)}function es(r){return r!=null&&typeof r=="object"}var ts="[object Symbol]";function rs(r){return typeof r=="symbol"||es(r)&&Yi(r)==ts}var ns=/\s/;function is(r){for(var e=r.length;e--&&ns.test(r.charAt(e)););return e}var as=/^\s+/;function os(r){return r&&r.slice(0,is(r)+1).replace(as,"")}function it(r){var e=typeof r;return r!=null&&(e=="object"||e=="function")}var kn=0/0,ss=/^[-+]0x[0-9a-f]+$/i,cs=/^0b[01]+$/i,us=/^0o[0-7]+$/i,ls=parseInt;function Xn(r){if(typeof r=="number")return r;if(rs(r))return kn;if(it(r)){var e=typeof r.valueOf=="function"?r.valueOf():r;r=it(e)?e+"":e}if(typeof r!="string")return r===0?r:+r;r=os(r);var n=cs.test(r);return n||us.test(r)?ls(r.slice(2),n?2:8):ss.test(r)?kn:+r}function ke(r){return r}var fs="[object AsyncFunction]",hs="[object Function]",_s="[object GeneratorFunction]",ds="[object Proxy]";function Es(r){if(!it(r))return!1;var e=Yi(r);return e==hs||e==_s||e==fs||e==ds}var gs=Dt["__core-js_shared__"];const vr=gs;var Wn=function(){var r=/[^.]+$/.exec(vr&&vr.keys&&vr.keys.IE_PROTO||"");return r?"Symbol(src)_1."+r:""}();function ms(r){return!!Wn&&Wn in r}var ps=Function.prototype,Ts=ps.toString;function As(r){if(r!=null){try{return Ts.call(r)}catch{}try{return r+""}catch{}}return""}var vs=/[\\^$.*+?()[\]{}|]/g,Rs=/^\[object .+?Constructor\]$/,ys=Function.prototype,Ss=Object.prototype,Is=ys.toString,Ps=Ss.hasOwnProperty,Ns=RegExp("^"+Is.call(Ps).replace(vs,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function Os(r){if(!it(r)||ms(r))return!1;var e=Es(r)?Ns:Rs;return e.test(As(r))}function bs(r,e){return r?.[e]}function mn(r,e){var n=bs(r,e);return Os(n)?n:void 0}function Fs(){}function Ls(r,e,n,a){for(var u=r.length,g=n+(a?1:-1);a?g--:++g<u;)if(e(r[g],g,r))return g;return-1}function Cs(r){return r!==r}function xs(r,e,n){for(var a=n-1,u=r.length;++a<u;)if(r[a]===e)return a;return-1}function Us(r,e,n){return e===e?xs(r,e,n):Ls(r,Cs,n)}function Ds(r,e){var n=r==null?0:r.length;return!!n&&Us(r,e,0)>-1}function ws(r,e){return r===e||r!==r&&e!==e}var Ms=mn(Object,"create");const bt=Ms;function Bs(){this.__data__=bt?bt(null):{},this.size=0}function Gs(r){var e=this.has(r)&&delete this.__data__[r];return this.size-=e?1:0,e}var Vs="__lodash_hash_undefined__",Hs=Object.prototype,ks=Hs.hasOwnProperty;function Xs(r){var e=this.__data__;if(bt){var n=e[r];return n===Vs?void 0:n}return ks.call(e,r)?e[r]:void 0}var Ws=Object.prototype,Ys=Ws.hasOwnProperty;function zs(r){var e=this.__data__;return bt?e[r]!==void 0:Ys.call(e,r)}var js="__lodash_hash_undefined__";function Ks(r,e){var n=this.__data__;return this.size+=this.has(r)?0:1,n[r]=bt&&e===void 0?js:e,this}function ze(r){var e=-1,n=r==null?0:r.length;for(this.clear();++e<n;){var a=r[e];this.set(a[0],a[1])}}ze.prototype.clear=Bs;ze.prototype.delete=Gs;ze.prototype.get=Xs;ze.prototype.has=zs;ze.prototype.set=Ks;function $s(){this.__data__=[],this.size=0}function sr(r,e){for(var n=r.length;n--;)if(ws(r[n][0],e))return n;return-1}var qs=Array.prototype,Zs=qs.splice;function Js(r){var e=this.__data__,n=sr(e,r);if(n<0)return!1;var a=e.length-1;return n==a?e.pop():Zs.call(e,n,1),--this.size,!0}function Qs(r){var e=this.__data__,n=sr(e,r);return n<0?void 0:e[n][1]}function ec(r){return sr(this.__data__,r)>-1}function tc(r,e){var n=this.__data__,a=sr(n,r);return a<0?(++this.size,n.push([r,e])):n[a][1]=e,this}function ut(r){var e=-1,n=r==null?0:r.length;for(this.clear();++e<n;){var a=r[e];this.set(a[0],a[1])}}ut.prototype.clear=$s;ut.prototype.delete=Js;ut.prototype.get=Qs;ut.prototype.has=ec;ut.prototype.set=tc;var rc=mn(Dt,"Map");const nc=rc;function ic(){this.size=0,this.__data__={hash:new ze,map:new(nc||ut),string:new ze}}function ac(r){var e=typeof r;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?r!=="__proto__":r===null}function cr(r,e){var n=r.__data__;return ac(e)?n[typeof e=="string"?"string":"hash"]:n.map}function oc(r){var e=cr(this,r).delete(r);return this.size-=e?1:0,e}function sc(r){return cr(this,r).get(r)}function cc(r){return cr(this,r).has(r)}function uc(r,e){var n=cr(this,r),a=n.size;return n.set(r,e),this.size+=n.size==a?0:1,this}function lt(r){var e=-1,n=r==null?0:r.length;for(this.clear();++e<n;){var a=r[e];this.set(a[0],a[1])}}lt.prototype.clear=ic;lt.prototype.delete=oc;lt.prototype.get=sc;lt.prototype.has=cc;lt.prototype.set=uc;var lc=mn(Dt,"Set");const Rr=lc;var fc="__lodash_hash_undefined__";function hc(r){return this.__data__.set(r,fc),this}function _c(r){return this.__data__.has(r)}function er(r){var e=-1,n=r==null?0:r.length;for(this.__data__=new lt;++e<n;)this.add(r[e])}er.prototype.add=er.prototype.push=hc;er.prototype.has=_c;function dc(r,e){return r.has(e)}function zi(r){var e=-1,n=Array(r.size);return r.forEach(function(a){n[++e]=a}),n}var Ec=function(){return Dt.Date.now()};const yr=Ec;var gc="Expected a function",mc=Math.max,pc=Math.min;function ji(r,e,n){var a,u,g,R,t,h,l=0,b=!1,f=!1,y=!0;if(typeof r!="function")throw new TypeError(gc);e=Xn(e)||0,it(n)&&(b=!!n.leading,f="maxWait"in n,g=f?mc(Xn(n.maxWait)||0,e):g,y="trailing"in n?!!n.trailing:y);function G(p){var A=a,I=u;return a=u=void 0,l=p,R=r.apply(I,A),R}function m(p){return l=p,t=setTimeout(V,e),b?G(p):R}function X(p){var A=p-h,I=p-l,P=e-A;return f?pc(P,g-I):P}function M(p){var A=p-h,I=p-l;return h===void 0||A>=e||A<0||f&&I>=g}function V(){var p=yr();if(M(p))return H(p);t=setTimeout(V,X(p))}function H(p){return t=void 0,y&&a?G(p):(a=u=void 0,R)}function F(){t!==void 0&&clearTimeout(t),l=0,a=h=u=t=void 0}function N(){return t===void 0?R:H(yr())}function O(){var p=yr(),A=M(p);if(a=arguments,u=this,h=p,A){if(t===void 0)return m(h);if(f)return clearTimeout(t),t=setTimeout(V,e),G(h)}return t===void 0&&(t=setTimeout(V,e)),R}return O.cancel=F,O.flush=N,O}function Tc(r,e,n){for(var a=-1,u=r==null?0:r.length;++a<u;)if(n(e,r[a]))return!0;return!1}function Ze(r){for(var e=-1,n=r==null?0:r.length,a={};++e<n;){var u=r[e];a[u[0]]=u[1]}return a}var Ac="Expected a function";function $r(r,e,n){var a=!0,u=!0;if(typeof r!="function")throw new TypeError(Ac);return it(n)&&(a="leading"in n?!!n.leading:a,u="trailing"in n?!!n.trailing:u),ji(r,e,{leading:a,maxWait:e,trailing:u})}var vc=1/0,Rc=Rr&&1/zi(new Rr([,-0]))[1]==vc?function(r){return new Rr(r)}:Fs;const yc=Rc;var Sc=200;function Ic(r,e,n){var a=-1,u=Ds,g=r.length,R=!0,t=[],h=t;if(n)R=!1,u=Tc;else if(g>=Sc){var l=e?null:yc(r);if(l)return zi(l);R=!1,u=dc,h=new er}else h=e?[]:t;e:for(;++a<g;){var b=r[a],f=e?e(b):b;if(b=n||b!==0?b:0,R&&f===f){for(var y=h.length;y--;)if(h[y]===f)continue e;e&&h.push(f),t.push(b)}else u(h,f,n)||(h!==t&&h.push(f),t.push(b))}return t}function Pc(r,e){return e=typeof e=="function"?e:void 0,r&&r.length?Ic(r,void 0,e):[]}const tr=le.infinite(()=>he().createUniformBuffer([oe.FLOAT_MAT4,oe.FLOAT_MAT4,oe.FLOAT_MAT4,oe.FLOAT_MAT4,oe.FLOAT_MAT4,oe.FLOAT_MAT4,oe.UNSIGNED_INT])),Nc=Ot($r((r,e,n,a,u,g)=>{tr().set(0,r).set(1,e).set(2,n).set(3,a).set(4,u).set(5,g).update()},1));var wt={};function Oc(r){if(typeof r=="object"){if("buttons"in r)return r.buttons;if("which"in r){var e=r.which;if(e===2)return 4;if(e===3)return 2;if(e>0)return 1<<e-1}else if("button"in r){var e=r.button;if(e===1)return 4;if(e===2)return 2;if(e>=0)return 1<<e}}return 0}wt.buttons=Oc;function pn(r){return r.target||r.srcElement||window}wt.element=pn;function bc(r){if(typeof r=="object"){if("offsetX"in r)return r.offsetX;var e=pn(r),n=e.getBoundingClientRect();return r.clientX-n.left}return 0}wt.x=bc;function Fc(r){if(typeof r=="object"){if("offsetY"in r)return r.offsetY;var e=pn(r),n=e.getBoundingClientRect();return r.clientY-n.top}return 0}wt.y=Fc;var Lc=Cc,pt=wt;function Cc(r,e){e||(e=r,r=window);var n=0,a=0,u=0,g={shift:!1,alt:!1,control:!1,meta:!1},R=!1;function t(H){var F=!1;return"altKey"in H&&(F=F||H.altKey!==g.alt,g.alt=!!H.altKey),"shiftKey"in H&&(F=F||H.shiftKey!==g.shift,g.shift=!!H.shiftKey),"ctrlKey"in H&&(F=F||H.ctrlKey!==g.control,g.control=!!H.ctrlKey),"metaKey"in H&&(F=F||H.metaKey!==g.meta,g.meta=!!H.metaKey),F}function h(H,F){var N=pt.x(F),O=pt.y(F);"buttons"in F&&(H=F.buttons|0),(H!==n||N!==a||O!==u||t(F))&&(n=H|0,a=N||0,u=O||0,e&&e(n,a,u,g))}function l(H){h(0,H)}function b(){(n||a||u||g.shift||g.alt||g.meta||g.control)&&(a=u=0,n=0,g.shift=g.alt=g.control=g.meta=!1,e&&e(0,0,0,g))}function f(H){t(H)&&e&&e(n,a,u,g)}function y(H){pt.buttons(H)===0?h(0,H):h(n,H)}function G(H){h(n|pt.buttons(H),H)}function m(H){h(n&~pt.buttons(H),H)}function X(){R||(R=!0,r.addEventListener("mousemove",y),r.addEventListener("mousedown",G),r.addEventListener("mouseup",m),r.addEventListener("mouseleave",l),r.addEventListener("mouseenter",l),r.addEventListener("mouseout",l),r.addEventListener("mouseover",l),r.addEventListener("blur",b),r.addEventListener("keyup",f),r.addEventListener("keydown",f),r.addEventListener("keypress",f),r!==window&&(window.addEventListener("blur",b),window.addEventListener("keyup",f),window.addEventListener("keydown",f),window.addEventListener("keypress",f)))}function M(){R&&(R=!1,r.removeEventListener("mousemove",y),r.removeEventListener("mousedown",G),r.removeEventListener("mouseup",m),r.removeEventListener("mouseleave",l),r.removeEventListener("mouseenter",l),r.removeEventListener("mouseout",l),r.removeEventListener("mouseover",l),r.removeEventListener("blur",b),r.removeEventListener("keyup",f),r.removeEventListener("keydown",f),r.removeEventListener("keypress",f),r!==window&&(window.removeEventListener("blur",b),window.removeEventListener("keyup",f),window.removeEventListener("keydown",f),window.removeEventListener("keypress",f)))}X();var V={element:r};return Object.defineProperties(V,{enabled:{get:function(){return R},set:function(H){H?X():M()},enumerable:!0},buttons:{get:function(){return n},enumerable:!0},x:{get:function(){return a},enumerable:!0},y:{get:function(){return u},enumerable:!0},mods:{get:function(){return g},enumerable:!0}}),V}var xc={left:0,top:0},Uc=Dc;function Dc(r,e,n){e=e||r.currentTarget||r.srcElement,Array.isArray(n)||(n=[0,0]);var a=r.clientX||0,u=r.clientY||0,g=wc(e);return n[0]=a-g.left,n[1]=u-g.top,n}function wc(r){return r===window||r===document||r===document.body?xc:r.getBoundingClientRect()}var rr={},Mc={get exports(){return rr},set exports(r){rr=r}},qr={},Bc={get exports(){return qr},set exports(r){qr=r}},Gc=void 0,Ki=function(r){return r!==Gc&&r!==null},Vc=Ki,Hc={object:!0,function:!0,undefined:!0},kc=function(r){return Vc(r)?hasOwnProperty.call(Hc,typeof r):!1},Xc=kc,Wc=function(r){if(!Xc(r))return!1;try{return r.constructor?r.constructor.prototype===r:!1}catch{return!1}},Yc=Wc,zc=function(r){if(typeof r!="function"||!hasOwnProperty.call(r,"length"))return!1;try{if(typeof r.length!="number"||typeof r.call!="function"||typeof r.apply!="function")return!1}catch{return!1}return!Yc(r)},jc=zc,Kc=/^\s*class[\s{/}]/,$c=Function.prototype.toString,qc=function(r){return!(!jc(r)||Kc.test($c.call(r)))},Zc=function(){var r=Object.assign,e;return typeof r!="function"?!1:(e={foo:"raz"},r(e,{bar:"dwa"},{trzy:"trzy"}),e.foo+e.bar+e.trzy==="razdwatrzy")},Sr,Yn;function Jc(){return Yn||(Yn=1,Sr=function(){try{return Object.keys("primitive"),!0}catch{return!1}}),Sr}var Qc=function(){},eu=Qc(),Tn=function(r){return r!==eu&&r!==null},Ir,zn;function tu(){if(zn)return Ir;zn=1;var r=Tn,e=Object.keys;return Ir=function(n){return e(r(n)?Object(n):n)},Ir}var Pr,jn;function ru(){return jn||(jn=1,Pr=Jc()()?Object.keys:tu()),Pr}var Nr,Kn;function nu(){if(Kn)return Nr;Kn=1;var r=Tn;return Nr=function(e){if(!r(e))throw new TypeError("Cannot use null or undefined");return e},Nr}var Or,$n;function iu(){if($n)return Or;$n=1;var r=ru(),e=nu(),n=Math.max;return Or=function(a,u){var g,R,t=n(arguments.length,2),h;for(a=Object(e(a)),h=function(l){try{a[l]=u[l]}catch(b){g||(g=b)}},R=1;R<t;++R)u=arguments[R],r(u).forEach(h);if(g!==void 0)throw g;return a},Or}var au=Zc()?Object.assign:iu(),ou=Tn,su=Array.prototype.forEach,cu=Object.create,uu=function(r,e){var n;for(n in r)e[n]=r[n]},lu=function(r){var e=cu(null);return su.call(arguments,function(n){ou(n)&&uu(Object(n),e)}),e},br="razdwatrzy",fu=function(){return typeof br.contains!="function"?!1:br.contains("dwa")===!0&&br.contains("foo")===!1},Fr,qn;function hu(){if(qn)return Fr;qn=1;var r=String.prototype.indexOf;return Fr=function(e){return r.call(this,e,arguments[1])>-1},Fr}var _u=fu()?String.prototype.contains:hu(),zt=Ki,Zn=qc,$i=au,qi=lu,It=_u,du=Bc.exports=function(r,e){var n,a,u,g,R;return arguments.length<2||typeof r!="string"?(g=e,e=r,r=null):g=arguments[2],zt(r)?(n=It.call(r,"c"),a=It.call(r,"e"),u=It.call(r,"w")):(n=u=!0,a=!1),R={value:e,configurable:n,enumerable:a,writable:u},g?$i(qi(g),R):R};du.gs=function(r,e,n){var a,u,g,R;return typeof r!="string"?(g=n,n=e,e=r,r=null):g=arguments[3],zt(e)?Zn(e)?zt(n)?Zn(n)||(g=n,n=void 0):n=void 0:(g=e,e=n=void 0):e=void 0,zt(r)?(a=It.call(r,"c"),u=It.call(r,"e")):(a=!0,u=!1),R={get:e,set:n,configurable:a,enumerable:u},g?$i(qi(g),R):R};var Eu=function(r){if(typeof r!="function")throw new TypeError(r+" is not a function");return r};(function(r,e){var n=qr,a=Eu,u=Function.prototype.apply,g=Function.prototype.call,R=Object.create,t=Object.defineProperty,h=Object.defineProperties,l=Object.prototype.hasOwnProperty,b={configurable:!0,enumerable:!1,writable:!0},f,y,G,m,X,M,V;f=function(H,F){var N;return a(F),l.call(this,"__ee__")?N=this.__ee__:(N=b.value=R(null),t(this,"__ee__",b),b.value=null),N[H]?typeof N[H]=="object"?N[H].push(F):N[H]=[N[H],F]:N[H]=F,this},y=function(H,F){var N,O;return a(F),O=this,f.call(this,H,N=function(){G.call(O,H,N),u.call(F,this,arguments)}),N.__eeOnceListener__=F,this},G=function(H,F){var N,O,p,A;if(a(F),!l.call(this,"__ee__"))return this;if(N=this.__ee__,!N[H])return this;if(O=N[H],typeof O=="object")for(A=0;p=O[A];++A)(p===F||p.__eeOnceListener__===F)&&(O.length===2?N[H]=O[A?0:1]:O.splice(A,1));else(O===F||O.__eeOnceListener__===F)&&delete N[H];return this},m=function(H){var F,N,O,p,A;if(l.call(this,"__ee__")&&(p=this.__ee__[H],!!p))if(typeof p=="object"){for(N=arguments.length,A=new Array(N-1),F=1;F<N;++F)A[F-1]=arguments[F];for(p=p.slice(),F=0;O=p[F];++F)u.call(O,this,A)}else switch(arguments.length){case 1:g.call(p,this);break;case 2:g.call(p,this,arguments[1]);break;case 3:g.call(p,this,arguments[1],arguments[2]);break;default:for(N=arguments.length,A=new Array(N-1),F=1;F<N;++F)A[F-1]=arguments[F];u.call(p,this,A)}},X={on:f,once:y,off:G,emit:m},M={on:n(f),once:n(y),off:n(G),emit:n(m)},V=h({},M),r.exports=e=function(H){return H==null?R(V):h(Object(H),M)},e.methods=X})(Mc,rr);var Zr=pu,gu=Lc,Je=Uc,mu=rr;function pu(r){r=r||window;var e=mu(),n=[null,null],a=[null,null],u=[null,null],g=[null,null],R=0,t={},h,l,b=r===window?function(){h=window.innerWidth,l=window.innerHeight}:function(){h=r.clientWidth,l=r.clientHeight},f=0,y,G,m={},X=gu(r,function(i,s,d,T){y=s,G=d,f=i,m=T});function M(i){Je(i,r,u),b(),t.buttons=f,t.mods=m,t.x0=t.x=t.x1=2*u[0]/h-1,t.y0=t.y=t.y1=1-2*u[1]/l,t.x2=null,t.y2=null,t.dx=2*i.deltaX/h,t.dy=-2*i.deltaY/l,t.dz=2*i.deltaZ/h,t.active=1,t.zoomx=1,t.zoomy=1,t.theta=0,t.dtheta=0,t.originalEvent=i,e.emit("wheel",t),n[0]=u[0],n[1]=u[1]}var V=null,H=null,F=0;function N(i){Je(i,r,u),F=0,b(),t.buttons=f,t.mods=m,t.x=t.x1=2*u[0]/h-1,t.y=t.y1=1-2*u[1]/l,t.x2=null,t.y2=null,t.active=F,t.x0=2*V/h-1,t.y0=1-2*H/l,t.dx=0,t.dy=0,t.dz=0,t.zoomx=1,t.zoomy=1,t.theta=0,t.dtheta=0,t.originalEvent=i,e.emit("mouseup",t),V=H=null,n[0]=u[0],n[1]=u[1]}function O(i){Je(i,r,u),F=1,b(),V=y,H=G,t.buttons=f,t.mods=m,t.x=t.x0=t.x1=2*u[0]/h-1,t.y=t.y0=t.y1=1-2*u[1]/l,t.x2=null,t.y2=null,t.active=F,t.dx=0,t.dy=0,t.dz=0,t.zoomx=1,t.zoomy=1,t.theta=0,t.dtheta=0,t.originalEvent=i,e.emit("mousedown",t),n[0]=u[0],n[1]=u[1]}function p(i){Je(i,r,u),b(),t.buttons=f,t.mods=m,t.x0=2*V/h-1,t.y0=1-2*H/l,t.x=t.x1=2*u[0]/h-1,t.y=t.y1=1-2*u[1]/l,t.x2=null,t.y2=null,t.dx=2*(u[0]-n[0])/h,t.dy=-2*(u[1]-n[1])/l,t.active=F,t.dz=0,t.zoomx=1,t.zoomy=1,t.theta=0,t.dtheta=0,t.originalEvent=i,e.emit("mousemove",t),n[0]=u[0],n[1]=u[1]}function A(i){for(var s=i.identifier,d=0;d<g.length;d++)if(g[d]&&g[d].touch&&g[d].touch.identifier===s)return d;return-1}function I(i){a[0]=null,a[1]=null;for(var s=0;s<i.changedTouches.length;s++){var d=i.changedTouches[s],T=d.identifier,L=A(T);if(L===-1&&R<2){var C=g[0]?1:0,Y=g[0]?0:1,v={position:[0,0],touch:null};g[C]=v,R++,v.touch=d,Je(d,r,v.position),g[Y]&&g[Y].touch}}for(var S=0,w=0,k=0,s=0;s<g.length;s++)g[s]&&(S+=g[s].position[0],w+=g[s].position[1],k++);if(S/=k,w/=k,R>0){if(t.theta=0,k>1){var q=g[1].position[0]-g[0].position[0],W=(g[0].position[1]-g[1].position[1])*h/l;t.theta=Math.atan2(W,q)}b(),t.buttons=0,t.mods={},t.active=R,V=S,H=w,t.x0=2*V/h-1,t.y0=1-2*H/l,t.x=2*S/h-1,t.y=1-2*w/l,t.x1=2*g[0].position[0]/h-1,t.y1=1-2*g[0].position[1]/l,R>1&&(t.x2=2*g[1].position[0]/h-1,t.y2=1-2*g[1].position[1]/l),t.active=R,t.dx=0,t.dy=0,t.dz=0,t.zoomx=1,t.zoomy=1,t.dtheta=0,t.originalEvent=i,e.emit(R===1?"touchstart":"pinchstart",t)}}function P(i){for(var s,d=!1,T=0;T<i.changedTouches.length;T++){var L=i.changedTouches[T];s=A(L),s!==-1&&(d=!0,g[s].touch=L,Je(L,r,g[s].position))}if(d){if(R===1){for(s=0;s<g.length&&!g[s];s++);if(g[s]&&a[s]){var C=g[s].position[0],Y=g[s].position[1],v=C-a[s][0],S=Y-a[s][1];t.buttons=0,t.mods={},t.active=R,t.x=t.x1=2*C/h-1,t.y=t.y1=1-2*Y/l,t.x2=null,t.y2=null,t.x0=2*V/h-1,t.y0=1-2*H/l,t.dx=2*v/h,t.dy=-2*S/l,t.dz=0,t.zoomx=1,t.zoomy=1,t.theta=0,t.dtheta=0,t.originalEvent=i,e.emit("touchmove",t)}}else if(R===2&&a[0]&&a[1]){var w=a[0],k=a[1],q=k[0]-w[0],W=(k[1]-w[1])*h/l,j=g[0].position,$=g[1].position,ne=$[0]-j[0],J=(j[1]-$[1])*h/l,ie=Math.sqrt(q*q+W*W)*.5,x=Math.atan2(W,q),K=Math.sqrt(ne*ne+J*J)*.5,Z=Math.atan2(J,ne),D=(k[0]+w[0])*.5,B=(k[1]+w[1])*.5,v=.5*($[0]+j[0]-w[0]-k[0]),S=.5*($[1]+j[1]-w[1]-k[1]),z=K/ie,Q=Z-x;t.buttons=0,t.mods=m,t.active=R,t.x=2*D/h-1,t.y=1-2*B/l,t.x0=2*V/h-1,t.y0=1-2*H/l,t.x1=2*j[0]/h-1,t.y1=1-2*j[1]/l,t.x2=2*$[0]/h-1,t.y2=1-2*$[1]/l,t.dx=2*v/h,t.dy=-2*S/l,t.dz=0,t.zoomx=z,t.zoomy=z,t.theta=Z,t.dtheta=Q,t.originalEvent=i,e.emit("pinchmove",t)}}g[0]&&(a[0]=g[0].position.slice()),g[1]&&(a[1]=g[1].position.slice())}function U(i){for(var s,d=0;d<i.changedTouches.length;d++){var T=i.changedTouches[d],L=A(T);if(L!==-1){s=g[L],g[L]=null,R--;var C=L===0?1:0;g[C]&&g[C].touch}}var Y=0,v=0;if(R===0)s&&(Y=s.position[0],v=s.position[1]);else{for(var S=0,d=0;d<g.length;d++)g[d]&&(Y+=g[d].position[0],v+=g[d].position[1],S++);Y/=S,v/=S}R<2&&(t.buttons=0,t.mods=m,t.active=R,t.x=2*Y/h-1,t.y=1-2*v/l,t.x0=2*V/h-1,t.y0=1-2*H/l,t.dx=0,t.dy=0,t.dz=0,t.zoomx=1,t.zoomy=1,t.theta=0,t.dtheta=0,t.originalEvent=i,e.emit(R===0?"touchend":"pinchend",t)),R===0&&(V=H=null)}var c=!1;function E(){c||(c=!0,X.enabled=!0,r.addEventListener("wheel",M,!1),r.addEventListener("mousedown",O,!1),window.addEventListener("mousemove",p,!1),window.addEventListener("mouseup",N,!1),r.addEventListener("touchstart",I,!1),window.addEventListener("touchmove",P,!1),window.addEventListener("touchend",U,!1),window.addEventListener("touchcancel",U,!1))}function _(){c&&(c=!1,X.enabled=!1,r.removeEventListener("wheel",M,!1),r.removeEventListener("mousedown",O,!1),window.removeEventListener("mousemove",p,!1),window.removeEventListener("mouseup",N,!1),r.removeEventListener("touchstart",I,!1),window.removeEventListener("touchmove",P,!1),window.removeEventListener("touchend",U,!1),window.removeEventListener("touchcancel",U,!1))}return E(),e.enable=E,e.disable=_,e}function Tu(){return new Worker("/dat-garden-visualization/assets/graph-db-worker-571b24c8.js",{type:"module"})}function Au(){return new Worker("/dat-garden-visualization/assets/graph-layout-worker-7e84d6b4.js",{type:"module"})}const Zi=new Array(128).fill(void 0);Zi.push(void 0,null,!0,!1);const vu=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});vu.decode();Zi.length;const Lr=new TextEncoder("utf-8");Lr.encodeInto;var Ji={};(function(r){var e=xe&&xe.__extends||function(){var v=function(S,w){return v=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(k,q){k.__proto__=q}||function(k,q){for(var W in q)Object.prototype.hasOwnProperty.call(q,W)&&(k[W]=q[W])},v(S,w)};return function(S,w){if(typeof w!="function"&&w!==null)throw new TypeError("Class extends value "+String(w)+" is not a constructor or null");v(S,w);function k(){this.constructor=S}S.prototype=w===null?Object.create(w):(k.prototype=w.prototype,new k)}}(),n=xe&&xe.__classPrivateFieldSet||function(v,S,w){if(!S.has(v))throw new TypeError("attempted to set private field on non-instance");return S.set(v,w),w},a=xe&&xe.__classPrivateFieldGet||function(v,S){if(!S.has(v))throw new TypeError("attempted to get private field on non-instance");return S.get(v)},u,g,R,t,h,l,b,f,y,G,m,X,M,V,H,F,N,O,p,A,I,P;r.__esModule=!0,r.default=void 0;var U=function(v){var S=131,w=137,k=0;v+="x";for(var q=Math.floor(9007199254740991/w),W=0;W<v.length;W++)k>q&&(k=Math.floor(k/w)),k=k*S+v.charCodeAt(W);return k},c="0123456789abcdef".split(""),E=[-2147483648,8388608,32768,128],_=[24,16,8,0],i=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],s=[],d=function(){function v(S,w){S===void 0&&(S=!1),w===void 0&&(w=!1),u.set(this,void 0),g.set(this,void 0),R.set(this,void 0),t.set(this,void 0),h.set(this,void 0),l.set(this,void 0),b.set(this,void 0),f.set(this,void 0),y.set(this,void 0),G.set(this,void 0),m.set(this,void 0),X.set(this,void 0),M.set(this,void 0),V.set(this,void 0),H.set(this,void 0),F.set(this,void 0),N.set(this,0),O.set(this,void 0),this.init(S,w)}return v.prototype.init=function(S,w){w?(s[0]=s[16]=s[1]=s[2]=s[3]=s[4]=s[5]=s[6]=s[7]=s[8]=s[9]=s[10]=s[11]=s[12]=s[13]=s[14]=s[15]=0,n(this,g,s)):n(this,g,[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),S?(n(this,l,3238371032),n(this,b,914150663),n(this,f,812702999),n(this,y,4144912697),n(this,G,4290775857),n(this,m,1750603025),n(this,X,1694076839),n(this,M,3204075428)):(n(this,l,1779033703),n(this,b,3144134277),n(this,f,1013904242),n(this,y,2773480762),n(this,G,1359893119),n(this,m,2600822924),n(this,X,528734635),n(this,M,1541459225)),n(this,u,n(this,O,n(this,R,n(this,H,0)))),n(this,t,n(this,V,!1)),n(this,h,!0),n(this,F,S)},v.prototype.update=function(S){if(a(this,t))return this;var w;S instanceof ArrayBuffer?w=new Uint8Array(S):w=S;for(var k=0,q=w.length,W=a(this,g);k<q;){var j=void 0;if(a(this,V)&&(n(this,V,!1),W[0]=a(this,u),W[16]=W[1]=W[2]=W[3]=W[4]=W[5]=W[6]=W[7]=W[8]=W[9]=W[10]=W[11]=W[12]=W[13]=W[14]=W[15]=0),typeof w!="string")for(j=a(this,O);k<q&&j<64;++k)W[j>>2]|=w[k]<<_[j++&3];else for(j=a(this,O);k<q&&j<64;++k){var $=w.charCodeAt(k);$<128?W[j>>2]|=$<<_[j++&3]:$<2048?(W[j>>2]|=(192|$>>6)<<_[j++&3],W[j>>2]|=(128|$&63)<<_[j++&3]):$<55296||$>=57344?(W[j>>2]|=(224|$>>12)<<_[j++&3],W[j>>2]|=(128|$>>6&63)<<_[j++&3],W[j>>2]|=(128|$&63)<<_[j++&3]):($=65536+(($&1023)<<10|w.charCodeAt(++k)&1023),W[j>>2]|=(240|$>>18)<<_[j++&3],W[j>>2]|=(128|$>>12&63)<<_[j++&3],W[j>>2]|=(128|$>>6&63)<<_[j++&3],W[j>>2]|=(128|$&63)<<_[j++&3])}n(this,N,j),n(this,R,a(this,R)+(j-a(this,O))),j>=64?(n(this,u,W[16]),n(this,O,j-64),this.hash(),n(this,V,!0)):n(this,O,j)}return a(this,R)>4294967295&&(n(this,H,a(this,H)+(a(this,R)/4294967296<<0)),n(this,R,a(this,R)%4294967296)),this},v.prototype.finalize=function(){if(!a(this,t)){n(this,t,!0);var S=a(this,g),w=a(this,N);S[16]=a(this,u),S[w>>2]|=E[w&3],n(this,u,S[16]),w>=56&&(a(this,V)||this.hash(),S[0]=a(this,u),S[16]=S[1]=S[2]=S[3]=S[4]=S[5]=S[6]=S[7]=S[8]=S[9]=S[10]=S[11]=S[12]=S[13]=S[14]=S[15]=0),S[14]=a(this,H)<<3|a(this,R)>>>29,S[15]=a(this,R)<<3,this.hash()}},v.prototype.hash=function(){for(var S=a(this,l),w=a(this,b),k=a(this,f),q=a(this,y),W=a(this,G),j=a(this,m),$=a(this,X),ne=a(this,M),J=a(this,g),ie,x,K,Z,D,B,z,Q,re,te,ee=16;ee<64;++ee)Z=J[ee-15],ie=(Z>>>7|Z<<25)^(Z>>>18|Z<<14)^Z>>>3,Z=J[ee-2],x=(Z>>>17|Z<<15)^(Z>>>19|Z<<13)^Z>>>10,J[ee]=J[ee-16]+ie+J[ee-7]+x<<0;te=w&k;for(var ae=0;ae<64;ae+=4)a(this,h)?(a(this,F)?(z=300032,Z=J[0]-1413257819,ne=Z-150054599<<0,q=Z+24177077<<0):(z=704751109,Z=J[0]-210244248,ne=Z-1521486534<<0,q=Z+143694565<<0),n(this,h,!1)):(ie=(S>>>2|S<<30)^(S>>>13|S<<19)^(S>>>22|S<<10),x=(W>>>6|W<<26)^(W>>>11|W<<21)^(W>>>25|W<<7),z=S&w,K=z^S&k^te,B=W&j^~W&$,Z=ne+x+B+i[ae]+J[ae],D=ie+K,ne=q+Z<<0,q=Z+D<<0),ie=(q>>>2|q<<30)^(q>>>13|q<<19)^(q>>>22|q<<10),x=(ne>>>6|ne<<26)^(ne>>>11|ne<<21)^(ne>>>25|ne<<7),Q=q&S,K=Q^q&w^z,B=ne&W^~ne&j,Z=$+x+B+i[ae+1]+J[ae+1],D=ie+K,$=k+Z<<0,k=Z+D<<0,ie=(k>>>2|k<<30)^(k>>>13|k<<19)^(k>>>22|k<<10),x=($>>>6|$<<26)^($>>>11|$<<21)^($>>>25|$<<7),re=k&q,K=re^k&S^Q,B=$&ne^~$&W,Z=j+x+B+i[ae+2]+J[ae+2],D=ie+K,j=w+Z<<0,w=Z+D<<0,ie=(w>>>2|w<<30)^(w>>>13|w<<19)^(w>>>22|w<<10),x=(j>>>6|j<<26)^(j>>>11|j<<21)^(j>>>25|j<<7),te=w&k,K=te^w&q^re,B=j&$^~j&ne,Z=W+x+B+i[ae+3]+J[ae+3],D=ie+K,W=S+Z<<0,S=Z+D<<0;n(this,l,a(this,l)+S<<0),n(this,b,a(this,b)+w<<0),n(this,f,a(this,f)+k<<0),n(this,y,a(this,y)+q<<0),n(this,G,a(this,G)+W<<0),n(this,m,a(this,m)+j<<0),n(this,X,a(this,X)+$<<0),n(this,M,a(this,M)+ne<<0)},v.prototype.hex=function(){this.finalize();var S=a(this,l),w=a(this,b),k=a(this,f),q=a(this,y),W=a(this,G),j=a(this,m),$=a(this,X),ne=a(this,M),J=c[S>>28&15]+c[S>>24&15]+c[S>>20&15]+c[S>>16&15]+c[S>>12&15]+c[S>>8&15]+c[S>>4&15]+c[S&15]+c[w>>28&15]+c[w>>24&15]+c[w>>20&15]+c[w>>16&15]+c[w>>12&15]+c[w>>8&15]+c[w>>4&15]+c[w&15]+c[k>>28&15]+c[k>>24&15]+c[k>>20&15]+c[k>>16&15]+c[k>>12&15]+c[k>>8&15]+c[k>>4&15]+c[k&15]+c[q>>28&15]+c[q>>24&15]+c[q>>20&15]+c[q>>16&15]+c[q>>12&15]+c[q>>8&15]+c[q>>4&15]+c[q&15]+c[W>>28&15]+c[W>>24&15]+c[W>>20&15]+c[W>>16&15]+c[W>>12&15]+c[W>>8&15]+c[W>>4&15]+c[W&15]+c[j>>28&15]+c[j>>24&15]+c[j>>20&15]+c[j>>16&15]+c[j>>12&15]+c[j>>8&15]+c[j>>4&15]+c[j&15]+c[$>>28&15]+c[$>>24&15]+c[$>>20&15]+c[$>>16&15]+c[$>>12&15]+c[$>>8&15]+c[$>>4&15]+c[$&15];return a(this,F)||(J+=c[ne>>28&15]+c[ne>>24&15]+c[ne>>20&15]+c[ne>>16&15]+c[ne>>12&15]+c[ne>>8&15]+c[ne>>4&15]+c[ne&15]),J},v.prototype.toString=function(){return this.hex()},v.prototype.digest=function(){this.finalize();var S=a(this,l),w=a(this,b),k=a(this,f),q=a(this,y),W=a(this,G),j=a(this,m),$=a(this,X),ne=a(this,M),J=[S>>24&255,S>>16&255,S>>8&255,S&255,w>>24&255,w>>16&255,w>>8&255,w&255,k>>24&255,k>>16&255,k>>8&255,k&255,q>>24&255,q>>16&255,q>>8&255,q&255,W>>24&255,W>>16&255,W>>8&255,W&255,j>>24&255,j>>16&255,j>>8&255,j&255,$>>24&255,$>>16&255,$>>8&255,$&255];return a(this,F)||J.push(ne>>24&255,ne>>16&255,ne>>8&255,ne&255),J},v.prototype.array=function(){return this.digest()},v.prototype.arrayBuffer=function(){this.finalize();var S=new ArrayBuffer(a(this,F)?28:32),w=new DataView(S);return w.setUint32(0,a(this,l)),w.setUint32(4,a(this,b)),w.setUint32(8,a(this,f)),w.setUint32(12,a(this,y)),w.setUint32(16,a(this,G)),w.setUint32(20,a(this,m)),w.setUint32(24,a(this,X)),a(this,F)||w.setUint32(28,a(this,M)),S},v}();u=new WeakMap,g=new WeakMap,R=new WeakMap,t=new WeakMap,h=new WeakMap,l=new WeakMap,b=new WeakMap,f=new WeakMap,y=new WeakMap,G=new WeakMap,m=new WeakMap,X=new WeakMap,M=new WeakMap,V=new WeakMap,H=new WeakMap,F=new WeakMap,N=new WeakMap,O=new WeakMap,function(v){e(S,v);function S(w,k,q){k===void 0&&(k=!1),q===void 0&&(q=!1);var W=v.call(this,k,q)||this;p.set(W,void 0),A.set(W,void 0),I.set(W,void 0),P.set(W,void 0);var j;if(typeof w=="string"){for(var $=[],ne=w.length,J=0,ie=0;ie<ne;++ie){var x=w.charCodeAt(ie);x<128?$[J++]=x:x<2048?($[J++]=192|x>>6,$[J++]=128|x&63):x<55296||x>=57344?($[J++]=224|x>>12,$[J++]=128|x>>6&63,$[J++]=128|x&63):(x=65536+((x&1023)<<10|w.charCodeAt(++ie)&1023),$[J++]=240|x>>18,$[J++]=128|x>>12&63,$[J++]=128|x>>6&63,$[J++]=128|x&63)}j=$}else w instanceof ArrayBuffer?j=new Uint8Array(w):j=w;j.length>64&&(j=new d(k,!0).update(j).array());for(var K=[],Z=[],ie=0;ie<64;++ie){var D=j[ie]||0;K[ie]=92^D,Z[ie]=54^D}return W.update(Z),n(W,I,K),n(W,p,!0),n(W,A,k),n(W,P,q),W}return S.prototype.finalize=function(){if(v.prototype.finalize.call(this),a(this,p)){n(this,p,!1);var w=this.array();v.prototype.init.call(this,a(this,A),a(this,P)),this.update(a(this,I)),this.update(w),v.prototype.finalize.call(this)}},S}(d),p=new WeakMap,A=new WeakMap,I=new WeakMap,P=new WeakMap;function T(v){var S=new d;return S.update(v),parseInt(S.hex().substring(0,8),16)}var L=function(v){var S="#";return v.forEach(function(w){w<16&&(S+=0),S+=w.toString(16)}),S},C=function(v,S,w){v/=360;var k=w<.5?w*(1+S):w+S-w*S,q=2*w-k;return[v+1/3,v,v-1/3].map(function(W){return W<0&&W++,W>1&&W--,W<1/6?W=q+(k-q)*6*W:W<.5?W=k:W<2/3?W=q+(k-q)*6*(2/3-W):W=q,Math.round(W*255)})},Y=function(){function v(S){S===void 0&&(S={});var w=[S.lightness,S.saturation].map(function(W){return W=W!==void 0?W:[.35,.5,.65],Array.isArray(W)?W.concat():[W]}),k=w[0],q=w[1];this.L=k,this.S=q,typeof S.hue=="number"&&(S.hue={min:S.hue,max:S.hue}),typeof S.hue=="object"&&!Array.isArray(S.hue)&&(S.hue=[S.hue]),typeof S.hue>"u"&&(S.hue=[]),this.hueRanges=S.hue.map(function(W){return{min:typeof W.min>"u"?0:W.min,max:typeof W.max>"u"?360:W.max}}),this.hash=T,typeof S.hash=="function"&&(this.hash=S.hash),S.hash==="bkdr"&&(this.hash=U)}return v.prototype.hsl=function(S){var w,k,q,W=this.hash(S),j=727;if(this.hueRanges.length){var $=this.hueRanges[W%this.hueRanges.length];w=W/this.hueRanges.length%j*($.max-$.min)/j+$.min}else w=W%359;return W=Math.ceil(W/360),k=this.S[W%this.S.length],W=Math.ceil(W/this.S.length),q=this.L[W%this.L.length],[w,k,q]},v.prototype.rgb=function(S){var w=this.hsl(S);return C.apply(this,w)},v.prototype.hex=function(S){var w=this.rgb(S);return L(w)},v}();r.default=Y})(Ji);const Ru=Ka(Ji);var ge={},yu={get exports(){return ge},set exports(r){ge=r}};(function(r,e){(function(a,u){r.exports=u()})(self,()=>(()=>{var n={566:function(R,t){(function(h,l){l(t)})(this,function(h){function l(c){return!Number.isNaN(c)&&typeof c=="number"}function b(c){return l(c)&&Number.isFinite(c)}function f(c){return b(c)&&c%1===0}function y(c){return l(c)&&c>0}function G(c){return f(c)&&c>0}function m(c){return l(c)&&c<0}function X(c){return f(c)&&c<0}function M(c){return l(c)&&c>=0}function V(c){return f(c)&&c>=0}function H(c){return l(c)&&c<=0}function F(c){return f(c)&&c<=0}function N(c,E,_){return l(c)&&c>=E&&c<=_}function O(c,E,_){return f(c)&&c>=E&&c<=_}function p(c){return typeof c=="string"}function A(c){return ArrayBuffer.isView(c)&&!(c instanceof DataView)}function I(c){return Array.isArray(c)||A(c)}function P(c){return typeof c=="object"&&!I(c)&&c!==null&&!(c instanceof ArrayBuffer)&&!(c instanceof DataView)}function U(c){return typeof c=="boolean"}h.isArray=I,h.isBoolean=U,h.isFiniteNumber=b,h.isInteger=f,h.isIntegerInRange=O,h.isNegativeInteger=X,h.isNegativeNumber=m,h.isNonNegativeInteger=V,h.isNonNegativeNumber=M,h.isNonPositiveInteger=F,h.isNonPositiveNumber=H,h.isNumber=l,h.isNumberInRange=N,h.isObject=P,h.isPositiveInteger=G,h.isPositiveNumber=y,h.isString=p,h.isTypedArray=A,Object.defineProperty(h,"__esModule",{value:!0})})},809:(R,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.changeDpiBlob=O,t.changeDpiDataUrl=p;function h(U){if(Array.isArray(U)){for(var c=0,E=Array(U.length);c<U.length;c++)E[c]=U[c];return E}else return Array.from(U)}function l(){for(var U=new Int32Array(256),c=0;c<256;c++){for(var E=c,_=0;_<8;_++)E=E&1?3988292384^E>>>1:E>>>1;U[c]=E}return U}function b(U){var c=-1;f||(f=l());for(var E=0;E<U.length;E++)c=f[(c^U[E])&255]^c>>>8;return c^-1}var f=void 0,y="image/png",G="image/jpeg",m="AAlwSFlz",X="AAAJcEhZ",M="AAAACXBI",V="p".charCodeAt(0),H="H".charCodeAt(0),F="Y".charCodeAt(0),N="s".charCodeAt(0);function O(U,c){var E=U.slice(0,33);return new Promise(function(_,i){var s=new FileReader;s.onload=function(){var d=new Uint8Array(s.result),T=U.slice(33),L=P(d,c,U.type);_(new Blob([L,T],{type:U.type}))},s.readAsArrayBuffer(E)})}function p(U,c){var E=U.split(","),_=E[0],i=E[1],s=void 0,d=void 0,T=!1;if(_.indexOf(y)!==-1){s=y;var L=A(i);L>=0?(d=Math.ceil((L+28)/3)*4,T=!0):d=44}_.indexOf(G)!==-1&&(s=G,d=24);for(var C=i.substring(0,d),Y=i.substring(d),v=atob(C),S=new Uint8Array(v.length),w=0;w<S.length;w++)S[w]=v.charCodeAt(w);var k=P(S,c,s,T),q=btoa(String.fromCharCode.apply(String,h(k)));return[_,",",q,Y].join("")}function A(U){var c=U.indexOf(m);return c===-1&&(c=U.indexOf(X)),c===-1&&(c=U.indexOf(M)),c}function I(U){for(var c=U.length-1,E=c;E>=4;E--)if(U[E-4]===9&&U[E-3]===V&&U[E-2]===H&&U[E-1]===F&&U[E]===N)return E-3}function P(U,c,E,_){if(E===G)return U[13]=1,U[14]=c>>8,U[15]=c&255,U[16]=c>>8,U[17]=c&255,U;if(E===y){var i=new Uint8Array(13);c*=39.3701,i[0]=V,i[1]=H,i[2]=F,i[3]=N,i[4]=c>>>24,i[5]=c>>>16,i[6]=c>>>8,i[7]=c&255,i[8]=i[4],i[9]=i[5],i[10]=i[6],i[11]=i[7],i[12]=1;var s=b(i),d=new Uint8Array(4);if(d[0]=s>>>24,d[1]=s>>>16,d[2]=s>>>8,d[3]=s&255,_){var T=I(U);return U.set(i,T),U.set(d,T+13),U}else{var L=new Uint8Array(4);L[0]=0,L[1]=0,L[2]=0,L[3]=9;var C=new Uint8Array(54);return C.set(U,0),C.set(L,33),C.set(i,37),C.set(d,50),C}}}},162:function(R,t,h){var l,b,f;(function(y,G){b=[],l=G,f=typeof l=="function"?l.apply(t,b):l,f!==void 0&&(R.exports=f)})(this,function(){function y(F,N){return typeof N>"u"?N={autoBom:!1}:typeof N!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),N={autoBom:!N}),N.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(F.type)?new Blob(["\uFEFF",F],{type:F.type}):F}function G(F,N,O){var p=new XMLHttpRequest;p.open("GET",F),p.responseType="blob",p.onload=function(){H(p.response,N,O)},p.onerror=function(){console.error("could not download file")},p.send()}function m(F){var N=new XMLHttpRequest;N.open("HEAD",F,!1);try{N.send()}catch{}return 200<=N.status&&299>=N.status}function X(F){try{F.dispatchEvent(new MouseEvent("click"))}catch{var N=document.createEvent("MouseEvents");N.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),F.dispatchEvent(N)}}var M=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof h.g=="object"&&h.g.global===h.g?h.g:void 0,V=M.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),H=M.saveAs||(typeof window!="object"||window!==M?function(){}:"download"in HTMLAnchorElement.prototype&&!V?function(F,N,O){var p=M.URL||M.webkitURL,A=document.createElement("a");N=N||F.name||"download",A.download=N,A.rel="noopener",typeof F=="string"?(A.href=F,A.origin===location.origin?X(A):m(A.href)?G(F,N,O):X(A,A.target="_blank")):(A.href=p.createObjectURL(F),setTimeout(function(){p.revokeObjectURL(A.href)},4e4),setTimeout(function(){X(A)},0))}:"msSaveOrOpenBlob"in navigator?function(F,N,O){if(N=N||F.name||"download",typeof F!="string")navigator.msSaveOrOpenBlob(y(F,O),N);else if(m(F))G(F,N,O);else{var p=document.createElement("a");p.href=F,p.target="_blank",setTimeout(function(){X(p)})}}:function(F,N,O,p){if(p=p||open("","_blank"),p&&(p.document.title=p.document.body.innerText="downloading..."),typeof F=="string")return G(F,N,O);var A=F.type==="application/octet-stream",I=/constructor/i.test(M.HTMLElement)||M.safari,P=/CriOS\/[\d]+/.test(navigator.userAgent);if((P||A&&I||V)&&typeof FileReader<"u"){var U=new FileReader;U.onloadend=function(){var _=U.result;_=P?_:_.replace(/^data:[^;]*;/,"data:attachment/file;"),p?p.location.href=_:location=_,p=null},U.readAsDataURL(F)}else{var c=M.URL||M.webkitURL,E=c.createObjectURL(F);p?p.location=E:location.href=E,p=null,setTimeout(function(){c.revokeObjectURL(E)},4e4)}});M.saveAs=H.saveAs=H,R.exports=H})},484:function(R,t,h){var l=this&&this.__assign||function(){return l=Object.assign||function(_){for(var i,s=1,d=arguments.length;s<d;s++){i=arguments[s];for(var T in i)Object.prototype.hasOwnProperty.call(i,T)&&(_[T]=i[T])}return _},l.apply(this,arguments)},b=this&&this.__spreadArray||function(_,i,s){if(s||arguments.length===2)for(var d=0,T=i.length,L;d<T;d++)(L||!(d in i))&&(L||(L=Array.prototype.slice.call(i,0,d)),L[d]=i[d]);return _.concat(L||Array.prototype.slice.call(i))};Object.defineProperty(t,"__esModule",{value:!0}),t.GPUComposer=void 0;var f=h(809),y=h(566),G=h(355);h(191);var m=h(601),X=h(404),M=h(593),V=h(651),H=h(567),F=h(946),N=h(929),O=h(634),p=h(380),A=h(690),I=h(579),P=h(707),U=h(798),c=h(581),E=function(){function _(i){var s;this._errorState=!1,this._circlePositionsBuffer={},this._vertexAttributeLocations={},this._enabledVertexAttributes={},this._extensions={},this._clearValue=0,this._copyPrograms={},this._setValuePrograms={},this._vertexShaders=(s={},s[m.DEFAULT_PROGRAM_NAME]={src:V.DEFAULT_VERT_SHADER_SOURCE,compiledShaders:{}},s[m.SEGMENT_PROGRAM_NAME]={src:F.SEGMENT_VERTEX_SHADER_SOURCE,compiledShaders:{}},s[m.LAYER_POINTS_PROGRAM_NAME]={src:N.LAYER_POINTS_VERTEX_SHADER_SOURCE,compiledShaders:{}},s[m.LAYER_VECTOR_FIELD_PROGRAM_NAME]={src:O.LAYER_VECTOR_FIELD_VERTEX_SHADER_SOURCE,compiledShaders:{}},s[m.LAYER_LINES_PROGRAM_NAME]={src:H.LAYER_LINES_VERTEX_SHADER_SOURCE,compiledShaders:{}},s[m.LAYER_MESH_PROGRAM_NAME]={src:p.LAYER_MESH_VERTEX_SHADER_SOURCE,compiledShaders:{}},s),this.verboseLogging=!1,this._numTicks=0;var d=["canvas","context","contextID","contextAttributes","glslVersion","intPrecision","floatPrecision","clearValue","verboseLogging","errorCallback"],T=["canvas"],L=Object.keys(i);(0,P.checkValidKeys)(L,d,"GPUComposer(params)"),(0,P.checkRequiredKeys)(L,T,"GPUComposer(params)"),i.verboseLogging!==void 0&&(this.verboseLogging=i.verboseLogging);var C=this;this._errorCallback=function(q){C._errorState||(C._errorState=!0,i.errorCallback?i.errorCallback(q):(0,m.DEFAULT_ERROR_CALLBACK)(q))};var Y=i.canvas,v=i.context;if(!v){if(i.contextID){var S=Y.getContext(i.contextID,i.contextAttributes);S?v=S:console.warn("Unable to initialize WebGL context with contextID: ".concat(i.contextID,"."))}if(!v){var S=Y.getContext(m.WEBGL2,i.contextAttributes)||Y.getContext(m.WEBGL1,i.contextAttributes)||Y.getContext(m.EXPERIMENTAL_WEBGL2,i.contextAttributes)||Y.getContext(m.EXPERIMENTAL_WEBGL,i.contextAttributes);S&&(v=S)}if(!v){this._errorCallback("Unable to initialize WebGL context.");return}}this.isWebGL2=(0,M.isWebGL2)(v),this.isWebGL2?this.verboseLogging&&console.log("Using WebGL 2.0 context."):this.verboseLogging&&console.log("Using WebGL 1.0 context."),this.gl=v;var w=i.glslVersion||(this.isWebGL2?m.GLSL3:m.GLSL1);if(!this.isWebGL2&&w===m.GLSL3&&(console.warn("GLSL3.x is incompatible with WebGL1.0 contexts, falling back to GLSL1."),w=m.GLSL1),this.glslVersion=w,this.intPrecision=i.intPrecision||m.PRECISION_HIGH_P,this.floatPrecision=i.floatPrecision||m.PRECISION_HIGH_P,v.disable(v.DEPTH_TEST),v.pixelStorei(v.UNPACK_ALIGNMENT,1),this.isWebGL2)v.bindVertexArray(null);else{var k=(0,c.getExtension)(this,c.OES_VERTEX_ARRAY_OBJECT,!0);k.bindVertexArrayOES(null)}v.bindBuffer(v.ARRAY_BUFFER,null),i.clearValue!==void 0&&(this.clearValue=i.clearValue),this.resize([Y.clientWidth,Y.clientHeight]),this.verboseLogging&&console.log("".concat(this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS)," textures max."))}return _.initWithThreeRenderer=function(i,s){var d=new _(l(l({floatPrecision:i.capabilities.precision,intPrecision:i.capabilities.precision},s),{canvas:i.domElement,context:i.getContext()}));return d._threeRenderer=i,d},Object.defineProperty(_.prototype,"canvas",{get:function(){return this.gl.canvas},enumerable:!1,configurable:!0}),_.prototype._setValueProgramForType=function(i){var s=this._setValuePrograms,d=(0,A.uniformTypeForType)(i,this.glslVersion);return s[d]===void 0&&(s[d]=(0,I.setValueProgram)(this,{type:i,value:[0,0,0,0]})),s[d]},_.prototype._copyProgramForType=function(i){var s=this._copyPrograms,d=(0,A.uniformTypeForType)(i,this.glslVersion);return s[d]===void 0&&(s[d]=(0,I.copyProgram)(this,{type:i})),s[d]},_.prototype._initVertexBuffer=function(i){var s=this,d=s._errorCallback,T=s.gl,L=s.isWebGL2;if(L)T.bindVertexArray(null);else{var C=(0,c.getExtension)(this,c.OES_VERTEX_ARRAY_OBJECT,!0);C.bindVertexArrayOES(null)}var Y=T.createBuffer();if(!Y){d("Unable to allocate gl buffer.");return}return T.bindBuffer(T.ARRAY_BUFFER,Y),T.bufferData(T.ARRAY_BUFFER,i,T.STATIC_DRAW),Y},_.prototype._getQuadPositionsBuffer=function(){if(this._quadPositionsBuffer===void 0){var i=new Float32Array([-1,-1,1,-1,-1,1,1,1]);this._quadPositionsBuffer=this._initVertexBuffer(i)}return this._quadPositionsBuffer},_.prototype._getBoundaryPositionsBuffer=function(){if(this._boundaryPositionsBuffer===void 0){var i=new Float32Array([-1,-1,1,-1,1,1,-1,1,-1,-1]);this._boundaryPositionsBuffer=this._initVertexBuffer(i)}return this._boundaryPositionsBuffer},_.prototype._getCirclePositionsBuffer=function(i){var s=this._circlePositionsBuffer;if(s[i]==null){for(var d=[0,0],T=0;T<i;T++)d.push(Math.cos(2*Math.PI*T/i),Math.sin(2*Math.PI*T/i));d.push(Math.cos(0),Math.sin(0));var L=new Float32Array(d),C=this._initVertexBuffer(L);s[i]=C}return s[i]},_.prototype._cloneGPULayer=function(i,s){for(var d=i.is1D()?i.length:[i.width,i.height],T=new G.GPULayer(this,{name:s||"".concat(i.name,"-clone"),dimensions:d,type:i.type,numComponents:i.numComponents,filter:i.filter,wrapX:i.wrapX,wrapY:i.wrapY,numBuffers:i.numBuffers,clearValue:i.clearValue}),L=this._copyProgramForType(i.type),C=0;C<i.numBuffers-1;C++)T.incrementBufferIndex();for(var C=0;C<i.numBuffers;C++)this.step({program:L,input:i.getStateAtIndex(C),output:T});for(var C=-1;C<i.bufferIndex;C++)T.incrementBufferIndex();return T},_.prototype._getVertexShader=function(i,s,d,T){var L=this,C=L._errorCallback,Y=L._vertexShaders,v=L.gl,S=L.glslVersion,w=L.intPrecision,k=L.floatPrecision,q=Y[i],W=q.compiledShaders,j=q.src;if(s===""&&(s="_default"),W[s]===void 0){if(j==="")throw new Error('Error compiling GPUProgram "'.concat(T,'": no source for vertex shader with name "').concat(i,'".'));var $=(0,M.preprocessVertexShader)(j,S),ne=(0,M.compileShader)(v,S,w,k,$,v.VERTEX_SHADER,T,C,d,void 0,!0);if(!ne){C('Unable to compile "'.concat(i).concat(s,'" vertex shader for GPUProgram "').concat(T,'".'));return}W[s]=ne}return W[s]},_.prototype.resize=function(i){var s=this.canvas,d=i[0],T=i[1];if(!(0,y.isNonNegativeInteger)(d)||!(0,y.isNonNegativeInteger)(T))throw(0,y.isArray)(i)?new Error("Invalid dimensions parameter supplied to GPUComposer.resize(), expected positive integers, got: ".concat(d,", ").concat(T)):new Error("Invalid dimensions parameter supplied to GPUComposer.resize(), expected dimensions array of length 2, got: ".concat(JSON.stringify(i)));s.width=d,s.height=T,this._width=d,this._height=T},_.prototype._drawSetup=function(i,s,d,T,L,C){var Y=this.gl,v=[];if(L)if(L.layer)v.push(L);else if(L.constructor===G.GPULayer)v.push(L.currentState);else for(var S=0;S<L.length;S++){var w=L[S];v.push(w.currentState?w.currentState:w)}var k=i._getProgramWithName(s,d,v);this._setOutputLayer(i.name,T,L,C),Y.useProgram(k);for(var S=0;S<v.length;S++)Y.activeTexture(Y.TEXTURE0+S),Y.bindTexture(Y.TEXTURE_2D,v[S].texture);return i._setInternalFragmentUniforms(k,v),k},_.prototype._setBlendMode=function(i){var s=this.gl;i&&(s.enable(s.BLEND),s.blendFunc(s.SRC_ALPHA,s.ONE_MINUS_SRC_ALPHA))},_.prototype._addLayerToInputs=function(i,s){return s===void 0?[i]:(0,y.isArray)(s)?(0,M.indexOfLayerInArray)(i,s)>=0?s:b(b([],s,!0),[i],!1):s===i||s.layer===i?[s]:[s,i]},_.prototype._passThroughLayerDataFromInputToOutput=function(i){var s=this._copyProgramForType(i._internalType);this.step({program:s,input:i,output:i})},_.prototype._setOutputLayer=function(i,s,d,T){var L=this,C=L.gl,Y=L.isWebGL2;if(!T){C.bindFramebuffer(C.FRAMEBUFFER,null);var v=this,S=v._width,w=v._height;C.viewport(0,0,S,w);return}for(var k=(0,y.isArray)(T)?T:[T],q=0,W=k.length;q<W;q++){var j=k[q];if(d&&(d===T||d.layer===T||(0,y.isArray)(d)&&(0,M.indexOfLayerInArray)(j,d)>=0)){if(j.numBuffers===1)throw new Error('Cannot use same buffer "'.concat(j.name,'" for input and output of a program. Try increasing the number of buffers in your output layer to at least 2 so you can render to nextState using currentState as an input.'));s?j._prepareForWrite(!0):(this._passThroughLayerDataFromInputToOutput(j),j._prepareForWrite(!1))}else s?j._prepareForWrite(!0):(j._usingTextureOverrideForCurrentBuffer()&&this._passThroughLayerDataFromInputToOutput(j),j._prepareForWrite(!1))}var $=k[0],ne=void 0,J=[C.COLOR_ATTACHMENT0];if(k.length>1){ne=[];for(var q=1,W=k.length;q<W;q++)ne.push(k[q]._currentTexture),J.push(C.COLOR_ATTACHMENT0+q)}(0,U.bindFrameBuffer)(this,$,$._currentTexture,ne),Y&&C.drawBuffers(J);var ie=this._widthHeightForOutput(i,T),x=ie.width,K=ie.height;C.viewport(0,0,x,K)},_.prototype._setVertexAttribute=function(i,s,d,T){var L=this,C=L.gl,Y=L._vertexAttributeLocations,v=L._enabledVertexAttributes,S=Y[s],w;if(S||(S=new WeakMap,Y[s]=S),w===void 0){if(w=C.getAttribLocation(i,s),w<0)throw new Error('Unable to find vertex attribute "'.concat(s,'" in program "').concat(T,'".'));S.set(i,w)}C.vertexAttribPointer(w,d,C.FLOAT,!1,0,0),C.enableVertexAttribArray(w),v[w]=!0},_.prototype._disableVertexAttributes=function(){for(var i=this,s=i._enabledVertexAttributes,d=i.gl,T=Object.keys(s),L=0,C=T.length;L<C;L++){var Y=T[L];s[Y]&&(d.disableVertexAttribArray(Y),delete s[Y])}},_.prototype._setPositionAttribute=function(i,s){this._setVertexAttribute(i,"a_gpuio_position",2,s)},_.prototype._setIndexAttribute=function(i,s){this._setVertexAttribute(i,"a_gpuio_index",1,s)},_.prototype._setUVAttribute=function(i,s){this._setVertexAttribute(i,"a_gpuio_uv",2,s)},_.prototype._widthHeightForOutput=function(i,s){if((0,y.isArray)(s)){for(var d=s[0],T=d?d.width:this._width,L=d?d.height:this._height,C=1,Y=s.length;C<Y;C++){var v=s[C];if(v.width!==T||v.height!==L)throw new Error("Output GPULayers must have the same dimensions, got dimensions [".concat(T,", ").concat(L,"] and [").concat(v.width,", ").concat(v.height,'] for program "').concat(i,'".'))}return{width:T,height:L}}var S=s?s.width:this._width,w=s?s.height:this._height;return{width:S,height:w}},_.prototype._iterateOverOutputsIfNeeded=function(i,s){if(i.output&&(0,y.isArray)(i.output)&&this.glslVersion===m.GLSL1){for(var d=0,T=i.output.length;d<T;d++)this[s](l(l({},i),{program:d===0?i.program:i.program._childPrograms[d-1],output:i.output[d]}));return!0}return!1},_.prototype._drawFinish=function(i){var s=this.gl;i.blendAlpha&&s.disable(s.BLEND)},_.prototype.step=function(i){var s=["program","input","output","blendAlpha"],d=["program"],T=Object.keys(i);if((0,P.checkValidKeys)(T,s,"GPUComposer.step(params)"),(0,P.checkRequiredKeys)(T,d,"GPUComposer.step(params)"),!this._iterateOverOutputsIfNeeded(i,"step")){var L=this,C=L.gl,Y=L._errorState,v=i.program,S=i.input,w=i.output;if(!Y){var k=this._drawSetup(v,m.DEFAULT_PROGRAM_NAME,{},!0,S,w);v._setVertexUniform(k,"u_gpuio_scale",[1,1],m.FLOAT),v._setVertexUniform(k,"u_gpuio_translation",[0,0],m.FLOAT),C.bindBuffer(C.ARRAY_BUFFER,this._getQuadPositionsBuffer()),this._setPositionAttribute(k,v.name),this._setBlendMode(i.blendAlpha),C.drawArrays(C.TRIANGLE_STRIP,0,4),this._drawFinish(i)}}},_.prototype.stepBoundary=function(i){var s=["program","input","output","edges","blendAlpha"],d=["program"],T=Object.keys(i);if((0,P.checkValidKeys)(T,s,"GPUComposer.stepBoundary(params)"),(0,P.checkRequiredKeys)(T,d,"GPUComposer.stepBoundary(params)"),!this._iterateOverOutputsIfNeeded(i,"stepBoundary")){var L=this,C=L.gl,Y=L._errorState,v=i.program,S=i.input,w=i.output;if(!Y){var k=this._widthHeightForOutput(v.name,w),q=k.width,W=k.height,j=this._drawSetup(v,m.DEFAULT_PROGRAM_NAME,{},!1,S,w),$=[1/q,1/W];if(v._setVertexUniform(j,"u_gpuio_scale",[1-$[0],1-$[1]],m.FLOAT),v._setVertexUniform(j,"u_gpuio_translation",$,m.FLOAT),C.bindBuffer(C.ARRAY_BUFFER,this._getBoundaryPositionsBuffer()),this._setPositionAttribute(j,v.name),this._setBlendMode(i.blendAlpha),i.edges){var ne=i.edges;(0,y.isArray)(ne)||(ne=[ne]);for(var J=0,ie=ne.length;J<ie;J++){var x=ne[J];x===m.BOUNDARY_LEFT&&C.drawArrays(C.LINES,3,2),x===m.BOUNDARY_RIGHT&&C.drawArrays(C.LINES,1,2),x===m.BOUNDARY_TOP&&C.drawArrays(C.LINES,2,2),x===m.BOUNDARY_BOTTOM&&C.drawArrays(C.LINES,0,2)}}else C.drawArrays(C.LINE_LOOP,0,4);this._drawFinish(i)}}},_.prototype.stepNonBoundary=function(i){var s=["program","input","output","blendAlpha"],d=["program"],T=Object.keys(i);if((0,P.checkValidKeys)(T,s,"GPUComposer.stepNonBoundary(params)"),(0,P.checkRequiredKeys)(T,d,"GPUComposer.stepNonBoundary(params)"),!this._iterateOverOutputsIfNeeded(i,"stepNonBoundary")){var L=this,C=L.gl,Y=L._errorState,v=i.program,S=i.input,w=i.output;if(!Y){var k=this._widthHeightForOutput(v.name,w),q=k.width,W=k.height,j=this._drawSetup(v,m.DEFAULT_PROGRAM_NAME,{},!1,S,w),$=[1/q,1/W];v._setVertexUniform(j,"u_gpuio_scale",[1-2*$[0],1-2*$[1]],m.FLOAT),v._setVertexUniform(j,"u_gpuio_translation",$,m.FLOAT),C.bindBuffer(C.ARRAY_BUFFER,this._getQuadPositionsBuffer()),this._setPositionAttribute(j,v.name),this._setBlendMode(i.blendAlpha),C.drawArrays(C.TRIANGLE_STRIP,0,4),this._drawFinish(i)}}},_.prototype.stepCircle=function(i){var s,d=["program","position","diameter","useOutputScale","input","output","numSegments","blendAlpha"],T=["program","position","diameter"],L=Object.keys(i);if((0,P.checkValidKeys)(L,d,"GPUComposer.stepCircle(params)"),(0,P.checkRequiredKeys)(L,T,"GPUComposer.stepCircle(params)"),!this._iterateOverOutputsIfNeeded(i,"stepCircle")){var C=this,Y=C.gl,v=C._errorState,S=i.program,w=i.position,k=i.diameter,q=i.input,W=i.output;if(!v){var j=this._width,$=this._height;i.useOutputScale&&(s=this._widthHeightForOutput(S.name,W),j=s.width,$=s.height);var ne=this._drawSetup(S,m.DEFAULT_PROGRAM_NAME,{},!1,q,W);S._setVertexUniform(ne,"u_gpuio_scale",[k/j,k/$],m.FLOAT),S._setVertexUniform(ne,"u_gpuio_translation",[2*w[0]/j-1,2*w[1]/$-1],m.FLOAT);var J=i.numSegments?i.numSegments:m.DEFAULT_CIRCLE_NUM_SEGMENTS;if(J<3)throw new Error("numSegments for GPUComposer.stepCircle must be greater than 2, got ".concat(J,"."));Y.bindBuffer(Y.ARRAY_BUFFER,this._getCirclePositionsBuffer(J)),this._setPositionAttribute(ne,S.name),this._setBlendMode(i.blendAlpha),Y.drawArrays(Y.TRIANGLE_FAN,0,J+2),this._drawFinish(i)}}},_.prototype.stepSegment=function(i){var s,d=["program","position1","position2","thickness","useOutputScale","input","output","endCaps","numCapSegments","blendAlpha"],T=["program","position1","position2","thickness"],L=Object.keys(i);if((0,P.checkValidKeys)(L,d,"GPUComposer.stepSegment(params)"),(0,P.checkRequiredKeys)(L,T,"GPUComposer.stepSegment(params)"),!this._iterateOverOutputsIfNeeded(i,"stepSegment")){var C=this,Y=C.gl,v=C._errorState,S=i.program,w=i.position1,k=i.position2,q=i.thickness,W=i.input,j=i.output;if(!v){var $=this._width,ne=this._height;i.useOutputScale&&(s=this._widthHeightForOutput(S.name,j),$=s.width,ne=s.height);var J=this._drawSetup(S,m.SEGMENT_PROGRAM_NAME,{},!1,W,j);S._setVertexUniform(J,"u_gpuio_halfThickness",q/2,m.FLOAT),S._setVertexUniform(J,"u_gpuio_scale",[2/$,2/ne],m.FLOAT);var ie=w[0]-k[0],x=w[1]-k[1],K=Math.atan2(x,ie);S._setVertexUniform(J,"u_gpuio_rotation",K,m.FLOAT);var Z=(w[0]+k[0])/2,D=(w[1]+k[1])/2;S._setVertexUniform(J,"u_gpuio_translation",[2*Z/$-1,2*D/ne-1],m.FLOAT);var B=Math.sqrt(ie*ie+x*x),z=i.numCapSegments?i.numCapSegments*2:m.DEFAULT_CIRCLE_NUM_SEGMENTS;if(i.endCaps){if(z<6||z%6!==0)throw new Error("numCapSegments for GPUComposer.stepSegment must be divisible by 3, got ".concat(z/2,"."));S._setVertexUniform(J,"u_gpuio_length",B,m.FLOAT),Y.bindBuffer(Y.ARRAY_BUFFER,this._getCirclePositionsBuffer(z))}else S._setVertexUniform(J,"u_gpuio_length",B-q,m.FLOAT),Y.bindBuffer(Y.ARRAY_BUFFER,this._getQuadPositionsBuffer());this._setPositionAttribute(J,S.name),this._setBlendMode(i.blendAlpha),i.endCaps?Y.drawArrays(Y.TRIANGLE_FAN,0,z+2):Y.drawArrays(Y.TRIANGLE_STRIP,0,4),this._drawFinish(i)}}},_.prototype.stepRect=function(i){var s=["program","position","size","useOutputScale","input","output","blendAlpha"],d=["program","position","size"],T=Object.keys(i);if((0,P.checkValidKeys)(T,s,"GPUComposer.stepRect(params)"),(0,P.checkRequiredKeys)(T,d,"GPUComposer.stepRect(params)"),!this._iterateOverOutputsIfNeeded(i,"stepRect")){var L=[i.position[0],i.position[1]+i.size[1]/2],C=[i.position[0]+i.size[0],L[1]];this.stepSegment({program:i.program,position1:L,position2:C,thickness:i.size[1],useOutputScale:i.useOutputScale,input:i.input,output:i.output,endCaps:!1,blendAlpha:i.blendAlpha})}},_.prototype.drawLayerAsPoints=function(i){var s,d=["layer","program","input","output","pointSize","useOutputScale","count","color","wrapX","wrapY","blendAlpha"],T=["layer"],L=Object.keys(i);if((0,P.checkValidKeys)(L,d,"GPUComposer.drawLayerAsPoints(params)"),(0,P.checkRequiredKeys)(L,T,"GPUComposer.drawLayerAsPoints(params)"),!this._iterateOverOutputsIfNeeded(i,"drawLayerAsPoints")){var C=this,Y=C.gl,v=C._pointIndexArray,S=C.glslVersion,w=C._errorState,k=i.layer,q=i.output;if(!w){if(k.numComponents!==2&&k.numComponents!==4)throw new Error('GPUComposer.drawLayerAsPoints() must be passed a layer parameter with either 2 or 4 components, got layer "'.concat(k.name,'" with ').concat(k.numComponents," components."));var W=k.length,j=i.count||W;if(j>W)throw new Error("Invalid count ".concat(j," for layer parameter of length ").concat(W,"."));S===m.GLSL1&&j>m.MAX_FLOAT_INT&&console.warn("Points positions array length: ".concat(j," is longer than what is supported by GLSL1 : ").concat(m.MAX_FLOAT_INT,"."));var $=i.program;if($===void 0){$=this._setValueProgramForType(m.FLOAT);var ne=i.color||[1,0,0];if(ne.length!==3)throw new Error("Color parameter must have length 3, got ".concat(JSON.stringify(ne),"."));$.setUniform("u_value",b(b([],ne,!0),[1],!1),m.FLOAT)}var J=this._addLayerToInputs(k,i.input),ie={};k.numComponents===4&&(ie[m.GPUIO_VS_POSITION_W_ACCUM]="1"),i.wrapX&&(ie[m.GPUIO_VS_WRAP_X]="1"),i.wrapY&&(ie[m.GPUIO_VS_WRAP_Y]="1");var x=this._drawSetup($,m.LAYER_POINTS_PROGRAM_NAME,ie,!1,J,q);$._setVertexUniform(x,"u_gpuio_positions",(0,M.indexOfLayerInArray)(k,J),m.INT);var K=this._width,Z=this._height;i.useOutputScale&&(s=this._widthHeightForOutput($.name,q),K=s.width,Z=s.height),$._setVertexUniform(x,"u_gpuio_scale",[1/K,1/Z],m.FLOAT);var D=i.pointSize||1;$._setVertexUniform(x,"u_gpuio_pointSize",D,m.FLOAT);var B=[k.width,k.height];if($._setVertexUniform(x,"u_gpuio_positionsDimensions",B,m.FLOAT),S===m.GLSL1){if(this._pointIndexBuffer===void 0||v&&v.length<j){var z=(0,M.initSequentialFloatArray)(W);this._pointIndexArray=z,this._pointIndexBuffer=this._initVertexBuffer(z)}Y.bindBuffer(Y.ARRAY_BUFFER,this._pointIndexBuffer),this._setIndexAttribute(x,$.name)}this._setBlendMode(i.blendAlpha),Y.drawArrays(Y.POINTS,0,j),this._drawFinish(i)}}},_.prototype.drawLayerAsVectorField=function(i){var s=["layer","program","input","output","vectorSpacing","vectorScale","color","blendAlpha"],d=["layer"],T=Object.keys(i);if((0,P.checkValidKeys)(T,s,"GPUComposer.drawLayerAsVectorField(params)"),(0,P.checkRequiredKeys)(T,d,"GPUComposer.drawLayerAsVectorField(params)"),!this._iterateOverOutputsIfNeeded(i,"drawLayerAsVectorField")){var L=this,C=L.gl,Y=L._vectorFieldIndexArray,v=L._width,S=L._height,w=L.glslVersion,k=L._errorState,q=i.layer,W=i.output;if(!k){if(q.numComponents!==2)throw new Error('GPUComposer.drawLayerAsVectorField() must be passed a fieldLayer with 2 components, got fieldLayer "'.concat(q.name,'" with ').concat(q.numComponents," components."));var j=i.program;if(j===void 0){j=this._setValueProgramForType(m.FLOAT);var $=i.color||[1,0,0];if($.length!==3)throw new Error("color parameter must have length 3, got ".concat(JSON.stringify($),"."));j.setUniform("u_value",b(b([],$,!0),[1],!1),m.FLOAT)}var ne=this._addLayerToInputs(q,i.input),J=this._drawSetup(j,m.LAYER_VECTOR_FIELD_PROGRAM_NAME,{},!1,ne,W);j._setVertexUniform(J,"u_gpuio_vectors",(0,M.indexOfLayerInArray)(q,ne),m.INT);var ie=i.vectorScale||1;j._setVertexUniform(J,"u_gpuio_scale",[ie/v,ie/S],m.FLOAT);var x=i.vectorSpacing||10,K=[Math.floor(v/x),Math.floor(S/x)];j._setVertexUniform(J,"u_gpuio_dimensions",K,m.FLOAT);var Z=2*K[0]*K[1];if(w===m.GLSL1){if(this._vectorFieldIndexBuffer===void 0||Y&&Y.length<Z){var D=(0,M.initSequentialFloatArray)(Z);this._vectorFieldIndexArray=D,this._vectorFieldIndexBuffer=this._initVertexBuffer(D)}C.bindBuffer(C.ARRAY_BUFFER,this._vectorFieldIndexBuffer),this._setIndexAttribute(J,j.name)}this._setBlendMode(i.blendAlpha),C.drawArrays(C.LINES,0,Z),this._drawFinish(i)}}},_.prototype.drawLayerAsMesh=function(i){var s,d=["layer","indices","program","input","output","useOutputScale","color","blendAlpha"],T=["layer"],L=Object.keys(i);if((0,P.checkValidKeys)(L,d,"GPUComposer.drawLayerAsMesh(params)"),(0,P.checkRequiredKeys)(L,T,"GPUComposer.drawLayerAsMesh(params)"),!this._iterateOverOutputsIfNeeded(i,"drawLayerAsMesh")){var C=this,Y=C.gl,v=C._width,S=C._height,w=C.glslVersion,k=C._errorState,q=C._meshIndexBuffer,W=C._meshIndexArray,j=i.layer,$=i.output;if(!k){if(j.numComponents!==2&&j.numComponents!==4)throw new Error('GPUComposer.drawLayerAsMesh() must be passed a layer parameter with either 2 or 4 components, got position GPULayer "'.concat(j.name,'" with ').concat(j.numComponents," components."));var ne=j.is1D()?j.length:j.width*j.height;w===m.GLSL1&&ne>m.MAX_FLOAT_INT&&console.warn("Mesh positions array length: ".concat(ne," is longer than what is supported by GLSL1 : ").concat(m.MAX_FLOAT_INT,"."));var J=i.program;if(J===void 0){J=this._setValueProgramForType(m.FLOAT);var ie=i.color||[1,0,0];if(ie.length!==3)throw new Error("Color parameter must have length 3, got ".concat(JSON.stringify(ie),"."));J.setUniform("u_value",b(b([],ie,!0),[1],!1),m.FLOAT)}var x=this._addLayerToInputs(j,i.input),K={};j.numComponents===4&&(K[m.GPUIO_VS_POSITION_W_ACCUM]="1");var Z=this._drawSetup(J,m.LAYER_MESH_PROGRAM_NAME,K,!1,x,$);J._setVertexUniform(Z,"u_gpuio_positions",(0,M.indexOfLayerInArray)(j,x),m.INT);var D=v,B=S;i.useOutputScale&&(s=this._widthHeightForOutput(J.name,$),D=s.width,B=s.height),J._setVertexUniform(Z,"u_gpuio_scale",[1/D,1/B],m.FLOAT);var z=[j.width,j.height];if(J._setVertexUniform(Z,"u_gpuio_positionsDimensions",z,m.FLOAT),w===m.GLSL1){if(q===void 0||W&&W.length<ne){var Q=(0,M.initSequentialFloatArray)(ne);this._meshIndexArray=Q,this._meshIndexBuffer=this._initVertexBuffer(Q)}Y.bindBuffer(Y.ARRAY_BUFFER,this._meshIndexBuffer),this._setIndexAttribute(Z,J.name)}if(this._setBlendMode(i.blendAlpha),i.indices){var re=i.indices,te=re.glType,ee=re.count,ae=re.buffer;Y.bindBuffer(Y.ELEMENT_ARRAY_BUFFER,ae);var fe=0;Y.drawElements(Y.TRIANGLES,ee,te,fe)}else Y.drawArrays(Y.TRIANGLES,0,ne);this._drawFinish(i)}}},Object.defineProperty(_.prototype,"clearValue",{get:function(){return this._clearValue},set:function(i){var s=m.FLOAT,d=4;if(!(0,P.isValidClearValue)(i,d,s))throw new Error("Invalid clearValue: ".concat(JSON.stringify(i)," for GPUComposer, expected ").concat(s," or array of ").concat(s," of length ").concat(d,"."));this._clearValue=(0,y.isArray)(i)?i.slice():i,this._clearValueVec4=void 0},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"clearValueVec4",{get:function(){var i=this._clearValueVec4;if(!i){var s=this.clearValue;if(i=[],(0,y.isFiniteNumber)(s))i.push(s,s,s,s);else{i.push.apply(i,s);for(var d=i.length;d<4;d++)i.push(0)}this._clearValueVec4=i}return i},enumerable:!1,configurable:!0}),_.prototype.clear=function(){var i=this,s=i.verboseLogging,d=i.clearValueVec4;s&&console.log("Clearing GPUComoser.");var T=this._setValueProgramForType(m.FLOAT);T.setUniform("u_value",d),this.step({program:T})},_.prototype.undoThreeState=function(){var i=this,s=i.gl,d=i._threeRenderer,T=i.isWebGL2;if(!d)throw new Error("Can't call undoThreeState() on a GPUComposer that was not inited with GPUComposer.initWithThreeRenderer().");if(s.disable(s.BLEND),d)if(T)s.bindVertexArray(null);else{var L=(0,c.getExtension)(this,c.OES_VERTEX_ARRAY_OBJECT,!0);L.bindVertexArrayOES(null)}},_.prototype.resetThreeState=function(){var i=this,s=i.gl,d=i._threeRenderer;if(!d)throw new Error("Can't call resetThreeState() on a GPUComposer that was not inited with GPUComposer.initWithThreeRenderer().");var T=d.getViewport(new X.Vector4);s.viewport(T.x,T.y,T.width,T.height),d.resetState()},_.prototype.savePNG=function(i){i===void 0&&(i={});var s=["filename","dpi","callback"],d=Object.keys(i);(0,P.checkValidKeys)(d,s,"GPUComposer.savePNG(params)");var T=this.canvas,L=i.filename||"output",C=i.callback||saveAs;T.toBlob(function(Y){if(!Y){console.warn("Problem saving PNG, unable to init blob from canvas.");return}i.dpi?(0,f.changeDpiBlob)(Y,i.dpi).then(function(v){C(v,"".concat(L,".png"))}):C(Y,"".concat(L,".png"))},"image/png")},_.prototype.tick=function(){this._numTicks+=1;var i=this,s=i._lastTickTime,d=i._lastTickFPS,T=performance.now();if(this._lastTickTime=T,!s)return{fps:0,numTicks:this._numTicks};var L=1e3/(T-s);d||(d=L);var C=.9,Y=Number.parseFloat((C*d+(1-C)*L).toFixed(1));return this._lastTickFPS=Y,{fps:Y,numTicks:this._numTicks}},Object.defineProperty(_.prototype,"numTicks",{get:function(){return this._numTicks},enumerable:!1,configurable:!0}),_.prototype.dispose=function(){var i=this,s,d=this,T=d.gl,L=d.verboseLogging;L&&console.log("Deallocating GPUComposer."),this._quadPositionsBuffer&&(T.deleteBuffer(this._quadPositionsBuffer),delete this._quadPositionsBuffer),this._boundaryPositionsBuffer&&(T.deleteBuffer(this._boundaryPositionsBuffer),delete this._boundaryPositionsBuffer),Object.keys(this._circlePositionsBuffer).forEach(function(C){T.deleteBuffer(i._circlePositionsBuffer[C])}),delete this._circlePositionsBuffer,delete this._pointIndexArray,this._pointIndexBuffer&&(T.deleteBuffer(this._pointIndexBuffer),delete this._pointIndexBuffer),delete this._vectorFieldIndexArray,this._vectorFieldIndexBuffer&&(T.deleteBuffer(this._vectorFieldIndexBuffer),delete this._vectorFieldIndexBuffer),this._indexedLinesIndexBuffer&&(T.deleteBuffer(this._indexedLinesIndexBuffer),delete this._indexedLinesIndexBuffer),Object.keys(this._vertexAttributeLocations).forEach(function(C){delete i._vertexAttributeLocations[C]}),delete this._vertexAttributeLocations,delete this._enabledVertexAttributes,Object.values(this._vertexShaders).forEach(function(C){var Y=C.compiledShaders;Object.keys(Y).forEach(function(v){T.deleteShader(Y[v]),delete Y[v]})}),delete this._vertexShaders,Object.values(this._copyPrograms).forEach(function(C){C.dispose()}),Object.keys(this._copyPrograms).forEach(function(C){delete i._copyPrograms[C]}),delete this._copyPrograms,Object.values(this._setValuePrograms).forEach(function(C){C.dispose()}),Object.keys(this._setValuePrograms).forEach(function(C){delete i._setValuePrograms[C]}),delete this._setValuePrograms,(s=this._wrappedLineColorProgram)===null||s===void 0||s.dispose(),delete this._wrappedLineColorProgram,delete this._threeRenderer,delete this.gl,delete this.canvas,delete this._errorCallback,delete this._extensions,delete this._errorState,delete this.verboseLogging,delete this._numTicks,delete this.isWebGL2,delete this.glslVersion,delete this.intPrecision,delete this.floatPrecision,delete this._width,delete this._height,delete this._clearValue,delete this._clearValueVec4},_}();t.GPUComposer=E},981:(R,t,h)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GPUIndexBuffer=void 0;var l=h(566),b=h(650),f=h(707),y=h(581),G=function(){function m(X,M){if(this._composer=X,!M)throw new Error("Error initing GPUIndexBuffer: must pass params to GPUIndexBuffer(composer, params).");if(!(0,l.isObject)(M))throw new Error("Error initing GPUIndexBuffer: must pass valid params object to GPUIndexBuffer(composer, params), got ".concat(JSON.stringify(M),"."));var V=["indices","name"],H=["indices"],F=Object.keys(M);(0,f.checkValidKeys)(F,V,"GPUIndexBuffer(composer, params)",M.name),(0,f.checkRequiredKeys)(F,H,"GPUIndexBuffer(composer, params)",M.name);var N=M.indices,O=X.gl,p=X.isWebGL2,A=O.createBuffer();O.bindBuffer(O.ELEMENT_ARRAY_BUFFER,A),(0,b.isTypedArray)(N)||(N=new Uint32Array(N));var I;switch(N.constructor){case Uint8Array:I=O.UNSIGNED_BYTE;break;case Uint16Array:I=O.UNSIGNED_SHORT;break;case Uint32Array:if(!p){var P=(0,y.getExtension)(X,y.OES_ELEMENT_INDEX_UINT,!0);if(!P){I=O.UNSIGNED_SHORT,N=Uint16Array.from(N);break}}I=O.UNSIGNED_INT;break}O.bufferData(O.ELEMENT_ARRAY_BUFFER,N,O.STATIC_DRAW),this.buffer=A,this.glType=I,this.count=N.length}return m.prototype.dispose=function(){var X=this,M=X._composer,V=X.buffer;M.gl.deleteBuffer(V),delete this._composer,delete this.buffer,delete this.glType,delete this.count},m}();t.GPUIndexBuffer=G},355:function(R,t,h){var l=this&&this.__awaiter||function(O,p,A,I){function P(U){return U instanceof A?U:new A(function(c){c(U)})}return new(A||(A=Promise))(function(U,c){function E(s){try{i(I.next(s))}catch(d){c(d)}}function _(s){try{i(I.throw(s))}catch(d){c(d)}}function i(s){s.done?U(s.value):P(s.value).then(E,_)}i((I=I.apply(O,p||[])).next())})},b=this&&this.__generator||function(O,p){var A={label:0,sent:function(){if(U[0]&1)throw U[1];return U[1]},trys:[],ops:[]},I,P,U,c;return c={next:E(0),throw:E(1),return:E(2)},typeof Symbol=="function"&&(c[Symbol.iterator]=function(){return this}),c;function E(i){return function(s){return _([i,s])}}function _(i){if(I)throw new TypeError("Generator is already executing.");for(;A;)try{if(I=1,P&&(U=i[0]&2?P.return:i[0]?P.throw||((U=P.return)&&U.call(P),0):P.next)&&!(U=U.call(P,i[1])).done)return U;switch(P=0,U&&(i=[i[0]&2,U.value]),i[0]){case 0:case 1:U=i;break;case 4:return A.label++,{value:i[1],done:!1};case 5:A.label++,P=i[1],i=[0];continue;case 7:i=A.ops.pop(),A.trys.pop();continue;default:if(U=A.trys,!(U=U.length>0&&U[U.length-1])&&(i[0]===6||i[0]===2)){A=0;continue}if(i[0]===3&&(!U||i[1]>U[0]&&i[1]<U[3])){A.label=i[1];break}if(i[0]===6&&A.label<U[1]){A.label=U[1],U=i;break}if(U&&A.label<U[2]){A.label=U[2],A.ops.push(i);break}U[2]&&A.ops.pop(),A.trys.pop();continue}i=p.call(O,A)}catch(s){i=[6,s],P=0}finally{I=U=0}if(i[0]&5)throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(t,"__esModule",{value:!0}),t.GPULayer=void 0;var f=h(650),y=h(566),G=h(809),m=h(162),X=h(707),M=h(601),V=h(593),H=h(798),F=h(690),N=function(){function O(p,A){this._clearValue=0,this._bufferIndex=0,this._buffers=[];var I=(A||{}).name;if(!p)throw new Error('Error initing GPULayer "'.concat(I,'": must pass GPUComposer instance to GPULayer(composer, params).'));if(!A)throw new Error("Error initing GPULayer: must pass params to GPULayer(composer, params).");if(!(0,y.isObject)(A))throw new Error("Error initing GPULayer: must pass valid params object to GPULayer(composer, params), got ".concat(JSON.stringify(A),"."));var P=["name","type","numComponents","dimensions","filter","wrapX","wrapY","numBuffers","clearValue","array"],U=["name","type","numComponents","dimensions"],c=Object.keys(A);(0,X.checkValidKeys)(c,P,"GPULayer(composer, params)",A.name),(0,X.checkRequiredKeys)(c,U,"GPULayer(composer, params)",A.name);var E=A.dimensions,_=A.type,i=A.numComponents,s=p.gl;if(this._composer=p,this.name=I,!(0,y.isPositiveInteger)(i)||i>4)throw new Error("Invalid numComponents: ".concat(JSON.stringify(i),' for GPULayer "').concat(I,'", must be number in range [1-4].'));this.numComponents=i;var d=O.calcGPULayerSize(E,I,p.verboseLogging),T=d.length,L=d.width,C=d.height;this._length=T,this._width=L,this._height=C;var Y=T===void 0&&(_===M.FLOAT||_==M.HALF_FLOAT)?M.LINEAR:M.NEAREST,v=A.filter!==void 0?A.filter:Y;if(!(0,X.isValidFilter)(v))throw new Error("Invalid filter: ".concat(JSON.stringify(v),' for GPULayer "').concat(I,'", must be one of ').concat(JSON.stringify(M.validFilters),"."));if(v===M.LINEAR&&!(_===M.FLOAT||_==M.HALF_FLOAT))throw new Error('LINEAR filtering is not supported on integer types, please use NEAREST filtering for GPULayer "'.concat(I,'" with type: ').concat(_,"."));this.filter=v;var S=A.wrapX!==void 0?A.wrapX:M.CLAMP_TO_EDGE;if(!(0,X.isValidWrap)(S))throw new Error("Invalid wrapX: ".concat(JSON.stringify(S),' for GPULayer "').concat(I,'", must be one of ').concat(JSON.stringify(M.validWraps),"."));this.wrapX=S;var w=A.wrapY!==void 0?A.wrapY:M.CLAMP_TO_EDGE;if(!(0,X.isValidWrap)(w))throw new Error("Invalid wrapY: ".concat(JSON.stringify(w),' for GPULayer "').concat(I,'", must be one of ').concat(JSON.stringify(M.validWraps),"."));if(this.wrapY=w,!(0,X.isValidDataType)(_))throw new Error("Invalid type: ".concat(JSON.stringify(_),' for GPULayer "').concat(I,'", must be one of ').concat(JSON.stringify(M.validDataTypes),"."));this.type=_;var k=O.getGPULayerInternalType({composer:p,type:_,name:I});this._internalType=k;var q=O.getGLTextureParameters({composer:p,name:I,numComponents:i,internalType:k}),W=q.glFormat,j=q.glInternalFormat,$=q.glType,ne=q.glNumChannels;this._glInternalFormat=j,this._glFormat=W,this._glType=$,this._glNumChannels=ne;var J=O.getGPULayerInternalFilter({composer:p,filter:v,wrapX:S,wrapY:w,internalType:k,name:I});this._internalFilter=J,this._glFilter=s[J],this._internalWrapX=O.getGPULayerInternalWrap({composer:p,wrap:S,internalFilter:J,internalType:k,name:I}),this._glWrapS=s[this._internalWrapX],this._internalWrapY=O.getGPULayerInternalWrap({composer:p,wrap:w,internalFilter:J,internalType:k,name:I}),this._glWrapT=s[this._internalWrapY];var ie=A.numBuffers!==void 0?A.numBuffers:1;if(!(0,y.isPositiveInteger)(ie))throw new Error("Invalid numBuffers: ".concat(JSON.stringify(ie),' for GPULayer "').concat(I,'", must be positive integer.'));this.numBuffers=ie,A.clearValue!==void 0&&(this.clearValue=A.clearValue),this._initBuffers(A.array)}return O.initFromImageURL=function(p,A){return l(this,void 0,void 0,function(){return b(this,function(I){return[2,new Promise(function(P,U){if(!A)throw new Error("Error initing GPULayer: must pass params to GPULayer.initFromImageURL(composer, params).");if(!(0,y.isObject)(A))throw new Error("Error initing GPULayer: must pass valid params object to GPULayer.initFromImageURL(composer, params), got ".concat(JSON.stringify(A),"."));var c=["name","url","filter","wrapX","wrapY","format","type","clearValue"],E=["name","url"],_=Object.keys(A);(0,X.checkValidKeys)(_,c,"GPULayer.initFromImageURL(composer, params)",A.name),(0,X.checkRequiredKeys)(_,E,"GPULayer.initFromImageURL(composer, params)",A.name);var i=A.url,s=A.name,d=A.filter,T=A.wrapX,L=A.wrapY,C=A.type,Y=A.format;if(!(0,y.isString)(i))throw new Error("Expected GPULayer.initFromImageURL params to have url of type string, got ".concat(i," of type ").concat(typeof i,"."));if(C&&!(0,X.isValidImageType)(C))throw new Error('Invalid type: "'.concat(C,'" for GPULayer.initFromImageURL "').concat(s,'", must be one of ').concat(JSON.stringify(M.validImageTypes),"."));if(Y&&!(0,X.isValidImageFormat)(Y))throw new Error('Invalid format: "'.concat(Y,'" for GPULayer.initFromImageURL "').concat(s,'", must be one of ').concat(JSON.stringify(M.validImageFormats),"."));var v=new O(p,{name:s,type:C||M.FLOAT,numComponents:Y?Y.length:4,dimensions:[1,1],filter:d,wrapX:T,wrapY:L,numBuffers:1,clearValue:A.clearValue}),S=new Image;S.onload=function(){v.resize([S.width,S.height],S),P(v)},S.onerror=function(w){U(new Error('Error loading image "'.concat(s,'": ').concat(w)))},S.src=i})]})})},Object.defineProperty(O.prototype,"width",{get:function(){return this._width},enumerable:!1,configurable:!0}),Object.defineProperty(O.prototype,"height",{get:function(){return this._height},enumerable:!1,configurable:!0}),Object.defineProperty(O.prototype,"length",{get:function(){if(!this._length)throw new Error('Cannot access length on 2D GPULayer "'.concat(this.name,'".'));return this._length},enumerable:!1,configurable:!0}),O.prototype.is1D=function(){return this._length!==void 0},O.prototype.is2D=function(){return!this.is1D()},O.prototype._usingTextureOverrideForCurrentBuffer=function(){return!!(this._textureOverrides&&this._textureOverrides[this.bufferIndex])},O.prototype.copyCurrentStateToGPULayer=function(p){var A=this._composer;if(this===p)throw new Error("Can't call GPULayer.copyCurrentStateToGPULayer() on self.");var I=A._copyProgramForType(this._internalType);A.step({program:I,input:this,output:p})},O.prototype._initBuffers=function(p){var A=this,I=A.name,P=A.numBuffers,U=A._composer,c=A._glInternalFormat,E=A._glFormat,_=A._glType,i=A._glFilter,s=A._glWrapS,d=A._glWrapT,T=A.width,L=A.height,C=U.gl,Y=U._errorCallback,v=null;(0,y.isArray)(p)?v=O.validateGPULayerArray(p,this):p?.constructor===HTMLImageElement&&(v=p);for(var S=0;S<P;S++){var w=C.createTexture();if(!w){Y('Could not init texture for GPULayer "'.concat(I,'": ').concat(C.getError(),"."));return}C.bindTexture(C.TEXTURE_2D,w),C.texParameteri(C.TEXTURE_2D,C.TEXTURE_WRAP_S,s),C.texParameteri(C.TEXTURE_2D,C.TEXTURE_WRAP_T,d),C.texParameteri(C.TEXTURE_2D,C.TEXTURE_MIN_FILTER,i),C.texParameteri(C.TEXTURE_2D,C.TEXTURE_MAG_FILTER,i),C.texImage2D(C.TEXTURE_2D,0,c,T,L,0,E,_,v),this._buffers.push(w)}C.bindTexture(C.TEXTURE_2D,null),C.bindFramebuffer(C.FRAMEBUFFER,null)},Object.defineProperty(O.prototype,"bufferIndex",{get:function(){return this._bufferIndex},enumerable:!1,configurable:!0}),O.prototype.incrementBufferIndex=function(){var p=this.numBuffers;p!==1&&(this._bufferIndex=(this.bufferIndex+1)%p)},O.prototype.decrementBufferIndex=function(){var p=this.numBuffers;p!==1&&(this._bufferIndex=(this.bufferIndex-1+p)%p)},Object.defineProperty(O.prototype,"currentState",{get:function(){return this.getStateAtIndex(this.bufferIndex)},enumerable:!1,configurable:!0}),Object.defineProperty(O.prototype,"_currentTexture",{get:function(){var p=this,A=p._buffers,I=p._bufferIndex,P=p._textureOverrides;return P&&P[I]?P[I]:A[I]},enumerable:!1,configurable:!0}),Object.defineProperty(O.prototype,"lastState",{get:function(){if(this.numBuffers===1)throw new Error('Cannot access lastState on GPULayer "'.concat(this.name,'" with only one buffer.'));return this.getStateAtIndex((this.bufferIndex-1+this.numBuffers)%this.numBuffers)},enumerable:!1,configurable:!0}),O.prototype.getStateAtIndex=function(p){var A=this,I=A.numBuffers,P=A._textureOverrides,U=A._buffers;p<0&&p>-I&&(p+=I),(p<0||p>=I)&&(console.warn("Out of range buffer index: ".concat(p,' for GPULayer "').concat(this.name,'" with $.numBuffers} buffer').concat(I>1?"s":"",".  Was this intentional?")),p<0?p+=I*Math.ceil(Math.abs(p)/I):p=p%I);var c=U[p];return P&&P[p]&&(c=P[p]),{texture:c,layer:this}},O.prototype._prepareForWrite=function(p){p&&this.incrementBufferIndex(),this._textureOverrides&&(this._textureOverrides[this.bufferIndex]=void 0)},O.prototype.setFromArray=function(p){var A=this,I=A._composer,P=A._glInternalFormat,U=A._glFormat,c=A._glType,E=A.width,_=A.height,i=A._currentTexture,s=I.gl,d=O.validateGPULayerArray(p,this);s.bindTexture(s.TEXTURE_2D,i),s.texImage2D(s.TEXTURE_2D,0,P,E,_,0,U,c,d),s.bindTexture(s.TEXTURE_2D,null)},O.prototype.setAtIndex2D=function(p,A,I){var P=this,U=P._composer,c=P.width,E=P.height,_=P._currentTexture,i=U.gl;if(p<0||p>=c||A<0||A>=E)throw new Error("Invalid coordinates [".concat(p,", ").concat(A,'] for GPULayer "').concat(this.name,'" with dimensions [').concat(c,", ").concat(E,"]."));var s=O.validateGPULayerArray(I,this,1);i.bindTexture(i.TEXTURE_2D,_),i.texSubImage2D(i.TEXTURE_2D,0,p,A,1,1,this._glFormat,this._glType,s),i.bindTexture(i.TEXTURE_2D,null)},O.prototype.setAtIndex1D=function(p,A){var I=this;I._glInternalFormat,I._glFormat,I._glType;var P=I.width,U=I.height;if(I._currentTexture,p<0||p>=P*U)throw new Error("Invalid index ".concat(p,' for GPULayer "').concat(this.name,'" with dimensions [').concat(P,", ").concat(U,"]."));var c=p%P,E=Math.floor(p/P);this.setAtIndex2D(c,E,A)},O.prototype.resize=function(p,A){var I=this,P=I.name,U=I._composer,c=U.verboseLogging;c&&console.log('Resizing GPULayer "'.concat(P,'" to ').concat(JSON.stringify(p),"."));var E=O.calcGPULayerSize(p,P,c),_=E.length,i=E.width,s=E.height;this._length=_,this._width=i,this._height=s,this._destroyBuffers(),this._initBuffers(A)},Object.defineProperty(O.prototype,"clearValue",{get:function(){return this._clearValue},set:function(p){var A=this,I=A.numComponents,P=A.type;if(!(0,X.isValidClearValue)(p,I,P))throw new Error("Invalid clearValue: ".concat(JSON.stringify(p),' for GPULayer "').concat(this.name,'", expected ').concat(P," or array of ").concat(P," of length ").concat(I,"."));this._clearValue=(0,y.isArray)(p)?p.slice():p,this._clearValueVec4=void 0},enumerable:!1,configurable:!0}),Object.defineProperty(O.prototype,"clearValueVec4",{get:function(){var p=this._clearValueVec4;if(!p){var A=this.clearValue;if(p=[],(0,y.isFiniteNumber)(A))p.push(A,A,A,A);else{p.push.apply(p,A);for(var I=p.length;I<4;I++)p.push(0)}this._clearValueVec4=p}return p},enumerable:!1,configurable:!0}),O.prototype.clear=function(p){p===void 0&&(p=!1);var A=this,I=A.name,P=A._composer,U=A.clearValueVec4,c=A.numBuffers,E=A.type,_=P.verboseLogging;_&&console.log('Clearing GPULayer "'.concat(I,'".'));var i=P._setValueProgramForType(E);i.setUniform("u_value",U),this.decrementBufferIndex();for(var s=p?c:1,d=0;d<s;d++)P.step({program:i,output:this});p&&this.incrementBufferIndex()},O.prototype._getValuesSetup=function(){var p=this,A=p.width,I=p.height,P=p._composer,U=p._currentTexture,c=this._valuesRaw,E=P.gl;(0,H.bindFrameBuffer)(P,this,U);var _=this,i=_._glNumChannels,s=_._glType,d=_._glFormat,T=_._internalType;switch(T){case M.HALF_FLOAT:E.FLOAT!==void 0?(i=4,d=E.RGBA,s=E.FLOAT,c=c||new Float32Array(A*I*i)):c=c||new Uint16Array(A*I*i);break;case M.FLOAT:i=4,d=E.RGBA,c=c||new Float32Array(A*I*i);break;case M.UNSIGNED_BYTE:i=4,d=E.RGBA_INTEGER,s=E.UNSIGNED_INT,c=c||new Uint32Array(A*I*i);break;case M.UNSIGNED_SHORT:i=4,d=E.RGBA_INTEGER,s=E.UNSIGNED_INT,c=c||new Uint32Array(A*I*i);break;case M.UNSIGNED_INT:i=4,d=E.RGBA_INTEGER,c=c||new Uint32Array(A*I*i);break;case M.BYTE:i=4,d=E.RGBA_INTEGER,s=E.INT,c=c||new Int32Array(A*I*i);break;case M.SHORT:i=4,d=E.RGBA_INTEGER,s=E.INT,c=c||new Int32Array(A*I*i);break;case M.INT:i=4,d=E.RGBA_INTEGER,c=c||new Int32Array(A*I*i);break;default:throw new Error("Unsupported internalType ".concat(T," for getValues()."))}if(this._valuesRaw=c,(0,V.readyToRead)(E))return{_glFormat:d,_glType:s,_valuesRaw:c,_glNumChannels:i,_internalType:T};throw new Error("Unable to read values from Buffer with status: ".concat(E.checkFramebufferStatus(E.FRAMEBUFFER),"."))},O.prototype._getValuesPost=function(p,A,I){var P=this,U=P.width,c=P.height,E=P.numComponents,_=P.type,i=(this._length?this._length:U*c)*E,s=I===M.HALF_FLOAT&&p.constructor===Uint16Array,d=this._valuesBufferView;s&&!d&&(d=new DataView(p.buffer),this._valuesBufferView=d),p.length===i&&(0,F.arrayConstructorForType)(_,!0)===p.constructor?this._values=p:this._values||(this._values=O.initArrayForType(_,i,!0));var T=this._values;if(d||T!==p||E!==A)for(var L=0,C=U*c;L<C;L++){var Y=L*A,v=L*E;if(v>=i)break;for(var S=0;S<E;S++)d?T[v+S]=(0,f.getFloat16)(d,2*(Y+S),!0):T[v+S]=p[Y+S]}return T},O.prototype.getValues=function(){var p=this,A=p.width,I=p.height,P=p._composer,U=P.gl,c=this._getValuesSetup(),E=c._glFormat,_=c._glType,i=c._valuesRaw,s=c._glNumChannels,d=c._internalType;return U.readPixels(0,0,A,I,E,_,i),this._getValuesPost(i,s,d)},O.prototype.getValuesAsync=function(){return l(this,void 0,void 0,function(){var p,A,I,P,U,c,E,_,i,s,d,T;return b(this,function(L){switch(L.label){case 0:return p=this,A=p.width,I=p.height,P=p._composer,U=P.gl,c=P.isWebGL2,c?(E=this._getValuesSetup(),_=E._glFormat,i=E._glType,s=E._valuesRaw,d=E._glNumChannels,T=E._internalType,[4,(0,V.readPixelsAsync)(U,0,0,A,I,_,i,s)]):[2,this.getValues()];case 1:return L.sent(),[2,this._getValuesPost(s,d,T)]}})})},O.prototype._getCanvasWithImageData=function(p){var A=this.getValues(),I=this,P=I.width,U=I.height,c=I.numComponents,E=I.type;p=p||(E===M.FLOAT||E===M.HALF_FLOAT?255:1);var _=document.createElement("canvas");_.width=P,_.height=U;for(var i=_.getContext("2d"),s=i.getImageData(0,0,P,U),d=s.data,T=0;T<U;T++)for(var L=0;L<P;L++){for(var C=T*P+L,Y=(U-1-T)*P+L,v=0;v<c;v++)d[4*Y+v]=A[c*C+v]*p;c===1&&(d[4*Y+1]=d[4*Y],d[4*Y+2]=d[4*Y]),c<4&&(d[4*Y+3]=255)}return i.putImageData(s,0,0),_},O.prototype.getImage=function(p){if(p){var A=["multiplier"],I=Object.keys(p);(0,X.checkValidKeys)(I,A,"GPULayer.getImage(params)")}var P=this._getCanvasWithImageData(p&&p.multiplier),U=new Image;return U.src=P.toDataURL(),U},O.prototype.savePNG=function(p){p===void 0&&(p={});var A=["filename","dpi","multiplier","callback"],I=Object.keys(p);(0,X.checkValidKeys)(I,A,"GPULayer.savePNG(params)");var P=this.name,U=p.callback||m.saveAs,c=p.filename||P,E=this._getCanvasWithImageData(p.multiplier);E.toBlob(function(_){if(!_){console.warn('Problem saving PNG from GPULayer "'.concat(P,'", unable to init blob.'));return}p.dpi?(0,G.changeDpiBlob)(_,p.dpi).then(function(i){U(i,"".concat(c,".png"))}):U(_,"".concat(c,".png"))},"image/png")},O.prototype.attachToThreeTexture=function(p){var A=this,I=A._composer,P=A.numBuffers,U=A.currentState,c=A.name,E=I._threeRenderer,_=I.gl;if(!E)throw new Error("GPUComposer was not inited with a renderer.");if(P>1)throw new Error('GPULayer "'.concat(c,'" contains multiple WebGL textures (one for each buffer) that are flip-flopped during compute cycles, please choose a GPULayer with one buffer.  You can copy the current state of this GPULayer to a single buffer GPULayer during your render loop.'));var i=E.properties.get(p);_.deleteTexture(i.__webglTexture),i.__webglTexture=U.texture,i.__webglInit=!0},O.prototype._destroyBuffers=function(){var p=this,A=p._composer,I=p._buffers,P=A.gl;I.forEach(function(U){P.deleteTexture(U),(0,H.disposeFramebuffers)(P,U)}),I.length=0,delete this._textureOverrides},O.prototype.clone=function(p){return this._composer._cloneGPULayer(this,p)},O.prototype.dispose=function(){var p=this,A=p.name,I=p._composer,P=I.gl,U=I.verboseLogging;if(U&&console.log('Deallocating GPULayer "'.concat(A,'".')),!P)throw new Error("Must call dispose() on all GPULayers before calling dispose() on GPUComposer.");this._destroyBuffers(),delete this._buffers,delete this._composer,this._values&&delete this._values,this._valuesRaw&&delete this._valuesRaw},O}();t.GPULayer=N},191:(R,t,h)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.minMaxValuesForType=t.testFilterWrap=t.testWriteSupport=t.shouldCastIntTypeAsFloat=void 0;var l=h(566),b=h(650),f=h(601),y=h(690),G=h(581),m=h(798),X=h(355),M=h(593),V={writeSupport:{},filterWrapSupport:{}};X.GPULayer.initArrayForType=function(p,A,I){return I===void 0&&(I=!1),new((0,y.arrayConstructorForType)(p,I))(A)},X.GPULayer.calcGPULayerSize=function(p,A,I){if((0,l.isNumber)(p)){if(!(0,l.isPositiveInteger)(p))throw new Error("Invalid length: ".concat(JSON.stringify(p),' for GPULayer "').concat(A,'", must be positive integer.'));var P=p,U=Math.ceil(Math.sqrt(P)),c=Math.ceil(P/U);return I&&console.log("Using [".concat(U,", ").concat(c,"] for 1D array of length ").concat(p,' in GPULayer "').concat(A,'".')),{width:U,height:c,length:P}}var E=p[0];if(!(0,l.isPositiveInteger)(E))throw new Error("Invalid width: ".concat(JSON.stringify(E),' for GPULayer "').concat(A,'", must be positive integer.'));var _=p[1];if(!(0,l.isPositiveInteger)(_))throw new Error("Invalid height: ".concat(JSON.stringify(_),' for GPULayer "').concat(A,'", must be positive integer.'));return{width:E,height:_}},X.GPULayer.getGPULayerInternalWrap=function(p){var A=p.composer,I=p.wrap,P=p.internalFilter,U=p.internalType;return I===f.CLAMP_TO_EDGE||N(A,U,P,I)?I:f.CLAMP_TO_EDGE},X.GPULayer.getGPULayerInternalFilter=function(p){var A=p.filter;if(A===f.NEAREST)return A;var I=p.composer,P=p.internalType,U=p.wrapX,c=p.wrapY,E=p.name;if(P===f.HALF_FLOAT){var _=(0,G.getExtension)(I,G.OES_TEXTURE_HAlF_FLOAT_LINEAR,!0)||(0,G.getExtension)(I,G.OES_TEXTURE_FLOAT_LINEAR,!0);(!_||!N(I,P,A,U)||!N(I,P,A,c))&&(console.warn("This browser does not support ".concat(A," filtering for type ").concat(P," and wrap [").concat(U,", ").concat(c,'].  Falling back to NEAREST filter for GPULayer "').concat(E,'" with ').concat(A," polyfill in fragment shader.")),A=f.NEAREST)}if(P===f.FLOAT){var _=(0,G.getExtension)(I,G.OES_TEXTURE_FLOAT_LINEAR,!0);(!_||!N(I,P,A,U)||!N(I,P,A,c))&&(console.warn("This browser does not support ".concat(A," filtering for type ").concat(P," and wrap [").concat(U,", ").concat(c,'].  Falling back to NEAREST filter for GPULayer "').concat(E,'" with ').concat(A," polyfill in fragment shader.")),A=f.NEAREST)}return A};function H(p,A){var I=p.glslVersion,P=p.isWebGL2;return I===f.GLSL3&&P?!1:A===f.UNSIGNED_BYTE||A===f.BYTE||A===f.SHORT||A===f.INT||A===f.UNSIGNED_SHORT||A===f.UNSIGNED_INT}t.shouldCastIntTypeAsFloat=H,X.GPULayer.getGLTextureParameters=function(p){var A=p.composer,I=p.name,P=p.numComponents,U=p.internalType,c=A.gl,E=A.glslVersion,_=A.isWebGL2,i,s,d,T;if(_){if(T=P,P===3&&(T=4),U===f.FLOAT||U===f.HALF_FLOAT)switch(T){case 1:s=c.RED;break;case 2:s=c.RG;break;case 4:s=c.RGBA;break;default:throw new Error("Unsupported glNumChannels: ".concat(T,' for GPULayer "').concat(I,'".'))}else switch(T){case 1:s=c.RED_INTEGER;break;case 2:s=c.RG_INTEGER;break;case 4:s=c.RGBA_INTEGER;break;default:throw new Error("Unsupported glNumChannels: ".concat(T,' for GPULayer "').concat(I,'".'))}switch(U){case f.HALF_FLOAT:switch(i=c.HALF_FLOAT,T){case 1:d=c.R16F;break;case 2:d=c.RG16F;break;case 4:d=c.RGBA16F;break;default:throw new Error("Unsupported glNumChannels: ".concat(T,' for GPULayer "').concat(I,'".'))}break;case f.FLOAT:switch(i=c.FLOAT,T){case 1:d=c.R32F;break;case 2:d=c.RG32F;break;case 4:d=c.RGBA32F;break;default:throw new Error("Unsupported glNumChannels: ".concat(T,' for GPULayer "').concat(I,'".'))}break;case f.UNSIGNED_BYTE:if(i=c.UNSIGNED_BYTE,E===f.GLSL1&&U===f.UNSIGNED_BYTE)d=s;else switch(T){case 1:d=c.R8UI;break;case 2:d=c.RG8UI;break;case 4:d=c.RGBA8UI;break;default:throw new Error("Unsupported glNumChannels: ".concat(T,' for GPULayer "').concat(I,'".'))}break;case f.BYTE:switch(i=c.BYTE,T){case 1:d=c.R8I;break;case 2:d=c.RG8I;break;case 4:d=c.RGBA8I;break;default:throw new Error("Unsupported glNumChannels: ".concat(T,' for GPULayer "').concat(I,'".'))}break;case f.SHORT:switch(i=c.SHORT,T){case 1:d=c.R16I;break;case 2:d=c.RG16I;break;case 4:d=c.RGBA16I;break;default:throw new Error("Unsupported glNumChannels: ".concat(T,' for GPULayer "').concat(I,'".'))}break;case f.UNSIGNED_SHORT:switch(i=c.UNSIGNED_SHORT,T){case 1:d=c.R16UI;break;case 2:d=c.RG16UI;break;case 4:d=c.RGBA16UI;break;default:throw new Error("Unsupported glNumChannels: ".concat(T,' for GPULayer "').concat(I,'".'))}break;case f.INT:switch(i=c.INT,T){case 1:d=c.R32I;break;case 2:d=c.RG32I;break;case 4:d=c.RGBA32I;break;default:throw new Error("Unsupported glNumChannels: ".concat(T,' for GPULayer "').concat(I,'".'))}break;case f.UNSIGNED_INT:switch(i=c.UNSIGNED_INT,T){case 1:d=c.R32UI;break;case 2:d=c.RG32UI;break;case 4:d=c.RGBA32UI;break;default:throw new Error("Unsupported glNumChannels: ".concat(T,' for GPULayer "').concat(I,'".'))}break;default:throw new Error('Unsupported type: "'.concat(U,'" for GPULayer "').concat(I,'".'))}}else{if(P<1||P>4)throw new Error("Unsupported numComponents: ".concat(P,' for GPULayer "').concat(I,'".'));switch(T=4,s=c.RGBA,d=c.RGBA,U){case f.FLOAT:i=c.FLOAT;break;case f.HALF_FLOAT:i=c.HALF_FLOAT||(0,G.getExtension)(A,G.OES_TEXTURE_HALF_FLOAT).HALF_FLOAT_OES;break;default:throw new Error('Unsupported type: "'.concat(U,'" in WebGL 1.0 for GPULayer "').concat(I,'".'))}}if(i===void 0||s===void 0||d===void 0){var L=[];throw i===void 0&&L.push("glType"),s===void 0&&L.push("glFormat"),d===void 0&&L.push("glInternalFormat"),new Error("Invalid type: ".concat(U," for numComponents: ").concat(P,", unable to init parameter").concat(L.length>1?"s":""," ").concat(L.join(", "),' for GPULayer "').concat(I,'".'))}if(T===void 0||P<1||P>4||T<P)throw new Error("Invalid numChannels: ".concat(T," for numComponents: ").concat(P,' for GPULayer "').concat(I,'".'));return{glFormat:s,glInternalFormat:d,glType:i,glNumChannels:T}};function F(p,A){var I=p.gl,P=p.glslVersion,U=p.isWebGL2,c="".concat(U,",").concat(A,",").concat(P===f.GLSL3?"3":"1");if(V.writeSupport[c]!==void 0)return V.writeSupport[c];var E=I.createTexture();if(!E)return V.writeSupport[c]=!1,V.writeSupport[c];I.bindTexture(I.TEXTURE_2D,E);var _=I[f.CLAMP_TO_EDGE],i=I[f.NEAREST],s=10,d=10;I.texParameteri(I.TEXTURE_2D,I.TEXTURE_WRAP_S,_),I.texParameteri(I.TEXTURE_2D,I.TEXTURE_WRAP_T,_),I.texParameteri(I.TEXTURE_2D,I.TEXTURE_MIN_FILTER,i),I.texParameteri(I.TEXTURE_2D,I.TEXTURE_MAG_FILTER,i);var T=X.GPULayer.getGLTextureParameters({composer:p,name:"testWriteSupport",numComponents:1,internalType:A}),L=T.glInternalFormat,C=T.glFormat,Y=T.glType;I.texImage2D(I.TEXTURE_2D,0,L,s,d,0,C,Y,null);var v=I.createFramebuffer();if(!v)return I.deleteTexture(E),V.writeSupport[c]=!1,V.writeSupport[c];I.bindFramebuffer(I.FRAMEBUFFER,v),I.framebufferTexture2D(I.FRAMEBUFFER,I.COLOR_ATTACHMENT0,I.TEXTURE_2D,E,0);var S=I.checkFramebufferStatus(I.FRAMEBUFFER)===I.FRAMEBUFFER_COMPLETE;return I.deleteTexture(E),I.deleteFramebuffer(v),V.writeSupport[c]=S,V.writeSupport[c]}t.testWriteSupport=F;function N(p,A,I,P){var U,c=p.gl,E=p.glslVersion,_=p.intPrecision,i=p.floatPrecision,s=p._errorCallback,d=p.isWebGL2,T="".concat(d,",").concat(A,",").concat(I,",").concat(P,",").concat(E===f.GLSL3?"3":"1");if(V.filterWrapSupport[T]!==void 0)return V.filterWrapSupport[T];var L=c.createTexture();if(!L)return V.filterWrapSupport[T]=!1,V.filterWrapSupport[T];c.bindTexture(c.TEXTURE_2D,L);var C=c[P],Y=c[I],v=3,S=3,w=1;c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,C),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,C),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,Y),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,Y);for(var k=X.GPULayer.getGLTextureParameters({composer:p,name:"testFilterWrap",numComponents:w,internalType:A}),q=k.glInternalFormat,W=k.glFormat,j=k.glType,$=k.glNumChannels,ne=[3,56.5,834,-53.6,.003,96.2,23,90.2,32],J=X.GPULayer.initArrayForType(A,ne.length*$,!0),ie=0;ie<ne.length;ie++)J[ie*$]=ne[ie],ne[ie]=J[ie*$];if(A===f.HALF_FLOAT){for(var x=new Uint16Array(J.length),K=new DataView(x.buffer),ie=0;ie<J.length;ie++)(0,b.setFloat16)(K,2*ie,J[ie],!0);J=x}c.texImage2D(c.TEXTURE_2D,0,q,v,S,0,W,j,J);var Z=new X.GPULayer(p,{name:"testFloatLinearFiltering-output",type:A,numComponents:w,dimensions:[v,S],wrapX:f.CLAMP_TO_EDGE,wrapY:f.CLAMP_TO_EDGE,filter:f.NEAREST}),D=I===f.LINEAR?.5:1,B="testFilterWrap-program",z=`
in vec2 v_uv;
uniform vec2 u_offset;
#ifdef GPUIO_INT
	uniform isampler2D u_input;
	out int out_result;
#endif
#ifdef GPUIO_UINT
	uniform usampler2D u_input;
	out uint out_result;
#endif
#ifdef GPUIO_FLOAT
	uniform sampler2D u_input;
	out float out_result;
#endif
void main() {
	out_result = texture(u_input, v_uv + offset).x;
}`;E!==f.GLSL3&&(z=(0,M.convertFragmentShaderToGLSL1)(z,B)[0]);var Q=(0,M.compileShader)(c,E,_,i,z,c.FRAGMENT_SHADER,B,s,(U={offset:"vec2(".concat(D/v,", ").concat(D/S,")")},U[(0,M.isUnsignedIntType)(A)?"GPUIO_UINT":(0,M.isIntType)(A)?"GPUIO_INT":"GPUIO_FLOAT"]="1",U),void 0,!0);function re(ye,Ie){return P===f.CLAMP_TO_EDGE?Math.max(0,Math.min(Ie-1,ye)):(ye+Ie)%Ie}var te=p._getVertexShader(f.DEFAULT_PROGRAM_NAME,"",{},B);if(te&&Q){var ee=(0,M.initGLProgram)(c,te,Q,B,s);if(ee){Z._prepareForWrite(!1),(0,m.bindFrameBuffer)(p,Z,Z._currentTexture),c.viewport(0,0,v,S),c.useProgram(ee),c.activeTexture(c.TEXTURE0),c.bindTexture(c.TEXTURE_2D,L),c.uniform2fv(c.getUniformLocation(ee,"u_gpuio_scale"),[1,1]),c.uniform2fv(c.getUniformLocation(ee,"u_gpuio_translation"),[0,0]),c.bindBuffer(c.ARRAY_BUFFER,p._getQuadPositionsBuffer()),p._setPositionAttribute(ee,B),c.drawArrays(c.TRIANGLE_STRIP,0,4),c.disable(c.BLEND);for(var ae=Z.getValues(),fe=!0,_e=(0,M.isIntType)(A)?0:A===f.HALF_FLOAT?.01:1e-4,de=0;de<v;de++)for(var me=0;me<S;me++){var pe=void 0;if(I===f.LINEAR)pe=(ne[me*v+de]+ne[me*v+re(de+1,v)]+ne[re(me+1,S)*v+de]+ne[re(me+1,S)*v+re(de+1,v)])/4;else{var ve=re(de+D,v),Fe=re(me+D,S);pe=ne[Fe*v+ve]}var ie=me*v+de;if(Math.abs((pe-ae[ie])/pe)>_e){fe=!1;break}}V.filterWrapSupport[T]=fe,c.deleteProgram(ee)}else V.filterWrapSupport[T]=!1;c.deleteShader(Q)}else V.filterWrapSupport[T]=!1;return Z.dispose(),c.deleteTexture(L),V.filterWrapSupport[T]}t.testFilterWrap=N,X.GPULayer.getGPULayerInternalType=function(p){var A=p.composer,I=p.name,P=A._errorCallback,U=A.isWebGL2,c=p.type,E=c,_=H(A,c);if(_&&(E===f.UNSIGNED_BYTE||E===f.BYTE?E=f.HALF_FLOAT:(console.warn("Falling back ".concat(E,' type to FLOAT type for glsl1.x support for GPULayer "').concat(I,`".
Large UNSIGNED_INT or INT with absolute value > 16,777,216 are not supported, on mobile UNSIGNED_INT, INT, UNSIGNED_SHORT, and SHORT with absolute value > 2,048 may not be supported.`)),E=f.FLOAT)),U){if(E===f.FLOAT){var i=(0,G.getExtension)(A,G.EXT_COLOR_BUFFER_FLOAT,!0);if(!i)console.warn('FLOAT not supported in this browser, falling back to HALF_FLOAT type for GPULayer "'.concat(I,'".')),E=f.HALF_FLOAT;else{var s=F(A,E);s||(console.warn('FLOAT not supported for writing operations in this browser, falling back to HALF_FLOAT type for GPULayer "'.concat(I,'".')),E=f.HALF_FLOAT)}}if(E===f.HALF_FLOAT){var d=(0,G.getExtension)(A,G.EXT_COLOR_BUFFER_HALF_FLOAT,!0);d||(0,G.getExtension)(A,G.EXT_COLOR_BUFFER_FLOAT,!0);var s=F(A,E);s||(console.warn("This browser does not support writing to HALF_FLOAT textures."),P("This browser does not support writing to HALF_FLOAT textures."))}}else{if(E===f.FLOAT){var i=(0,G.getExtension)(A,G.OES_TEXTURE_FLOAT,!0);if(i){var s=F(A,E);s||(console.warn('FLOAT not supported for writing operations in this browser, falling back to HALF_FLOAT type for GPULayer "'.concat(I,'".')),E=f.HALF_FLOAT)}else console.warn('FLOAT not supported in this browser, falling back to HALF_FLOAT type for GPULayer "'.concat(I,'".')),E=f.HALF_FLOAT}if(E===f.HALF_FLOAT){(0,G.getExtension)(A,G.OES_TEXTURE_HALF_FLOAT,!0);var s=F(A,E);s||console.warn("This browser does not support writing to HALF_FLOAT textures.")}}return E};function O(p){var A=-1/0,I=1/0;switch(p){case f.UNSIGNED_BYTE:A=f.MIN_UNSIGNED_BYTE,I=f.MAX_UNSIGNED_BYTE;break;case f.BYTE:A=f.MIN_BYTE,I=f.MAX_BYTE;break;case f.UNSIGNED_SHORT:A=f.MIN_UNSIGNED_SHORT,I=f.MAX_UNSIGNED_SHORT;break;case f.SHORT:A=f.MIN_SHORT,I=f.MAX_SHORT;break;case f.UNSIGNED_INT:A=f.MIN_UNSIGNED_INT,I=f.MAX_UNSIGNED_INT;break;case f.INT:A=f.MIN_INT,I=f.MAX_INT;break}return{min:A,max:I}}t.minMaxValuesForType=O,X.GPULayer.validateGPULayerArray=function(p,A,I){I===void 0&&(I=null);var P=A.numComponents,U=A.width,c=A.height,E=A.name,_=A._glNumChannels,i=A._internalType,s=A.is1D()?A.length:null;if(I){if(p.length!==I*P)throw new Error("Invalid data length: ".concat(p.length,' for GPULayer "').concat(E,'" of numComponents: ').concat(P,"."))}else if(p.length!==U*c*P&&(!s||s&&p.length!==s*P))throw new Error("Invalid data length: ".concat(p.length,' for GPULayer "').concat(E,'" of ').concat(s?"length ".concat(s," and "):"","dimensions: [").concat(U,", ").concat(c,"] and numComponents: ").concat(P,"."));var d=!1;switch(p.constructor){case Array:d=!0;break;case Float32Array:d=i!==f.FLOAT;break;case Uint8Array:d=i!==f.UNSIGNED_BYTE;break;case Int8Array:d=i!==f.BYTE;break;case Uint16Array:d=i!==f.UNSIGNED_SHORT;break;case Int16Array:d=i!==f.SHORT;break;case Uint32Array:d=i!==f.UNSIGNED_INT;break;case Int32Array:d=i!==f.INT;break;default:throw new Error("Invalid array type: ".concat(p.constructor.name,' for GPULayer "').concat(E,'", please use one of [').concat(f.validArrayTypes.map(function(ie){return ie.name}).join(", "),"]."))}var T=O(i),L=T.min,C=T.max,Y=I?I*_:U*c*_,v=p.length!==Y,S=p;if(d||v){S=X.GPULayer.initArrayForType(i,Y);for(var w=i===f.HALF_FLOAT&&d?new DataView(S.buffer):null,k=0,q=p.length/P;k<q;k++)for(var W=0;W<P;W++){var j=p[k*P+W],$=j,ne=!1;$<L?($=L,ne=!0):$>C&&($=C,ne=!0),ne&&console.warn("Clipping out of range value ".concat(j," to ").concat($,' for GPULayer "').concat(E,'" with internal type ').concat(i,"."));var J=k*_+W;w?(0,b.setFloat16)(w,2*J,$,!0):S[J]=$}}return S}},664:function(R,t,h){var l=this&&this.__extends||function(){var F=function(N,O){return F=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(p,A){p.__proto__=A}||function(p,A){for(var I in A)Object.prototype.hasOwnProperty.call(A,I)&&(p[I]=A[I])},F(N,O)};return function(N,O){if(typeof O!="function"&&O!==null)throw new TypeError("Class extends value "+String(O)+" is not a constructor or null");F(N,O);function p(){this.constructor=N}N.prototype=O===null?Object.create(O):(p.prototype=O.prototype,new p)}}(),b=this&&this.__assign||function(){return b=Object.assign||function(F){for(var N,O=1,p=arguments.length;O<p;O++){N=arguments[O];for(var A in N)Object.prototype.hasOwnProperty.call(N,A)&&(F[A]=N[A])}return F},b.apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.GPUProgram=void 0;var f=h(601),y=h(593),G=h(360),m=h(566),X=h(707),M=h(581),V=function(){function F(N,O){var p=this;this._fragmentShaders={},this._compileTimeConstants={},this._uniforms={},this._programs={},this._programsKeyLookup=new WeakMap,this._samplerUniformsIndices=[];var A=(O||{}).name;if(!N)throw new Error('Error initing GPUProgram "'.concat(A,'": must pass GPUComposer instance to GPUProgram(composer, params).'));if(!O)throw new Error("Error initing GPUProgram: must pass params to GPUProgram(composer, params).");if(!(0,m.isObject)(O))throw new Error("Error initing GPUProgram: must pass valid params object to GPUProgram(composer, params), got ".concat(JSON.stringify(O),"."));var I=["name","fragmentShader","uniforms","compileTimeConstants"],P=["name","fragmentShader"],U=Object.keys(O);(0,X.checkValidKeys)(U,I,"GPUProgram(composer, params)",O.name),(0,X.checkRequiredKeys)(U,P,"GPUProgram(composer, params)",O.name);var c=O.fragmentShader,E=O.uniforms,_=O.compileTimeConstants;this._composer=N,this.name=A;var i=(0,m.isString)(c)?c:c.join(`
`),s=(0,y.preprocessFragmentShader)(i,N.glslVersion,A),d=s.shaderSource,T=s.samplerUniforms,L=s.additionalSources;if(this._fragmentShaderSource=d,T.forEach(function(W,j){p._samplerUniformsIndices.push({name:W,inputIndex:0,shaderIndex:j})}),this.constructor===F&&L){this._childPrograms=[];for(var C=0,Y=L.length;C<Y;C++)this._childPrograms.push(new H(N,O,{fragmentShaderSource:L[C]}))}if(_&&(this._compileTimeConstants=b({},_)),N.glslVersion===f.GLSL1&&(d.includes("dFdx")||d.includes("dFdy")||d.includes("fwidth"))){var v=(0,M.getExtension)(N,M.OES_STANDARD_DERIVATIVES,!0);v&&(this._extensions=`#extension GL_OES_standard_derivatives : enable
`)}if(E)for(var C=0;C<E.length;C++){var S=E[C],w=S.name,k=S.value,q=S.type;this.setUniform(w,k,q)}}return F.prototype.recompile=function(N){var O=this._compileTimeConstants,p=!1;if(Object.keys(N).forEach(function(k){O[k]!==N[k]&&(p=!0,O[k]=N[k])}),!!p){for(var A=this,I=A._fragmentShaders,P=A._programs,U=A._programsKeyLookup,c=A._composer,E=A._uniforms,_=c.gl,i=Object.keys(P),s=0,d=i.length;s<d;s++){var T=i[s],L=P[T];_.deleteProgram(L),U.delete(L),delete P[T]}for(var C=Object.keys(I),s=0,Y=C.length;s<Y;s++){var T=C[s];_.deleteShader(I[T]),delete I[T]}for(var v=Object.values(E),s=0,S=v.length;s<S;s++)v[s].location=new WeakMap;if(this._childPrograms)for(var s=0,w=this._childPrograms.length;s<w;s++)this._childPrograms[s].recompile(N)}},F.prototype._getFragmentShader=function(N,O){var p=this._fragmentShaders;if(p[N])return p[N];for(var A=this,I=A._composer,P=A.name,U=A._fragmentShaderSource,c=A._compileTimeConstants,E=A._extensions,_=I.gl,i=I._errorCallback,s=I.verboseLogging,d=I.glslVersion,T=I.floatPrecision,L=I.intPrecision,C=Object.keys(O),Y=0;Y<C.length;Y++){var v=C[Y];c[v]=O[v]}s&&console.log('Compiling fragment shader for GPUProgram "'.concat(P,'" with compile time constants: ').concat(JSON.stringify(c)));var S=(0,y.compileShader)(_,d,L,T,U,_.FRAGMENT_SHADER,P,i,c,E,Object.keys(p).length===0);if(!S){i('Unable to compile fragment shader for GPUProgram "'.concat(P,'".'));return}return p[N]=S,p[N]},F.prototype._getProgramWithName=function(N,O,p){for(var A=this,I=A._samplerUniformsIndices,P=A._composer,U="",c={},E=0,_=I.length;E<_;E++){var i=I[E].inputIndex,s=p[i].layer,d=s.filter,T=s.wrapX,L=s.wrapY,C=s.type,Y=s._internalFilter,v=s._internalWrapX,S=s._internalWrapY,w=T===v?0:T===f.REPEAT?1:0,k=L===S?0:L===f.REPEAT?1:0,q=d===Y?0:d===f.LINEAR?1:0;U+="_IN".concat(E,"_").concat(w,"_").concat(k,"_").concat(q),c["".concat(G.SAMPLER2D_WRAP_X).concat(E)]="".concat(w),c["".concat(G.SAMPLER2D_WRAP_Y).concat(E)]="".concat(k),c["".concat(G.SAMPLER2D_FILTER).concat(E)]="".concat(q),P.glslVersion===f.GLSL1&&(0,y.isIntType)(C)&&(c["".concat(G.SAMPLER2D_CAST_INT).concat(E)]="1")}var W=Object.keys(O).map(function(ae){return"_".concat(ae,"_").concat(O[ae])}).join(),j="".concat(N).concat(W).concat(U);if(this._programs[j])return this._programs[j];var $=this,ne=$._uniforms,J=$._programs,ie=$._programsKeyLookup,x=P.gl,K=P._errorCallback,Z=P._getVertexShader(N,W,O,this.name);if(Z===void 0){K('Unable to init vertex shader "'.concat(N).concat(W,'" for GPUProgram "').concat(this.name,'".'));return}var D=this._getFragmentShader(U,c);if(D===void 0){K('Unable to init fragment shader "'.concat(U,'" for GPUProgram "').concat(this.name,'".'));return}var B=(0,y.initGLProgram)(x,Z,D,this.name,K);if(B===void 0){x.deleteShader(D),K('Unable to init program "'.concat(j,'" for GPUProgram "').concat(this.name,'".'));return}x.useProgram(B);for(var z=Object.keys(ne),E=0,Q=z.length;E<Q;E++){var re=z[E],te=ne[re],ee=te.value,C=te.type;this._setProgramUniform(B,re,ee,C)}return J[j]=B,ie.set(B,j),B},F.prototype._setProgramUniform=function(N,O,p,A){var I,P=this,U=P._composer,c=P._uniforms,E=U.gl,_=U._errorCallback,i=U.glslVersion,s=i===f.GLSL3,d=(I=c[O])===null||I===void 0?void 0:I.location.get(N);if(d===void 0){var T=E.getUniformLocation(N,O);if(T===null){console.warn('Could not init uniform "'.concat(O,'" for program "').concat(this.name,'". Check that uniform is present in shader code, unused uniforms may be removed by compiler. Also check that uniform type in shader code matches type ').concat(A,". Error code: ").concat(E.getError(),"."));return}d=T,c[O]&&c[O].location.set(N,d);var L=E.getUniform(N,d),C=!1;if(A===f.BOOL_1D_UNIFORM||A===f.BOOL_2D_UNIFORM||A===f.BOOL_3D_UNIFORM||A===f.BOOL_4D_UNIFORM?!(0,m.isBoolean)(L)&&L.constructor!==Array&&(C=!0):A===f.FLOAT_1D_UNIFORM||A===f.FLOAT_2D_UNIFORM||A===f.FLOAT_3D_UNIFORM||A===f.FLOAT_4D_UNIFORM?!(0,m.isFiniteNumber)(L)&&L.constructor!==Float32Array&&(C=!0):A===f.INT_1D_UNIFORM||A===f.INT_2D_UNIFORM||A===f.INT_3D_UNIFORM||A===f.INT_4D_UNIFORM?!(0,m.isInteger)(L)&&L.constructor!==Int32Array&&(C=!0):(A===f.UINT_1D_UNIFORM||A===f.UINT_2D_UNIFORM||A===f.UINT_3D_UNIFORM||A===f.UINT_4D_UNIFORM)&&(s?!(0,m.isNonNegativeInteger)(L)&&L.constructor!==Uint32Array&&(C=!0):!(0,m.isNonNegativeInteger)(L)&&L.constructor!==Int32Array&&(C=!0)),C){_('Invalid uniform "'.concat(O,'" for program "').concat(this.name,'". Check that uniform type in shader code matches type ').concat(A,", gl.getUniform(program, location) returned type: ").concat(L.constructor.name,"."));return}}switch(A){case f.BOOL_1D_UNIFORM:E.uniform1i(d,p?1:0);break;case f.BOOL_2D_UNIFORM:E.uniform2i(d,p[0]?1:0,p[1]?1:0);break;case f.BOOL_3D_UNIFORM:E.uniform3i(d,p[0]?1:0,p[1]?1:0,p[2]?1:0);break;case f.BOOL_4D_UNIFORM:E.uniform4i(d,p[0]?1:0,p[1]?1:0,p[2]?1:0,p[3]?1:0);break;case f.FLOAT_1D_UNIFORM:E.uniform1f(d,p);break;case f.FLOAT_2D_UNIFORM:E.uniform2fv(d,p);break;case f.FLOAT_3D_UNIFORM:E.uniform3fv(d,p);break;case f.FLOAT_4D_UNIFORM:E.uniform4fv(d,p);break;case f.INT_1D_UNIFORM:E.uniform1i(d,p);break;case f.INT_2D_UNIFORM:E.uniform2iv(d,p);break;case f.INT_3D_UNIFORM:E.uniform3iv(d,p);break;case f.INT_4D_UNIFORM:E.uniform4iv(d,p);break;case f.UINT_1D_UNIFORM:s?E.uniform1ui(d,p):E.uniform1i(d,p);break;case f.UINT_2D_UNIFORM:s?E.uniform2uiv(d,p):E.uniform2iv(d,p);break;case f.UINT_3D_UNIFORM:s?E.uniform3uiv(d,p):E.uniform3iv(d,p);break;case f.UINT_4D_UNIFORM:s?E.uniform4uiv(d,p):E.uniform4iv(d,p);break;default:throw new Error("Unknown uniform type ".concat(A,' for GPUProgram "').concat(this.name,'".'))}},F.prototype._cacheUniformValue=function(N,O,p){var A=this._uniforms,I=A[N];if(!I)return A[N]={location:new WeakMap,value:(0,m.isArray)(O)?O.slice():O,type:p},!0;var P=I.value;if(I.value=(0,m.isArray)(O)?O.slice():O,(0,m.isArray)(O)){for(var U=0,c=O.length;U<c;U++)if(O[U]!==P[U])return!0;return!1}return O!==P},F.prototype.setUniform=function(N,O,p){var A,I=this,P=I._programs,U=I._uniforms,c=I._composer,E=I._samplerUniformsIndices,_=c.verboseLogging,i=c.gl;if((0,m.isArray)(O)){var s=O.length;if(s>4)throw new Error("Invalid uniform value: [".concat(O.join(", "),'] passed to GPUProgram "').concat(this.name,', uniforms must be of type number[] with length <= 4, number, or boolean."'))}var d=(A=U[N])===null||A===void 0?void 0:A.type;if(p){var T=(0,y.uniformInternalTypeForValue)(O,p,N,this.name);if(d===void 0)d=T;else if(d!==T)throw new Error('Uniform "'.concat(N,'" for GPUProgram "').concat(this.name,'" cannot change from type ').concat(d," to type ").concat(T,"."))}if(d===void 0)throw new Error('Unknown type for uniform "'.concat(N,'", please pass in type to GPUProgram.setUniform(name, value, type) when initing a new uniform.'));var L=this._cacheUniformValue(N,O,d);if(L){var C=E.find(function(W){return W.name===N});C&&(0,m.isInteger)(O)&&(C.inputIndex=O),_&&console.log('Setting uniform "'.concat(N,'" for program "').concat(this.name,'" to value ').concat(JSON.stringify(O),"."));for(var Y=Object.keys(P),v=0,S=Y.length;v<S;v++){var w=Y[v],k=P[w];i.useProgram(k),this._setProgramUniform(k,N,O,d)}if(this._childPrograms)for(var v=0,q=this._childPrograms.length;v<q;v++)this._childPrograms[v].setUniform(N,O,p)}},F.prototype._setInternalFragmentUniforms=function(N,O){if(O.length!==0){if(!N)throw new Error("Must pass in valid WebGLProgram to GPUProgram._setInternalFragmentUniforms, got undefined.");var p=this,A=p._programsKeyLookup,I=p._samplerUniformsIndices,P=A.get(N);if(!P)throw new Error('Could not find valid programName for WebGLProgram in GPUProgram "'.concat(this.name,'".'));for(var U=new Array(Math.max(O.length,I.length)).fill(-1),c=0,E=I.length;c<E;c++){var _=I[c],i=_.inputIndex,s=_.shaderIndex;U[i]>=0?console.warn("Found > 1 sampler2D uniforms at texture index ".concat(i,' for GPUProgram "').concat(this.name,'".')):U[i]=s}for(var c=0,d=O.length;c<d;c++){var T=O[c].layer,L=T.width,C=T.height,Y=U[c];if(!(Y<0)){var v=T.filter,S=T.wrapX,w=T.wrapY,k=T._internalFilter,q=T._internalWrapX,W=T._internalWrapY,j=v!==k;if(j||S!==q||w!==W){var $=[.5/L,.5/C],ne="".concat(G.SAMPLER2D_HALF_PX_UNIFORM).concat(Y),J=this._cacheUniformValue(ne,$,f.FLOAT_2D_UNIFORM);if(J&&this._setProgramUniform(N,ne,$,f.FLOAT_2D_UNIFORM),j){var ie=[L,C],x="".concat(G.SAMPLER2D_DIMENSIONS_UNIFORM).concat(Y),K=this._cacheUniformValue(x,ie,f.FLOAT_2D_UNIFORM);K&&this._setProgramUniform(N,x,ie,f.FLOAT_2D_UNIFORM)}}}}}},F.prototype._setVertexUniform=function(N,O,p,A){if(!N)throw new Error("Must pass in valid WebGLProgram to GPUProgram._setVertexUniform, got undefined.");var I=this._programsKeyLookup,P=I.get(N);if(!P)throw new Error('Could not find valid programName for WebGLProgram in GPUProgram "'.concat(this.name,'".'));var U=(0,y.uniformInternalTypeForValue)(p,A,O,this.name);this._setProgramUniform(N,O,p,U)},F.prototype.dispose=function(){var N=this,O=N._composer,p=N._fragmentShaders,A=N._programs,I=N._programsKeyLookup,P=O.gl,U=O.verboseLogging;if(U&&console.log('Deallocating GPUProgram "'.concat(this.name,'".')),!P)throw new Error("Must call dispose() on all GPUPrograms before calling dispose() on GPUComposer.");if(Object.values(A).forEach(function(_){_&&(P.deleteProgram(_),I.delete(_))}),Object.keys(A).forEach(function(_){delete A[_]}),Object.values(p).forEach(function(_){P.deleteShader(_)}),Object.keys(p).forEach(function(_){delete p[_]}),this._childPrograms){for(var c=0,E=this._childPrograms.length;c<E;c++)this._childPrograms[c].dispose();this._childPrograms.length}delete this._childPrograms,delete this._composer,delete this.name,delete this._fragmentShaderSource,delete this._compileTimeConstants,delete this._extensions,delete this._uniforms,delete this._programs,delete this._programsKeyLookup,delete this._fragmentShaders,delete this._samplerUniformsIndices},F}();t.GPUProgram=V;var H=function(F){l(N,F);function N(O,p,A){var I=F.call(this,O,p)||this,P=A.fragmentShaderSource;return I._fragmentShaderSource=P,I}return N}(V)},579:(R,t,h)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.wrappedLineColorProgram=t.renderSignedAmplitudeProgram=t.renderAmplitudeProgram=t.renderRGBProgram=t.zeroProgram=t.setColorProgram=t.setValueProgram=t.multiplyValueProgram=t.addValueProgram=t.addLayersProgram=t.copyProgram=void 0;var l=h(566),b=h(601),f=h(690),y=h(664);function G(I,P){var U=P.type,c=P.precision||"",E=(0,f.glslTypeForType)(U,4),_=P.name||"copy_".concat((0,f.uniformTypeForType)(U,I.glslVersion),"_layer");return new y.GPUProgram(I,{name:_,fragmentShader:`
in vec2 v_uv;
uniform `.concat(c," ").concat((0,f.glslPrefixForType)(U),`sampler2D u_state;
out `).concat(c," ").concat(E,` out_result;
void main() {
	out_result = texture(u_state, v_uv);
}`),uniforms:[{name:"u_state",value:0,type:b.INT}]})}t.copyProgram=G;function m(I,P){var U=P.type,c=P.numInputs||2,E=P.precision||"",_=P.components||"xyzw",i=(0,f.glslTypeForType)(U,_.length),s=new Array(c),d=P.name||"".concat(c,"-way_add_").concat((0,f.uniformTypeForType)(U,I.glslVersion),"_").concat(_);return new y.GPUProgram(I,{name:d,fragmentShader:`
in vec2 v_uv;
`.concat(s.map(function(T,L){return"uniform ".concat(E," ").concat((0,f.glslPrefixForType)(U),"sampler2D u_state").concat(L,";")}).join(`
`),`
out `).concat(E," ").concat(i,` out_result;
void main() {
	out_result = `).concat(s.map(function(T,L){return"texture(u_state".concat(L,", v_uv).").concat(_)}).join(" + "),`;
}`),uniforms:s.map(function(T,L){return{name:"u_state".concat(L),value:L,type:b.INT}})})}t.addLayersProgram=m;function X(I,P){var U=P.type,c=P.value,E=P.precision||"",_=(0,l.isArray)(c)?c.length:1,i=(0,f.glslTypeForType)(U,_),s=_===1?4:_,d=(0,f.glslTypeForType)(U,s),T=(0,f.glslComponentSelectionForNumComponents)(s),L=P.name||"addValue_".concat(i,"_w_length_").concat(_);return new y.GPUProgram(I,{name:L,fragmentShader:`
in vec2 v_uv;
uniform `.concat(E," ").concat(i,` u_value;
uniform `).concat(E," ").concat((0,f.glslPrefixForType)(U),`sampler2D u_state;
out `).concat(E," ").concat(d,` out_result;
void main() {
	out_result = `).concat(i!==d?d:"","(u_value) + texture(u_state, v_uv)").concat(T,`;
}`),uniforms:[{name:"u_state",value:0,type:b.INT},{name:"u_value",value:c,type:(0,f.uniformTypeForType)(U,I.glslVersion)}]})}t.addValueProgram=X;function M(I,P){var U=P.type,c=P.value,E=P.precision||"",_=(0,l.isArray)(c)?c.length:1,i=(0,f.glslTypeForType)(U,_),s=_===1?4:_,d=(0,f.glslTypeForType)(U,s),T=(0,f.glslComponentSelectionForNumComponents)(s),L=P.name||"addValue_".concat(i,"_w_length_").concat(_);return new y.GPUProgram(I,{name:L,fragmentShader:`
in vec2 v_uv;
uniform `.concat(E," ").concat(i,` u_value;
uniform `).concat(E," ").concat((0,f.glslPrefixForType)(U),`sampler2D u_state;
out `).concat(E," ").concat(d,` out_result;
void main() {
	out_result = `).concat(i!==d?d:"","(u_value) * texture(u_state, v_uv)").concat(T,`;
}`),uniforms:[{name:"u_state",value:0,type:b.INT},{name:"u_value",value:c,type:(0,f.uniformTypeForType)(U,I.glslVersion)}]})}t.multiplyValueProgram=M;function V(I,P){var U=P.type,c=P.value,E=P.precision||"",_=(0,l.isArray)(c)?c.length:1,i=(0,f.glslTypeForType)(U,_),s=_===1?4:_,d=(0,f.glslTypeForType)(U,s),T=P.name||"setValue_".concat(i,"_w_length_").concat(_);return new y.GPUProgram(I,{name:T,fragmentShader:`
uniform `.concat(E," ").concat(i,` u_value;
out `).concat(E," ").concat(d,` out_result;
void main() {
	out_result = `).concat(i!==d?d:"",`(u_value);
}`),uniforms:[{name:"u_value",value:c,type:(0,f.uniformTypeForType)(U,I.glslVersion)}]})}t.setValueProgram=V;function H(I,P){var U=P.type,c=P.precision||"",E=P.opacity===void 0?1:P.opacity,_=P.color||[0,0,0],i=P.name||"setColor",s=(0,f.glslTypeForType)(U,4);return new y.GPUProgram(I,{name:i,fragmentShader:`
uniform `.concat(c,` vec3 u_color;
uniform `).concat(c,` float u_opacity;
out `).concat(c," ").concat(s,` out_result;
void main() {
	out_result = `).concat(s,`(u_color, u_opacity);
}`),uniforms:[{name:"u_color",value:_,type:b.FLOAT},{name:"u_opacity",value:E,type:b.FLOAT}]})}t.setColorProgram=H;function F(I,P){return V(I,{type:b.FLOAT,value:0,name:P.name})}t.zeroProgram=F;function N(I,P){var U=P.type,c=P.precision||"",E=3,_=(0,f.glslTypeForType)(U,E),i=(0,f.glslTypeForType)(b.FLOAT,E),s=(0,f.glslPrefixForType)(U),d=i===_,T=P.name||"renderRGB_".concat(_);return new y.GPUProgram(I,{name:T,fragmentShader:`
in vec2 v_uv;
uniform float u_opacity;
uniform float u_scale;
uniform `.concat(c," ").concat(s,`sampler2D u_state;
out vec4 out_result;
void main() {
	vec3 color = u_scale * (`).concat(d?"":i,`(texture(u_state, v_uv).rgb));
	out_result = vec4(color, u_opacity);
}`),uniforms:[{name:"u_state",value:0,type:b.INT},{name:"u_scale",value:P.scale!==void 0?P.scale:1,type:b.FLOAT},{name:"u_opacity",value:P.opacity!==void 0?P.opacity:1,type:b.FLOAT}]})}t.renderRGBProgram=N;function O(I,P){var U=P.type,c=P.precision||"",E=P.components||"xyzw",_=E.length,i=(0,f.glslTypeForType)(U,_),s=(0,f.glslTypeForType)(b.FLOAT,_),d=(0,f.glslPrefixForType)(U),T=s===i,L=P.name||"renderAmplitude_".concat(i,"_w_").concat(_,"_components");return new y.GPUProgram(I,{name:L,fragmentShader:`
in vec2 v_uv;
uniform float u_opacity;
uniform float u_scale;
uniform vec3 u_colorMax;
uniform vec3 u_colorMin;
uniform `.concat(c," ").concat(d,`sampler2D u_state;
out vec4 out_result;
void main() {
	float amplitude = u_scale * `).concat(_===1?"abs":"length","(").concat(T?"":s,"(texture(u_state, v_uv)").concat(E==="xyzw"||E==="rgba"||E==="stpq"?"":".".concat(E),`));
	vec3 color = mix(u_colorMin, u_colorMax, amplitude);
	out_result = vec4(color, u_opacity);
}`),uniforms:[{name:"u_state",value:0,type:b.INT},{name:"u_scale",value:P.scale!==void 0?P.scale:1,type:b.FLOAT},{name:"u_opacity",value:P.opacity!==void 0?P.opacity:1,type:b.FLOAT},{name:"u_colorMax",value:P.colorMax||[1,1,1],type:b.FLOAT},{name:"u_colorMin",value:P.colorMin||[0,0,0],type:b.FLOAT}]})}t.renderAmplitudeProgram=O;function p(I,P){var U=P.type,c=P.precision||"",E=(0,f.glslTypeForType)(U,1),_=(0,f.glslPrefixForType)(U),i=E==="float",s=P.component||"x",d=P.name||"renderAmplitude_".concat(E,"_").concat(s);return new y.GPUProgram(I,{name:d,fragmentShader:`
in vec2 v_uv;
uniform float u_opacity;
uniform float u_scale;
uniform float u_bias;
uniform vec3 u_colorMin;
uniform vec3 u_colorMax;
uniform vec3 u_colorCenter;
uniform `.concat(c," ").concat(_,`sampler2D u_state;
out vec4 out_result;
void main() {
	float signedAmplitude = u_scale * (`).concat(i?"":"float","(texture(u_state, v_uv).").concat(s,`) - u_bias);
	float amplitudeSign = sign(signedAmplitude);
	vec3 interpColor = mix(u_colorMin, u_colorMax, amplitudeSign / 2.0 + 0.5);
	vec3 color = mix(u_colorCenter, interpColor, signedAmplitude * amplitudeSign);
	out_result = vec4(color, u_opacity);
}`),uniforms:[{name:"u_state",value:0,type:b.INT},{name:"u_scale",value:P.scale!==void 0?P.scale:1,type:b.FLOAT},{name:"u_bias",value:P.bias||0,type:b.FLOAT},{name:"u_opacity",value:P.opacity!==void 0?P.opacity:1,type:b.FLOAT},{name:"u_colorMin",value:P.colorMin||[0,0,1],type:b.FLOAT},{name:"u_colorMax",value:P.colorMax||[1,0,0],type:b.FLOAT},{name:"u_colorCenter",value:P.colorCenter||[1,1,1],type:b.FLOAT}]})}t.renderSignedAmplitudeProgram=p;function A(I){return new y.GPUProgram(I,{name:"wrappedLineColor",fragmentShader:`
in vec2 v_lineWrapping;
uniform vec4 u_value;
out vec4 out_result;
void main() {
	// Check if this line has wrapped.
	if ((v_lineWrapping.x != 0.0 && v_lineWrapping.x != 1.0) || (v_lineWrapping.y != 0.0 && v_lineWrapping.y != 1.0)) {
		// Render nothing.
		discard;
		return;
	}
	out_result = vec4(u_value);
}`})}t.wrappedLineColorProgram=A},404:(R,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Vector4=void 0;var h=function(){function l(b,f,y,G){b===void 0&&(b=0),f===void 0&&(f=0),y===void 0&&(y=0),G===void 0&&(G=1),this.x=b,this.y=f,this.z=y,this.w=G}return Object.defineProperty(l.prototype,"width",{get:function(){return this.z},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"height",{get:function(){return this.w},enumerable:!1,configurable:!0}),l.prototype.copy=function(b){return this.x=b.x,this.y=b.y,this.z=b.z,this.w=b.w,this},l}();t.Vector4=h},707:(R,t,h)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.checkRequiredKeys=t.checkValidKeys=t.isNumberOfType=t.isValidClearValue=t.isValidImageType=t.isValidImageFormat=t.isValidWrap=t.isValidFilter=t.isValidDataType=void 0;var l=h(566),b=h(601);function f(N){return b.validDataTypes.indexOf(N)>-1}t.isValidDataType=f;function y(N){return b.validFilters.indexOf(N)>-1}t.isValidFilter=y;function G(N){return b.validWraps.indexOf(N)>-1}t.isValidWrap=G;function m(N){return b.validImageFormats.indexOf(N)>-1}t.isValidImageFormat=m;function X(N){return b.validImageTypes.indexOf(N)>-1}t.isValidImageType=X;function M(N,O,p){if((0,l.isArray)(N)){if(N.length!==O)return!1;for(var A=0;A<N.length;A++)if(!V(N[A],p))return!1}else if(!V(N,p))return!1;return!0}t.isValidClearValue=M;function V(N,O){switch(O){case b.HALF_FLOAT:case b.FLOAT:return(0,l.isFiniteNumber)(N);case b.BYTE:return N<-128||N>127?!1:(0,l.isInteger)(N);case b.SHORT:return N<-32768||N>32767?!1:(0,l.isInteger)(N);case b.INT:return N<-2147483648||N>2147483647?!1:(0,l.isInteger)(N);case b.UNSIGNED_BYTE:return N>255?!1:(0,l.isNonNegativeInteger)(N);case b.UNSIGNED_SHORT:return N>65535?!1:(0,l.isNonNegativeInteger)(N);case b.UNSIGNED_INT:return N>4294967295?!1:(0,l.isNonNegativeInteger)(N);default:throw new Error("Unknown type ".concat(O))}}t.isNumberOfType=V;function H(N,O,p,A){N.forEach(function(I){O.indexOf(I)<0&&console.warn('Invalid params key "'.concat(I,'" passed to ').concat(p).concat(A?' with name "'.concat(A,'"'):"",".  Valid keys are ").concat(JSON.stringify(O),"."))})}t.checkValidKeys=H;function F(N,O,p,A){O.forEach(function(I){if(N.indexOf(I)<0)throw new Error('Required params key "'.concat(I,'" was not passed to ').concat(p).concat(A?' with name "'.concat(A,'"'):"","."))})}t.checkRequiredKeys=F},601:(R,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LAYER_POINTS_PROGRAM_NAME=t.SEGMENT_PROGRAM_NAME=t.DEFAULT_PROGRAM_NAME=t.BOOL_4D_UNIFORM=t.BOOL_3D_UNIFORM=t.BOOL_2D_UNIFORM=t.BOOL_1D_UNIFORM=t.UINT_4D_UNIFORM=t.UINT_3D_UNIFORM=t.UINT_2D_UNIFORM=t.UINT_1D_UNIFORM=t.INT_4D_UNIFORM=t.INT_3D_UNIFORM=t.INT_2D_UNIFORM=t.INT_1D_UNIFORM=t.FLOAT_4D_UNIFORM=t.FLOAT_3D_UNIFORM=t.FLOAT_2D_UNIFORM=t.FLOAT_1D_UNIFORM=t.PRECISION_HIGH_P=t.PRECISION_MEDIUM_P=t.PRECISION_LOW_P=t.EXPERIMENTAL_WEBGL2=t.EXPERIMENTAL_WEBGL=t.WEBGL1=t.WEBGL2=t.GLSL1=t.GLSL3=t.validImageTypes=t.validImageFormats=t.RGBA=t.RGB=t.validWraps=t.validFilters=t.validDataTypes=t.validArrayTypes=t.REPEAT=t.CLAMP_TO_EDGE=t.LINEAR=t.NEAREST=t.UINT=t.BOOL=t.INT=t.UNSIGNED_INT=t.SHORT=t.UNSIGNED_SHORT=t.BYTE=t.UNSIGNED_BYTE=t.FLOAT=t.HALF_FLOAT=void 0,t.BOUNDARY_RIGHT=t.BOUNDARY_LEFT=t.BOUNDARY_BOTTOM=t.BOUNDARY_TOP=t.GPUIO_FLOAT_PRECISION=t.GPUIO_INT_PRECISION=t.MAX_FLOAT_INT=t.MIN_FLOAT_INT=t.MAX_HALF_FLOAT_INT=t.MIN_HALF_FLOAT_INT=t.MAX_INT=t.MIN_INT=t.MAX_UNSIGNED_INT=t.MIN_UNSIGNED_INT=t.MAX_SHORT=t.MIN_SHORT=t.MAX_UNSIGNED_SHORT=t.MIN_UNSIGNED_SHORT=t.MAX_BYTE=t.MIN_BYTE=t.MAX_UNSIGNED_BYTE=t.MIN_UNSIGNED_BYTE=t.DEFAULT_CIRCLE_NUM_SEGMENTS=t.DEFAULT_ERROR_CALLBACK=t.GPUIO_VS_POSITION_W_ACCUM=t.GPUIO_VS_NORMAL_ATTRIBUTE=t.GPUIO_VS_UV_ATTRIBUTE=t.GPUIO_VS_INDEXED_POSITIONS=t.GPUIO_VS_WRAP_Y=t.GPUIO_VS_WRAP_X=t.LAYER_MESH_PROGRAM_NAME=t.LAYER_VECTOR_FIELD_PROGRAM_NAME=t.LAYER_LINES_PROGRAM_NAME=void 0,t.HALF_FLOAT="HALF_FLOAT",t.FLOAT="FLOAT",t.UNSIGNED_BYTE="UNSIGNED_BYTE",t.BYTE="BYTE",t.UNSIGNED_SHORT="UNSIGNED_SHORT",t.SHORT="SHORT",t.UNSIGNED_INT="UNSIGNED_INT",t.INT="INT",t.BOOL="BOOL",t.UINT="UINT",t.NEAREST="NEAREST",t.LINEAR="LINEAR",t.CLAMP_TO_EDGE="CLAMP_TO_EDGE",t.REPEAT="REPEAT",t.validArrayTypes=[Float32Array,Uint8Array,Int8Array,Uint16Array,Int16Array,Uint32Array,Int32Array,Array],t.validDataTypes=[t.HALF_FLOAT,t.FLOAT,t.UNSIGNED_BYTE,t.BYTE,t.UNSIGNED_SHORT,t.SHORT,t.UNSIGNED_INT,t.INT],t.validFilters=[t.NEAREST,t.LINEAR],t.validWraps=[t.CLAMP_TO_EDGE,t.REPEAT],t.RGB="RGB",t.RGBA="RGBA",t.validImageFormats=[t.RGB,t.RGBA],t.validImageTypes=[t.UNSIGNED_BYTE,t.FLOAT,t.HALF_FLOAT],t.GLSL3="300 es",t.GLSL1="100",t.WEBGL2="webgl2",t.WEBGL1="webgl",t.EXPERIMENTAL_WEBGL="experimental-webgl",t.EXPERIMENTAL_WEBGL2="experimental-webgl2",t.PRECISION_LOW_P="lowp",t.PRECISION_MEDIUM_P="mediump",t.PRECISION_HIGH_P="highp",t.FLOAT_1D_UNIFORM="FLOAT_1D_UNIFORM",t.FLOAT_2D_UNIFORM="FLOAT_2D_UNIFORM",t.FLOAT_3D_UNIFORM="FLOAT_3D_UNIFORM",t.FLOAT_4D_UNIFORM="FLOAT_4D_UNIFORM",t.INT_1D_UNIFORM="INT_1D_UNIFORM",t.INT_2D_UNIFORM="INT_2D_UNIFORM",t.INT_3D_UNIFORM="INT_3D_UNIFORM",t.INT_4D_UNIFORM="INT_4D_UNIFORM",t.UINT_1D_UNIFORM="UINT_1D_UNIFORM",t.UINT_2D_UNIFORM="UINT_2D_UNIFORM",t.UINT_3D_UNIFORM="UINT_3D_UNIFORM",t.UINT_4D_UNIFORM="UINT_4D_UNIFORM",t.BOOL_1D_UNIFORM="BOOL_1D_UNIFORM",t.BOOL_2D_UNIFORM="BOOL_2D_UNIFORM",t.BOOL_3D_UNIFORM="BOOL_3D_UNIFORM",t.BOOL_4D_UNIFORM="BOOL_4D_UNIFORM",t.DEFAULT_PROGRAM_NAME="DEFAULT",t.SEGMENT_PROGRAM_NAME="SEGMENT",t.LAYER_POINTS_PROGRAM_NAME="LAYER_POINTS",t.LAYER_LINES_PROGRAM_NAME="LAYER_LINES",t.LAYER_VECTOR_FIELD_PROGRAM_NAME="LAYER_VECTOR_FIELD",t.LAYER_MESH_PROGRAM_NAME="LAYER_MESH",t.GPUIO_VS_WRAP_X="GPUIO_VS_WRAP_X",t.GPUIO_VS_WRAP_Y="GPUIO_VS_WRAP_Y",t.GPUIO_VS_INDEXED_POSITIONS="GPUIO_VS_INDEXED_POSITIONS",t.GPUIO_VS_UV_ATTRIBUTE="GPUIO_VS_UV_ATTRIBUTE",t.GPUIO_VS_NORMAL_ATTRIBUTE="GPUIO_VS_NORMAL_ATTRIBUTE",t.GPUIO_VS_POSITION_W_ACCUM="GPUIO_VS_POSITION_W_ACCUM";var h=function(l){throw new Error(l)};t.DEFAULT_ERROR_CALLBACK=h,t.DEFAULT_CIRCLE_NUM_SEGMENTS=18,t.MIN_UNSIGNED_BYTE=0,t.MAX_UNSIGNED_BYTE=Math.pow(2,8)-1,t.MIN_BYTE=-Math.pow(2,7),t.MAX_BYTE=Math.pow(2,7)-1,t.MIN_UNSIGNED_SHORT=0,t.MAX_UNSIGNED_SHORT=Math.pow(2,16)-1,t.MIN_SHORT=-Math.pow(2,15),t.MAX_SHORT=Math.pow(2,15)-1,t.MIN_UNSIGNED_INT=0,t.MAX_UNSIGNED_INT=Math.pow(2,32)-1,t.MIN_INT=-Math.pow(2,31),t.MAX_INT=Math.pow(2,31)-1,t.MIN_HALF_FLOAT_INT=-2048,t.MAX_HALF_FLOAT_INT=2048,t.MIN_FLOAT_INT=-16777216,t.MAX_FLOAT_INT=16777216,t.GPUIO_INT_PRECISION="GPUIO_INT_PRECISION",t.GPUIO_FLOAT_PRECISION="GPUIO_FLOAT_PRECISION",t.BOUNDARY_TOP="BOUNDARY_TOP",t.BOUNDARY_BOTTOM="BOUNDARY_BOTTOM",t.BOUNDARY_LEFT="BOUNDARY_LEFT",t.BOUNDARY_RIGHT="BOUNDARY_RIGHT"},690:(R,t,h)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.glslComponentSelectionForNumComponents=t.glslPrefixForType=t.glslTypeForType=t.arrayConstructorForType=t.uniformTypeForType=t.intForPrecision=void 0;var l=h(601);function b(M){if(M===l.PRECISION_HIGH_P)return 2;if(M===l.PRECISION_MEDIUM_P)return 1;if(M===l.PRECISION_LOW_P)return 0;throw new Error("Unknown shader precision value: ".concat(JSON.stringify(M),"."))}t.intForPrecision=b;function f(M,V){switch(M){case l.HALF_FLOAT:case l.FLOAT:return l.FLOAT;case l.UNSIGNED_BYTE:case l.UNSIGNED_SHORT:case l.UNSIGNED_INT:return V===l.GLSL1?l.INT:l.UINT;case l.BYTE:case l.SHORT:case l.INT:return l.INT;default:throw new Error("Invalid type: ".concat(M," passed to glslKeyForType."))}}t.uniformTypeForType=f;function y(M,V){switch(V===void 0&&(V=!1),M){case l.HALF_FLOAT:return V?Float32Array:Uint16Array;case l.FLOAT:return Float32Array;case l.UNSIGNED_BYTE:return Uint8Array;case l.BYTE:return Int8Array;case l.UNSIGNED_SHORT:return Uint16Array;case l.SHORT:return Int16Array;case l.UNSIGNED_INT:return Uint32Array;case l.INT:return Int32Array;default:throw new Error('Unsupported type: "'.concat(M,'".'))}}t.arrayConstructorForType=y;function G(M,V){switch(M){case l.HALF_FLOAT:case l.FLOAT:return V===1?"float":"vec".concat(V);case l.UNSIGNED_BYTE:case l.UNSIGNED_SHORT:case l.UNSIGNED_INT:return V===1?"uint":"uvec".concat(V);case l.BYTE:case l.SHORT:case l.INT:return V===1?"int":"ivec".concat(V)}throw new Error("Invalid type: ".concat(M," passed to glslTypeForType."))}t.glslTypeForType=G;function m(M){switch(M){case l.HALF_FLOAT:case l.FLOAT:return"";case l.UNSIGNED_BYTE:case l.UNSIGNED_SHORT:case l.UNSIGNED_INT:return"u";case l.BYTE:case l.SHORT:case l.INT:return"i"}throw new Error("Invalid type: ".concat(M," passed to glslPrefixForType."))}t.glslPrefixForType=m;function X(M){switch(M){case 1:return".x";case 2:return".xy";case 3:return".xyz";case 4:return""}throw new Error("Invalid numComponents: ".concat(M," passed to glslComponentSelectionForNumComponents."))}t.glslComponentSelectionForNumComponents=X},581:(R,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getExtension=t.OES_STANDARD_DERIVATIVES=t.OES_ELEMENT_INDEX_UINT=t.OES_VERTEX_ARRAY_OBJECT=t.EXT_COLOR_BUFFER_HALF_FLOAT=t.EXT_COLOR_BUFFER_FLOAT=t.WEBGL_DEPTH_TEXTURE=t.OES_TEXTURE_HAlF_FLOAT_LINEAR=t.OES_TEXTURE_FLOAT_LINEAR=t.OES_TEXTURE_HALF_FLOAT=t.OES_TEXTURE_FLOAT=void 0,t.OES_TEXTURE_FLOAT="OES_texture_float",t.OES_TEXTURE_HALF_FLOAT="OES_texture_half_float",t.OES_TEXTURE_FLOAT_LINEAR="OES_texture_float_linear",t.OES_TEXTURE_HAlF_FLOAT_LINEAR="OES_texture_half_float_linear",t.WEBGL_DEPTH_TEXTURE="WEBGL_depth_texture",t.EXT_COLOR_BUFFER_FLOAT="EXT_color_buffer_float",t.EXT_COLOR_BUFFER_HALF_FLOAT="EXT_color_buffer_half_float",t.OES_VERTEX_ARRAY_OBJECT="OES_vertex_array_object",t.OES_ELEMENT_INDEX_UINT="OES_element_index_uint",t.OES_STANDARD_DERIVATIVES="OES_standard_derivatives";function h(l,b,f){if(f===void 0&&(f=!1),l._extensions[b]!==void 0)return l._extensions[b];var y=l.gl,G=l._errorCallback,m=l._extensions;l.verboseLogging;var X;try{X=y.getExtension(b)}catch{}return X?(m[b]=X,l.verboseLogging&&console.log("Loaded extension: ".concat(b,"."))):(m[b]=!1,l.verboseLogging&&console.log("Unsupported ".concat(f?"optional ":"","extension: ").concat(b,"."))),!X&&!f&&G("Required extension unsupported by this device / browser: ".concat(b,".")),X}t.getExtension=h},798:function(R,t){var h=this&&this.__spreadArray||function(m,X,M){if(M||arguments.length===2)for(var V=0,H=X.length,F;V<H;V++)(F||!(V in X))&&(F||(F=Array.prototype.slice.call(X,0,V)),F[V]=X[V]);return m.concat(F||Array.prototype.slice.call(X))};Object.defineProperty(t,"__esModule",{value:!0}),t.disposeFramebuffers=t.bindFrameBuffer=void 0;var l=new WeakMap,b=new WeakMap;function f(m,X,M,V){var H=m.gl,F=m._errorCallback,N=m.isWebGL2,O=H.createFramebuffer();if(!O){F('Could not init framebuffer for GPULayer "'.concat(X.name,'": ').concat(H.getError(),"."));return}if(H.bindFramebuffer(H.FRAMEBUFFER,O),H.framebufferTexture2D(H.FRAMEBUFFER,H.COLOR_ATTACHMENT0,H.TEXTURE_2D,M,0),V){if(!N)throw new Error("WebGL1 does not support drawing to multiple outputs.");if(V.length>15)throw new Error("Can't draw to more than 16 outputs.");for(var p=0,A=V.length;p<A;p++)H.framebufferTexture2D(H.FRAMEBUFFER,H.COLOR_ATTACHMENT0+p+1,H.TEXTURE_2D,V[p],0)}var I=H.checkFramebufferStatus(H.FRAMEBUFFER);return I!==H.FRAMEBUFFER_COMPLETE&&F('Invalid status for framebuffer for GPULayer "'.concat(X.name,'": ').concat(I,".")),O}function y(m,X,M,V){var H=m.gl,F=V?h([M],V,!0):M,N=l.get(F);if(!N){if(N=f(m,X,M,V),!N)return;l.set(F,N);var O=b.get(M)||[];if(O.push(N),b.set(M,O),V)for(var p=0,A=V.length;p<A;p++){var I=V[p],P=b.get(I)||[];P.push(N),b.set(I,P)}}H.bindFramebuffer(H.FRAMEBUFFER,N)}t.bindFrameBuffer=y;function G(m,X){m.bindFramebuffer(m.FRAMEBUFFER,null);var M=b.get(X);if(M)for(var V=0,H=M.length;V<H;V++)m.deleteFramebuffer(M[V]);b.delete(X)}t.disposeFramebuffers=G},724:(R,t,h)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PRECISION_SOURCE=void 0;var l=h(601),b=h(690);t.PRECISION_SOURCE=`
#if (`.concat(l.GPUIO_INT_PRECISION," == ").concat((0,b.intForPrecision)(l.PRECISION_LOW_P),`)
	precision lowp int;
	#if (__VERSION__ == 300)
		precision lowp isampler2D;
		precision lowp usampler2D;
	#endif
#elif (`).concat(l.GPUIO_INT_PRECISION," == ").concat((0,b.intForPrecision)(l.PRECISION_MEDIUM_P),`)
	precision mediump int;
	#if (__VERSION__ == 300)
		precision mediump isampler2D;
		precision mediump usampler2D;
	#endif
#else 
	#ifdef GL_FRAGMENT_PRECISION_HIGH
		precision highp int;
		#if (__VERSION__ == 300)
			precision highp isampler2D;
			precision highp usampler2D;
		#endif
	#else
		precision mediump int;
		#if (__VERSION__ == 300)
			precision mediump isampler2D;
			precision mediump usampler2D;
		#endif
	#endif
#endif
#if (`).concat(l.GPUIO_FLOAT_PRECISION," == ").concat((0,b.intForPrecision)(l.PRECISION_LOW_P),`)
	precision lowp float;
	precision lowp sampler2D;
#elif (`).concat(l.GPUIO_FLOAT_PRECISION," == ").concat((0,b.intForPrecision)(l.PRECISION_MEDIUM_P),`)
	precision mediump float;
	precision mediump sampler2D;
#else
	#ifdef GL_FRAGMENT_PRECISION_HIGH
		precision highp float;
		precision highp sampler2D;
	#else
		precision mediump float;
		precision mediump sampler2D;
	#endif
#endif
`)},651:(R,t,h)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_VERT_SHADER_SOURCE=void 0;var l=h(601);t.DEFAULT_VERT_SHADER_SOURCE=`
in vec2 a_gpuio_position;
#ifdef `.concat(l.GPUIO_VS_UV_ATTRIBUTE,`
	in vec2 a_gpuio_uv;
#endif
#ifdef `).concat(l.GPUIO_VS_NORMAL_ATTRIBUTE,`
	in vec2 a_gpuio_normal;
#endif

uniform vec2 u_gpuio_scale;
uniform vec2 u_gpuio_translation;

out vec2 v_uv;
out vec2 v_uv_local;
#ifdef `).concat(l.GPUIO_VS_NORMAL_ATTRIBUTE,`
	out vec2 v_normal;
#endif

void main() {
	// Optional varyings.
	#ifdef `).concat(l.GPUIO_VS_UV_ATTRIBUTE,`
		v_uv_local = a_gpuio_uv;
	#else
		v_uv_local = 0.5 * (a_gpuio_position + 1.0);
	#endif
	#ifdef `).concat(l.GPUIO_VS_NORMAL_ATTRIBUTE,`
		v_normal = a_gpuio_normal;
	#endif

	// Apply transformations.
	vec2 position = u_gpuio_scale * a_gpuio_position + u_gpuio_translation;

	// Calculate a global uv for the viewport.
	v_uv = 0.5 * (position + 1.0);

	// Calculate vertex position.
	gl_Position = vec4(position, 0, 1);
}`)},567:(R,t,h)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LAYER_LINES_VERTEX_SHADER_SOURCE=void 0;var l=h(601),b=h(324);t.LAYER_LINES_VERTEX_SHADER_SOURCE=`
`.concat(b.VERTEX_SHADER_HELPERS_SOURCE,`

#if (__VERSION__ != 300 || `).concat(l.GPUIO_VS_INDEXED_POSITIONS,` == 1)
	// Cannot use int vertex attributes.
	// https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/vertexAttribPointer
	in float a_gpuio_index;
#endif

uniform sampler2D u_gpuio_positions; // Texture lookup with position data.
uniform vec2 u_gpuio_positionsDimensions;
uniform vec2 u_gpuio_scale;

out vec2 v_uv;
out vec2 v_lineWrapping; // Use this to test if line is only half wrapped and should not be rendered.
flat out int v_index;

void main() {
	// Calculate a uv based on the point's index attribute.
	#if (__VERSION__ != 300 || `).concat(l.GPUIO_VS_INDEXED_POSITIONS,` == 1)
		vec2 positionUV = uvFromIndex(a_gpuio_index, u_gpuio_positionsDimensions);
		v_index = int(a_gpuio_index);
	#else
		vec2 positionUV = uvFromIndex(gl_VertexID, u_gpuio_positionsDimensions);
		v_index = gl_VertexID;
	#endif

	// Calculate a global uv for the viewport.
	// Lookup vertex position and scale to [0, 1] range.
	#ifdef `).concat(l.GPUIO_VS_POSITION_W_ACCUM,`
		// We have packed a 2D displacement with the position.
		vec4 positionData = texture(u_gpuio_positions, positionUV);
		// position = first two components plus last two components (optional accumulation buffer).
		v_uv = (positionData.rg + positionData.ba) * u_gpuio_scale;
	#else
		v_uv = texture(u_gpuio_positions, positionUV).rg  * u_gpuio_scale;
	#endif

	// Wrap if needed.
	v_lineWrapping = vec2(0.0);
	#ifdef `).concat(l.GPUIO_VS_WRAP_X,`
		v_lineWrapping.x = max(step(1.0, v_uv.x), step(v_uv.x, 0.0));
		v_ux.x = fract(v_uv.x + 1.0);
	#endif
	#ifdef `).concat(l.GPUIO_VS_WRAP_Y,`
		v_lineWrapping.y = max(step(1.0, v_uv.y), step(v_uv.y, 0.0));
		v_ux.y = fract(v_uv.y + 1.0);
	#endif

	// Calculate position in [-1, 1] range.
	vec2 position = v_uv * 2.0 - 1.0;

	gl_Position = vec4(position, 0, 1);
}`)},380:(R,t,h)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LAYER_MESH_VERTEX_SHADER_SOURCE=void 0;var l=h(601),b=h(324);t.LAYER_MESH_VERTEX_SHADER_SOURCE=`
`.concat(b.VERTEX_SHADER_HELPERS_SOURCE,`

#if (__VERSION__ != 300)
	// Cannot use int vertex attributes.
	// https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/vertexAttribPointer
	in float a_gpuio_index;
#endif

uniform sampler2D u_gpuio_positions; // Texture lookup with position data.
uniform vec2 u_gpuio_positionsDimensions;
uniform vec2 u_gpuio_scale;

out vec2 v_uv;
out vec2 v_uv_position;
out vec2 v_position;
flat out int v_index;

void main() {
	// Calculate a uv based on the point's index attribute.
	#if (__VERSION__ == 300)
		v_uv_position = uvFromIndex(gl_VertexID, u_gpuio_positionsDimensions);
		v_index = gl_VertexID;
	#else
		v_uv_position = uvFromIndex(a_gpuio_index, u_gpuio_positionsDimensions);
		v_index = int(a_gpuio_index);
	#endif

	// Calculate a global uv for the viewport.
	// Lookup vertex position and scale to [0, 1] range.
	#ifdef `).concat(l.GPUIO_VS_POSITION_W_ACCUM,`
		// We have packed a 2D displacement with the position.
		vec4 positionData = texture(u_gpuio_positions, v_uv_position);
		// position = first two components plus last two components (optional accumulation buffer).
		v_position = positionData.rg + positionData.ba;
		v_uv = v_position * u_gpuio_scale;
	#else
		v_position = texture(u_gpuio_positions, v_uv_position).rg;
		v_uv = v_position * u_gpuio_scale;
	#endif

	// Calculate position in [-1, 1] range.
	vec2 position = v_uv * 2.0 - 1.0;

	gl_Position = vec4(position, 0, 1);
}`)},929:(R,t,h)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LAYER_POINTS_VERTEX_SHADER_SOURCE=void 0;var l=h(601),b=h(324);t.LAYER_POINTS_VERTEX_SHADER_SOURCE=`
`.concat(b.VERTEX_SHADER_HELPERS_SOURCE,`

#if (__VERSION__ != 300)
	// Cannot use int vertex attributes.
	// https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/vertexAttribPointer
	in float a_gpuio_index;
#endif

uniform sampler2D u_gpuio_positions; // Texture lookup with position data.
uniform vec2 u_gpuio_positionsDimensions;
uniform vec2 u_gpuio_scale;
uniform float u_gpuio_pointSize;

out vec2 v_uv;
out vec2 v_uv_position;
out vec2 v_position;
flat out int v_index;

void main() {
	// Calculate a uv based on the point's index attribute.
	#if (__VERSION__ == 300)
		v_uv_position = uvFromIndex(gl_VertexID, u_gpuio_positionsDimensions);
		v_index = gl_VertexID;
	#else
		v_uv_position = uvFromIndex(a_gpuio_index, u_gpuio_positionsDimensions);
		v_index = int(a_gpuio_index);
	#endif

	// Calculate a global uv for the viewport.
	// Lookup vertex position and scale to [0, 1] range.
	#ifdef `).concat(l.GPUIO_VS_POSITION_W_ACCUM,`
		// We have packed a 2D displacement with the position.
		vec4 positionData = texture(u_gpuio_positions, v_uv_position);
		// position = first two components plus last two components (optional accumulation buffer).
		v_position = positionData.rg + positionData.ba;
		v_uv = v_position * u_gpuio_scale;
	#else
		v_position = texture(u_gpuio_positions, v_uv_position).rg;
		v_uv = v_position * u_gpuio_scale;
	#endif

	// Wrap if needed.
	#ifdef `).concat(l.GPUIO_VS_WRAP_X,`
		v_uv.x = fract(v_uv.x + ceil(abs(v_uv.x)));
	#endif
	#ifdef `).concat(l.GPUIO_VS_WRAP_Y,`
		v_uv.y = fract(v_uv.y + ceil(abs(v_uv.y)));
	#endif

	// Calculate position in [-1, 1] range.
	vec2 position = v_uv * 2.0 - 1.0;

	gl_PointSize = u_gpuio_pointSize;
	gl_Position = vec4(position, 0, 1);
}`)},634:(R,t,h)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LAYER_VECTOR_FIELD_VERTEX_SHADER_SOURCE=void 0;var l=h(324);t.LAYER_VECTOR_FIELD_VERTEX_SHADER_SOURCE=`
`.concat(l.VERTEX_SHADER_HELPERS_SOURCE,`

#if (__VERSION__ != 300)
	// Cannot use int vertex attributes.
	// https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/vertexAttribPointer
	in float a_gpuio_index;
#endif

uniform sampler2D u_gpuio_vectors; // Texture lookup with vector data.
uniform vec2 u_gpuio_dimensions;
uniform vec2 u_gpuio_scale;

out vec2 v_uv;
flat out int v_index;

void main() {
	#if (__VERSION__ == 300)
		// Divide index by 2.
		int index = gl_VertexID / 2;
		v_index = index;
	#else
		// Divide index by 2.
		float index = floor((a_gpuio_index + 0.5) / 2.0);
		v_index = int(index);
	#endif

	// Calculate a uv based on the vertex index attribute.
	v_uv = uvFromIndex(index, u_gpuio_dimensions);
	#if (__VERSION__ == 300)
		// Add vector displacement if needed.
		v_uv += float(gl_VertexID - 2 * index) * texture(u_gpuio_vectors, v_uv).xy * u_gpuio_scale;
	#else
		// Add vector displacement if needed.
		v_uv += (a_gpuio_index - 2.0 * index) * texture(u_gpuio_vectors, v_uv).xy * u_gpuio_scale;
	#endif


	// Calculate position in [-1, 1] range.
	vec2 position = v_uv * 2.0 - 1.0;

	gl_Position = vec4(position, 0, 1);
}`)},946:(R,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SEGMENT_VERTEX_SHADER_SOURCE=void 0,t.SEGMENT_VERTEX_SHADER_SOURCE=`
in vec2 a_gpuio_position;

uniform float u_gpuio_halfThickness;
uniform vec2 u_gpuio_scale;
uniform float u_gpuio_length;
uniform float u_gpuio_rotation;
uniform vec2 u_gpuio_translation;

out vec2 v_uv_local;
out vec2 v_uv;

mat2 rotate2d(float _angle){
	return mat2(cos(_angle), -sin(_angle), sin(_angle), cos(_angle));
}

void main() {
	// Calculate UV coordinates of current rendered object.
	v_uv_local = 0.5 * (a_gpuio_position + 1.0);

	vec2 position = a_gpuio_position;
	// Apply thickness / radius.
	position *= u_gpuio_halfThickness;
	// Stretch center of shape to form a round-capped line segment.
	float signX = sign(position.x);
	position.x += signX * u_gpuio_length / 2.0;
	v_uv_local.x = (signX + 1.0) / 2.0;// Set entire cap uv.x to 1 or 0.
	// Apply transformations.
	position = u_gpuio_scale * (rotate2d(-u_gpuio_rotation) * position) + u_gpuio_translation;

	// Calculate a global uv for the viewport.
	v_uv = 0.5 * (position + 1.0);

	// Calculate vertex position.
	gl_Position = vec4(position, 0, 1);
}`},324:(R,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.VERTEX_SHADER_HELPERS_SOURCE=void 0,t.VERTEX_SHADER_HELPERS_SOURCE=`
/**
 * Create UV coordinates from a 1D index for data stored in a texture of size "dimensions".
 */
vec2 uvFromIndex(const float index, const vec2 dimensions) {
	float y = floor((index + 0.5) / dimensions.x);
	float x = floor(index - y * dimensions.x + 0.5);
	return vec2(x + 0.5, y + 0.5) / dimensions;
}
vec2 uvFromIndex(const int index, const vec2 dimensions) {
	int width = int(dimensions.x);
	int y = index / width;
	int x = index - y * width;
	return vec2(float(x) + 0.5, float(y) + 0.5) / dimensions;
}
vec2 uvFromIndex(const float index, const ivec2 dimensions) {
	float width = float(dimensions.x);
	float y = floor((index + 0.5) / width);
	float x = floor(index - y * width + 0.5);
	return vec2(x + 0.5, y + 0.5) / vec2(dimensions);
}
vec2 uvFromIndex(const int index, const ivec2 dimensions) {
	int y = index / dimensions.x;
	int x = index - y * dimensions.x;
	return vec2(float(x) + 0.5, float(y) + 0.5) / vec2(dimensions);
}`},607:function(R,t,h){var l=this&&this.__assign||function(){return l=Object.assign||function(q){for(var W,j=1,$=arguments.length;j<$;j++){W=arguments[j];for(var ne in W)Object.prototype.hasOwnProperty.call(W,ne)&&(q[ne]=W[ne])}return q},l.apply(this,arguments)},b=this&&this.__createBinding||(Object.create?function(q,W,j,$){$===void 0&&($=j);var ne=Object.getOwnPropertyDescriptor(W,j);(!ne||("get"in ne?!W.__esModule:ne.writable||ne.configurable))&&(ne={enumerable:!0,get:function(){return W[j]}}),Object.defineProperty(q,$,ne)}:function(q,W,j,$){$===void 0&&($=j),q[$]=W[j]}),f=this&&this.__exportStar||function(q,W){for(var j in q)j!=="default"&&!Object.prototype.hasOwnProperty.call(W,j)&&b(W,q,j)};Object.defineProperty(t,"__esModule",{value:!0}),t._testing=t.renderRGBProgram=t.zeroProgram=t.setColorProgram=t.setValueProgram=t.renderSignedAmplitudeProgram=t.renderAmplitudeProgram=t.multiplyValueProgram=t.addValueProgram=t.addLayersProgram=t.copyProgram=t.getFragmentShaderMediumpPrecision=t.getVertexShaderMediumpPrecision=t.isHighpSupportedInFragmentShader=t.isHighpSupportedInVertexShader=t.isWebGL2Supported=t.isWebGL2=t.GPUIndexBuffer=t.GPUProgram=t.GPULayer=t.GPUComposer=void 0;var y=h(593),G=h(484);Object.defineProperty(t,"GPUComposer",{enumerable:!0,get:function(){return G.GPUComposer}});var m=h(355);Object.defineProperty(t,"GPULayer",{enumerable:!0,get:function(){return m.GPULayer}});var X=h(191),M=h(664);Object.defineProperty(t,"GPUProgram",{enumerable:!0,get:function(){return M.GPUProgram}});var V=h(981);Object.defineProperty(t,"GPUIndexBuffer",{enumerable:!0,get:function(){return V.GPUIndexBuffer}});var H=h(707),F=h(126),N=h(581),O=h(360),p=h(690),A=h(579),I=l(l(l(l(l(l({isFloatType:y.isFloatType,isUnsignedIntType:y.isUnsignedIntType,isSignedIntType:y.isSignedIntType,isIntType:y.isIntType,makeShaderHeader:y.makeShaderHeader,compileShader:y.compileShader,initGLProgram:y.initGLProgram,readyToRead:y.readyToRead,preprocessVertexShader:y.preprocessVertexShader,preprocessFragmentShader:y.preprocessFragmentShader,isPowerOf2:y.isPowerOf2,initSequentialFloatArray:y.initSequentialFloatArray,uniformInternalTypeForValue:y.uniformInternalTypeForValue,indexOfLayerInArray:y.indexOfLayerInArray,readPixelsAsync:y.readPixelsAsync},N),F),H),X),O),p);t._testing=I;var P=y.isWebGL2,U=y.isWebGL2Supported,c=y.isHighpSupportedInVertexShader,E=y.isHighpSupportedInFragmentShader,_=y.getVertexShaderMediumpPrecision,i=y.getFragmentShaderMediumpPrecision;t.isWebGL2=P,t.isWebGL2Supported=U,t.isHighpSupportedInVertexShader=c,t.isHighpSupportedInFragmentShader=E,t.getVertexShaderMediumpPrecision=_,t.getFragmentShaderMediumpPrecision=i;var s=A.copyProgram,d=A.addLayersProgram,T=A.addValueProgram,L=A.multiplyValueProgram,C=A.setValueProgram,Y=A.setColorProgram,v=A.zeroProgram,S=A.renderRGBProgram,w=A.renderAmplitudeProgram,k=A.renderSignedAmplitudeProgram;t.copyProgram=s,t.addLayersProgram=d,t.addValueProgram=T,t.multiplyValueProgram=L,t.setValueProgram=C,t.setColorProgram=Y,t.zeroProgram=v,t.renderRGBProgram=S,t.renderAmplitudeProgram=w,t.renderSignedAmplitudeProgram=k,f(h(601),t)},360:(R,t,h)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.fragmentShaderPolyfills=t.GLSL1Polyfills=t.texturePolyfill=t.SAMPLER2D_DIMENSIONS_UNIFORM=t.SAMPLER2D_HALF_PX_UNIFORM=t.SAMPLER2D_FILTER=t.SAMPLER2D_CAST_INT=t.SAMPLER2D_WRAP_Y=t.SAMPLER2D_WRAP_X=void 0;var l=h(601),b=h(126);t.SAMPLER2D_WRAP_X="GPUIO_WRAP_X",t.SAMPLER2D_WRAP_Y="GPUIO_WRAP_Y",t.SAMPLER2D_CAST_INT="GPUIO_CAST_INT",t.SAMPLER2D_FILTER="GPUIO_FILTER",t.SAMPLER2D_HALF_PX_UNIFORM="u_gpuio_half_px",t.SAMPLER2D_DIMENSIONS_UNIFORM="u_gpuio_dimensions";function f(v){var S=v.match(/\btexture\(/g);if(!S||S.length===0)return{shaderSource:v,samplerUniforms:[]};var w=(0,b.getSampler2DsInProgram)(v);if(w.length===0)return{shaderSource:v,samplerUniforms:w};w.forEach(function(J,ie){var x=new RegExp("\\btexture(2D)?\\(\\s?".concat(J,"\\b"),"gs");v=v.replace(x,"GPUIO_TEXTURE_POLYFILL".concat(ie,"(").concat(J))});var k=v.match(/\btexture(2D)?\(/g);k?.length&&console.warn("Fragment shader polyfill has missed some calls to texture().",v);for(var q={},W=0;W<w.length;W++)q["".concat(t.SAMPLER2D_HALF_PX_UNIFORM).concat(W)]="vec2",q["".concat(t.SAMPLER2D_DIMENSIONS_UNIFORM).concat(W)]="vec2";function j(J,ie,x){x===void 0&&(x="");var K=x===""?"":")",Z=x===""?ie:"i";return`
`.concat(Z,"vec4 GPUIO_TEXTURE_POLYFILL").concat(J,"(const ").concat(ie,`sampler2D sampler, const vec2 uv) {
	`).concat(ie===""?"#if (".concat(t.SAMPLER2D_FILTER).concat(J," == 0)"):"",`
		#if (`).concat(t.SAMPLER2D_WRAP_X).concat(J,` == 0)
			#if (`).concat(t.SAMPLER2D_WRAP_Y).concat(J,` == 0)
				return `).concat(x,"texture(sampler, uv)").concat(K,`;
			#else
				return `).concat(x,"GPUIO_TEXTURE_WRAP_CLAMP_REPEAT(sampler, uv, ").concat(t.SAMPLER2D_HALF_PX_UNIFORM).concat(J,")").concat(K,`;
			#endif
		#else
			#if (`).concat(t.SAMPLER2D_WRAP_Y).concat(J,` == 0)
				return `).concat(x,"GPUIO_TEXTURE_WRAP_REPEAT_CLAMP(sampler, uv, ").concat(t.SAMPLER2D_HALF_PX_UNIFORM).concat(J,")").concat(K,`;
			#else
				return `).concat(x,"GPUIO_TEXTURE_WRAP_REPEAT_REPEAT(sampler, uv, ").concat(t.SAMPLER2D_HALF_PX_UNIFORM).concat(J,")").concat(K,`;
			#endif
		#endif
	`).concat(ie===""?`#else
		#if (`.concat(t.SAMPLER2D_WRAP_X).concat(J,` == 0)
			#if (`).concat(t.SAMPLER2D_WRAP_Y).concat(J,` == 0)
				return `).concat(x,"GPUIO_TEXTURE_BILINEAR_INTERP(sampler, uv, ").concat(t.SAMPLER2D_HALF_PX_UNIFORM).concat(J,", ").concat(t.SAMPLER2D_DIMENSIONS_UNIFORM).concat(J,")").concat(K,`;
			#else
				return `).concat(x,"GPUIO_TEXTURE_BILINEAR_INTERP_WRAP_CLAMP_REPEAT(sampler, uv, ").concat(t.SAMPLER2D_HALF_PX_UNIFORM).concat(J,", ").concat(t.SAMPLER2D_DIMENSIONS_UNIFORM).concat(J,")").concat(K,`;
			#endif
		#else
			#if (`).concat(t.SAMPLER2D_WRAP_Y).concat(J,` == 0)
				return `).concat(x,"GPUIO_TEXTURE_BILINEAR_INTERP_WRAP_REPEAT_CLAMP(sampler, uv, ").concat(t.SAMPLER2D_HALF_PX_UNIFORM).concat(J,", ").concat(t.SAMPLER2D_DIMENSIONS_UNIFORM).concat(J,")").concat(K,`;
			#else
				return `).concat(x,"GPUIO_TEXTURE_BILINEAR_INTERP_WRAP_REPEAT_REPEAT(sampler, uv, ").concat(t.SAMPLER2D_HALF_PX_UNIFORM).concat(J,", ").concat(t.SAMPLER2D_DIMENSIONS_UNIFORM).concat(J,")").concat(K,`;
			#endif
		#endif
	#endif`):"",`
}
`)}function $(J){return`
`.concat(J,"vec4 GPUIO_TEXTURE_WRAP_REPEAT_REPEAT(const ").concat(J,`sampler2D sampler, const vec2 uv, const vec2 halfPx) {
	return texture(sampler, GPUIO_WRAP_REPEAT_UV(uv));
}
`).concat(J,"vec4 GPUIO_TEXTURE_WRAP_REPEAT_CLAMP(const ").concat(J,`sampler2D sampler, vec2 uv, const vec2 halfPx) {
	uv.x = GPUIO_WRAP_REPEAT_UV_COORD(uv.x);
	// uv.y = GPUIO_WRAP_CLAMP_UV_COORD(uv.y, halfPx.y);
	return texture(sampler, uv);
}
`).concat(J,"vec4 GPUIO_TEXTURE_WRAP_CLAMP_REPEAT(const ").concat(J,`sampler2D sampler, vec2 uv, const vec2 halfPx) {
	// uv.x = GPUIO_WRAP_CLAMP_UV_COORD(uv.x, halfPx.x);
	uv.y = GPUIO_WRAP_REPEAT_UV_COORD(uv.y);
	return texture(sampler, uv);
}
`)}function ne(J){var ie=J?"GPUIO_TEXTURE_WRAP_".concat(J):"texture",x=J?", halfPx":"";return`
vec4 GPUIO_TEXTURE_BILINEAR_INTERP`.concat(J?"_WRAP_".concat(J):"",`(const sampler2D sampler, const vec2 uv, const vec2 halfPx, const vec2 dimensions) {
	vec2 pxFraction = fract(uv * dimensions);
	vec2 offset = halfPx - vec2(0.00001, 0.00001) * max(
			step(abs(pxFraction.x - 0.5), 0.001),
			step(abs(pxFraction.y - 0.5), 0.001)
		);
	vec2 baseUV = uv - offset;
	vec2 diagOffset = vec2(offset.x, -offset.y);
	vec4 minmin = `).concat(ie,"(sampler, baseUV").concat(x,`);
	vec4 maxmin = `).concat(ie,"(sampler, uv + diagOffset").concat(x,`);
	vec4 minmax = `).concat(ie,"(sampler, uv - diagOffset").concat(x,`);
	vec4 maxmax = `).concat(ie,"(sampler, uv + offset").concat(x,`);
	vec2 t = fract(baseUV * dimensions);
	vec4 yMin = mix(minmin, maxmin, t.x);
	vec4 yMax = mix(minmax, maxmax, t.x);
	return mix(yMin, yMax, t.y);
}
`)}return v=`
`.concat(Object.keys(q).map(function(J){return"uniform ".concat(q[J]," ").concat(J,";")}).join(`
`),`

float GPUIO_WRAP_REPEAT_UV_COORD(const float coord) {
	return fract(coord + ceil(abs(coord)));
}
vec2 GPUIO_WRAP_REPEAT_UV(const vec2 uv) {
	return fract(uv + ceil(abs(uv)));
}
// float GPUIO_WRAP_CLAMP_UV_COORD(const float coord, const float halfPx) {
// 	return clamp(coord, halfPx, 1.0 - halfPx);
// }

`).concat($(""),`
#if (__VERSION__ == 300)
`).concat(["u","i"].map(function(J){return $(J)}).join(`
`),`
#endif

`).concat([null,"REPEAT_REPEAT","REPEAT_CLAMP","CLAMP_REPEAT"].map(function(J){return ne(J)}).join(`
`),`

`).concat(w.map(function(J,ie){return"#ifndef ".concat(t.SAMPLER2D_CAST_INT).concat(ie,`
	`).concat(j(ie,""),`
#endif`)}).join(`
`),`
#if (__VERSION__ == 300)
`).concat(["u","i"].map(function(J){return w.map(function(ie,x){return j(x,J)}).join(`
`)}).join(`
`),`
#else
	`).concat(w.map(function(J,ie){return"#ifdef ".concat(t.SAMPLER2D_CAST_INT).concat(ie,`
	`).concat(j(ie,"","ivec4("),`
#endif`)}).join(`
`),`
#endif

`).concat(v),{shaderSource:v,samplerUniforms:w}}t.texturePolyfill=f;function y(v){switch(v){case"int":case"uint":return"float";case"ivec2":case"uvec2":return"vec2";case"ivec3":case"uvec3":return"vec3";case"ivec4":case"uvec4":return"vec4"}throw new Error("Unknown type ".concat(v,"."))}function G(v){switch(v){case"bool":return"float";case"bvec2":return"vec2";case"bvec3":return"vec3";case"bvec4":return"vec4"}throw new Error("Unknown type ".concat(v,"."))}function m(v){return"".concat(v," abs(const ").concat(v," a) { return ").concat(v,"(abs(").concat(y(v),"(a))); }")}function X(v){return"".concat(v," sign(const ").concat(v," a) { return ").concat(v,"(sign(").concat(y(v),"(a))); }")}function M(v){return"".concat(v," trunc(const ").concat(v," a) { return round(a - fract(a) * sign(a)); }")}function V(v){return"".concat(v," round(const ").concat(v," a) { return floor(a + 0.5); }")}function H(v){return"".concat(v," roundEven(const ").concat(v," a) { return 2.0 * round(a / 2.0); }")}function F(v,S){return"".concat(v," min(const ").concat(v," a, const ").concat(S," b) { return ").concat(v,"(min(").concat(y(v),"(a), ").concat(y(S),"(b))); }")}function N(v,S){return"".concat(v," max(const ").concat(v," a, const ").concat(S," b) { return ").concat(v,"(max(").concat(y(v),"(a), ").concat(y(S),"(b))); }")}function O(v,S){return"".concat(v," clamp(const ").concat(v," a, const ").concat(S," min, const ").concat(S," max) { return ").concat(v,"(clamp(").concat(y(v),"(a), ").concat(y(S),"(min), ").concat(y(S),"(max))); }")}function p(v,S){return"".concat(v," mix(const ").concat(v," a, const ").concat(v," b, const ").concat(S," c) { return mix(a, b, ").concat(G(S),"(c)); }")}function A(v,S,w){return"a[".concat(v,"][").concat(S,"] * a[").concat((v+1)%w,"][").concat((S+1)%w,"] - a[").concat((v+1)%w,"][").concat(S,"] * a[").concat(v,"][").concat((S+1)%w,"]")}function I(v,S,w){return[0,1,2].map(function(k){return"a[".concat(v,"][").concat((S+k)%w,"] * (").concat(A((v+1)%w,(S+1+k)%w,w),")")}).join(" + ")}function P(v,S,w){return[0,1,2,3].map(function(k){return"a[".concat(v,"][").concat((S+k)%w,"] * (").concat(I((v+1)%w,(S+1+k)%w,w),")")}).join(" + ")}function U(v){var S="";return v.includes("abs")&&(S+=`


`.concat(m("int"),`
`).concat(m("ivec2"),`
`).concat(m("ivec3"),`
`).concat(m("ivec4"),`
`)),v.includes("sign")&&(S+=`


`.concat(X("int"),`
`).concat(X("ivec2"),`
`).concat(X("ivec3"),`
`).concat(X("ivec4"),`
`)),v.includes("round")&&(S+=`


`.concat(V("float"),`
`).concat(V("vec2"),`
`).concat(V("vec3"),`
`).concat(V("vec4"),`
`)),v.includes("trunc")&&(S+=`


`.concat(M("float"),`
`).concat(M("vec2"),`
`).concat(M("vec3"),`
`).concat(M("vec4"),`
`)),v.includes("roundEven")&&(S+=`


`.concat(H("float"),`
`).concat(H("vec2"),`
`).concat(H("vec3"),`
`).concat(H("vec4"),`
`)),v.includes("min")&&(S+=`


`.concat(F("int","int"),`
`).concat(F("ivec2","ivec2"),`
`).concat(F("ivec3","ivec3"),`
`).concat(F("ivec4","ivec4"),`
`).concat(F("ivec2","int"),`
`).concat(F("ivec3","int"),`
`).concat(F("ivec4","int"),`
`)),v.includes("max")&&(S+=`


`.concat(N("int","int"),`
`).concat(N("ivec2","ivec2"),`
`).concat(N("ivec3","ivec3"),`
`).concat(N("ivec4","ivec4"),`
`).concat(N("ivec2","int"),`
`).concat(N("ivec3","int"),`
`).concat(N("ivec4","int"),`
`)),v.includes("clamp")&&(S+=`


`.concat(O("int","int"),`
`).concat(O("ivec2","ivec2"),`
`).concat(O("ivec3","ivec3"),`
`).concat(O("ivec4","ivec4"),`
`).concat(O("ivec2","int"),`
`).concat(O("ivec3","int"),`
`).concat(O("ivec4","int"),`
`)),v.includes("mix")&&(S+=`


`.concat(p("float","bool"),`
`).concat(p("vec2","bvec2"),`
`).concat(p("vec3","bvec3"),`
`).concat(p("vec4","bvec4"),`
`)),v.includes("outerProduct")&&(S+=`


mat2 outerProduct(const vec2 a, const vec2 b) {
	return mat2(
		a.x * b.x, a.x * b.y,
		a.y * b.x, a.y * b.y
	);
}
mat3 outerProduct(const vec3 a, const vec3 b) {
	return mat3(
		a.x * b.x, a.x * b.y, a.x * b.z,
		a.y * b.x, a.y * b.y, a.y * b.z,
		a.z * b.x, a.z * b.y, a.z * b.z
	);
}
mat4 outerProduct(const vec4 a, const vec4 b) {
	return mat4(
		a.x * b.x, a.x * b.y, a.x * b.z, a.x * b.w,
		a.y * b.x, a.y * b.y, a.y * b.z, a.y * b.w,
		a.z * b.x, a.z * b.y, a.z * b.z, a.z * b.w,
		a.w * b.x, a.w * b.y, a.w * b.z, a.w * b.w
	);
}
`),v.includes("transpose")&&(S+=`


mat2 transpose(mat2 a) {
	float temp = a[0][1];
	a[0][1] = a[1][0];
	a[1][0] = temp;
	return a;
}
mat3 transpose(mat3 a) {
	float temp = a[0][2];
	a[0][2] = a[2][0];
	a[2][0] = temp;
	temp = a[0][1];
	a[0][1] = a[1][0];
	a[1][0] = temp;
	temp = a[1][2];
	a[1][2] = a[2][1];
	a[2][1] = temp;
	return a;
}
mat4 transpose(mat4 a) {
	float temp = a[0][3];
	a[0][3] = a[3][0];
	a[3][0] = temp;
	temp = a[0][2];
	a[0][2] = a[2][0];
	a[2][0] = temp;
	temp = a[2][3];
	a[2][3] = a[3][2];
	a[3][2] = temp;
	temp = a[0][1];
	a[0][1] = a[1][0];
	a[1][0] = temp;
	temp = a[1][2];
	a[1][2] = a[2][1];
	a[2][1] = temp;
	temp = a[2][3];
	a[2][3] = a[3][2];
	a[3][2] = temp;
	return a;
}
`),v.includes("determinant")&&(S+=`


float determinant(const mat2 a) {
	return `.concat(A(0,0,2),`;
}
float determinant(const mat3 a) {
	return `).concat(I(0,0,3),`;
}
float determinant(const mat4 a) {
	return `).concat(P(0,0,4),`;
}
`)),v.includes("sinh")&&(S+=`


float sinh(const float x) {
	return (pow(`.concat(Math.E,", x) - pow(").concat(Math.E,`, -x)) / 2.0;
}
`)),v.includes("cosh")&&(S+=`


float cosh(const float x) {
	return (pow(`.concat(Math.E,", x) + pow(").concat(Math.E,`, -x)) / 2.0; 
}
`)),v.includes("tanh")&&(S+=`


float tanh(const float x) {
	float e = exp(2.0 * x);
	return (e - 1.0) / (e + 1.0);
}
`),v.includes("asinh")&&(S+=`


float asinh(const float x) {
	return log(x + sqrt(x * x + 1.0));
}
`),v.includes("asinh")&&(S+=`


float acosh(const float x) {
	return log(x + sqrt(x * x - 1.0));
}
`),v.includes("asinh")&&(S+=`


float atanh(float x) {
	x = (x + 1.0) / (x - 1.0);
	return 0.5 * log(x * sign(x));
}
`),S}t.GLSL1Polyfills=U;function c(v,S){return"vec2 index1DToUV(const ".concat(v," index1D, const ").concat(S,` dimensions) {
	`).concat(v," width = ").concat(v,`(dimensions.x);
	`).concat(v,` y = index1D / width;
	`).concat(v,` x = index1D - width * y;
	float u = (float(x) + 0.5) / float(dimensions.x);
	float v = (float(y) + 0.5) / float(dimensions.y);
	return vec2(u, v);
}`)}function E(v,S){return"".concat(v," modi(const ").concat(v," x, const ").concat(S," y) { return x - y * (x / y); }")}function _(v,S){return"".concat(S," stepi(const ").concat(v," x, const ").concat(S," y) { return ").concat(S,"(step(").concat(y(v),"(x), ").concat(y(S),"(y))); }")}function i(v,S){return"".concat(v," bitshiftLeft(const ").concat(v," a, const ").concat(S,` b) {
	#if (__VERSION__ == 300)
		return a << b;
	#else
		return a * `).concat(v,"(pow(").concat(y(S),"(2.0), ").concat(y(S),`(b)));
	#endif
}`)}function s(v,S){return"".concat(v," bitshiftRight(const ").concat(v," a, const ").concat(S,` b) {
	#if (__VERSION__ == 300)
		return a >> b;
	#else
		return `).concat(v,"(round(").concat(y(v),"(a) / pow(").concat(y(S),"(2.0), ").concat(y(S),`(b))));
	#endif
}`)}function d(v){return"int bitwiseOr".concat(v===32?"":v,`(int a, int b) {
	#if (__VERSION__ == 300)
		return a | b;
	#else
		int result = 0;
		int n = 1;
		
		for (int i = 0; i < `).concat(v,`; i++) {
			if ((modi(a, 2) == 1) || (modi(b, 2) == 1)) {
				result += n;
			}
			a = a / 2;
			b = b / 2;
			n = n * 2;
			if(!(a > 0 || b > 0)) {
				break;
			}
		}
		return result;
	#endif
}`)}function T(v){return"int bitwiseXOR".concat(v===32?"":v,`(int a, int b) {
	#if (__VERSION__ == 300)
		return a ^ b;
	#else
		int result = 0;
		int n = 1;
		
		for (int i = 0; i < `).concat(v,`; i++) {
			if ((modi(a, 2) == 1) != (modi(b, 2) == 1)) {
				result += n;
			}
			a = a / 2;
			b = b / 2;
			n = n * 2;
			if(!(a > 0 || b > 0)) {
				break;
			}
		}
		return result;
	#endif
}`)}function L(v){return"int bitwiseAnd".concat(v===32?"":v,`(int a, int b) {
	#if (__VERSION__ == 300)
		return a & b;
	#else
		int result = 0;
		int n = 1;
		for (int i = 0; i < `).concat(v,`; i++) {
			if ((modi(a, 2) == 1) && (modi(b, 2) == 1)) {
				result += n;
			}
			a = a / 2;
			b = b / 2;
			n = n * 2;
			if(!(a > 0 && b > 0)) {
				break;
			}
		}
		return result;
	#endif
}`)}function C(v){return"int bitwiseNot".concat(v===32?"":v,`(int a) {
	#if (__VERSION__ == 300)
		return ~a;
	#else
		int result = 0;
		int n = 1;

		for (int i = 0; i < `).concat(v,`; i++) {
			if (modi(a, 2) == 0) {
				result += n;
			}
			a = a / 2;
			n = n * 2;
		}
		return result;
	#endif
}`)}function Y(v,S){var w="";return v.includes("index1DToUV")&&(w+=`

`.concat(c("int","ivec2"),`
`).concat(c("int","vec2"),`
#if (__VERSION__ == 300)
`).concat(c("int","uvec2"),`
`).concat(c("uint","uvec2"),`
`).concat(c("uint","ivec2"),`
`).concat(c("uint","vec2"),`
#endif
`)),(v.includes("modi")||S===l.GLSL1&&v.includes("bitwise"))&&(w+=`

`.concat(E("int","int"),`
`).concat(E("ivec2","ivec2"),`
`).concat(E("ivec3","ivec3"),`
`).concat(E("ivec4","ivec4"),`
`).concat(E("ivec2","int"),`
`).concat(E("ivec3","int"),`
`).concat(E("ivec4","int"),`
#if (__VERSION__ == 300)
`).concat(E("uint","uint"),`
`).concat(E("uvec2","uvec2"),`
`).concat(E("uvec3","uvec3"),`
`).concat(E("uvec4","uvec4"),`
`).concat(E("uvec2","uint"),`
`).concat(E("uvec3","uint"),`
`).concat(E("uvec4","uint"),`
#endif
`)),v.includes("stepi")&&(w+=`

`.concat(_("int","int"),`
`).concat(_("ivec2","ivec2"),`
`).concat(_("ivec3","ivec3"),`
`).concat(_("ivec4","ivec4"),`
`).concat(_("int","ivec2"),`
`).concat(_("int","ivec3"),`
`).concat(_("int","ivec4"),`
#if (__VERSION__ == 300)
`).concat(_("uint","uint"),`
`).concat(_("uvec2","uvec2"),`
`).concat(_("uvec3","uvec3"),`
`).concat(_("uvec4","uvec4"),`
`).concat(_("uint","uvec2"),`
`).concat(_("uint","uvec3"),`
`).concat(_("uint","uvec4"),`
#endif
`)),v.includes("bitshiftLeft")&&(w+=`

`.concat(i("int","int"),`
`).concat(i("ivec2","ivec2"),`
`).concat(i("ivec3","ivec3"),`
`).concat(i("ivec4","ivec4"),`
`).concat(i("ivec2","int"),`
`).concat(i("ivec3","int"),`
`).concat(i("ivec4","int"),`
#if (__VERSION__ == 300)
`).concat(i("uint","uint"),`
`).concat(i("uvec2","uvec2"),`
`).concat(i("uvec3","uvec3"),`
`).concat(i("uvec4","uvec4"),`
`).concat(i("uvec2","uint"),`
`).concat(i("uvec3","uint"),`
`).concat(i("uvec4","uint"),`
#endif
`)),v.includes("bitshiftRight")&&(w+=`

`.concat(s("int","int"),`
`).concat(s("ivec2","ivec2"),`
`).concat(s("ivec3","ivec3"),`
`).concat(s("ivec4","ivec4"),`
`).concat(s("ivec2","int"),`
`).concat(s("ivec3","int"),`
`).concat(s("ivec4","int"),`
#if (__VERSION__ == 300)
`).concat(s("uint","uint"),`
`).concat(s("uvec2","uvec2"),`
`).concat(s("uvec3","uvec3"),`
`).concat(s("uvec4","uvec4"),`
`).concat(s("uvec2","uint"),`
`).concat(s("uvec3","uint"),`
`).concat(s("uvec4","uint"),`
#endif
`)),v.includes("bitwiseOr")&&(w+=`

`.concat(d(8),`
`).concat(d(16),`
`).concat(d(32),`
#if (__VERSION__ == 300)
`).concat([8,16,""].map(function(k){return`
uint bitwiseOr`.concat(k,`(uint a, uint b) {
	return uint(bitwiseOr`).concat(k,`(int(a), int(b)));
}`)}).join(`
`),`
#endif
`)),v.includes("bitwiseXOR")&&(w+=`

`.concat(T(8),`
`).concat(T(16),`
`).concat(T(32),`
#if (__VERSION__ == 300)
`).concat([8,16,""].map(function(k){return`
uint bitwiseXOR`.concat(k,`(uint a, uint b) {
	return uint(bitwiseXOR`).concat(k,`(int(a), int(b)));
}`)}).join(`
`),`
#endif
`)),v.includes("bitwiseAnd")&&(w+=`

`.concat(L(8),`
`).concat(L(16),`
`).concat(L(32),`
#if (__VERSION__ == 300)
`).concat([8,16,""].map(function(k){return`
uint bitwiseAnd`.concat(k,`(uint a, uint b) {
	return uint(bitwiseAnd`).concat(k,`(int(a), int(b)));
}`)}).join(`
`),`
#endif
`)),v.includes("bitwiseNot")&&(w+=`

`.concat(C(8),`
`).concat(C(16),`
`).concat(C(32),`
#if (__VERSION__ == 300)
`).concat([8,16,""].map(function(k){return`
uint bitwiseNot`.concat(k,`(uint a) {
	return uint(bitwiseNot`).concat(k,`(int(a)));
}`)}).join(`
`),`
#endif
`)),w}t.fragmentShaderPolyfills=Y},126:(R,t,h)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getSampler2DsInProgram=t.stripComments=t.stripPrecision=t.stripVersion=t.highpToMediump=t.glsl1Uint=t.glsl1Sampler2D=t.glsl1Texture=t.checkFragmentShaderForFragColor=t.glsl1FragmentOut=t.getFragmentOuts=t.glsl1FragmentIn=t.glsl1VertexOut=t.castVaryingToFloat=t.glsl1VertexIn=void 0;var l=h(601);function b(_){return _.replace(/\bin\b/g,"attribute")}t.glsl1VertexIn=b;function f(_){return _.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function y(_,i,s){var d=new RegExp("\\b".concat(f(i),"\\s*=\\s*\\S[^;]*;"),"sg"),T=_.match(d);if(T)for(var L=0;L<T.length;L++){var C=new RegExp("\\b".concat(f(i),"\\s*=\\s*(\\S[^;]*);"),"s"),Y=T[L].match(C);if(Y&&Y[1]){var v=new RegExp("\\b".concat(f(i),"\\s*=\\s*").concat(f(Y[1]),"\\s*;"),"s");_=_.replace(v,"".concat(i," = ").concat(s,"(").concat(Y[1],");"))}else console.warn('Could not find value in expression: "'.concat(T[L],'"'))}else console.warn("No assignment found for shader variable ".concat(i,"."));return _}function G(_,i,s){var d=new RegExp("".concat(i,"\\s+\\S[^;]*;"),"g"),T=_.match(d);if(T){var L=new RegExp("".concat(i,"\\b"),"g");_=_.replace(L,"varying ".concat(s));for(var C=0;C<T.length;C++){var Y=new RegExp("".concat(i,"\\s+(\\S[^;]*);")),v=T[C].match(Y);v&&v[2]?_=y(_,v[2],s):console.warn('Could not find variable name in expression: "'.concat(T[C],'"'))}}return _}function m(_){return _=G(_,"\\bvarying\\s+(u)?int","float"),_=G(_,"\\bvarying\\s+(i|u)vec2","vec2"),_=G(_,"\\bvarying\\s+(i|u)vec3","vec3"),_=G(_,"\\bvarying\\s+(i|u)vec4","vec4"),_}t.castVaryingToFloat=m;function X(_){return _=_.replace(/(\bflat\s+)?\bout\b/g,"varying"),_=m(_),_}t.glsl1VertexOut=X;function M(_){return _=_.replace(/(\bflat\s+)?\bin\b/g,"varying"),_=m(_),_}t.glsl1FragmentIn=M;function V(_,i){for(var s={},d=0;;){var T=_.match(/\b(layout\s*\(\s*location\s*=\s*([0-9]+)\s*\)\s*)?out\s+((lowp|mediump|highp)\s+)?((float|int|uint|([iu]?vec[234]))\s+)?([_$a-zA-Z0-9]+)\s*;/);if(!T){if(Object.keys(s).length===0)return[];for(var L=Object.keys(s),C=L.length,Y=new Array(d).fill(void 0),v=0;v<C;v++){var S=L[v],w=s[S],k=w.location,q=w.type;if(Y[k]!==void 0)throw new Error('Must be exactly one out declaration per layout location in GPUProgram "'.concat(i,'", conflicting declarations found at location ').concat(k,"."));Y[k]={name:S,type:q}}if(L.length!==d+1)throw new Error('Must be exactly one out declaration per layout location in GPUProgram "'.concat(i,'", layout locations must be sequential (no missing location numbers) starting from 0.'));for(var v=0;v<=d;v++)if(Y[v]===void 0)throw new Error("Missing out declaration at location ".concat(v,' in GPUProgram "').concat(i,'", layout locations must be sequential (no missing location numbers) starting from 0.'));return Y}var W=T[8],j=parseInt(T[2]||"0"),$=T[6];if(!$)throw new Error('No type found for out declaration "'.concat(T[0],'" for GPUProgram "').concat(i,'".'));if(!W)throw new Error('No variable name found for out declaration "'.concat(T[0],'" for GPUProgram "').concat(i,'".'));if(s[W]){if(s[W].location!==j)throw new Error('All out declarations for variable "'.concat(W,'" must have same location in GPUProgram "').concat(i,'".'))}else j>d&&(d=j),s[W]={location:j,type:$};_=_.replace(T[0],"")}}t.getFragmentOuts=V;function H(_,i){var s=V(_,i);if(s.length===0)return[_];_=_.replace(/\blayout\s*\(\s*location\s*=\s*([0-9]+)\s*\)\s*/g,"");for(var d=[],T=0,L=s.length;T<L;T++){var C=s[T],Y=C.type,v=C.name,S=new RegExp("\\bout\\s+((lowp|mediump|highp)\\s+)?(float|int|uint|([iu]?vec[234]))\\s+".concat(v,"\\s*;"),"g"),w=_.replace(S,"");w=w.replace(/\bout\b/g,"");for(var k=!1,q=new RegExp("\\b".concat(v,"\\s*=\\s*(\\S.*?);"),"s");;){var W=w.match(q);if(W&&W[1]){k=!0;var j="";switch(Y){case"float":case"int":case"uint":j=", 0, 0, 0";break;case"vec2":case"ivec2":case"uvec2":j=", 0, 0";break;case"vec3":case"ivec3":case"uvec3":j=", 0";break}w=w.replace(q,"gl_FragColor = vec4(".concat(W[1]).concat(j,");"))}else{if(!k)throw new Error('No assignment found for out declaration in GPUProgram "'.concat(i,'".'));break}}d.push(w)}return d}t.glsl1FragmentOut=H;function F(_){return!!_.match(/\bgl_FragColor\b/)}function N(_,i,s){var d=F(_);if(i===l.GLSL3&&d)throw new Error('Found "gl_FragColor" declaration in fragment shader for GPUProgram "'.concat(s,'": either init GPUComposer with glslVersion = GLSL1 or use GLSL3 syntax in your fragment shader.'))}t.checkFragmentShaderForFragColor=N;function O(_){return _.replace(/\btexture\(/g,"texture2D(")}t.glsl1Texture=O;function p(_){return _.replace(/\b(i|u)sampler2D\b/g,"sampler2D")}t.glsl1Sampler2D=p;function A(_){return _=_.replace(/\buint\b/g,"int"),_=_.replace(/\buvec2\b/g,"ivec2"),_=_.replace(/\buvec3\b/g,"ivec3"),_=_.replace(/\buvec4\b/g,"ivec4"),_=_.replace(/\buint\(/g,"int("),_=_.replace(/\buvec2\(/g,"ivec2("),_=_.replace(/\buvec3\(/g,"ivec3("),_=_.replace(/\buvec4\(/g,"ivec4("),_}t.glsl1Uint=A;function I(_){return _.replace(/\bhighp\b/,"mediump")}t.highpToMediump=I;function P(_){var i=_.length;return _=_.replace(/^\s*\#version\s+([0-9]+(\s+(es)+)?)\s*/,""),_.length!==i&&console.warn("GPUIO expects shader source that does not contain #version declarations, removing...."),_}t.stripVersion=P;function U(_){var i=_.length;return _=_.replace(/\s*precision\s+((highp)|(mediump)|(lowp))\s+[a-zA-Z0-9]+\s*;/g,""),_.length!==i&&console.warn("GPUIO expects shader source that does not contain precision declarations, removing...."),_}t.stripPrecision=U;function c(_){return _=_.replace(/[\t ]*\/\/.*\n/g,""),_=_.replace(/\/\*.*?\*\//gs,""),_}t.stripComments=c;function E(_){var i={},s="\\buniform\\s+(((highp)|(mediump)|(lowp))\\s+)?(i|u)?sampler2D\\s+(\\w+)\\s*;",d=_.match(new RegExp(s,"g"));if(!d||d.length===0)return[];var T=new RegExp(s);return d.forEach(function(L){var C=L.match(T);if(!C||!C[7]){console.warn('Could not find sampler2D uniform name in string "'.concat(L,'".'));return}i[C[7]]=!0}),Object.keys(i)}t.getSampler2DsInProgram=E},593:function(R,t,h){var l=this&&this.__awaiter||function(x,K,Z,D){function B(z){return z instanceof Z?z:new Z(function(Q){Q(z)})}return new(Z||(Z=Promise))(function(z,Q){function re(ae){try{ee(D.next(ae))}catch(fe){Q(fe)}}function te(ae){try{ee(D.throw(ae))}catch(fe){Q(fe)}}function ee(ae){ae.done?z(ae.value):B(ae.value).then(re,te)}ee((D=D.apply(x,K||[])).next())})},b=this&&this.__generator||function(x,K){var Z={label:0,sent:function(){if(z[0]&1)throw z[1];return z[1]},trys:[],ops:[]},D,B,z,Q;return Q={next:re(0),throw:re(1),return:re(2)},typeof Symbol=="function"&&(Q[Symbol.iterator]=function(){return this}),Q;function re(ee){return function(ae){return te([ee,ae])}}function te(ee){if(D)throw new TypeError("Generator is already executing.");for(;Z;)try{if(D=1,B&&(z=ee[0]&2?B.return:ee[0]?B.throw||((z=B.return)&&z.call(B),0):B.next)&&!(z=z.call(B,ee[1])).done)return z;switch(B=0,z&&(ee=[ee[0]&2,z.value]),ee[0]){case 0:case 1:z=ee;break;case 4:return Z.label++,{value:ee[1],done:!1};case 5:Z.label++,B=ee[1],ee=[0];continue;case 7:ee=Z.ops.pop(),Z.trys.pop();continue;default:if(z=Z.trys,!(z=z.length>0&&z[z.length-1])&&(ee[0]===6||ee[0]===2)){Z=0;continue}if(ee[0]===3&&(!z||ee[1]>z[0]&&ee[1]<z[3])){Z.label=ee[1];break}if(ee[0]===6&&Z.label<z[1]){Z.label=z[1],z=ee;break}if(z&&Z.label<z[2]){Z.label=z[2],Z.ops.push(ee);break}z[2]&&Z.ops.pop(),Z.trys.pop();continue}ee=K.call(x,Z)}catch(ae){ee=[6,ae],B=0}finally{D=z=0}if(ee[0]&5)throw ee[1];return{value:ee[0]?ee[1]:void 0,done:!0}}};Object.defineProperty(t,"__esModule",{value:!0}),t.readPixelsAsync=t.indexOfLayerInArray=t.uniformInternalTypeForValue=t.preprocessFragmentShader=t.preprocessVertexShader=t.convertFragmentShaderToGLSL1=t.initSequentialFloatArray=t.isPowerOf2=t.getFragmentShaderMediumpPrecision=t.getVertexShaderMediumpPrecision=t.isHighpSupportedInFragmentShader=t.isHighpSupportedInVertexShader=t.readyToRead=t.isWebGL2Supported=t.isWebGL2=t.initGLProgram=t.compileShader=t.makeShaderHeader=t.isIntType=t.isSignedIntType=t.isUnsignedIntType=t.isFloatType=void 0;var f=h(566),y=h(601),G=h(690),m=h(724),X=h(360),M=h(126),V={supportsWebGL2:void 0,supportsHighpVertex:void 0,supportsHighpFragment:void 0,mediumpVertexPrecision:void 0,mediumpFragmentPrecision:void 0};function H(x){return x===y.FLOAT||x===y.HALF_FLOAT}t.isFloatType=H;function F(x){return x===y.UNSIGNED_BYTE||x===y.UNSIGNED_SHORT||x===y.UNSIGNED_INT}t.isUnsignedIntType=F;function N(x){return x===y.BYTE||x===y.SHORT||x===y.INT}t.isSignedIntType=N;function O(x){return F(x)||N(x)}t.isIntType=O;function p(x){for(var K="",Z=Object.keys(x),D=0;D<Z.length;D++){var B=Z[D];if(!(0,f.isString)(B)||!(0,f.isString)(x[B]))throw new Error("GPUProgram compile time constants must be passed in as key value pairs that are both strings, got key value pair of type [".concat(typeof B," : ").concat(typeof x[B],"] for key ").concat(B,"."));K+="#define ".concat(B," ").concat(x[B],`
`)}return K}function A(x,K,Z,D,B){var z,Q=x===y.GLSL3?"#version ".concat(y.GLSL3,`
`):"",re=D?p(D):"",te=p((z={},z[y.GPUIO_INT_PRECISION]="".concat((0,G.intForPrecision)(K)),z[y.GPUIO_FLOAT_PRECISION]="".concat((0,G.intForPrecision)(Z)),z));return"".concat(Q).concat(B||"").concat(re).concat(te).concat(m.PRECISION_SOURCE)}t.makeShaderHeader=A;function I(x,K,Z,D,B,z,Q,re,te,ee,ae){ae===void 0&&(ae=!1);var fe=x.createShader(z);if(!fe)return re("Unable to init gl shader."),null;var _e=A(K,Z,D,te,ee),de="".concat(_e).concat(B);if(x.shaderSource(fe,de),x.compileShader(fe),ae){var me=x.getShaderParameter(fe,x.COMPILE_STATUS);if(!me)return console.log(de.split(`
`).map(function(pe,ve){return"".concat(ve,"	").concat(pe)}).join(`
`)),re("Could not compile ".concat(z===x.FRAGMENT_SHADER?"fragment":"vertex",' shader for program "').concat(Q,'": ').concat(x.getShaderInfoLog(fe),".")),null}return fe}t.compileShader=I;function P(x,K,Z,D,B){var z=x.createProgram();if(!z){B('Unable to init GL program for GPUProgram "'.concat(D,'", gl.createProgram() has failed.'));return}x.attachShader(z,K),x.attachShader(z,Z),x.linkProgram(z);var Q=x.getProgramParameter(z,x.LINK_STATUS);if(!Q){B('GPUProgram "'.concat(D,'" failed to link: ').concat(x.getProgramInfoLog(z)));return}return z}t.initGLProgram=P;function U(x){return typeof WebGL2RenderingContext<"u"&&x instanceof WebGL2RenderingContext||typeof WebGL2ComputeRenderingContext<"u"&&x instanceof WebGL2ComputeRenderingContext}t.isWebGL2=U;function c(){if(V.supportsWebGL2===void 0){var x=document.createElement("canvas").getContext(y.WEBGL2);V.supportsWebGL2=U(x)}return V.supportsWebGL2}t.isWebGL2Supported=c;function E(x){return x.checkFramebufferStatus(x.FRAMEBUFFER)==x.FRAMEBUFFER_COMPLETE}t.readyToRead=E;function _(x,K){var Z=document.createElement("canvas").getContext(y.WEBGL1);if(!Z)throw new Error("Unable to init webgl context.");try{var D=I(Z,y.GLSL1,y.PRECISION_HIGH_P,y.PRECISION_HIGH_P,x,Z.VERTEX_SHADER,"highpFragmentTest",y.DEFAULT_ERROR_CALLBACK),B=I(Z,y.GLSL1,y.PRECISION_HIGH_P,y.PRECISION_HIGH_P,K,Z.FRAGMENT_SHADER,"highpFragmentTest",y.DEFAULT_ERROR_CALLBACK),z=P(Z,D,B,"highpFragmentTest",y.DEFAULT_ERROR_CALLBACK);Z.deleteProgram(z),Z.deleteShader(D),Z.deleteShader(B)}catch{return!1}return!0}function i(){if(V.supportsHighpVertex===void 0){var x=_("void main() { highp float test = 0.524; gl_Position = vec4(test, test, 0, 1); }","void main() { gl_FragColor = vec4(0); }");V.supportsHighpVertex=x}return V.supportsHighpVertex}t.isHighpSupportedInVertexShader=i;function s(){if(V.supportsHighpFragment===void 0){var x=_("void main() { gl_Position = vec4(0.5, 0.5, 0, 1); }","void main() { highp float test = 1.35; gl_FragColor = vec4(test); }");V.supportsHighpFragment=x}return V.supportsHighpFragment}t.isHighpSupportedInFragmentShader=s;function d(x,K,Z,D,B){var z=P(K,D,Z,x,y.DEFAULT_ERROR_CALLBACK);if(!z)throw new Error("Unable to init WebGLProgram.");var Q=K.getAttribLocation(z,"position"),re=K.createBuffer();K.bindBuffer(K.ARRAY_BUFFER,re),K.bufferData(K.ARRAY_BUFFER,1,K.STATIC_DRAW),K.enableVertexAttribArray(Q),K.vertexAttribPointer(Q,1,K.UNSIGNED_BYTE,!1,0,0),K.viewport(0,0,1,1),K.useProgram(z),B(z),K.drawArrays(K.POINTS,0,1);var te=new Uint8Array(4);return K.readPixels(0,0,1,1,K.RGBA,K.UNSIGNED_BYTE,te),K.disableVertexAttribArray(Q),K.deleteProgram(z),K.deleteShader(D),K.deleteShader(Z),K.deleteBuffer(re),te}function T(){if(V.mediumpVertexPrecision===void 0){var x=document.createElement("canvas"),K=x.getContext("webgl");if(!K)throw new Error("Unable to init webgl context.");var Z=I(K,y.GLSL1,y.PRECISION_MEDIUM_P,y.PRECISION_MEDIUM_P,`
	attribute vec4 position;  // needed because of another bug in Safari
	uniform mediump vec3 v;
	varying mediump vec4 v_result;
	void main() {
		gl_Position = position;
		gl_PointSize = 1.0;
		v_result = vec4(normalize(v) * 0.5 + 0.5, 1);
	}
		`,K.VERTEX_SHADER,"mediumpPrecisionVertexTest",y.DEFAULT_ERROR_CALLBACK);if(!Z)throw new Error("Unable to init vertex shader.");var D=I(K,y.GLSL1,y.PRECISION_MEDIUM_P,y.PRECISION_MEDIUM_P,`
	varying mediump vec4 v_result;
	void main() {
		gl_FragColor = v_result;
	}
		`,K.FRAGMENT_SHADER,"mediumpPrecisionVertexTest",y.DEFAULT_ERROR_CALLBACK);if(!D)throw new Error("Unable to init fragment shader.");var B=Math.pow(2,31)-1,z=Math.sqrt(B),Q=(z/Math.sqrt(z*z*3)*.5+.5)*255|0,re=d("mediumpPrecisionVertexTest",K,D,Z,function(ee){var ae=K.getUniformLocation(ee,"v");K.uniform3f(ae,z,z,z)}),te=Math.abs(re[0]-Q)>16;V.mediumpVertexPrecision=te?y.PRECISION_MEDIUM_P:y.PRECISION_HIGH_P}return V.mediumpVertexPrecision}t.getVertexShaderMediumpPrecision=T;function L(){if(V.mediumpFragmentPrecision===void 0){var x=document.createElement("canvas"),K=x.getContext("webgl");if(!K)throw new Error("Unable to init webgl context.");var Z=I(K,y.GLSL1,y.PRECISION_MEDIUM_P,y.PRECISION_MEDIUM_P,`
	attribute vec4 position;  // needed because of another bug in Safari
	void main() {
		gl_Position = position;
		gl_PointSize = 1.0;
	}
		`,K.VERTEX_SHADER,"mediumpPrecisionFragmentTest",y.DEFAULT_ERROR_CALLBACK);if(!Z)throw new Error("Unable to init vertex shader.");var D=I(K,y.GLSL1,y.PRECISION_MEDIUM_P,y.PRECISION_MEDIUM_P,`
	uniform mediump vec3 v;
	void main() {
		gl_FragColor = vec4(normalize(v) * 0.5 + 0.5, 1);
	}
		`,K.FRAGMENT_SHADER,"mediumpPrecisionFragmentTest",y.DEFAULT_ERROR_CALLBACK);if(!D)throw new Error("Unable to init fragment shader.");var B=Math.pow(2,31)-1,z=Math.sqrt(B),Q=(z/Math.sqrt(z*z*3)*.5+.5)*255|0,re=d("mediumpPrecisionFragmentTest",K,D,Z,function(ee){var ae=K.getUniformLocation(ee,"v");K.uniform3f(ae,z,z,z)}),te=Math.abs(re[0]-Q)>16;V.mediumpFragmentPrecision=te?y.PRECISION_MEDIUM_P:y.PRECISION_HIGH_P}return V.mediumpFragmentPrecision}t.getFragmentShaderMediumpPrecision=L;function C(x){return x>0&&(x&x-1)==0}t.isPowerOf2=C;function Y(x){for(var K=new Float32Array(x),Z=0;Z<x;Z++)K[Z]=Z;return K}t.initSequentialFloatArray=Y;function v(x){return x=(0,M.stripVersion)(x),x=(0,M.stripPrecision)(x),x=(0,M.stripComments)(x),x}function S(x){return x=(0,M.glsl1Sampler2D)(x),x=(0,M.glsl1Uint)(x),x=(0,M.glsl1Texture)(x),x}function w(x){return x=S(x),x=(0,M.glsl1VertexIn)(x),x=(0,M.glsl1VertexOut)(x),x}function k(x,K){return x=S(x),x=(0,M.glsl1FragmentIn)(x),(0,M.glsl1FragmentOut)(x,K)}t.convertFragmentShaderToGLSL1=k;function q(x,K){return x=v(x),i()||(console.warn("highp not supported in vertex shader in this browser, falling back to mediump."),x=(0,M.highpToMediump)(x)),K===y.GLSL3?x:w(x)}t.preprocessVertexShader=q;function W(x,K,Z){var D;x=v(x),(0,M.checkFragmentShaderForFragColor)(x,K,Z),s()||(console.warn("highp not supported in fragment shader in this browser, falling back to mediump."),x=(0,M.highpToMediump)(x)),x=(0,X.fragmentShaderPolyfills)(x,K)+x;var B;if(D=(0,X.texturePolyfill)(x),x=D.shaderSource,B=D.samplerUniforms,K!==y.GLSL3){for(var z=k(x,Z),Q=0,re=z.length;Q<re;Q++)z[Q]=(0,X.GLSL1Polyfills)(z[Q])+z[Q];if(x=z.shift(),z.length)return{shaderSource:x,samplerUniforms:B,additionalSources:z}}return{shaderSource:x,samplerUniforms:B}}t.preprocessFragmentShader=W;function j(x,K,Z,D){if(K===y.FLOAT){if((0,f.isArray)(x)){for(var B=0;B<x.length;B++)if(!(0,f.isFiniteNumber)(x[B]))throw new Error("Invalid value ".concat(JSON.stringify(x),' for uniform "').concat(Z,'" in program "').concat(D,'", expected float or float[] of length 1-4.'))}else if(!(0,f.isFiniteNumber)(x))throw new Error("Invalid value ".concat(JSON.stringify(x),' for uniform "').concat(Z,'" in program "').concat(D,'", expected float or float[] of length 1-4.'));if(!(0,f.isArray)(x)||x.length===1)return y.FLOAT_1D_UNIFORM;if(x.length===2)return y.FLOAT_2D_UNIFORM;if(x.length===3)return y.FLOAT_3D_UNIFORM;if(x.length===4)return y.FLOAT_4D_UNIFORM;throw new Error("Invalid value ".concat(JSON.stringify(x),' for uniform "').concat(Z,'" in program "').concat(D,'", expected float or float[] of length 1-4.'))}else if(K===y.INT){if((0,f.isArray)(x)){for(var B=0;B<x.length;B++)if(!(0,f.isInteger)(x[B]))throw new Error("Invalid value ".concat(JSON.stringify(x),' for uniform "').concat(Z,'" in program "').concat(D,'", expected int or int[] of length 1-4.'))}else if(!(0,f.isInteger)(x))throw new Error("Invalid value ".concat(JSON.stringify(x),' for uniform "').concat(Z,'" in program "').concat(D,'", expected int or int[] of length 1-4.'));if(!(0,f.isArray)(x)||x.length===1)return y.INT_1D_UNIFORM;if(x.length===2)return y.INT_2D_UNIFORM;if(x.length===3)return y.INT_3D_UNIFORM;if(x.length===4)return y.INT_4D_UNIFORM;throw new Error("Invalid value ".concat(JSON.stringify(x),' for uniform "').concat(Z,'" in program "').concat(D,'", expected int or int[] of length 1-4.'))}else if(K===y.UINT){if((0,f.isArray)(x)){for(var B=0;B<x.length;B++)if(!(0,f.isNonNegativeInteger)(x[B]))throw new Error("Invalid value ".concat(JSON.stringify(x),' for uniform "').concat(Z,'" in program "').concat(D,'", expected uint or uint[] of length 1-4.'))}else if(!(0,f.isNonNegativeInteger)(x))throw new Error("Invalid value ".concat(JSON.stringify(x),' for uniform "').concat(Z,'" in program "').concat(D,'", expected uint or uint[] of length 1-4.'));if(!(0,f.isArray)(x)||x.length===1)return y.UINT_1D_UNIFORM;if(x.length===2)return y.UINT_2D_UNIFORM;if(x.length===3)return y.UINT_3D_UNIFORM;if(x.length===4)return y.UINT_4D_UNIFORM;throw new Error("Invalid value ".concat(JSON.stringify(x),' for uniform "').concat(Z,'" in program "').concat(D,'", expected uint or uint[] of length 1-4.'))}else if(K===y.BOOL){if((0,f.isArray)(x)){for(var B=0;B<x.length;B++)if(!(0,f.isBoolean)(x[B]))throw new Error("Invalid value ".concat(JSON.stringify(x),' for uniform "').concat(Z,'" in program "').concat(D,'", expected bool or bool[] of length 1-4.'))}else if(!(0,f.isBoolean)(x))throw new Error("Invalid value ".concat(JSON.stringify(x),' for uniform "').concat(Z,'" in program "').concat(D,'", expected bool or bool[] of length 1-4.'));if(!(0,f.isArray)(x)||x.length===1)return y.BOOL_1D_UNIFORM;if(x.length===2)return y.BOOL_2D_UNIFORM;if(x.length===3)return y.BOOL_3D_UNIFORM;if(x.length===4)return y.BOOL_4D_UNIFORM;throw new Error("Invalid value ".concat(JSON.stringify(x),' for uniform "').concat(Z,'" in program "').concat(D,'", expected boolean.'))}else throw new Error('Invalid type "'.concat(K,'" for uniform "').concat(Z,'" in program "').concat(D,'", expected ').concat(y.FLOAT," or ").concat(y.INT," or ").concat(y.BOOL,"."))}t.uniformInternalTypeForValue=j;function $(x,K){return K.findIndex(function(Z){return Z===x||Z.layer===x})}t.indexOfLayerInArray=$;function ne(x,K,Z,D){return new Promise(function(B,z){function Q(){var re=x.clientWaitSync(K,Z,0);if(re===x.WAIT_FAILED){z();return}if(re===x.TIMEOUT_EXPIRED){setTimeout(Q,D);return}B()}Q()})}function J(x,K,Z,D,B){return l(this,void 0,void 0,function(){var z;return b(this,function(Q){switch(Q.label){case 0:return z=x.fenceSync(x.SYNC_GPU_COMMANDS_COMPLETE,0),x.flush(),[4,ne(x,z,0,10)];case 1:return Q.sent(),x.deleteSync(z),x.bindBuffer(K,Z),x.getBufferSubData(K,D,B),x.bindBuffer(K,null),[2]}})})}function ie(x,K,Z,D,B,z,Q,re){return l(this,void 0,void 0,function(){var te;return b(this,function(ee){switch(ee.label){case 0:return te=x.createBuffer(),x.bindBuffer(x.PIXEL_PACK_BUFFER,te),x.bufferData(x.PIXEL_PACK_BUFFER,re.byteLength,x.STREAM_READ),x.readPixels(K,Z,D,B,z,Q,0),x.bindBuffer(x.PIXEL_PACK_BUFFER,null),[4,J(x,x.PIXEL_PACK_BUFFER,te,0,re)];case 1:return ee.sent(),x.deleteBuffer(te),[2,re]}})})}t.readPixelsAsync=ie},557:(R,t,h)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getFloat16=y,t.setFloat16=G;var l=h(802),b=h(605),f=h(983);function y(m,X,...M){return(0,b.convertToNumber)((0,f.DataViewPrototypeGetUint16)(m,X,...(0,l.safeIfNeeded)(M)))}function G(m,X,M,...V){return(0,f.DataViewPrototypeSetUint16)(m,X,(0,b.roundToFloat16Bits)(M),...(0,l.safeIfNeeded)(V))}},310:(R,t,h)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isFloat16Array=H;var l=h(802),b=h(299),f=h(605),y=h(554),G=h(930),m=h(983),X=h(700);const M=2,V=new m.NativeWeakMap;function H(c){return(0,m.WeakMapPrototypeHas)(V,c)||!(0,m.ArrayBufferIsView)(c)&&(0,b.hasFloat16ArrayBrand)(c)}function F(c){if(!H(c))throw(0,m.NativeTypeError)(G.THIS_IS_NOT_A_FLOAT16ARRAY_OBJECT)}function N(c,E){const _=H(c),i=(0,y.isNativeTypedArray)(c);if(!_&&!i)throw(0,m.NativeTypeError)(G.SPECIES_CONSTRUCTOR_DIDNT_RETURN_TYPEDARRAY_OBJECT);if(typeof E=="number"){let s;if(_){const d=O(c);s=(0,m.TypedArrayPrototypeGetLength)(d)}else s=(0,m.TypedArrayPrototypeGetLength)(c);if(s<E)throw(0,m.NativeTypeError)(G.DERIVED_CONSTRUCTOR_CREATED_TYPEDARRAY_OBJECT_WHICH_WAS_TOO_SMALL_LENGTH)}if((0,y.isNativeBigIntTypedArray)(c))throw(0,m.NativeTypeError)(G.CANNOT_MIX_BIGINT_AND_OTHER_TYPES)}function O(c){const E=(0,m.WeakMapPrototypeGet)(V,c);if(E!==void 0){const s=(0,m.TypedArrayPrototypeGetBuffer)(E);if((0,X.IsDetachedBuffer)(s))throw(0,m.NativeTypeError)(G.ATTEMPTING_TO_ACCESS_DETACHED_ARRAYBUFFER);return E}const _=c.buffer;if((0,X.IsDetachedBuffer)(_))throw(0,m.NativeTypeError)(G.ATTEMPTING_TO_ACCESS_DETACHED_ARRAYBUFFER);const i=(0,m.ReflectConstruct)(P,[_,c.byteOffset,c.length],c.constructor);return(0,m.WeakMapPrototypeGet)(V,i)}function p(c){const E=(0,m.TypedArrayPrototypeGetLength)(c),_=[];for(let i=0;i<E;++i)_[i]=(0,f.convertToNumber)(c[i]);return _}const A=new m.NativeWeakSet;for(const c of(0,m.ReflectOwnKeys)(m.TypedArrayPrototype)){if(c===m.SymbolToStringTag)continue;const E=(0,m.ReflectGetOwnPropertyDescriptor)(m.TypedArrayPrototype,c);(0,m.ObjectHasOwn)(E,"get")&&typeof E.get=="function"&&(0,m.WeakSetPrototypeAdd)(A,E.get)}const I=(0,m.ObjectFreeze)({get(c,E,_){return(0,y.isCanonicalIntegerIndexString)(E)&&(0,m.ObjectHasOwn)(c,E)?(0,f.convertToNumber)((0,m.ReflectGet)(c,E)):(0,m.WeakSetPrototypeHas)(A,(0,m.ObjectPrototype__lookupGetter__)(c,E))?(0,m.ReflectGet)(c,E):(0,m.ReflectGet)(c,E,_)},set(c,E,_,i){return(0,y.isCanonicalIntegerIndexString)(E)&&(0,m.ObjectHasOwn)(c,E)?(0,m.ReflectSet)(c,E,(0,f.roundToFloat16Bits)(_)):(0,m.ReflectSet)(c,E,_,i)},getOwnPropertyDescriptor(c,E){if((0,y.isCanonicalIntegerIndexString)(E)&&(0,m.ObjectHasOwn)(c,E)){const _=(0,m.ReflectGetOwnPropertyDescriptor)(c,E);return _.value=(0,f.convertToNumber)(_.value),_}return(0,m.ReflectGetOwnPropertyDescriptor)(c,E)},defineProperty(c,E,_){return(0,y.isCanonicalIntegerIndexString)(E)&&(0,m.ObjectHasOwn)(c,E)&&(0,m.ObjectHasOwn)(_,"value")&&(_.value=(0,f.roundToFloat16Bits)(_.value)),(0,m.ReflectDefineProperty)(c,E,_)}});class P{constructor(E,_,i){let s;if(H(E))s=(0,m.ReflectConstruct)(m.NativeUint16Array,[O(E)],new.target);else if((0,y.isObject)(E)&&!(0,y.isArrayBuffer)(E)){let T,L;if((0,y.isNativeTypedArray)(E)){T=E,L=(0,m.TypedArrayPrototypeGetLength)(E);const C=(0,m.TypedArrayPrototypeGetBuffer)(E),Y=(0,y.isSharedArrayBuffer)(C)?m.NativeArrayBuffer:(0,X.SpeciesConstructor)(C,m.NativeArrayBuffer);if((0,X.IsDetachedBuffer)(C))throw(0,m.NativeTypeError)(G.ATTEMPTING_TO_ACCESS_DETACHED_ARRAYBUFFER);if((0,y.isNativeBigIntTypedArray)(E))throw(0,m.NativeTypeError)(G.CANNOT_MIX_BIGINT_AND_OTHER_TYPES);const v=new Y(L*M);s=(0,m.ReflectConstruct)(m.NativeUint16Array,[v],new.target)}else{const C=E[m.SymbolIterator];if(C!=null&&typeof C!="function")throw(0,m.NativeTypeError)(G.ITERATOR_PROPERTY_IS_NOT_CALLABLE);C!=null?(0,y.isOrdinaryArray)(E)?(T=E,L=E.length):(T=[...E],L=T.length):(T=E,L=(0,X.ToLength)(T.length)),s=(0,m.ReflectConstruct)(m.NativeUint16Array,[L],new.target)}for(let C=0;C<L;++C)s[C]=(0,f.roundToFloat16Bits)(T[C])}else s=(0,m.ReflectConstruct)(m.NativeUint16Array,arguments,new.target);const d=new m.NativeProxy(s,I);return(0,m.WeakMapPrototypeSet)(V,d,s),d}static from(E,..._){const i=this;if(!(0,m.ReflectHas)(i,b.brand))throw(0,m.NativeTypeError)(G.THIS_CONSTRUCTOR_IS_NOT_A_SUBCLASS_OF_FLOAT16ARRAY);if(i===P){if(H(E)&&_.length===0){const v=O(E),S=new m.NativeUint16Array((0,m.TypedArrayPrototypeGetBuffer)(v),(0,m.TypedArrayPrototypeGetByteOffset)(v),(0,m.TypedArrayPrototypeGetLength)(v));return new P((0,m.TypedArrayPrototypeGetBuffer)((0,m.TypedArrayPrototypeSlice)(S)))}if(_.length===0)return new P((0,m.TypedArrayPrototypeGetBuffer)((0,m.Uint16ArrayFrom)(E,f.roundToFloat16Bits)));const C=_[0],Y=_[1];return new P((0,m.TypedArrayPrototypeGetBuffer)((0,m.Uint16ArrayFrom)(E,function(v,...S){return(0,f.roundToFloat16Bits)((0,m.ReflectApply)(C,this,[v,...(0,l.safeIfNeeded)(S)]))},Y)))}let s,d;const T=E[m.SymbolIterator];if(T!=null&&typeof T!="function")throw(0,m.NativeTypeError)(G.ITERATOR_PROPERTY_IS_NOT_CALLABLE);if(T!=null)(0,y.isOrdinaryArray)(E)?(s=E,d=E.length):(0,y.isOrdinaryNativeTypedArray)(E)?(s=E,d=(0,m.TypedArrayPrototypeGetLength)(E)):(s=[...E],d=s.length);else{if(E==null)throw(0,m.NativeTypeError)(G.CANNOT_CONVERT_UNDEFINED_OR_NULL_TO_OBJECT);s=(0,m.NativeObject)(E),d=(0,X.ToLength)(s.length)}const L=new i(d);if(_.length===0)for(let C=0;C<d;++C)L[C]=s[C];else{const C=_[0],Y=_[1];for(let v=0;v<d;++v)L[v]=(0,m.ReflectApply)(C,Y,[s[v],v])}return L}static of(...E){const _=this;if(!(0,m.ReflectHas)(_,b.brand))throw(0,m.NativeTypeError)(G.THIS_CONSTRUCTOR_IS_NOT_A_SUBCLASS_OF_FLOAT16ARRAY);const i=E.length;if(_===P){const d=new P(i),T=O(d);for(let L=0;L<i;++L)T[L]=(0,f.roundToFloat16Bits)(E[L]);return d}const s=new _(i);for(let d=0;d<i;++d)s[d]=E[d];return s}keys(){F(this);const E=O(this);return(0,m.TypedArrayPrototypeKeys)(E)}values(){F(this);const E=O(this);return(0,l.wrap)(function*(){for(const _ of(0,m.TypedArrayPrototypeValues)(E))yield(0,f.convertToNumber)(_)}())}entries(){F(this);const E=O(this);return(0,l.wrap)(function*(){for(const[_,i]of(0,m.TypedArrayPrototypeEntries)(E))yield[_,(0,f.convertToNumber)(i)]}())}at(E){F(this);const _=O(this),i=(0,m.TypedArrayPrototypeGetLength)(_),s=(0,X.ToIntegerOrInfinity)(E),d=s>=0?s:i+s;if(!(d<0||d>=i))return(0,f.convertToNumber)(_[d])}map(E,..._){F(this);const i=O(this),s=(0,m.TypedArrayPrototypeGetLength)(i),d=_[0],T=(0,X.SpeciesConstructor)(i,P);if(T===P){const C=new P(s),Y=O(C);for(let v=0;v<s;++v){const S=(0,f.convertToNumber)(i[v]);Y[v]=(0,f.roundToFloat16Bits)((0,m.ReflectApply)(E,d,[S,v,this]))}return C}const L=new T(s);N(L,s);for(let C=0;C<s;++C){const Y=(0,f.convertToNumber)(i[C]);L[C]=(0,m.ReflectApply)(E,d,[Y,C,this])}return L}filter(E,..._){F(this);const i=O(this),s=(0,m.TypedArrayPrototypeGetLength)(i),d=_[0],T=[];for(let Y=0;Y<s;++Y){const v=(0,f.convertToNumber)(i[Y]);(0,m.ReflectApply)(E,d,[v,Y,this])&&(0,m.ArrayPrototypePush)(T,v)}const L=(0,X.SpeciesConstructor)(i,P),C=new L(T);return N(C),C}reduce(E,..._){F(this);const i=O(this),s=(0,m.TypedArrayPrototypeGetLength)(i);if(s===0&&_.length===0)throw(0,m.NativeTypeError)(G.REDUCE_OF_EMPTY_ARRAY_WITH_NO_INITIAL_VALUE);let d,T;_.length===0?(d=(0,f.convertToNumber)(i[0]),T=1):(d=_[0],T=0);for(let L=T;L<s;++L)d=E(d,(0,f.convertToNumber)(i[L]),L,this);return d}reduceRight(E,..._){F(this);const i=O(this),s=(0,m.TypedArrayPrototypeGetLength)(i);if(s===0&&_.length===0)throw(0,m.NativeTypeError)(G.REDUCE_OF_EMPTY_ARRAY_WITH_NO_INITIAL_VALUE);let d,T;_.length===0?(d=(0,f.convertToNumber)(i[s-1]),T=s-2):(d=_[0],T=s-1);for(let L=T;L>=0;--L)d=E(d,(0,f.convertToNumber)(i[L]),L,this);return d}forEach(E,..._){F(this);const i=O(this),s=(0,m.TypedArrayPrototypeGetLength)(i),d=_[0];for(let T=0;T<s;++T)(0,m.ReflectApply)(E,d,[(0,f.convertToNumber)(i[T]),T,this])}find(E,..._){F(this);const i=O(this),s=(0,m.TypedArrayPrototypeGetLength)(i),d=_[0];for(let T=0;T<s;++T){const L=(0,f.convertToNumber)(i[T]);if((0,m.ReflectApply)(E,d,[L,T,this]))return L}}findIndex(E,..._){F(this);const i=O(this),s=(0,m.TypedArrayPrototypeGetLength)(i),d=_[0];for(let T=0;T<s;++T){const L=(0,f.convertToNumber)(i[T]);if((0,m.ReflectApply)(E,d,[L,T,this]))return T}return-1}findLast(E,..._){F(this);const i=O(this),s=(0,m.TypedArrayPrototypeGetLength)(i),d=_[0];for(let T=s-1;T>=0;--T){const L=(0,f.convertToNumber)(i[T]);if((0,m.ReflectApply)(E,d,[L,T,this]))return L}}findLastIndex(E,..._){F(this);const i=O(this),s=(0,m.TypedArrayPrototypeGetLength)(i),d=_[0];for(let T=s-1;T>=0;--T){const L=(0,f.convertToNumber)(i[T]);if((0,m.ReflectApply)(E,d,[L,T,this]))return T}return-1}every(E,..._){F(this);const i=O(this),s=(0,m.TypedArrayPrototypeGetLength)(i),d=_[0];for(let T=0;T<s;++T)if(!(0,m.ReflectApply)(E,d,[(0,f.convertToNumber)(i[T]),T,this]))return!1;return!0}some(E,..._){F(this);const i=O(this),s=(0,m.TypedArrayPrototypeGetLength)(i),d=_[0];for(let T=0;T<s;++T)if((0,m.ReflectApply)(E,d,[(0,f.convertToNumber)(i[T]),T,this]))return!0;return!1}set(E,..._){F(this);const i=O(this),s=(0,X.ToIntegerOrInfinity)(_[0]);if(s<0)throw(0,m.NativeRangeError)(G.OFFSET_IS_OUT_OF_BOUNDS);if(E==null)throw(0,m.NativeTypeError)(G.CANNOT_CONVERT_UNDEFINED_OR_NULL_TO_OBJECT);if((0,y.isNativeBigIntTypedArray)(E))throw(0,m.NativeTypeError)(G.CANNOT_MIX_BIGINT_AND_OTHER_TYPES);if(H(E))return(0,m.TypedArrayPrototypeSet)(O(this),O(E),s);if((0,y.isNativeTypedArray)(E)){const C=(0,m.TypedArrayPrototypeGetBuffer)(E);if((0,X.IsDetachedBuffer)(C))throw(0,m.NativeTypeError)(G.ATTEMPTING_TO_ACCESS_DETACHED_ARRAYBUFFER)}const d=(0,m.TypedArrayPrototypeGetLength)(i),T=(0,m.NativeObject)(E),L=(0,X.ToLength)(T.length);if(s===1/0||L+s>d)throw(0,m.NativeRangeError)(G.OFFSET_IS_OUT_OF_BOUNDS);for(let C=0;C<L;++C)i[C+s]=(0,f.roundToFloat16Bits)(T[C])}reverse(){F(this);const E=O(this);return(0,m.TypedArrayPrototypeReverse)(E),this}fill(E,..._){F(this);const i=O(this);return(0,m.TypedArrayPrototypeFill)(i,(0,f.roundToFloat16Bits)(E),...(0,l.safeIfNeeded)(_)),this}copyWithin(E,_,...i){F(this);const s=O(this);return(0,m.TypedArrayPrototypeCopyWithin)(s,E,_,...(0,l.safeIfNeeded)(i)),this}sort(E){F(this);const _=O(this),i=E!==void 0?E:X.defaultCompare;return(0,m.TypedArrayPrototypeSort)(_,(s,d)=>i((0,f.convertToNumber)(s),(0,f.convertToNumber)(d))),this}slice(E,_){F(this);const i=O(this),s=(0,X.SpeciesConstructor)(i,P);if(s===P){const q=new m.NativeUint16Array((0,m.TypedArrayPrototypeGetBuffer)(i),(0,m.TypedArrayPrototypeGetByteOffset)(i),(0,m.TypedArrayPrototypeGetLength)(i));return new P((0,m.TypedArrayPrototypeGetBuffer)((0,m.TypedArrayPrototypeSlice)(q,E,_)))}const d=(0,m.TypedArrayPrototypeGetLength)(i),T=(0,X.ToIntegerOrInfinity)(E),L=_===void 0?d:(0,X.ToIntegerOrInfinity)(_);let C;T===-1/0?C=0:T<0?C=d+T>0?d+T:0:C=d<T?d:T;let Y;L===-1/0?Y=0:L<0?Y=d+L>0?d+L:0:Y=d<L?d:L;const v=Y-C>0?Y-C:0,S=new s(v);if(N(S,v),v===0)return S;const w=(0,m.TypedArrayPrototypeGetBuffer)(i);if((0,X.IsDetachedBuffer)(w))throw(0,m.NativeTypeError)(G.ATTEMPTING_TO_ACCESS_DETACHED_ARRAYBUFFER);let k=0;for(;C<Y;)S[k]=(0,f.convertToNumber)(i[C]),++C,++k;return S}subarray(E,_){F(this);const i=O(this),s=(0,X.SpeciesConstructor)(i,P),d=new m.NativeUint16Array((0,m.TypedArrayPrototypeGetBuffer)(i),(0,m.TypedArrayPrototypeGetByteOffset)(i),(0,m.TypedArrayPrototypeGetLength)(i)),T=(0,m.TypedArrayPrototypeSubarray)(d,E,_),L=new s((0,m.TypedArrayPrototypeGetBuffer)(T),(0,m.TypedArrayPrototypeGetByteOffset)(T),(0,m.TypedArrayPrototypeGetLength)(T));return N(L),L}indexOf(E,..._){F(this);const i=O(this),s=(0,m.TypedArrayPrototypeGetLength)(i);let d=(0,X.ToIntegerOrInfinity)(_[0]);if(d===1/0)return-1;d<0&&(d+=s,d<0&&(d=0));for(let T=d;T<s;++T)if((0,m.ObjectHasOwn)(i,T)&&(0,f.convertToNumber)(i[T])===E)return T;return-1}lastIndexOf(E,..._){F(this);const i=O(this),s=(0,m.TypedArrayPrototypeGetLength)(i);let d=_.length>=1?(0,X.ToIntegerOrInfinity)(_[0]):s-1;if(d===-1/0)return-1;d>=0?d=d<s-1?d:s-1:d+=s;for(let T=d;T>=0;--T)if((0,m.ObjectHasOwn)(i,T)&&(0,f.convertToNumber)(i[T])===E)return T;return-1}includes(E,..._){F(this);const i=O(this),s=(0,m.TypedArrayPrototypeGetLength)(i);let d=(0,X.ToIntegerOrInfinity)(_[0]);if(d===1/0)return!1;d<0&&(d+=s,d<0&&(d=0));const T=(0,m.NumberIsNaN)(E);for(let L=d;L<s;++L){const C=(0,f.convertToNumber)(i[L]);if(T&&(0,m.NumberIsNaN)(C)||C===E)return!0}return!1}join(E){F(this);const _=O(this),i=p(_);return(0,m.ArrayPrototypeJoin)(i,E)}toLocaleString(...E){F(this);const _=O(this),i=p(_);return(0,m.ArrayPrototypeToLocaleString)(i,...(0,l.safeIfNeeded)(E))}get[m.SymbolToStringTag](){if(H(this))return"Float16Array"}}t.Float16Array=P,(0,m.ObjectDefineProperty)(P,"BYTES_PER_ELEMENT",{value:M}),(0,m.ObjectDefineProperty)(P,b.brand,{}),(0,m.ReflectSetPrototypeOf)(P,m.TypedArray);const U=P.prototype;(0,m.ObjectDefineProperty)(U,"BYTES_PER_ELEMENT",{value:M}),(0,m.ObjectDefineProperty)(U,m.SymbolIterator,{value:U.values,writable:!0,configurable:!0}),(0,m.ReflectSetPrototypeOf)(U,m.TypedArrayPrototype)},802:(R,t,h)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.safeIfNeeded=y,t.wrap=X;var l=h(983);const b=new l.NativeWeakMap,f=(0,l.ObjectCreate)(null,{next:{value:function(){const V=(0,l.WeakMapPrototypeGet)(b,this);return(0,l.ArrayIteratorPrototypeNext)(V)}},[l.SymbolIterator]:{value:function(){return this}}});function y(M){if(M[l.SymbolIterator]===l.NativeArrayPrototypeSymbolIterator)return M;const V=(0,l.ObjectCreate)(f);return(0,l.WeakMapPrototypeSet)(b,V,(0,l.ArrayPrototypeSymbolIterator)(M)),V}const G=new l.NativeWeakMap,m=(0,l.ObjectCreate)(l.IteratorPrototype,{next:{value:function(){const V=(0,l.WeakMapPrototypeGet)(G,this);return(0,l.GeneratorPrototypeNext)(V)},writable:!0,configurable:!0}});for(const M of(0,l.ReflectOwnKeys)(l.ArrayIteratorPrototype))M!=="next"&&(0,l.ObjectDefineProperty)(m,M,(0,l.ReflectGetOwnPropertyDescriptor)(l.ArrayIteratorPrototype,M));function X(M){const V=(0,l.ObjectCreate)(m);return(0,l.WeakMapPrototypeSet)(G,V,M),V}},299:(R,t,h)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.hasFloat16ArrayBrand=G;var l=h(554),b=h(930),f=h(983);const y=(0,f.SymbolFor)("__Float16Array__");t.brand=y;function G(m){if(!(0,l.isObjectLike)(m))return!1;const X=(0,f.ReflectGetPrototypeOf)(m);if(!(0,l.isObjectLike)(X))return!1;const M=X.constructor;if(M===void 0)return!1;if(!(0,l.isObject)(M))throw(0,f.NativeTypeError)(b.THE_CONSTRUCTOR_PROPERTY_VALUE_IS_NOT_AN_OBJECT);return(0,f.ReflectHas)(M,y)}},605:(R,t,h)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.convertToNumber=F,t.roundToFloat16Bits=X;var l=h(983);const b=new l.NativeArrayBuffer(4),f=new l.NativeFloat32Array(b),y=new l.NativeUint32Array(b),G=new l.NativeUint32Array(512),m=new l.NativeUint32Array(512);for(let N=0;N<256;++N){const O=N-127;O<-27?(G[N]=0,G[N|256]=32768,m[N]=24,m[N|256]=24):O<-14?(G[N]=1024>>-O-14,G[N|256]=1024>>-O-14|32768,m[N]=-O-1,m[N|256]=-O-1):O<=15?(G[N]=O+15<<10,G[N|256]=O+15<<10|32768,m[N]=13,m[N|256]=13):O<128?(G[N]=31744,G[N|256]=64512,m[N]=24,m[N|256]=24):(G[N]=31744,G[N|256]=64512,m[N]=13,m[N|256]=13)}function X(N){f[0]=N;const O=y[0],p=O>>23&511;return G[p]+((O&8388607)>>m[p])}const M=new l.NativeUint32Array(2048),V=new l.NativeUint32Array(64),H=new l.NativeUint32Array(64);for(let N=1;N<1024;++N){let O=N<<13,p=0;for(;!(O&8388608);)O<<=1,p-=8388608;O&=-8388609,p+=947912704,M[N]=O|p}for(let N=1024;N<2048;++N)M[N]=939524096+(N-1024<<13);for(let N=1;N<31;++N)V[N]=N<<23;V[31]=1199570944,V[32]=2147483648;for(let N=33;N<63;++N)V[N]=2147483648+(N-32<<23);V[63]=3347054592;for(let N=1;N<64;++N)N!==32&&(H[N]=1024);function F(N){const O=N>>10;return y[0]=M[H[O]+(N&1023)]+V[O],f[0]}},554:(R,t,h)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isArrayBuffer=m,t.isCanonicalIntegerIndexString=H,t.isNativeBigIntTypedArray=G,t.isNativeTypedArray=y,t.isObject=b,t.isObjectLike=f,t.isOrdinaryArray=M,t.isOrdinaryNativeTypedArray=V,t.isSharedArrayBuffer=X;var l=h(983);function b(F){return F!==null&&typeof F=="object"||typeof F=="function"}function f(F){return F!==null&&typeof F=="object"}function y(F){return(0,l.TypedArrayPrototypeGetSymbolToStringTag)(F)!==void 0}function G(F){const N=(0,l.TypedArrayPrototypeGetSymbolToStringTag)(F);return N==="BigInt64Array"||N==="BigUint64Array"}function m(F){try{return(0,l.ArrayBufferPrototypeGetByteLength)(F),!0}catch{return!1}}function X(F){if(l.NativeSharedArrayBuffer===null)return!1;try{return(0,l.SharedArrayBufferPrototypeGetByteLength)(F),!0}catch{return!1}}function M(F){return(0,l.ArrayIsArray)(F)?F[l.SymbolIterator]===l.NativeArrayPrototypeSymbolIterator?!0:F[l.SymbolIterator]()[l.SymbolToStringTag]==="Array Iterator":!1}function V(F){return y(F)?F[l.SymbolIterator]===l.NativeTypedArrayPrototypeSymbolIterator?!0:F[l.SymbolIterator]()[l.SymbolToStringTag]==="Array Iterator":!1}function H(F){if(typeof F!="string")return!1;const N=+F;return F!==N+""||!(0,l.NumberIsFinite)(N)?!1:N===(0,l.MathTrunc)(N)}},930:(R,t)=>{Object.defineProperty(t,"__esModule",{value:!0});const h="This is not an object";t.THIS_IS_NOT_AN_OBJECT=h;const l="This is not a Float16Array object";t.THIS_IS_NOT_A_FLOAT16ARRAY_OBJECT=l;const b="This constructor is not a subclass of Float16Array";t.THIS_CONSTRUCTOR_IS_NOT_A_SUBCLASS_OF_FLOAT16ARRAY=b;const f="The constructor property value is not an object";t.THE_CONSTRUCTOR_PROPERTY_VALUE_IS_NOT_AN_OBJECT=f;const y="Species constructor didn't return TypedArray object";t.SPECIES_CONSTRUCTOR_DIDNT_RETURN_TYPEDARRAY_OBJECT=y;const G="Derived constructor created TypedArray object which was too small length";t.DERIVED_CONSTRUCTOR_CREATED_TYPEDARRAY_OBJECT_WHICH_WAS_TOO_SMALL_LENGTH=G;const m="Attempting to access detached ArrayBuffer";t.ATTEMPTING_TO_ACCESS_DETACHED_ARRAYBUFFER=m;const X="Cannot convert undefined or null to object";t.CANNOT_CONVERT_UNDEFINED_OR_NULL_TO_OBJECT=X;const M="Cannot mix BigInt and other types, use explicit conversions";t.CANNOT_MIX_BIGINT_AND_OTHER_TYPES=M;const V="@@iterator property is not callable";t.ITERATOR_PROPERTY_IS_NOT_CALLABLE=V;const H="Reduce of empty array with no initial value";t.REDUCE_OF_EMPTY_ARRAY_WITH_NO_INITIAL_VALUE=H;const F="Offset is out of bounds";t.OFFSET_IS_OUT_OF_BOUNDS=F},983:(R,t,h)=>{Object.defineProperty(t,"__esModule",{value:!0});var l=h(930);function b(Me){return(Et,...gt)=>y(Me,Et,gt)}function f(Me,Et){return b(M(Me,Et).get)}const{apply:y,construct:G,defineProperty:m,get:X,getOwnPropertyDescriptor:M,getPrototypeOf:V,has:H,ownKeys:F,set:N,setPrototypeOf:O}=Reflect;t.ReflectSetPrototypeOf=O,t.ReflectSet=N,t.ReflectOwnKeys=F,t.ReflectHas=H,t.ReflectGetPrototypeOf=V,t.ReflectGetOwnPropertyDescriptor=M,t.ReflectGet=X,t.ReflectDefineProperty=m,t.ReflectConstruct=G,t.ReflectApply=y;const p=Proxy;t.NativeProxy=p;const{MAX_SAFE_INTEGER:A,isFinite:I,isNaN:P}=Number;t.NumberIsNaN=P,t.NumberIsFinite=I,t.MAX_SAFE_INTEGER=A;const{iterator:U,species:c,toStringTag:E,for:_}=Symbol;t.SymbolFor=_,t.SymbolToStringTag=E,t.SymbolSpecies=c,t.SymbolIterator=U;const i=Object;t.NativeObject=i;const{create:s,defineProperty:d,freeze:T,is:L}=i;t.ObjectIs=L,t.ObjectFreeze=T,t.ObjectDefineProperty=d,t.ObjectCreate=s;const C=i.prototype,Y=C.__lookupGetter__?b(C.__lookupGetter__):(Me,Et)=>{if(Me==null)throw On(l.CANNOT_CONVERT_UNDEFINED_OR_NULL_TO_OBJECT);let gt=i(Me);do{const Tr=M(gt,Et);if(Tr!==void 0)return v(Tr,"get")?Tr.get:void 0}while((gt=V(gt))!==null)};t.ObjectPrototype__lookupGetter__=Y;const v=i.hasOwn||b(C.hasOwnProperty);t.ObjectHasOwn=v;const S=Array,w=S.isArray;t.ArrayIsArray=w;const k=S.prototype,q=b(k.join);t.ArrayPrototypeJoin=q;const W=b(k.push);t.ArrayPrototypePush=W;const j=b(k.toLocaleString);t.ArrayPrototypeToLocaleString=j;const $=k[U];t.NativeArrayPrototypeSymbolIterator=$;const ne=b($);t.ArrayPrototypeSymbolIterator=ne;const J=Math.trunc;t.MathTrunc=J;const ie=ArrayBuffer;t.NativeArrayBuffer=ie;const x=ie.isView;t.ArrayBufferIsView=x;const K=ie.prototype,Z=b(K.slice);t.ArrayBufferPrototypeSlice=Z;const D=f(K,"byteLength");t.ArrayBufferPrototypeGetByteLength=D;const B=typeof SharedArrayBuffer<"u"?SharedArrayBuffer:null;t.NativeSharedArrayBuffer=B;const z=B&&f(B.prototype,"byteLength");t.SharedArrayBufferPrototypeGetByteLength=z;const Q=V(Uint8Array);t.TypedArray=Q;const re=Q.from,te=Q.prototype;t.TypedArrayPrototype=te;const ee=te[U];t.NativeTypedArrayPrototypeSymbolIterator=ee;const ae=b(te.keys);t.TypedArrayPrototypeKeys=ae;const fe=b(te.values);t.TypedArrayPrototypeValues=fe;const _e=b(te.entries);t.TypedArrayPrototypeEntries=_e;const de=b(te.set);t.TypedArrayPrototypeSet=de;const me=b(te.reverse);t.TypedArrayPrototypeReverse=me;const pe=b(te.fill);t.TypedArrayPrototypeFill=pe;const ve=b(te.copyWithin);t.TypedArrayPrototypeCopyWithin=ve;const Fe=b(te.sort);t.TypedArrayPrototypeSort=Fe;const ye=b(te.slice);t.TypedArrayPrototypeSlice=ye;const Ie=b(te.subarray);t.TypedArrayPrototypeSubarray=Ie;const Ke=f(te,"buffer");t.TypedArrayPrototypeGetBuffer=Ke;const Bt=f(te,"byteOffset");t.TypedArrayPrototypeGetByteOffset=Bt;const dr=f(te,"length");t.TypedArrayPrototypeGetLength=dr;const Er=f(te,E);t.TypedArrayPrototypeGetSymbolToStringTag=Er;const Gt=Uint16Array;t.NativeUint16Array=Gt;const $e=(...Me)=>y(re,Gt,Me);t.Uint16ArrayFrom=$e;const _t=Uint32Array;t.NativeUint32Array=_t;const gr=Float32Array;t.NativeFloat32Array=gr;const dt=V([][U]());t.ArrayIteratorPrototype=dt;const mr=b(dt.next);t.ArrayIteratorPrototypeNext=mr;const Oa=b(function*(){}().next);t.GeneratorPrototypeNext=Oa;const ba=V(dt);t.IteratorPrototype=ba;const Nn=DataView.prototype,Fa=b(Nn.getUint16);t.DataViewPrototypeGetUint16=Fa;const La=b(Nn.setUint16);t.DataViewPrototypeSetUint16=La;const On=TypeError;t.NativeTypeError=On;const Ca=RangeError;t.NativeRangeError=Ca;const bn=WeakSet;t.NativeWeakSet=bn;const Fn=bn.prototype,xa=b(Fn.add);t.WeakSetPrototypeAdd=xa;const Ua=b(Fn.has);t.WeakSetPrototypeHas=Ua;const Ln=WeakMap;t.NativeWeakMap=Ln;const pr=Ln.prototype,Da=b(pr.get);t.WeakMapPrototypeGet=Da;const wa=b(pr.has);t.WeakMapPrototypeHas=wa;const Ma=b(pr.set);t.WeakMapPrototypeSet=Ma},700:(R,t,h)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.IsDetachedBuffer=X,t.SpeciesConstructor=m,t.ToIntegerOrInfinity=y,t.ToLength=G,t.defaultCompare=M;var l=h(554),b=h(930),f=h(983);function y(V){const H=+V;return(0,f.NumberIsNaN)(H)||H===0?0:(0,f.MathTrunc)(H)}function G(V){const H=y(V);return H<0?0:H<f.MAX_SAFE_INTEGER?H:f.MAX_SAFE_INTEGER}function m(V,H){if(!(0,l.isObject)(V))throw(0,f.NativeTypeError)(b.THIS_IS_NOT_AN_OBJECT);const F=V.constructor;if(F===void 0)return H;if(!(0,l.isObject)(F))throw(0,f.NativeTypeError)(b.THE_CONSTRUCTOR_PROPERTY_VALUE_IS_NOT_AN_OBJECT);const N=F[f.SymbolSpecies];return N??H}function X(V){if((0,l.isSharedArrayBuffer)(V))return!1;try{return(0,f.ArrayBufferPrototypeSlice)(V,0,0),!1}catch{}return!0}function M(V,H){const F=(0,f.NumberIsNaN)(V),N=(0,f.NumberIsNaN)(H);if(F&&N)return 0;if(F)return 1;if(N||V<H)return-1;if(V>H)return 1;if(V===0&&H===0){const O=(0,f.ObjectIs)(V,0),p=(0,f.ObjectIs)(H,0);if(!O&&p)return-1;if(O&&!p)return 1}return 0}},216:(R,t,h)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.hfround=f;var l=h(605),b=h(983);function f(y){const G=+y;if(!(0,b.NumberIsFinite)(G)||G===0)return G;const m=(0,l.roundToFloat16Bits)(G);return(0,l.convertToNumber)(m)}},650:(R,t,h)=>{Object.defineProperty(t,"__esModule",{value:!0});var l=h(310);t.Float16Array=l.Float16Array,t.isFloat16Array=l.isFloat16Array;var b=h(146);t.isTypedArray=b.isTypedArray;var f=h(557);t.getFloat16=f.getFloat16,t.setFloat16=f.setFloat16;var y=h(216);t.hfround=y.hfround},146:(R,t,h)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isTypedArray=f;var l=h(310),b=h(554);function f(y){return(0,b.isNativeTypedArray)(y)||(0,l.isFloat16Array)(y)}}},a={};function u(R){var t=a[R];if(t!==void 0)return t.exports;var h=a[R]={exports:{}};return n[R].call(h.exports,h,h.exports,u),h.exports}u.g=function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch{if(typeof window=="object")return window}}();var g=u(607);return g})())})(yu);const Pe=(r,e=he())=>({texture:r,bind(n){return e.state.textures[n],e.gl.activeTexture(e.gl.TEXTURE0+n),e.gl.bindTexture(e.gl.TEXTURE_2D,this.texture),e.state.textures[n]=this,this}}),ur=(r,{type:e=ge.FLOAT,numComponents:n=1,dimensions:a=1}={})=>{const u=ft(),g=new ge.GPULayer(u,{name:`current_${r}`,type:e,dimensions:a,numComponents:n,numBuffers:2}),R=new ge.GPULayer(u,{name:`target_${r}`,type:e,dimensions:a,numComponents:n});return{current:g,target:R}},Ve=le.infinite(()=>ur("position",{numComponents:3})),Re=le.infinite(()=>ur("color",{numComponents:4})),Ue=le.infinite(()=>ur("size",{numComponents:1})),De=le.infinite(()=>ur("emphasis",{numComponents:1})),Su=r=>{[Ve(),Re(),Ue(),De()].forEach(({current:n,target:a})=>{n.resize(r),a.resize(r)})},Iu=le.infinite(()=>new ge.GPUProgram(ft(),{name:"interpolation",fragmentShader:`
      in vec2 v_uv;

      // the current and target textures
      uniform sampler2D uTargetPositions;
      uniform sampler2D uCurrentPositions;
      uniform sampler2D uTargetColors;
      uniform sampler2D uCurrentColors;
      uniform sampler2D uTargetSizes;
      uniform sampler2D uCurrentSizes;
      uniform sampler2D uTargetEmphasis;
      uniform sampler2D uCurrentEmphasis;

      // the interpolation ratio
      uniform float uMixRatio;

      
      layout (location = 0) out vec3 outPositions;
      layout (location = 1) out vec4 outColors;
      layout (location = 2) out float outSizes;
      layout (location = 3) out float outEmphasis;

      void main() {
        vec3 targetPosition = texture(uTargetPositions, v_uv).xyz;
        vec3 currentPosition = texture(uCurrentPositions, v_uv).xyz;
        outPositions = mix(currentPosition, targetPosition, uMixRatio);

        vec4 targetColor = texture(uTargetColors, v_uv);
        vec4 currentColor = texture(uCurrentColors, v_uv);
        outColors = mix(currentColor, targetColor, uMixRatio);

        float targetSize = texture(uTargetSizes, v_uv).r;
        float currentSize = texture(uCurrentSizes, v_uv).r;
        outSizes = mix(currentSize, targetSize, uMixRatio);

        float targetEmphasis = texture(uTargetEmphasis, v_uv).r;
        float currentEmphasis = texture(uCurrentEmphasis, v_uv).r;
        outEmphasis = mix(currentEmphasis, targetEmphasis, uMixRatio);
      }
    `,uniforms:[{name:"uTargetPositions",type:ge.INT,value:0},{name:"uCurrentPositions",type:ge.INT,value:1},{name:"uTargetColors",type:ge.INT,value:2},{name:"uCurrentColors",type:ge.INT,value:3},{name:"uTargetSizes",type:ge.INT,value:4},{name:"uCurrentSizes",type:ge.INT,value:5},{name:"uTargetEmphasis",type:ge.INT,value:6},{name:"uCurrentEmphasis",type:ge.INT,value:7},{name:"uMixRatio",type:ge.FLOAT,value:.5}]})),Pu=new Ru({saturation:.7,lightness:.6}),Nu=async()=>{const r="https://dat-ecosystem.org/dat-garden-rake/",e=await fetch(`${r}index.json`).then(R=>R.json()),n=`${r}${e.latest}`,[a,u,g]=await Promise.all([fetch(n+"/../valuenetwork.json").then(R=>R.json()),fetch(n+"/../projects.json").then(R=>R.json()),fetch(n+"/../organizations.json").then(R=>R.json())]);return{valueNetworkData:a,projectsData:u,organizationsData:g}},Qi=le.promise(Nu),ea=or(new Tu),ta=or(new Au),Ou=r=>Math.max(4*Math.log(2*(r?.length||1)**1.2),2),bu=r=>r.replace(/^(https?:\/\/)?(www\.)?([a-z0-9-]+\.)+[a-z0-9-]+/i,"").replace(/\/$/,"").replace(/^\//,"").replace(/[^A-Za-z0-9\.]/gi,"-").replace(/-+/g,"-").replace(/^package-/,"").replace(/-v-/,"-"),je=le.promise(async()=>{const{valueNetworkData:r,projectsData:e,organizationsData:n}=await Qi(),a=Object.entries(r).map(([l,{dependents:b,owner:f,dependencies:y}],G)=>({index:G,project:l,id:l,data:e[l],navId:bu(l),owner:f,ownerData:n[f],color:[...Pu.rgb(f||l||String(G)).map(m=>m/255),1],size:Ou(b),dependents:b,dependencies:y}));Ze(a.map(l=>[l.index,l]));const u=Ze(a.map(l=>[l.project,l])),g=Ze(a.map(l=>[l.data.name,l])),R=Ze(a.map(l=>[l.navId,l]));let t=Object.entries(r).flatMap(([l,{dependents:b,dependencies:f}])=>(b||[]).map(y=>({source:y,sourceNode:u[y],sourceIndex:a.find(G=>G.project===y).index,target:l,targetNode:u[l],targetIndex:a.find(G=>G.project===l).index})).concat((f||[]).map(y=>({source:l,sourceNode:u[l],sourceIndex:a.find(G=>G.project===l).index,target:y,targetNode:u[y],targetIndex:a.find(G=>G.project===y).index})))).filter(l=>l);t=Pc(t,(l,b)=>l.sourceIndex===b.sourceIndex&&l.targetIndex===b.targetIndex);const h=t.map(({sourceIndex:l,targetIndex:b})=>[l,b]);return Ze(h.map(([l,b],f)=>[`${l}-${b}`,f])),Ze(h.map(([l,b],f)=>[`${l}-${b}`,t[f]])),{nodes:a,links:t,linkIndexPairs:h,nodesByNavId:R,nodesByProject:u,nodesByProjectName:g}}),Fu=async()=>{const r=await Qi();return await ea.buildGraph(r)},Lu=async(r,e=ta.useD3ForceSimulator)=>await e(r,Ot(n=>{Mt()?.targetData(n),Ve().target.setFromArray(n)})),ra=r=>{const e=Mt().mostRecentData,n=r.index;return[e[n*3],e[n*3+1],e[n*3+2]]},Cu=async r=>await Lu(r||await prepareVisualizerData(),ta.useD3ForceSimulator),{doQuery:Jn,buildGraph:wl}=ea;function xu(){return new Worker("/dat-garden-visualization/assets/animation-worker-193e3d63.js",{type:"module"})}var Cr;const nr=window,at=nr.trustedTypes,Qn=at?at.createPolicy("lit-html",{createHTML:r=>r}):void 0,Jr="$lit$",Ge=`lit$${(Math.random()+"").slice(9)}$`,na="?"+Ge,Uu=`<${na}>`,ot=document,Ft=()=>ot.createComment(""),Lt=r=>r===null||typeof r!="object"&&typeof r!="function",ia=Array.isArray,Du=r=>ia(r)||typeof r?.[Symbol.iterator]=="function",xr=`[ 	
\f\r]`,Tt=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,ei=/-->/g,ti=/>/g,We=RegExp(`>|${xr}(?:([^\\s"'>=/]+)(${xr}*=${xr}*(?:[^ 	
\f\r"'\`<>=]|("|')|))|$)`,"g"),ri=/'/g,ni=/"/g,aa=/^(?:script|style|textarea|title)$/i,wu=r=>(e,...n)=>({_$litType$:r,strings:e,values:n}),Ce=wu(1),Ct=Symbol.for("lit-noChange"),Ae=Symbol.for("lit-nothing"),ii=new WeakMap,tt=ot.createTreeWalker(ot,129,null,!1),Mu=(r,e)=>{const n=r.length-1,a=[];let u,g=e===2?"<svg>":"",R=Tt;for(let h=0;h<n;h++){const l=r[h];let b,f,y=-1,G=0;for(;G<l.length&&(R.lastIndex=G,f=R.exec(l),f!==null);)G=R.lastIndex,R===Tt?f[1]==="!--"?R=ei:f[1]!==void 0?R=ti:f[2]!==void 0?(aa.test(f[2])&&(u=RegExp("</"+f[2],"g")),R=We):f[3]!==void 0&&(R=We):R===We?f[0]===">"?(R=u??Tt,y=-1):f[1]===void 0?y=-2:(y=R.lastIndex-f[2].length,b=f[1],R=f[3]===void 0?We:f[3]==='"'?ni:ri):R===ni||R===ri?R=We:R===ei||R===ti?R=Tt:(R=We,u=void 0);const m=R===We&&r[h+1].startsWith("/>")?" ":"";g+=R===Tt?l+Uu:y>=0?(a.push(b),l.slice(0,y)+Jr+l.slice(y)+Ge+m):l+Ge+(y===-2?(a.push(void 0),h):m)}const t=g+(r[n]||"<?>")+(e===2?"</svg>":"");if(!Array.isArray(r)||!r.hasOwnProperty("raw"))throw Error("invalid template strings array");return[Qn!==void 0?Qn.createHTML(t):t,a]};class xt{constructor({strings:e,_$litType$:n},a){let u;this.parts=[];let g=0,R=0;const t=e.length-1,h=this.parts,[l,b]=Mu(e,n);if(this.el=xt.createElement(l,a),tt.currentNode=this.el.content,n===2){const f=this.el.content,y=f.firstChild;y.remove(),f.append(...y.childNodes)}for(;(u=tt.nextNode())!==null&&h.length<t;){if(u.nodeType===1){if(u.hasAttributes()){const f=[];for(const y of u.getAttributeNames())if(y.endsWith(Jr)||y.startsWith(Ge)){const G=b[R++];if(f.push(y),G!==void 0){const m=u.getAttribute(G.toLowerCase()+Jr).split(Ge),X=/([.?@])?(.*)/.exec(G);h.push({type:1,index:g,name:X[2],strings:m,ctor:X[1]==="."?Gu:X[1]==="?"?Hu:X[1]==="@"?ku:lr})}else h.push({type:6,index:g})}for(const y of f)u.removeAttribute(y)}if(aa.test(u.tagName)){const f=u.textContent.split(Ge),y=f.length-1;if(y>0){u.textContent=at?at.emptyScript:"";for(let G=0;G<y;G++)u.append(f[G],Ft()),tt.nextNode(),h.push({type:2,index:++g});u.append(f[y],Ft())}}}else if(u.nodeType===8)if(u.data===na)h.push({type:2,index:g});else{let f=-1;for(;(f=u.data.indexOf(Ge,f+1))!==-1;)h.push({type:7,index:g}),f+=Ge.length-1}g++}}static createElement(e,n){const a=ot.createElement("template");return a.innerHTML=e,a}}function st(r,e,n=r,a){var u,g,R,t;if(e===Ct)return e;let h=a!==void 0?(u=n._$Co)===null||u===void 0?void 0:u[a]:n._$Cl;const l=Lt(e)?void 0:e._$litDirective$;return h?.constructor!==l&&((g=h?._$AO)===null||g===void 0||g.call(h,!1),l===void 0?h=void 0:(h=new l(r),h._$AT(r,n,a)),a!==void 0?((R=(t=n)._$Co)!==null&&R!==void 0?R:t._$Co=[])[a]=h:n._$Cl=h),h!==void 0&&(e=st(r,h._$AS(r,e.values),h,a)),e}let Bu=class{constructor(e,n){this._$AV=[],this._$AN=void 0,this._$AD=e,this._$AM=n}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(e){var n;const{el:{content:a},parts:u}=this._$AD,g=((n=e?.creationScope)!==null&&n!==void 0?n:ot).importNode(a,!0);tt.currentNode=g;let R=tt.nextNode(),t=0,h=0,l=u[0];for(;l!==void 0;){if(t===l.index){let b;l.type===2?b=new An(R,R.nextSibling,this,e):l.type===1?b=new l.ctor(R,l.name,l.strings,this,e):l.type===6&&(b=new Xu(R,this,e)),this._$AV.push(b),l=u[++h]}t!==l?.index&&(R=tt.nextNode(),t++)}return g}v(e){let n=0;for(const a of this._$AV)a!==void 0&&(a.strings!==void 0?(a._$AI(e,a,n),n+=a.strings.length-2):a._$AI(e[n])),n++}},An=class oa{constructor(e,n,a,u){var g;this.type=2,this._$AH=Ae,this._$AN=void 0,this._$AA=e,this._$AB=n,this._$AM=a,this.options=u,this._$Cp=(g=u?.isConnected)===null||g===void 0||g}get _$AU(){var e,n;return(n=(e=this._$AM)===null||e===void 0?void 0:e._$AU)!==null&&n!==void 0?n:this._$Cp}get parentNode(){let e=this._$AA.parentNode;const n=this._$AM;return n!==void 0&&e?.nodeType===11&&(e=n.parentNode),e}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(e,n=this){e=st(this,e,n),Lt(e)?e===Ae||e==null||e===""?(this._$AH!==Ae&&this._$AR(),this._$AH=Ae):e!==this._$AH&&e!==Ct&&this._(e):e._$litType$!==void 0?this.g(e):e.nodeType!==void 0?this.$(e):Du(e)?this.T(e):this._(e)}k(e){return this._$AA.parentNode.insertBefore(e,this._$AB)}$(e){this._$AH!==e&&(this._$AR(),this._$AH=this.k(e))}_(e){this._$AH!==Ae&&Lt(this._$AH)?this._$AA.nextSibling.data=e:this.$(ot.createTextNode(e)),this._$AH=e}g(e){var n;const{values:a,_$litType$:u}=e,g=typeof u=="number"?this._$AC(e):(u.el===void 0&&(u.el=xt.createElement(u.h,this.options)),u);if(((n=this._$AH)===null||n===void 0?void 0:n._$AD)===g)this._$AH.v(a);else{const R=new Bu(g,this),t=R.u(this.options);R.v(a),this.$(t),this._$AH=R}}_$AC(e){let n=ii.get(e.strings);return n===void 0&&ii.set(e.strings,n=new xt(e)),n}T(e){ia(this._$AH)||(this._$AH=[],this._$AR());const n=this._$AH;let a,u=0;for(const g of e)u===n.length?n.push(a=new oa(this.k(Ft()),this.k(Ft()),this,this.options)):a=n[u],a._$AI(g),u++;u<n.length&&(this._$AR(a&&a._$AB.nextSibling,u),n.length=u)}_$AR(e=this._$AA.nextSibling,n){var a;for((a=this._$AP)===null||a===void 0||a.call(this,!1,!0,n);e&&e!==this._$AB;){const u=e.nextSibling;e.remove(),e=u}}setConnected(e){var n;this._$AM===void 0&&(this._$Cp=e,(n=this._$AP)===null||n===void 0||n.call(this,e))}};class lr{constructor(e,n,a,u,g){this.type=1,this._$AH=Ae,this._$AN=void 0,this.element=e,this.name=n,this._$AM=u,this.options=g,a.length>2||a[0]!==""||a[1]!==""?(this._$AH=Array(a.length-1).fill(new String),this.strings=a):this._$AH=Ae}get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}_$AI(e,n=this,a,u){const g=this.strings;let R=!1;if(g===void 0)e=st(this,e,n,0),R=!Lt(e)||e!==this._$AH&&e!==Ct,R&&(this._$AH=e);else{const t=e;let h,l;for(e=g[0],h=0;h<g.length-1;h++)l=st(this,t[a+h],n,h),l===Ct&&(l=this._$AH[h]),R||(R=!Lt(l)||l!==this._$AH[h]),l===Ae?e=Ae:e!==Ae&&(e+=(l??"")+g[h+1]),this._$AH[h]=l}R&&!u&&this.j(e)}j(e){e===Ae?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,e??"")}}let Gu=class extends lr{constructor(){super(...arguments),this.type=3}j(e){this.element[this.name]=e===Ae?void 0:e}};const Vu=at?at.emptyScript:"";let Hu=class extends lr{constructor(){super(...arguments),this.type=4}j(e){e&&e!==Ae?this.element.setAttribute(this.name,Vu):this.element.removeAttribute(this.name)}},ku=class extends lr{constructor(e,n,a,u,g){super(e,n,a,u,g),this.type=5}_$AI(e,n=this){var a;if((e=(a=st(this,e,n,0))!==null&&a!==void 0?a:Ae)===Ct)return;const u=this._$AH,g=e===Ae&&u!==Ae||e.capture!==u.capture||e.once!==u.once||e.passive!==u.passive,R=e!==Ae&&(u===Ae||g);g&&this.element.removeEventListener(this.name,this,u),R&&this.element.addEventListener(this.name,this,e),this._$AH=e}handleEvent(e){var n,a;typeof this._$AH=="function"?this._$AH.call((a=(n=this.options)===null||n===void 0?void 0:n.host)!==null&&a!==void 0?a:this.element,e):this._$AH.handleEvent(e)}};class Xu{constructor(e,n,a){this.element=e,this.type=6,this._$AN=void 0,this._$AM=n,this.options=a}get _$AU(){return this._$AM._$AU}_$AI(e){st(this,e)}}const ai=nr.litHtmlPolyfillSupport;ai?.(xt,An),((Cr=nr.litHtmlVersions)!==null&&Cr!==void 0?Cr:nr.litHtmlVersions=[]).push("2.7.1");const Qr=(r,e,n)=>{var a,u;const g=(a=n?.renderBefore)!==null&&a!==void 0?a:e;let R=g._$litPart$;if(R===void 0){const t=(u=n?.renderBefore)!==null&&u!==void 0?u:null;g._$litPart$=R=new An(e.insertBefore(Ft(),t),t,void 0,n??{})}return R._$AI(r),R},Wu=r=>`
  PREFIX dependson: <http://dat-ecosystem.org#dependson>
  SELECT DISTINCT ?dependent WHERE {
    ?dependent dependson: <${r}> .
  }`,Yu=r=>`
  PREFIX dependson: <http://dat-ecosystem.org#dependson>
  SELECT DISTINCT ?dependency WHERE {
    <${r}> dependson: ?dependency .
  }`;var en;function kt(r,e,n){return Math.min(Math.max(r||0,e),n)}function Ur(r){return{r:kt(r.r,0,255),g:kt(r.g,0,255),b:kt(r.b,0,255),a:kt(r.a,0,1)}}function tn(r){return{r:255*r.r,g:255*r.g,b:255*r.b,a:r.a}}function rn(r){return{r:r.r/255,g:r.g/255,b:r.b/255,a:r.a}}function oi(r,e){e===void 0&&(e=0);var n=Math.pow(10,e);return{r:Math.round(r.r*n)/n,g:Math.round(r.g*n)/n,b:Math.round(r.b*n)/n,a:r.a}}function Dr(r,e,n,a,u,g){return(1-e/n)*a+e/n*Math.round((1-r)*u+r*g)}function zu(r,e,n,a,u){u===void 0&&(u={unitInput:!1,unitOutput:!1,roundOutput:!0}),u.unitInput&&(r=tn(r),e=tn(e)),r=Ur(r);var g=(e=Ur(e)).a+r.a-e.a*r.a,R=n(r,e,a),t=Ur({r:Dr(r.a,e.a,g,r.r,e.r,R.r),g:Dr(r.a,e.a,g,r.g,e.g,R.g),b:Dr(r.a,e.a,g,r.b,e.b,R.b),a:g});return u.unitOutput?rn(t):u.roundOutput?oi(t):oi(t,9)}function ju(r,e,n){return tn(n(rn(r),rn(e)))}function nn(r){return .3*r.r+.59*r.g+.11*r.b}function Ku(r,e){var n=e-nn(r);return function(a){var u=nn(a),g=a.r,R=a.g,t=a.b,h=Math.min(g,R,t),l=Math.max(g,R,t);function b(y){return u+(y-u)*u/(u-h)}function f(y){return u+(y-u)*(1-u)/(l-u)}return h<0&&(g=b(g),R=b(R),t=b(t)),l>1&&(g=f(g),R=f(R),t=f(t)),{r:g,g:R,b:t}}({r:r.r+n,g:r.g+n,b:r.b+n})}function $u(r){return Math.max(r.r,r.g,r.b)-Math.min(r.r,r.g,r.b)}function qu(r,e){var n=["r","g","b"].sort(function(t,h){return r[t]-r[h]}),a=n[0],u=n[1],g=n[2],R={r:r.r,g:r.g,b:r.b};return R[g]>R[a]?(R[u]=(R[u]-R[a])*e/(R[g]-R[a]),R[g]=e):R[u]=R[g]=0,R[a]=0,R}function Zu(r,e){return Ku(qu(e,$u(r)),nn(r))}en=function(r,e){return zu(r,e,ju,Zu,{unitInput:!0,unitOutput:!0})};var Ju={grad:.9,turn:360,rad:360/(2*Math.PI)},Le=function(r){return typeof r=="string"?r.length>0:typeof r=="number"},Te=function(r,e,n){return e===void 0&&(e=0),n===void 0&&(n=Math.pow(10,e)),Math.round(n*r)/n+0},Oe=function(r,e,n){return e===void 0&&(e=0),n===void 0&&(n=1),r>n?n:r>e?r:e},sa=function(r){return(r=isFinite(r)?r%360:0)>0?r:r+360},si=function(r){return{r:Oe(r.r,0,255),g:Oe(r.g,0,255),b:Oe(r.b,0,255),a:Oe(r.a)}},wr=function(r){return{r:Te(r.r),g:Te(r.g),b:Te(r.b),a:Te(r.a,3)}},Qu=/^#([0-9a-f]{3,8})$/i,Xt=function(r){var e=r.toString(16);return e.length<2?"0"+e:e},ca=function(r){var e=r.r,n=r.g,a=r.b,u=r.a,g=Math.max(e,n,a),R=g-Math.min(e,n,a),t=R?g===e?(n-a)/R:g===n?2+(a-e)/R:4+(e-n)/R:0;return{h:60*(t<0?t+6:t),s:g?R/g*100:0,v:g/255*100,a:u}},ua=function(r){var e=r.h,n=r.s,a=r.v,u=r.a;e=e/360*6,n/=100,a/=100;var g=Math.floor(e),R=a*(1-n),t=a*(1-(e-g)*n),h=a*(1-(1-e+g)*n),l=g%6;return{r:255*[a,t,R,R,h,a][l],g:255*[h,a,a,t,R,R][l],b:255*[R,R,h,a,a,t][l],a:u}},ci=function(r){return{h:sa(r.h),s:Oe(r.s,0,100),l:Oe(r.l,0,100),a:Oe(r.a)}},ui=function(r){return{h:Te(r.h),s:Te(r.s),l:Te(r.l),a:Te(r.a,3)}},li=function(r){return ua((n=(e=r).s,{h:e.h,s:(n*=((a=e.l)<50?a:100-a)/100)>0?2*n/(a+n)*100:0,v:a+n,a:e.a}));var e,n,a},Pt=function(r){return{h:(e=ca(r)).h,s:(u=(200-(n=e.s))*(a=e.v)/100)>0&&u<200?n*a/100/(u<=100?u:200-u)*100:0,l:u/2,a:e.a};var e,n,a,u},el=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s*,\s*([+-]?\d*\.?\d+)%\s*,\s*([+-]?\d*\.?\d+)%\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,tl=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s+([+-]?\d*\.?\d+)%\s+([+-]?\d*\.?\d+)%\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,rl=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,nl=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,an={string:[[function(r){var e=Qu.exec(r);return e?(r=e[1]).length<=4?{r:parseInt(r[0]+r[0],16),g:parseInt(r[1]+r[1],16),b:parseInt(r[2]+r[2],16),a:r.length===4?Te(parseInt(r[3]+r[3],16)/255,2):1}:r.length===6||r.length===8?{r:parseInt(r.substr(0,2),16),g:parseInt(r.substr(2,2),16),b:parseInt(r.substr(4,2),16),a:r.length===8?Te(parseInt(r.substr(6,2),16)/255,2):1}:null:null},"hex"],[function(r){var e=rl.exec(r)||nl.exec(r);return e?e[2]!==e[4]||e[4]!==e[6]?null:si({r:Number(e[1])/(e[2]?100/255:1),g:Number(e[3])/(e[4]?100/255:1),b:Number(e[5])/(e[6]?100/255:1),a:e[7]===void 0?1:Number(e[7])/(e[8]?100:1)}):null},"rgb"],[function(r){var e=el.exec(r)||tl.exec(r);if(!e)return null;var n,a,u=ci({h:(n=e[1],a=e[2],a===void 0&&(a="deg"),Number(n)*(Ju[a]||1)),s:Number(e[3]),l:Number(e[4]),a:e[5]===void 0?1:Number(e[5])/(e[6]?100:1)});return li(u)},"hsl"]],object:[[function(r){var e=r.r,n=r.g,a=r.b,u=r.a,g=u===void 0?1:u;return Le(e)&&Le(n)&&Le(a)?si({r:Number(e),g:Number(n),b:Number(a),a:Number(g)}):null},"rgb"],[function(r){var e=r.h,n=r.s,a=r.l,u=r.a,g=u===void 0?1:u;if(!Le(e)||!Le(n)||!Le(a))return null;var R=ci({h:Number(e),s:Number(n),l:Number(a),a:Number(g)});return li(R)},"hsl"],[function(r){var e=r.h,n=r.s,a=r.v,u=r.a,g=u===void 0?1:u;if(!Le(e)||!Le(n)||!Le(a))return null;var R=function(t){return{h:sa(t.h),s:Oe(t.s,0,100),v:Oe(t.v,0,100),a:Oe(t.a)}}({h:Number(e),s:Number(n),v:Number(a),a:Number(g)});return ua(R)},"hsv"]]},fi=function(r,e){for(var n=0;n<e.length;n++){var a=e[n][0](r);if(a)return[a,e[n][1]]}return[null,void 0]},il=function(r){return typeof r=="string"?fi(r.trim(),an.string):typeof r=="object"&&r!==null?fi(r,an.object):[null,void 0]},Mr=function(r,e){var n=Pt(r);return{h:n.h,s:Oe(n.s+100*e,0,100),l:n.l,a:n.a}},Br=function(r){return(299*r.r+587*r.g+114*r.b)/1e3/255},hi=function(r,e){var n=Pt(r);return{h:n.h,s:n.s,l:Oe(n.l+100*e,0,100),a:n.a}},on=function(){function r(e){this.parsed=il(e)[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return r.prototype.isValid=function(){return this.parsed!==null},r.prototype.brightness=function(){return Te(Br(this.rgba),2)},r.prototype.isDark=function(){return Br(this.rgba)<.5},r.prototype.isLight=function(){return Br(this.rgba)>=.5},r.prototype.toHex=function(){return e=wr(this.rgba),n=e.r,a=e.g,u=e.b,R=(g=e.a)<1?Xt(Te(255*g)):"","#"+Xt(n)+Xt(a)+Xt(u)+R;var e,n,a,u,g,R},r.prototype.toRgb=function(){return wr(this.rgba)},r.prototype.toRgbString=function(){return e=wr(this.rgba),n=e.r,a=e.g,u=e.b,(g=e.a)<1?"rgba("+n+", "+a+", "+u+", "+g+")":"rgb("+n+", "+a+", "+u+")";var e,n,a,u,g},r.prototype.toHsl=function(){return ui(Pt(this.rgba))},r.prototype.toHslString=function(){return e=ui(Pt(this.rgba)),n=e.h,a=e.s,u=e.l,(g=e.a)<1?"hsla("+n+", "+a+"%, "+u+"%, "+g+")":"hsl("+n+", "+a+"%, "+u+"%)";var e,n,a,u,g},r.prototype.toHsv=function(){return e=ca(this.rgba),{h:Te(e.h),s:Te(e.s),v:Te(e.v),a:Te(e.a,3)};var e},r.prototype.invert=function(){return be({r:255-(e=this.rgba).r,g:255-e.g,b:255-e.b,a:e.a});var e},r.prototype.saturate=function(e){return e===void 0&&(e=.1),be(Mr(this.rgba,e))},r.prototype.desaturate=function(e){return e===void 0&&(e=.1),be(Mr(this.rgba,-e))},r.prototype.grayscale=function(){return be(Mr(this.rgba,-1))},r.prototype.lighten=function(e){return e===void 0&&(e=.1),be(hi(this.rgba,e))},r.prototype.darken=function(e){return e===void 0&&(e=.1),be(hi(this.rgba,-e))},r.prototype.rotate=function(e){return e===void 0&&(e=15),this.hue(this.hue()+e)},r.prototype.alpha=function(e){return typeof e=="number"?be({r:(n=this.rgba).r,g:n.g,b:n.b,a:e}):Te(this.rgba.a,3);var n},r.prototype.hue=function(e){var n=Pt(this.rgba);return typeof e=="number"?be({h:e,s:n.s,l:n.l,a:n.a}):Te(n.h)},r.prototype.isEqual=function(e){return this.toHex()===be(e).toHex()},r}(),be=function(r){return r instanceof on?r:new on(r)},_i=[],al=function(r){r.forEach(function(e){_i.indexOf(e)<0&&(e(on,an),_i.push(e))})};function ol(r,e){var n={white:"#ffffff",bisque:"#ffe4c4",blue:"#0000ff",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",antiquewhite:"#faebd7",aqua:"#00ffff",azure:"#f0ffff",whitesmoke:"#f5f5f5",papayawhip:"#ffefd5",plum:"#dda0dd",blanchedalmond:"#ffebcd",black:"#000000",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",cornsilk:"#fff8dc",cornflowerblue:"#6495ed",burlywood:"#deb887",aquamarine:"#7fffd4",beige:"#f5f5dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkkhaki:"#bdb76b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",peachpuff:"#ffdab9",darkmagenta:"#8b008b",darkred:"#8b0000",darkorchid:"#9932cc",darkorange:"#ff8c00",darkslateblue:"#483d8b",gray:"#808080",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",deeppink:"#ff1493",deepskyblue:"#00bfff",wheat:"#f5deb3",firebrick:"#b22222",floralwhite:"#fffaf0",ghostwhite:"#f8f8ff",darkviolet:"#9400d3",magenta:"#ff00ff",green:"#008000",dodgerblue:"#1e90ff",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",blueviolet:"#8a2be2",forestgreen:"#228b22",lawngreen:"#7cfc00",indianred:"#cd5c5c",indigo:"#4b0082",fuchsia:"#ff00ff",brown:"#a52a2a",maroon:"#800000",mediumblue:"#0000cd",lightcoral:"#f08080",darkturquoise:"#00ced1",lightcyan:"#e0ffff",ivory:"#fffff0",lightyellow:"#ffffe0",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",linen:"#faf0e6",mediumaquamarine:"#66cdaa",lemonchiffon:"#fffacd",lime:"#00ff00",khaki:"#f0e68c",mediumseagreen:"#3cb371",limegreen:"#32cd32",mediumspringgreen:"#00fa9a",lightskyblue:"#87cefa",lightblue:"#add8e6",midnightblue:"#191970",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",mintcream:"#f5fffa",lightslategray:"#778899",lightslategrey:"#778899",navajowhite:"#ffdead",navy:"#000080",mediumvioletred:"#c71585",powderblue:"#b0e0e6",palegoldenrod:"#eee8aa",oldlace:"#fdf5e6",paleturquoise:"#afeeee",mediumturquoise:"#48d1cc",mediumorchid:"#ba55d3",rebeccapurple:"#663399",lightsteelblue:"#b0c4de",mediumslateblue:"#7b68ee",thistle:"#d8bfd8",tan:"#d2b48c",orchid:"#da70d6",mediumpurple:"#9370db",purple:"#800080",pink:"#ffc0cb",skyblue:"#87ceeb",springgreen:"#00ff7f",palegreen:"#98fb98",red:"#ff0000",yellow:"#ffff00",slateblue:"#6a5acd",lavenderblush:"#fff0f5",peru:"#cd853f",palevioletred:"#db7093",violet:"#ee82ee",teal:"#008080",slategray:"#708090",slategrey:"#708090",aliceblue:"#f0f8ff",darkseagreen:"#8fbc8f",darkolivegreen:"#556b2f",greenyellow:"#adff2f",seagreen:"#2e8b57",seashell:"#fff5ee",tomato:"#ff6347",silver:"#c0c0c0",sienna:"#a0522d",lavender:"#e6e6fa",lightgreen:"#90ee90",orange:"#ffa500",orangered:"#ff4500",steelblue:"#4682b4",royalblue:"#4169e1",turquoise:"#40e0d0",yellowgreen:"#9acd32",salmon:"#fa8072",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",darksalmon:"#e9967a",lightgoldenrodyellow:"#fafad2",snow:"#fffafa",lightgrey:"#d3d3d3",lightgray:"#d3d3d3",dimgray:"#696969",dimgrey:"#696969",olivedrab:"#6b8e23",olive:"#808000"},a={};for(var u in n)a[n[u]]=u;var g={};r.prototype.toName=function(R){if(!(this.rgba.a||this.rgba.r||this.rgba.g||this.rgba.b))return"transparent";var t,h,l=a[this.toHex()];if(l)return l;if(R?.closest){var b=this.toRgb(),f=1/0,y="black";if(!g.length)for(var G in n)g[G]=new r(n[G]).toRgb();for(var m in n){var X=(t=b,h=g[m],Math.pow(t.r-h.r,2)+Math.pow(t.g-h.g,2)+Math.pow(t.b-h.b,2));X<f&&(f=X,y=m)}return y}},e.string.push([function(R){var t=R.toLowerCase(),h=t==="transparent"?"#0000":n[t];return h?new r(h).toRgb():null},"name"])}const la=({color:r})=>r,sl=le.infinite(async(r=ke)=>{const{nodes:e,links:n}=await je();return new Float32Array(e.map(la).flatMap(r))}),fa=({size:r})=>Math.sqrt(r)/40,cl=le.infinite(async(r=ke)=>{const{nodes:e,links:n}=await je();return new Float32Array(e.map(fa).map(r))}),ha=async({colorMap:r=ke,sizeMap:e=ke,immediate:n=!1}={})=>{Rn(),yn(),Pa();const a=await sl(r),u=await cl(e),g=Re(),R=Ue(),t=De();g.target.setFromArray(a),R.target.setFromArray(u),t.target.setFromArray(new Float32Array(u.length).fill(0)),n&&(g.current.setFromArray(a),R.current.setFromArray(u),t.current.setFromArray(new Float32Array(u.length).fill(0)))},Gr=async(r,{colorMap:e=ke,sizeMap:n=ke,emphasis:a=0,immediate:u=!1}={})=>{const g=new Float32Array(e(la(r))),R=new Float32Array([n(fa(r))]),t=new Float32Array([a]),h=Re(),l=Ue(),b=De();h.target.setAtIndex1D(r.index,g),l.target.setAtIndex1D(r.index,R),b.target.setAtIndex1D(r.index,t),u&&(h.current.setAtIndex1D(r.index,g),l.current.setAtIndex1D(r.index,R),b.current.setAtIndex1D(r.index,t))},ul={colorMap:r=>{const e=r.slice(0,3).reduce((n,a)=>n+a,0)/3;return[...r.slice(0,3).map(n=>e),.5]},sizeMap:r=>r*.5},_a=async(r=!1)=>{await ha({...ul,immediate:r})},di="this.parentNode.style.display='none'",Ei="this.parentNode.style.display='initial'",ll=r=>Ce`
  <div class="project">
    <h3><a target="_blank" href="${r.data?.homepage}">${r.data.name}</a></h3>
    <div class="description">${r.data.description}</div>
    <div class="links">
      <span class="owner">
        <div class="owner-name-container">
          ${r.ownerData.html_url?Ce`<a target="_blank" href="${r.ownerData.html_url}">${r.ownerData.name}</a>`:Ce`<span>${r.ownerData.name}</span>`}
        </div>
        <div class="avatar-container">
          <img class="avatar-stroke" src="${r.ownerData?.avatar_url}" onerror=${di} onload=${Ei} alt="">
          <img class="avatar" src="${r.ownerData?.avatar_url}" onerror=${di} onload=${Ei} alt="${r.ownerData?.name}">
        </div>
      </span>
      <span><a target="_blank" href="${r.project}">NPM</a></span>
      ${r.data?.repository?Ce`<span><a target="_blank" href="${r.data.repository}">Git</a></span>`:Ce``}
      ${r.data?.bugs?Ce`<span><a target="_blank" href="${r.data.bugs}">Issues</a></span>`:Ce``}
      <!-- <a href="${r.ownerData.html_url}">Owner Profile</a> -->
    </div>
  </div>

`,fl=ji(r=>{const e=document.getElementById("selection-info");if(r){const n=ll(r);Qr(n,e)}else Qr(Ce``,e)},0),da=async(r,e=!0)=>{if(r){sn(r.index);const n=ra(r),a=Wu(r.project),u=Yu(r.project),{nodesByProject:g,links:R}=await je(),t=({sizeMap:h=ke,emphasis:l=1,colorMap:b=ke})=>(f,y)=>{y(["dependent","dependency"]).then(({dependent:G,dependency:m})=>{Gr(g[G?.value||r.project],{sizeMap:h,emphasis:l,colorMap:b}),Gr(g[m?.value||r.project],{sizeMap:h,emphasis:l,colorMap:b})})};_a().then(()=>{Jn(a,Ot(t({sizeMap:h=>h*2,colorMap:h=>{const l={r:h[0],g:h[1],b:h[2],a:h[3]},f=en(l,{r:0,g:1,b:0,a:.8});return[f.r,f.g,f.b,f.a]}}))),Gr(r,{sizeMap:h=>h*4,emphasis:1}),Jn(u,Ot(t({sizeMap:h=>h*2,colorMap:h=>{const l={r:h[0],g:h[1],b:h[2],a:h[3]},f=en(l,{r:0,g:0,b:1,a:.8});return[f.r,f.g,f.b,f.a]}}))),e&&mi(n),e&&pi(ma||75)})}else e&&pi(pa||1500),e&&mi([0,0,0],4e3),ha(),sn(-1);fl(r)},hl=()=>{da(null)};window.initializeSelectionVisuals=_a;let Ea=-1;const He=()=>Ea,sn=r=>{Ea=r};al([ol]);const _l=()=>{const r=document.documentElement,e=be(getComputedStyle(r).getPropertyValue("--selected-color")).toRgb();return new Float32Array([e.r/255,e.g/255,e.b/255,1])};var rt={},dl=(r,e)=>{rt[r]??(rt[r]=[]),rt[r].push(e)},El=(r,e)=>{var n;(n=rt[r])==null||n.splice(rt[r].indexOf(e),1)},gi=async(r,e,n)=>{for(const a of rt[r]??[])await a(e,n)},Vr=r=>r.length>1&&r.endsWith("/")?r.slice(0,-1):r,gl=r=>{var e;const n=(e=r.match(/(:[^/]+)/g))==null?void 0:e.map(a=>a.substring(1));return n&&{keys:n,regExp:new RegExp("^"+r.replace(/(:[^/]+)/g,"([^/]+)")+"$")}},ml=(r,e)=>Object.fromEntries(e.map((n,a)=>[n,r[a+1]])),ga=[],Qe,pl=r=>{for(const e of ga){const{pattern:n,regExp:a,keys:u}=e,g=a?r.match(a):n==="*"||n===r;if(g){const R=Array.isArray(g)?ml(g,u):void 0;return{definition:e,params:R}}}},At=async(r,e)=>{const n=pl(r),a=!!n,u=n?.params??{},g=Qe;Qe={path:r,params:u,matches:a,trigger:e},await gi("before-route",Qe,g),await n?.definition.action(u,Qe,g),await gi("route",Qe,g)},fr={get currentRoute(){return Qe},on:dl,off:El,start({handleInitial:r=!0}={}){const e=window.location.hash!=""&&window.location.hash;r&&At(e||window.location.pathname||"/","init"),window.addEventListener("popstate",()=>At(window.location.pathname,"popstate")),window.addEventListener("hashchange",()=>{At(window.location.hash,"hashchange")})},route(r,e){const n=Vr(r),{regExp:a,keys:u=[]}=gl(r)||{};ga.push({pattern:n,action:e,regExp:a,keys:u})},push(r){window.history.pushState(null,"",Vr(r)),At(r,"push")},replace(r){window.history.replaceState(null,"",Vr(r)),At(r,"replace")}};fr.route("#-",()=>{hl()});fr.route("#project/:id",async(r,{trigger:e})=>{const{nodesByNavId:n}=await je(),a=n[r.id];da(a,e!=="init")});const Tl=r=>{const a=he().canvas.getBoundingClientRect(),u=(r.clientX-a.left)/a.width,g=(r.clientY-a.top)/a.height;return{x:u*2-1,y:-(g*2-1)}},cn=or(new xu),{globalCamera:jt,updateCameras:Al,setCameraCenter:mi,setCameraDistance:pi,zoomGlobalCamera:Ti,panGlobalCamera:Ai,startZooming:vi,startPanning:Ri,stopPanning:yi,computeScreenPosition:vl}=cn;let ma,pa;const Ta=500,Rl=Ta,Si=async()=>{cn.stopZooming();const r=He(),e=(await cn.getGlobalCameraParams()).distance;r>-1?ma=Math.min(e,Ta):pa=Math.max(e,Rl)},Ne={},Ii=new Uint8Array(4).fill(0);let Nt=-1,ir=!1,Aa=0;const yl=()=>ir?!1:Date.now()-Aa<200;let un=0,ar=0;const Hr=()=>{un++},kr=()=>[Ne.canvasX,Ne.canvasY],ln=()=>[Ne.x,Ne.y],Kt=({x:r,y:e})=>{const n=he();Ne.x=r,Ne.y=e,Ne.canvasX=(r+1)/2*n.width,Ne.canvasY=(e+1)/2*n.height;const a=window.devicePixelRatio||1;Ne.pickerX=Math.floor(Ne.canvasX/a),Ne.pickerY=Math.floor(Ne.canvasY/a)};let fn=-1;const Sl=()=>fn,Il=le.infinite(()=>{const e=he().canvas;Zr(e).on("touchmove",Kt).on("mousemove",Kt),Zr(e).on("touchmove",Hr).on("pinchmove",Hr).on("mousemove",Hr),e.addEventListener("pointerdown",n=>{Kt(Tl(n)),ir=!0,un=0,ar=0}),e.addEventListener("pointerup",()=>{const n=ar>.03||un>5;ir=!1,n||(hn=!0,setTimeout(()=>{const a=He();sn(Nt===a?-1:Nt),bl().then(u=>{e.dispatchEvent(new CustomEvent("selected",{detail:{selectedIndex:a,info:u}}))}),e.dispatchEvent(new CustomEvent("tap",{detail:{selectedIndex:a}}))},50))}),e.addEventListener("selected",n=>{const a=n.detail.info;fr.push(a?`#project/${a?.navId}`:"#-")}),e.addEventListener("hover",async n=>{const{nodes:a}=await je(),u=n.detail.wasHoveredIndex;u>-1&&a[u];const g=n.detail.nowHoveredIndex,R=g>-1?a[g]:null;He()>-1&&a[He()],R&&yl()?fn=R?.index||-1:fn=-1})}),Wt=Math.PI/3,Pl=()=>{const e=he().canvas;e.addEventListener("wheel",n=>{const a=Math.exp(n.deltaY/e.clientHeight*2)-1,u=Math.sign(a);vi(),Ti(0,0,u*Math.min(Math.abs(a),.06)),n.preventDefault(),Si()},{passive:!1}),Zr(e).on("mousemove",function(n){Aa=Date.now(),!(!n.active||n.buttons!==1)&&(ar+=Math.sqrt(Math.pow(n.dx,2)+Math.pow(n.dy,2)),n.mods.shift?(Ri(),Ai(n.dx,n.dy)):n.mods.meta?jt.pivot(n.dx,n.dy):(jt.rotate(-n.dx*Wt,-n.dy*Wt),yi()),n.originalEvent.preventDefault())}).on("touchmove",function(n){Kt(n),n.active&&(ar+=Math.sqrt(Math.pow(n.dx,2)+Math.pow(n.dy,2)),jt.rotate(-n.dx*Wt,-n.dy*Wt))}).on("pinchmove",function(n){n.active&&(ir=!0,Ri(),vi(),Ti(0,0,1-n.zoomx),Ai(n.dx,n.dy))}).on("touchstart",n=>n.originalEvent.preventDefault()).on("pinchstart",n=>n.originalEvent.preventDefault()).on("pinchend",()=>{yi(),Si()})};let hn=!0;const Nl=r=>r[0]+r[1]*256+r[2]*256*256-1,Ol=()=>{const r=he(),e=Ro(),n=100,a=[kr()[0]-n/2,kr()[1]-n/2,n,n];r.drawFramebuffer(e.current.resize(r.width,r.height)).enable(oe.SCISSOR_TEST).scissor(...a);const u=yo().uniformBlock("cameras",tr()).uniform("mousePosition",ln()).uniform("selectedIndex",He()).uniform("textureDimensions",[Re().current.width,Re().current.height]).texture("positionTexture",Pe(Ve().current.currentState.texture)).texture("colorTexture",Pe(Re().current.currentState.texture)).texture("sizeTexture",Pe(Ue().current.currentState.texture)).texture("emphasisTexture",Pe(De().current.currentState.texture));r.defaultViewport().clear(),u.draw();{r.readFramebuffer(e.other).readPixel(...kr(),Ii);const g=Nl(Ii);Nt!==g&&r.canvas.dispatchEvent(new CustomEvent("hover",{detail:{wasHoveredIndex:Nt,nowHoveredIndex:g}})),Nt=g,e.swap(),hn=!1}},bl=async()=>{const{nodes:r}=await je();return r[He()]},vn=({classes:r,htmlTemplate:e,applyScreenPositionStyle:n}={})=>{n=n||((h,l)=>{l.style.left=`${h[0]}vw`,l.style.bottom=`${h[1]}vh`});const a=document.createElement("div");a.classList.add("cursor"),r?.forEach(h=>a.classList.add(h)),document.body.appendChild(a);const u=h=>{n(h,a)},g=h=>{const l=[(h[0]+1)/2*100,(h[1]+1)/2*100];u(l)},R=$r(async h=>{const l=ra(h),b=await vl(l);g(b)},50),t=$r(async h=>{h?(await R(h),a.classList.add("focused")):a.classList.remove("focused"),h&&e&&Qr(e(h),a)},50);return{element:a,alignToScreenPosition:u,alignToNDCPosition:g,alignToNode:R,highlightNode:t,destroy:()=>a.remove()}};vn({classes:["selected-cursor"]});vn({classes:["hovered-tooltip"],htmlTemplate:r=>Ce`
    <div class="node-name">${r.data.name}</div>
  `,applyScreenPositionStyle(r,e){e.style.left=`calc(min(${r[0]}vw, calc(100vw - 15em)))`,e.style.bottom=`${r[1]}vh`}});vn({classes:["hovered-cursor"]});let _n=!0,dn=!0;window.addEventListener("keydown",r=>{r.key==="e"&&(_n=!_n),r.key==="n"&&(dn=!dn)});const va=()=>[be(document.body.style.backgroundColor).toRgb()].flatMap(({r,g:e,b:n,a})=>[r,e,n,a].map(u=>u/255)),Ra=()=>{const r=window.devicePixelRatio||1,e=window.innerWidth,n=window.innerHeight,a=Math.floor(e*r),u=Math.floor(n*r);return{width:a,height:u}},ya=le.infinite(()=>{const r=document.createElement("canvas");document.body.appendChild(r);const e=r.getContext("webgl2");return e?console.log("WebGL2 initialized"):console.error("WebGL2 failed to initialize"),{canvas:r,gl:e}}),ft=le.infinite(()=>{const{canvas:r,gl:e}=ya();return he(),new ge.GPUComposer({context:e,canvas:r})}),he=le.infinite(()=>{const{width:r,height:e}=Ra();return oe.createApp(ya().canvas,{antialias:!0,extensions:["OES_texture_float","EXT_color_buffer_float","ANGLE_instanced_arrays"]}).viewport(0,0,r,e).enable(oe.BLEND).blendFunc(oe.SRC_ALPHA,oe.ONE_MINUS_SRC_ALPHA).enable(oe.DEPTH_TEST).depthFunc(oe.LEQUAL).clearColor(...va())}),Sa=()=>{const r=he(),{width:e,height:n}=Ra();console.log("resizing canvas to",e,n,"px"),r.resize(e,n),jt.resize(e/n);const a=r.canvas;a.style.position="absolute",a.style.top="0px",a.style.left="0px",a.style.height="100vh"};ge.renderRGBProgram(ft(),{name:"renderPositions",type:ge.FLOAT});ge.renderAmplitudeProgram(ft(),{name:"renderNoise",type:ge.FLOAT,components:"x"});const ct=he().canvas;Sa();const En=new Float32Array(ct.width*ct.height);En.forEach((r,e)=>En[e]=Math.random());new ge.GPULayer(ft(),{name:"state",dimensions:[ct.width,ct.height],numComponents:1,type:ge.FLOAT,filter:ge.NEAREST,numBuffers:2,wrapX:ge.REPEAT,wrapY:ge.REPEAT,array:En});const Ia=()=>{const r=he(),e=ft(),n=r.gl;r.disable(oe.BLEND),r.clearColor(0,0,0,0).clear();const a=[Ve(),Re(),Ue(),De()],u=Iu();Object.values(u._programs).forEach(t=>{t.id="interpolation"}),u.setUniform("uMixRatio",.05),e.step({program:u,input:a.flatMap(t=>[t.target,t.current]),output:a.flatMap(t=>[t.current])}),e.step({program:u,input:a.flatMap(t=>[t.target,t.current]),output:a.flatMap(t=>[t.current])}),n.disable(n.SCISSOR_TEST),n.viewport(0,0,ct.width,ct.height),n.bindFramebuffer(n.FRAMEBUFFER,null),Ol(),r.enable(oe.BLEND),r.enable(oe.DEPTH_TEST),r.clearColor(...va()).disable(oe.SCISSOR_TEST),r.defaultViewport().defaultDrawFramebuffer(),Sa(),Al(Nc,window.innerWidth,window.innerHeight);const g=So().uniformBlock("cameras",tr()).uniform("textureDimensions",[Re().current.width,Re().current.height]).texture("positionTexture",Pe(Ve().current.currentState.texture)).texture("colorTexture",Pe(Re().current.currentState.texture)).texture("sizeTexture",Pe(Ue().current.currentState.texture)).texture("emphasisTexture",Pe(De().current.currentState.texture)).uniform("mousePosition",ln()).uniform("selectedIndex",He()).uniform("selectedColor",_l()).uniform("hoveringIndex",Sl()).uniform("time",performance.now()/1e3),R=Co().uniformBlock("cameras",tr()).uniform("textureDimensions",[Re().current.width,Re().current.height]).texture("positionTexture",Pe(Ve().current.currentState.texture)).texture("colorTexture",Pe(Re().current.currentState.texture)).texture("sizeTexture",Pe(Ue().current.currentState.texture)).texture("emphasisTexture",Pe(De().current.currentState.texture)).uniform("mousePosition",ln()).uniform("selectedIndex",He()).uniform("time",performance.now()/1e3);Mi(),dn&&g.draw(),_n&&R.draw(),requestAnimationFrame(Ia)},Fl=(r,e)=>{let n;switch(`${r}${e}`){case`${oe.FLOAT}4`:n=oe.RGBA32F;break;case`${oe.FLOAT}3`:n=oe.RGBA32F;break;case`${oe.FLOAT}2`:n=oe.RG32F;break;case`${oe.FLOAT}1`:n=oe.R32F;break;case`${oe.UNSIGNED_BYTE}3`:n=oe.RGB8;break;case`${oe.UNSIGNED_BYTE}4`:n=oe.RGBA8;break;case`${oe.UNSIGNED_SHORT}3`:n=oe.RGB16UI;break;case`${oe.UNSIGNED_SHORT}4`:n=oe.RGBA16UI;break;case`${oe.UNSIGNED_INT}3`:n=oe.RGB32UI;break;case`${oe.UNSIGNED_INT}4`:n=oe.RGBA32UI;break}return n};class hr{constructor(e,n,a){this.positionSwap=!1,this.makeBuffer=le.infinite((u,g)=>he().createVertexBuffer(this._type,this._itemSize,u*this._itemSize)),this.makeTexture=le.infinite(u=>{const g=he(),R=Math.ceil(Math.sqrt(u+1)),t={width:R,height:R,internalFormat:Fl(this._type,this._itemSize),type:this._type,flipY:!0,minFilter:oe.NEAREST,magFilter:oe.NEAREST,premultiplyAlpha:!0,wrapY:oe.CLAMP_TO_EDGE,wrapX:oe.CLAMP_TO_EDGE};return g.createTexture2D(R,R,t)}),this.makeTextureIndicesVertexBuffer=le.infinite(u=>{const g=he(),R=new Uint32Array(u).map((t,h)=>h);return g.createVertexBuffer(oe.UNSIGNED_INT,1,R)}),this.targetData=(u,{offset:g=-1,immediate:R=!1}={})=>{let t;g>-1?t=this._target.numItems:(g=0,t=ArrayBuffer.isView(u)?u.byteLength/this._itemSize/4:u,this._readbackBuffer=this.makeBuffer(100,"readback")),this._currentA=this.makeBuffer(t,"currentA"),this._currentB=this.makeBuffer(t,"currentB"),this._target=this.makeBuffer(t,"target"),this._texture=this.makeTexture(t),this._texturePixelPositions=this.makeTextureIndicesVertexBuffer(t),ArrayBuffer.isView(u)&&(this._target.data(u,g*this._itemSize*4),this._mostRecentData=u,R&&(this._currentA.data(u,g*this._itemSize*4),this._currentB.data(u,g*this._itemSize*4)))},this._type=e,this._itemSize=n,this.targetData(a)}swap(){this.positionSwap=!this.positionSwap}readBack(e){const a=he().gl;let u;this._type===oe.FLOAT?u=new Float32Array(this._itemSize):this._type===oe.UNSIGNED_BYTE?u=new Uint8Array(this._itemSize):this._type===oe.UNSIGNED_SHORT?u=new Uint16Array(this._itemSize):this._type===oe.UNSIGNED_INT?u=new Uint32Array(this._itemSize):u=new ArrayBuffer(this._itemSize*4),a.bindBufferBase(a.TRANSFORM_FEEDBACK_BUFFER,0,null),a.bindBufferBase(a.TRANSFORM_FEEDBACK_BUFFER,1,null),a.bindBufferBase(a.TRANSFORM_FEEDBACK_BUFFER,2,null),a.bindBufferBase(a.TRANSFORM_FEEDBACK_BUFFER,3,null);const g=e*this._itemSize*4;a.bindBuffer(oe.COPY_READ_BUFFER,this.target.buffer),a.bindBuffer(oe.COPY_WRITE_BUFFER,this._readbackBuffer.buffer),a.copyBufferSubData(oe.COPY_READ_BUFFER,oe.COPY_WRITE_BUFFER,g,0,this._itemSize*4);const R=new DataView(u.buffer);return a.getBufferSubData(a.COPY_WRITE_BUFFER,0,R),a.bindBuffer(oe.COPY_READ_BUFFER,null),u}get current(){return this.positionSwap?this._currentA:this._currentB}get texture(){return this._texture}get texturePixelPositions(){return this._texturePixelPositions}get updated(){return this.positionSwap?this._currentB:this._currentA}get target(){return this._target}get mostRecentData(){return this._mostRecentData}}const Mt=le.infinite(()=>new hr(oe.FLOAT,3,1)),Rn=le.infinite(()=>new hr(oe.FLOAT,4,1)),yn=le.infinite(()=>new hr(oe.FLOAT,1,1)),Pa=le.infinite(()=>new hr(oe.FLOAT,1,1));le.infinite(()=>he().createFramebuffer());le.infinite(r=>he().createTexture2D(r,r,{internalFormat:oe.DEPTH_COMPONENT32F}));le.infinite(()=>he().createProgram(eo,to,{transformFeedbackVaryings:["vUpdatedPosition","vUpdatedColor","vUpdatedSize","vUpdatedEmphasis"],transformFeedbackMode:oe.SEPARATE_ATTRIBS}));le.infinite(()=>he().createVertexArray());le.infinite(()=>he().createTransformFeedback());const we=document.createElement("div");document.body.appendChild(we);we.id="fps-indicator";we.classList.add("overlay");we.classList.add("debug");we.innerHTML=`
<div class="value">FPS: 0</div>
<canvas width="60" height="20" class="graph"></canvas>
`;we.style.position="absolute";we.style.top="0px";we.style.left="0px";we.style.color="white";const Ll=document.querySelector("#fps-indicator .value"),et=document.querySelector("#fps-indicator .graph"),Be=et.getContext("2d");let Xr=performance.now(),Pi=performance.now(),Wr=0,Rt=[];const Ni=5,Cl=()=>Rt.slice(0,Ni).reduce((r,e)=>r+e,0)/Ni,Sn=()=>{const r=Cl(),e=performance.now();Wr++,e>Xr+100&&(Rt=[Math.round(Wr*1e3/(e-Xr)/2),...Rt].slice(0,1e3),Be?.clearRect(0,0,et.width,et.height),Be?.beginPath(),Be?.moveTo(0,et.height),Rt.forEach((n,a)=>{Be?.lineTo(a,et.height-n)}),Be?.lineTo(Rt.length,et.height),Be.fillStyle="rgba(255, 255, 255, 0.5)",Be?.fill(),Be?.stroke(),Xr=e,Wr=0),e>Pi+1e3&&(Pi=e,Ll.innerText=`FPS: ${r}`),requestAnimationFrame(Sn)};Sn();const xl=he();xl.clear();Pl();Il();document.querySelector("html")?.classList.add("loading");let _r;_r=await je();await Fu();const{nodes:Se,linkIndexPairs:Na}=_r;console.log("nodes",Se);const Oi=[Cu],Ul=async()=>{const r=Oi[Math.floor(Math.random()*Oi.length)];await r(_r)};await Ul();Lo(Na);Su(Se.length);const In=new Float32Array(Se.flatMap(({color:r})=>r));Rn().targetData(In);Re().target.setFromArray(In);Re().current.setFromArray(In);const Ut=new Float32Array(Se.length);for(let r=0;r<Ut.length;r++)Ut[r]=Math.sqrt(Se[r].size)/40;yn().targetData(Ut);Ue().target.setFromArray(Ut);Ue().current.setFromArray(Ut);const Yr=40,Dl=()=>[Math.random()*Yr-1,Math.random()*Yr-1,Math.random()*Yr-1],Pn=new Float32Array(Se.flatMap(Dl));Mt().targetData(Pn);Ve().target.setFromArray(Pn);Ve().current.setFromArray(Pn);Pa().targetData(new Float32Array(Se.length).fill(0));De().target.setFromArray(new Float32Array(Se.length).fill(0));De().current.setFromArray(new Float32Array(Se.length).fill(0));const ht=document.createElement("div");ht.classList.add("overlay");ht.classList.add("debug");ht.style.top="0";ht.style.right="0";document.body.appendChild(ht);ht.innerHTML=`
    <div>Nodes: ${Se.length}</div>
    <div>Edges: ${Na.length}</div>
`;document.querySelector("html").classList.remove("loading");Ia();Sn();fr.start();window.setNodePositions=r=>{Mt().targetData(new Float32Array(new Array(Se.length*3).fill(0).flatMap(r)))};window.setNodeColors=r=>{Rn().targetData(new Float32Array(new Array(Se.length*4).fill(0).flatMap(r)))};window.setNodeSizes=r=>{yn().targetData(new Float32Array(new Array(Se.length).fill(0).flatMap(r)))};window.graphData=_r;window.addEventListener("keydown",r=>{const e=document.querySelector("#debug-style").sheet,n=e.cssRules[0].styleMap.get("display").value!=="none";r.key==="d"&&e.cssRules[0].styleMap.set("display",n?"none":"block")})})();