(async()=>{(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const l of a.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&n(l)}).observe(document,{childList:!0,subtree:!0});function r(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(s){if(s.ep)return;s.ep=!0;const a=r(s);fetch(s.href,a)}})();const i={DEPTH_BUFFER_BIT:256,STENCIL_BUFFER_BIT:1024,COLOR_BUFFER_BIT:16384,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,ZERO:0,ONE:1,SRC_COLOR:768,ONE_MINUS_SRC_COLOR:769,SRC_ALPHA:770,ONE_MINUS_SRC_ALPHA:771,DST_ALPHA:772,ONE_MINUS_DST_ALPHA:773,DST_COLOR:774,ONE_MINUS_DST_COLOR:775,SRC_ALPHA_SATURATE:776,FUNC_ADD:32774,BLEND_EQUATION:32777,BLEND_EQUATION_RGB:32777,BLEND_EQUATION_ALPHA:34877,FUNC_SUBTRACT:32778,FUNC_REVERSE_SUBTRACT:32779,BLEND_DST_RGB:32968,BLEND_SRC_RGB:32969,BLEND_DST_ALPHA:32970,BLEND_SRC_ALPHA:32971,CONSTANT_COLOR:32769,ONE_MINUS_CONSTANT_COLOR:32770,CONSTANT_ALPHA:32771,ONE_MINUS_CONSTANT_ALPHA:32772,BLEND_COLOR:32773,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,ARRAY_BUFFER_BINDING:34964,ELEMENT_ARRAY_BUFFER_BINDING:34965,STREAM_DRAW:35040,STATIC_DRAW:35044,DYNAMIC_DRAW:35048,BUFFER_SIZE:34660,BUFFER_USAGE:34661,CURRENT_VERTEX_ATTRIB:34342,FRONT:1028,BACK:1029,FRONT_AND_BACK:1032,CULL_FACE:2884,BLEND:3042,DITHER:3024,STENCIL_TEST:2960,DEPTH_TEST:2929,SCISSOR_TEST:3089,POLYGON_OFFSET_FILL:32823,SAMPLE_ALPHA_TO_COVERAGE:32926,SAMPLE_COVERAGE:32928,NO_ERROR:0,INVALID_ENUM:1280,INVALID_VALUE:1281,INVALID_OPERATION:1282,OUT_OF_MEMORY:1285,CW:2304,CCW:2305,LINE_WIDTH:2849,ALIASED_POINT_SIZE_RANGE:33901,ALIASED_LINE_WIDTH_RANGE:33902,CULL_FACE_MODE:2885,FRONT_FACE:2886,DEPTH_RANGE:2928,DEPTH_WRITEMASK:2930,DEPTH_CLEAR_VALUE:2931,DEPTH_FUNC:2932,STENCIL_CLEAR_VALUE:2961,STENCIL_FUNC:2962,STENCIL_FAIL:2964,STENCIL_PASS_DEPTH_FAIL:2965,STENCIL_PASS_DEPTH_PASS:2966,STENCIL_REF:2967,STENCIL_VALUE_MASK:2963,STENCIL_WRITEMASK:2968,STENCIL_BACK_FUNC:34816,STENCIL_BACK_FAIL:34817,STENCIL_BACK_PASS_DEPTH_FAIL:34818,STENCIL_BACK_PASS_DEPTH_PASS:34819,STENCIL_BACK_REF:36003,STENCIL_BACK_VALUE_MASK:36004,STENCIL_BACK_WRITEMASK:36005,VIEWPORT:2978,SCISSOR_BOX:3088,COLOR_CLEAR_VALUE:3106,COLOR_WRITEMASK:3107,UNPACK_ALIGNMENT:3317,PACK_ALIGNMENT:3333,MAX_TEXTURE_SIZE:3379,MAX_VIEWPORT_DIMS:3386,SUBPIXEL_BITS:3408,RED_BITS:3410,GREEN_BITS:3411,BLUE_BITS:3412,ALPHA_BITS:3413,DEPTH_BITS:3414,STENCIL_BITS:3415,POLYGON_OFFSET_UNITS:10752,POLYGON_OFFSET_FACTOR:32824,TEXTURE_BINDING_2D:32873,SAMPLE_BUFFERS:32936,SAMPLES:32937,SAMPLE_COVERAGE_VALUE:32938,SAMPLE_COVERAGE_INVERT:32939,COMPRESSED_TEXTURE_FORMATS:34467,DONT_CARE:4352,FASTEST:4353,NICEST:4354,GENERATE_MIPMAP_HINT:33170,BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DEPTH_COMPONENT:6402,ALPHA:6406,RGB:6407,RGBA:6408,LUMINANCE:6409,LUMINANCE_ALPHA:6410,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,FRAGMENT_SHADER:35632,VERTEX_SHADER:35633,MAX_VERTEX_ATTRIBS:34921,MAX_VERTEX_UNIFORM_VECTORS:36347,MAX_VARYING_VECTORS:36348,MAX_COMBINED_TEXTURE_IMAGE_UNITS:35661,MAX_VERTEX_TEXTURE_IMAGE_UNITS:35660,MAX_TEXTURE_IMAGE_UNITS:34930,MAX_FRAGMENT_UNIFORM_VECTORS:36349,SHADER_TYPE:35663,DELETE_STATUS:35712,LINK_STATUS:35714,VALIDATE_STATUS:35715,ATTACHED_SHADERS:35717,ACTIVE_UNIFORMS:35718,ACTIVE_ATTRIBUTES:35721,SHADING_LANGUAGE_VERSION:35724,CURRENT_PROGRAM:35725,NEVER:512,LESS:513,EQUAL:514,LEQUAL:515,GREATER:516,NOTEQUAL:517,GEQUAL:518,ALWAYS:519,KEEP:7680,REPLACE:7681,INCR:7682,DECR:7683,INVERT:5386,INCR_WRAP:34055,DECR_WRAP:34056,VENDOR:7936,RENDERER:7937,VERSION:7938,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987,TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,TEXTURE_2D:3553,TEXTURE:5890,TEXTURE_CUBE_MAP:34067,TEXTURE_BINDING_CUBE_MAP:34068,TEXTURE_CUBE_MAP_POSITIVE_X:34069,TEXTURE_CUBE_MAP_NEGATIVE_X:34070,TEXTURE_CUBE_MAP_POSITIVE_Y:34071,TEXTURE_CUBE_MAP_NEGATIVE_Y:34072,TEXTURE_CUBE_MAP_POSITIVE_Z:34073,TEXTURE_CUBE_MAP_NEGATIVE_Z:34074,MAX_CUBE_MAP_TEXTURE_SIZE:34076,TEXTURE0:33984,TEXTURE1:33985,TEXTURE2:33986,TEXTURE3:33987,TEXTURE4:33988,TEXTURE5:33989,TEXTURE6:33990,TEXTURE7:33991,TEXTURE8:33992,TEXTURE9:33993,TEXTURE10:33994,TEXTURE11:33995,TEXTURE12:33996,TEXTURE13:33997,TEXTURE14:33998,TEXTURE15:33999,TEXTURE16:34e3,TEXTURE17:34001,TEXTURE18:34002,TEXTURE19:34003,TEXTURE20:34004,TEXTURE21:34005,TEXTURE22:34006,TEXTURE23:34007,TEXTURE24:34008,TEXTURE25:34009,TEXTURE26:34010,TEXTURE27:34011,TEXTURE28:34012,TEXTURE29:34013,TEXTURE30:34014,TEXTURE31:34015,ACTIVE_TEXTURE:34016,REPEAT:10497,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,SAMPLER_2D:35678,SAMPLER_CUBE:35680,VERTEX_ATTRIB_ARRAY_ENABLED:34338,VERTEX_ATTRIB_ARRAY_SIZE:34339,VERTEX_ATTRIB_ARRAY_STRIDE:34340,VERTEX_ATTRIB_ARRAY_TYPE:34341,VERTEX_ATTRIB_ARRAY_NORMALIZED:34922,VERTEX_ATTRIB_ARRAY_POINTER:34373,VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:34975,IMPLEMENTATION_COLOR_READ_TYPE:35738,IMPLEMENTATION_COLOR_READ_FORMAT:35739,COMPILE_STATUS:35713,LOW_FLOAT:36336,MEDIUM_FLOAT:36337,HIGH_FLOAT:36338,LOW_INT:36339,MEDIUM_INT:36340,HIGH_INT:36341,FRAMEBUFFER:36160,RENDERBUFFER:36161,RGBA4:32854,RGB5_A1:32855,RGB565:36194,DEPTH_COMPONENT16:33189,STENCIL_INDEX:6401,STENCIL_INDEX8:36168,DEPTH_STENCIL:34041,RENDERBUFFER_WIDTH:36162,RENDERBUFFER_HEIGHT:36163,RENDERBUFFER_INTERNAL_FORMAT:36164,RENDERBUFFER_RED_SIZE:36176,RENDERBUFFER_GREEN_SIZE:36177,RENDERBUFFER_BLUE_SIZE:36178,RENDERBUFFER_ALPHA_SIZE:36179,RENDERBUFFER_DEPTH_SIZE:36180,RENDERBUFFER_STENCIL_SIZE:36181,FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:36048,FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:36049,FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL:36050,FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE:36051,COLOR_ATTACHMENT0:36064,DEPTH_ATTACHMENT:36096,STENCIL_ATTACHMENT:36128,DEPTH_STENCIL_ATTACHMENT:33306,NONE:0,FRAMEBUFFER_COMPLETE:36053,FRAMEBUFFER_INCOMPLETE_ATTACHMENT:36054,FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:36055,FRAMEBUFFER_INCOMPLETE_DIMENSIONS:36057,FRAMEBUFFER_UNSUPPORTED:36061,FRAMEBUFFER_BINDING:36006,RENDERBUFFER_BINDING:36007,MAX_RENDERBUFFER_SIZE:34024,INVALID_FRAMEBUFFER_OPERATION:1286,UNPACK_FLIP_Y_WEBGL:37440,UNPACK_PREMULTIPLY_ALPHA_WEBGL:37441,CONTEXT_LOST_WEBGL:37442,UNPACK_COLORSPACE_CONVERSION_WEBGL:37443,BROWSER_DEFAULT_WEBGL:37444,READ_BUFFER:3074,UNPACK_ROW_LENGTH:3314,UNPACK_SKIP_ROWS:3315,UNPACK_SKIP_PIXELS:3316,PACK_ROW_LENGTH:3330,PACK_SKIP_ROWS:3331,PACK_SKIP_PIXELS:3332,COLOR:6144,DEPTH:6145,STENCIL:6146,RED:6403,RGB8:32849,RGBA8:32856,RGB10_A2:32857,TEXTURE_BINDING_3D:32874,UNPACK_SKIP_IMAGES:32877,UNPACK_IMAGE_HEIGHT:32878,TEXTURE_3D:32879,TEXTURE_WRAP_R:32882,MAX_3D_TEXTURE_SIZE:32883,UNSIGNED_INT_2_10_10_10_REV:33640,MAX_ELEMENTS_VERTICES:33e3,MAX_ELEMENTS_INDICES:33001,TEXTURE_MIN_LOD:33082,TEXTURE_MAX_LOD:33083,TEXTURE_BASE_LEVEL:33084,TEXTURE_MAX_LEVEL:33085,MIN:32775,MAX:32776,DEPTH_COMPONENT24:33190,MAX_TEXTURE_LOD_BIAS:34045,TEXTURE_COMPARE_MODE:34892,TEXTURE_COMPARE_FUNC:34893,CURRENT_QUERY:34917,QUERY_RESULT:34918,QUERY_RESULT_AVAILABLE:34919,STREAM_READ:35041,STREAM_COPY:35042,STATIC_READ:35045,STATIC_COPY:35046,DYNAMIC_READ:35049,DYNAMIC_COPY:35050,MAX_DRAW_BUFFERS:34852,DRAW_BUFFER0:34853,DRAW_BUFFER1:34854,DRAW_BUFFER2:34855,DRAW_BUFFER3:34856,DRAW_BUFFER4:34857,DRAW_BUFFER5:34858,DRAW_BUFFER6:34859,DRAW_BUFFER7:34860,DRAW_BUFFER8:34861,DRAW_BUFFER9:34862,DRAW_BUFFER10:34863,DRAW_BUFFER11:34864,DRAW_BUFFER12:34865,DRAW_BUFFER13:34866,DRAW_BUFFER14:34867,DRAW_BUFFER15:34868,MAX_FRAGMENT_UNIFORM_COMPONENTS:35657,MAX_VERTEX_UNIFORM_COMPONENTS:35658,SAMPLER_3D:35679,SAMPLER_2D_SHADOW:35682,FRAGMENT_SHADER_DERIVATIVE_HINT:35723,PIXEL_PACK_BUFFER:35051,PIXEL_UNPACK_BUFFER:35052,PIXEL_PACK_BUFFER_BINDING:35053,PIXEL_UNPACK_BUFFER_BINDING:35055,FLOAT_MAT2x3:35685,FLOAT_MAT2x4:35686,FLOAT_MAT3x2:35687,FLOAT_MAT3x4:35688,FLOAT_MAT4x2:35689,FLOAT_MAT4x3:35690,SRGB:35904,SRGB8:35905,SRGB8_ALPHA8:35907,COMPARE_REF_TO_TEXTURE:34894,RGBA32F:34836,RGB32F:34837,RGBA16F:34842,RGB16F:34843,VERTEX_ATTRIB_ARRAY_INTEGER:35069,MAX_ARRAY_TEXTURE_LAYERS:35071,MIN_PROGRAM_TEXEL_OFFSET:35076,MAX_PROGRAM_TEXEL_OFFSET:35077,MAX_VARYING_COMPONENTS:35659,TEXTURE_2D_ARRAY:35866,TEXTURE_BINDING_2D_ARRAY:35869,R11F_G11F_B10F:35898,UNSIGNED_INT_10F_11F_11F_REV:35899,RGB9_E5:35901,UNSIGNED_INT_5_9_9_9_REV:35902,TRANSFORM_FEEDBACK_BUFFER_MODE:35967,MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS:35968,TRANSFORM_FEEDBACK_VARYINGS:35971,TRANSFORM_FEEDBACK_BUFFER_START:35972,TRANSFORM_FEEDBACK_BUFFER_SIZE:35973,TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN:35976,RASTERIZER_DISCARD:35977,MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS:35978,MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS:35979,INTERLEAVED_ATTRIBS:35980,SEPARATE_ATTRIBS:35981,TRANSFORM_FEEDBACK_BUFFER:35982,TRANSFORM_FEEDBACK_BUFFER_BINDING:35983,RGBA32UI:36208,RGB32UI:36209,RGBA16UI:36214,RGB16UI:36215,RGBA8UI:36220,RGB8UI:36221,RGBA32I:36226,RGB32I:36227,RGBA16I:36232,RGB16I:36233,RGBA8I:36238,RGB8I:36239,RED_INTEGER:36244,RGB_INTEGER:36248,RGBA_INTEGER:36249,SAMPLER_2D_ARRAY:36289,SAMPLER_2D_ARRAY_SHADOW:36292,SAMPLER_CUBE_SHADOW:36293,UNSIGNED_INT_VEC2:36294,UNSIGNED_INT_VEC3:36295,UNSIGNED_INT_VEC4:36296,INT_SAMPLER_2D:36298,INT_SAMPLER_3D:36299,INT_SAMPLER_CUBE:36300,INT_SAMPLER_2D_ARRAY:36303,UNSIGNED_INT_SAMPLER_2D:36306,UNSIGNED_INT_SAMPLER_3D:36307,UNSIGNED_INT_SAMPLER_CUBE:36308,UNSIGNED_INT_SAMPLER_2D_ARRAY:36311,DEPTH_COMPONENT32F:36012,DEPTH32F_STENCIL8:36013,FLOAT_32_UNSIGNED_INT_24_8_REV:36269,FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING:33296,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE:33297,FRAMEBUFFER_ATTACHMENT_RED_SIZE:33298,FRAMEBUFFER_ATTACHMENT_GREEN_SIZE:33299,FRAMEBUFFER_ATTACHMENT_BLUE_SIZE:33300,FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE:33301,FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE:33302,FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE:33303,FRAMEBUFFER_DEFAULT:33304,UNSIGNED_INT_24_8:34042,DEPTH24_STENCIL8:35056,UNSIGNED_NORMALIZED:35863,DRAW_FRAMEBUFFER_BINDING:36006,READ_FRAMEBUFFER:36008,DRAW_FRAMEBUFFER:36009,READ_FRAMEBUFFER_BINDING:36010,RENDERBUFFER_SAMPLES:36011,FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER:36052,MAX_COLOR_ATTACHMENTS:36063,COLOR_ATTACHMENT1:36065,COLOR_ATTACHMENT2:36066,COLOR_ATTACHMENT3:36067,COLOR_ATTACHMENT4:36068,COLOR_ATTACHMENT5:36069,COLOR_ATTACHMENT6:36070,COLOR_ATTACHMENT7:36071,COLOR_ATTACHMENT8:36072,COLOR_ATTACHMENT9:36073,COLOR_ATTACHMENT10:36074,COLOR_ATTACHMENT11:36075,COLOR_ATTACHMENT12:36076,COLOR_ATTACHMENT13:36077,COLOR_ATTACHMENT14:36078,COLOR_ATTACHMENT15:36079,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE:36182,MAX_SAMPLES:36183,HALF_FLOAT:5131,RG:33319,RG_INTEGER:33320,R8:33321,RG8:33323,R16F:33325,R32F:33326,RG16F:33327,RG32F:33328,R8I:33329,R8UI:33330,R16I:33331,R16UI:33332,R32I:33333,R32UI:33334,RG8I:33335,RG8UI:33336,RG16I:33337,RG16UI:33338,RG32I:33339,RG32UI:33340,VERTEX_ARRAY_BINDING:34229,R8_SNORM:36756,RG8_SNORM:36757,RGB8_SNORM:36758,RGBA8_SNORM:36759,SIGNED_NORMALIZED:36764,COPY_READ_BUFFER:36662,COPY_WRITE_BUFFER:36663,COPY_READ_BUFFER_BINDING:36662,COPY_WRITE_BUFFER_BINDING:36663,UNIFORM_BUFFER:35345,UNIFORM_BUFFER_BINDING:35368,UNIFORM_BUFFER_START:35369,UNIFORM_BUFFER_SIZE:35370,MAX_VERTEX_UNIFORM_BLOCKS:35371,MAX_FRAGMENT_UNIFORM_BLOCKS:35373,MAX_COMBINED_UNIFORM_BLOCKS:35374,MAX_UNIFORM_BUFFER_BINDINGS:35375,MAX_UNIFORM_BLOCK_SIZE:35376,MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS:35377,MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS:35379,UNIFORM_BUFFER_OFFSET_ALIGNMENT:35380,ACTIVE_UNIFORM_BLOCKS:35382,UNIFORM_TYPE:35383,UNIFORM_SIZE:35384,UNIFORM_BLOCK_INDEX:35386,UNIFORM_OFFSET:35387,UNIFORM_ARRAY_STRIDE:35388,UNIFORM_MATRIX_STRIDE:35389,UNIFORM_IS_ROW_MAJOR:35390,UNIFORM_BLOCK_BINDING:35391,UNIFORM_BLOCK_DATA_SIZE:35392,UNIFORM_BLOCK_ACTIVE_UNIFORMS:35394,UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES:35395,UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER:35396,UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER:35398,INVALID_INDEX:4294967295,MAX_VERTEX_OUTPUT_COMPONENTS:37154,MAX_FRAGMENT_INPUT_COMPONENTS:37157,MAX_SERVER_WAIT_TIMEOUT:37137,OBJECT_TYPE:37138,SYNC_CONDITION:37139,SYNC_STATUS:37140,SYNC_FLAGS:37141,SYNC_FENCE:37142,SYNC_GPU_COMMANDS_COMPLETE:37143,UNSIGNALED:37144,SIGNALED:37145,ALREADY_SIGNALED:37146,TIMEOUT_EXPIRED:37147,CONDITION_SATISFIED:37148,WAIT_FAILED:37149,SYNC_FLUSH_COMMANDS_BIT:1,VERTEX_ATTRIB_ARRAY_DIVISOR:35070,ANY_SAMPLES_PASSED:35887,ANY_SAMPLES_PASSED_CONSERVATIVE:36202,SAMPLER_BINDING:35097,RGB10_A2UI:36975,INT_2_10_10_10_REV:36255,TRANSFORM_FEEDBACK:36386,TRANSFORM_FEEDBACK_PAUSED:36387,TRANSFORM_FEEDBACK_ACTIVE:36388,TRANSFORM_FEEDBACK_BINDING:36389,TEXTURE_IMMUTABLE_FORMAT:37167,MAX_ELEMENT_INDEX:36203,TEXTURE_IMMUTABLE_LEVELS:33503,TIMEOUT_IGNORED:-1,MAX_CLIENT_WAIT_TIMEOUT_WEBGL:37447,QUERY_COUNTER_BITS_EXT:34916,TIME_ELAPSED_EXT:35007,TIMESTAMP_EXT:36392,GPU_DISJOINT_EXT:36795,TEXTURE_MAX_ANISOTROPY_EXT:34046,MAX_TEXTURE_MAX_ANISOTROPY_EXT:34047,UNMASKED_VENDOR_WEBGL:37445,UNMASKED_RENDERER_WEBGL:37446,COMPLETION_STATUS_KHR:37297,COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_EXT:33778,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_SRGB_S3TC_DXT1_EXT:35916,COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT:35917,COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT:35918,COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT:35919,COMPRESSED_R11_EAC:37488,COMPRESSED_SIGNED_R11_EAC:37489,COMPRESSED_RG11_EAC:37490,COMPRESSED_SIGNED_RG11_EAC:37491,COMPRESSED_RGB8_ETC2:37492,COMPRESSED_SRGB8_ETC2:37493,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:37494,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:37495,COMPRESSED_RGBA8_ETC2_EAC:37496,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:37497,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGBA_ASTC_4x4_KHR:37808,COMPRESSED_RGBA_ASTC_5x4_KHR:37809,COMPRESSED_RGBA_ASTC_5x5_KHR:37810,COMPRESSED_RGBA_ASTC_6x5_KHR:37811,COMPRESSED_RGBA_ASTC_6x6_KHR:37812,COMPRESSED_RGBA_ASTC_8x5_KHR:37813,COMPRESSED_RGBA_ASTC_8x6_KHR:37814,COMPRESSED_RGBA_ASTC_8x8_KHR:37815,COMPRESSED_RGBA_ASTC_10x5_KHR:37816,COMPRESSED_RGBA_ASTC_10x6_KHR:37817,COMPRESSED_RGBA_ASTC_10x8_KHR:37818,COMPRESSED_RGBA_ASTC_10x10_KHR:37819,COMPRESSED_RGBA_ASTC_12x10_KHR:37820,COMPRESSED_RGBA_ASTC_12x12_KHR:37821,COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:37840,COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:37841,COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:37842,COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:37843,COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:37844,COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:37845,COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:37846,COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:37847,COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:37848,COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:37849,COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:37850,COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:37851,COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:37852,COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:37853},Bt={[i.BYTE]:1,[i.UNSIGNED_BYTE]:1,[i.SHORT]:2,[i.UNSIGNED_SHORT]:2,[i.INT]:4,[i.UNSIGNED_INT]:4,[i.FLOAT]:4},Wn={[i.R8]:[i.RED,i.UNSIGNED_BYTE],[i.R8_SNORM]:[i.RED,i.BYTE],[i.R16F]:[i.RED,i.FLOAT],[i.R32F]:[i.RED,i.FLOAT],[i.R8UI]:[i.RED_INTEGER,i.UNSIGNED_BYTE],[i.R8I]:[i.RED_INTEGER,i.BYTE],[i.R16UI]:[i.RED_INTEGER,i.UNSIGNED_SHORT],[i.R16I]:[i.RED_INTEGER,i.SHORT],[i.R32UI]:[i.RED_INTEGER,i.UNSIGNED_INT],[i.R32I]:[i.RED_INTEGER,i.INT],[i.RG8]:[i.RG,i.UNSIGNED_BYTE],[i.RG8_SNORM]:[i.RG,i.BYTE],[i.RG16F]:[i.RG,i.FLOAT],[i.RG32F]:[i.RG,i.FLOAT],[i.RG8UI]:[i.RG_INTEGER,i.UNSIGNED_BYTE],[i.RG8I]:[i.RG_INTEGER,i.BYTE],[i.RG16UI]:[i.RG_INTEGER,i.UNSIGNED_SHORT],[i.RG16I]:[i.RG_INTEGER,i.SHORT],[i.RG32UI]:[i.RG_INTEGER,i.UNSIGNED_INT],[i.RG32I]:[i.RG_INTEGER,i.INT],[i.RGB8]:[i.RGB,i.UNSIGNED_BYTE],[i.SRGB8]:[i.RGB,i.UNSIGNED_BYTE],[i.RGB565]:[i.RGB,i.UNSIGNED_SHORT_5_6_5],[i.RGB8_SNORM]:[i.RGB,i.BYTE],[i.R11F_G11F_B10F]:[i.RGB,i.UNSIGNED_INT_10F_11F_11F_REV],[i.RGB9_E5]:[i.RGB,i.UNSIGNED_INT_5_9_9_9_REV],[i.RGB16F]:[i.RGB,i.FLOAT],[i.RGB32F]:[i.RGB,i.FLOAT],[i.RGB8UI]:[i.RGB_INTEGER,i.UNSIGNED_BYTE],[i.RGB8I]:[i.RGB_INTEGER,i.BYTE],[i.RGB16UI]:[i.RGB_INTEGER,i.UNSIGNED_SHORT],[i.RGB16I]:[i.RGB_INTEGER,i.SHORT],[i.RGB32UI]:[i.RGB_INTEGER,i.UNSIGNED_INT],[i.RGB32I]:[i.RGB_INTEGER,i.INT],[i.RGBA8]:[i.RGBA,i.UNSIGNED_BYTE],[i.SRGB8_ALPHA8]:[i.RGBA,i.UNSIGNED_BYTE],[i.RGBA8_SNORM]:[i.RGBA,i.BYTE],[i.RGB5_A1]:[i.RGBA,i.UNSIGNED_SHORT_5_5_5_1],[i.RGBA4]:[i.RGBA,i.UNSIGNED_SHORT_4_4_4_4],[i.RGB10_A2]:[i.RGBA,i.UNSIGNED_INT_2_10_10_10_REV],[i.RGBA16F]:[i.RGBA,i.FLOAT],[i.RGBA32F]:[i.RGBA,i.FLOAT],[i.RGBA8UI]:[i.RGBA_INTEGER,i.UNSIGNED_BYTE],[i.RGBA8I]:[i.RGBA_INTEGER,i.BYTE],[i.RGB10_A2UI]:[i.RGBA_INTEGER,i.UNSIGNED_INT_2_10_10_10_REV],[i.RGBA16UI]:[i.RGBA_INTEGER,i.UNSIGNED_SHORT],[i.RGBA16I]:[i.RGBA_INTEGER,i.SHORT],[i.RGBA32I]:[i.RGBA_INTEGER,i.INT],[i.RGBA32UI]:[i.RGBA_INTEGER,i.UNSIGNED_INT],[i.DEPTH_COMPONENT16]:[i.DEPTH_COMPONENT,i.UNSIGNED_SHORT],[i.DEPTH_COMPONENT24]:[i.DEPTH_COMPONENT,i.UNSIGNED_INT],[i.DEPTH_COMPONENT32F]:[i.DEPTH_COMPONENT,i.FLOAT],[i.DEPTH24_STENCIL8]:[i.DEPTH_STENCIL,i.UNSIGNED_INT_24_8],[i.DEPTH32F_STENCIL8]:[i.DEPTH_STENCIL,i.FLOAT_32_UNSIGNED_INT_24_8_REV]},bt={[i.COMPRESSED_RGB_S3TC_DXT1_EXT]:!0,[i.COMPRESSED_RGBA_S3TC_DXT1_EXT]:!0,[i.COMPRESSED_RGBA_S3TC_DXT3_EXT]:!0,[i.COMPRESSED_RGBA_S3TC_DXT5_EXT]:!0,[i.COMPRESSED_SRGB_S3TC_DXT1_EXT]:!0,[i.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT]:!0,[i.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT]:!0,[i.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT]:!0,[i.COMPRESSED_R11_EAC]:!0,[i.COMPRESSED_SIGNED_R11_EAC]:!0,[i.COMPRESSED_RG11_EAC]:!0,[i.COMPRESSED_SIGNED_RG11_EAC]:!0,[i.COMPRESSED_RGB8_ETC2]:!0,[i.COMPRESSED_SRGB8_ETC2]:!0,[i.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2]:!0,[i.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2]:!0,[i.COMPRESSED_RGBA8_ETC2_EAC]:!0,[i.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC]:!0,[i.COMPRESSED_RGBA_ASTC_4x4_KHR]:!0,[i.COMPRESSED_RGBA_ASTC_5x4_KHR]:!0,[i.COMPRESSED_RGBA_ASTC_5x5_KHR]:!0,[i.COMPRESSED_RGBA_ASTC_6x5_KHR]:!0,[i.COMPRESSED_RGBA_ASTC_6x6_KHR]:!0,[i.COMPRESSED_RGBA_ASTC_8x5_KHR]:!0,[i.COMPRESSED_RGBA_ASTC_8x6_KHR]:!0,[i.COMPRESSED_RGBA_ASTC_8x8_KHR]:!0,[i.COMPRESSED_RGBA_ASTC_10x5_KHR]:!0,[i.COMPRESSED_RGBA_ASTC_10x6_KHR]:!0,[i.COMPRESSED_RGBA_ASTC_10x8_KHR]:!0,[i.COMPRESSED_RGBA_ASTC_10x10_KHR]:!0,[i.COMPRESSED_RGBA_ASTC_12x10_KHR]:!0,[i.COMPRESSED_RGBA_ASTC_12x12_KHR]:!0,[i.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR]:!0,[i.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR]:!0,[i.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR]:!0,[i.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR]:!0,[i.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR]:!0,[i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR]:!0,[i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR]:!0,[i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR]:!0,[i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR]:!0,[i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR]:!0,[i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR]:!0,[i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR]:!0,[i.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR]:!0,[i.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR]:!0,[i.COMPRESSED_RGB_PVRTC_4BPPV1_IMG]:!0,[i.COMPRESSED_RGB_PVRTC_2BPPV1_IMG]:!0,[i.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG]:!0,[i.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG]:!0},q={},Lt=new Array(1),Ze={},Yn={[i.UNSIGNED_BYTE]:{[i.RED]:i.R8,[i.RG]:i.RG8,[i.RGB]:i.RGB8,[i.RGBA]:i.RGBA8},[i.UNSIGNED_SHORT]:{[i.DEPTH_COMPONENT]:i.DEPTH_COMPONENT16},[i.FLOAT]:{[i.RED]:i.R16F,[i.RG]:i.RG16F,[i.RGB]:i.RGB16F,[i.RGBA]:i.RGBA16F,[i.DEPTH_COMPONENT]:i.DEPTH_COMPONENT32F}};class ji{constructor(e,r,n){if(this.gl=e,this.texture=null,this.appState=r,this.compressed=bt[n.internalFormat],n.format!==void 0&&(console.warn("Cubemap option 'format' is deprecated and will be removed. Use 'internalFormat' with a sized format instead."),this.compressed=!!bt[n.format],n.type===void 0&&(n.type=n.format===i.DEPTH_COMPONENT?i.UNSIGNED_SHORT:i.UNSIGNED_BYTE),n.internalFormat===void 0&&(this.compressed?n.internalFormat=n.format:n.internalFormat=Yn[n.type][n.format])),this.compressed)this.internalFormat=n.internalFormat,this.format=n.internalFormat,this.type=i.UNSIGNED_BYTE;else{this.internalFormat=n.internalFormat!==void 0?n.internalFormat:i.RGBA8;let W=Wn[this.internalFormat];this.format=W[0],this.type=n.type!==void 0?n.type:W[1]}this.currentUnit=-1;let s=Array.isArray(n.negX),a=s?n.negX[0]:n.negX,{width:l=a.width,height:o=a.height,flipY:u=!1,premultiplyAlpha:h=!1,minFilter:m=a?i.LINEAR_MIPMAP_NEAREST:i.NEAREST,magFilter:f=a?i.LINEAR:i.NEAREST,wrapS:A=i.REPEAT,wrapT:x=i.REPEAT,compareMode:C=i.NONE,compareFunc:b=i.LEQUAL,minLOD:G=null,maxLOD:B=null,baseLevel:g=null,maxLevel:d=null,maxAnisotropy:V=1}=n;this.width=l,this.height=o,this.flipY=u,this.premultiplyAlpha=h,this.minFilter=m,this.magFilter=f,this.wrapS=A,this.wrapT=x,this.compareMode=C,this.compareFunc=b,this.minLOD=G,this.maxLOD=B,this.baseLevel=g,this.maxLevel=d,this.maxAnisotropy=Math.min(V,q.MAX_TEXTURE_ANISOTROPY),this.mipmaps=m===i.LINEAR_MIPMAP_NEAREST||m===i.LINEAR_MIPMAP_LINEAR,this.miplevelsProvided=s&&n.negX.length>1,this.levels=this.mipmaps?Math.floor(Math.log2(Math.min(this.width,this.height)))+1:1,this.restore(n)}restore(e=Ze){this.texture=this.gl.createTexture(),this.currentUnit!==-1&&(this.appState.textures[this.currentUnit]=null),this.bind(0),this.gl.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_MAG_FILTER,this.magFilter),this.gl.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_MIN_FILTER,this.minFilter),this.gl.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_WRAP_S,this.wrapS),this.gl.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_WRAP_T,this.wrapT),this.gl.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_COMPARE_FUNC,this.compareFunc),this.gl.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_COMPARE_MODE,this.compareMode),this.baseLevel!==null&&this.gl.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_BASE_LEVEL,this.baseLevel),this.maxLevel!==null&&this.gl.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_MAX_LEVEL,this.maxLevel),this.minLOD!==null&&this.gl.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_MIN_LOD,this.minLOD),this.maxLOD!==null&&this.gl.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_MAX_LOD,this.maxLOD),this.maxAnisotropy>1&&this.gl.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_MAX_ANISOTROPY_EXT,this.maxAnisotropy),this.gl.texStorage2D(i.TEXTURE_CUBE_MAP,this.levels,this.internalFormat,this.width,this.height);let{negX:r,posX:n,negY:s,posY:a,negZ:l,posZ:o}=e;return r&&(this.faceData(i.TEXTURE_CUBE_MAP_NEGATIVE_X,r),this.faceData(i.TEXTURE_CUBE_MAP_POSITIVE_X,n),this.faceData(i.TEXTURE_CUBE_MAP_NEGATIVE_Y,s),this.faceData(i.TEXTURE_CUBE_MAP_POSITIVE_Y,a),this.faceData(i.TEXTURE_CUBE_MAP_NEGATIVE_Z,l),this.faceData(i.TEXTURE_CUBE_MAP_POSITIVE_Z,o)),this.mipmaps&&!this.miplevelsProvided&&this.gl.generateMipmap(i.TEXTURE_CUBE_MAP),this}delete(){return this.texture&&(this.gl.deleteTexture(this.texture),this.texture=null,this.appState.textures[this.currentUnit]=null,this.currentUnit=-1),this}faceData(e,r){Array.isArray(r)||(Lt[0]=r,r=Lt);let n=this.mipmaps?r.length:1,s=this.width,a=this.height,l;if(this.gl.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,this.flipY),this.gl.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.premultiplyAlpha),this.compressed)for(l=0;l<n;++l)this.gl.compressedTexSubImage2D(e,l,0,0,s,a,this.format,r[l]),s=Math.max(s>>1,1),a=Math.max(a>>1,1);else for(l=0;l<n;++l)this.gl.texSubImage2D(e,l,0,0,s,a,this.format,this.type,r[l]),s=Math.max(s>>1,1),a=Math.max(a>>1,1);return this}bind(e){let r=this.appState.textures[e];return this.appState.activeTexture!==e&&(this.gl.activeTexture(i.TEXTURE0+e),this.appState.activeTexture=e),r!==this&&(r&&(r.currentUnit=-1),this.currentUnit!==-1&&(this.appState.textures[this.currentUnit]=null),this.gl.bindTexture(i.TEXTURE_CUBE_MAP,this.texture),this.appState.textures[e]=this,this.currentUnit=e),this}}class qi{constructor(e,r,n,s=null,a){this.gl=e,this.currentProgram=n,this.drawPrimitive=i.TRIANGLES,this.currentVertexArray=s,this.currentTransformFeedback=null,this.appState=r,this.uniformIndices={},this.uniformNames=new Array(q.MAX_UNIFORMS),this.uniformValues=new Array(q.MAX_UNIFORMS),this.uniformCount=0,this.uniformBuffers=new Array(q.MAX_UNIFORM_BUFFERS),this.uniformBlockNames=new Array(q.MAX_UNIFORM_BUFFERS),this.uniformBlockCount=0,this.textures=new Array(q.MAX_TEXTURE_UNITS),this.textureCount=0,this.offsets=new Int32Array(1),this.numElements=new Int32Array(1),this.numInstances=new Int32Array(1),this.baseVertices=new Int32Array(1),this.baseInstances=new Uint32Array(1),this.hasBaseInstancesOrBaseVertices=!1,this.missingExtensionWarningDispatched=!1,this.numDraws=1,this.drawCountsFromVertexArray=!0,a!==void 0&&(console.warn("Primitive argument to 'App.createDrawCall' is deprecated and will be removed. Use 'DrawCall.primitive' instead."),this.primitive(a))}primitive(e){return this.drawPrimitive=e,this}transformFeedback(e){return this.currentTransformFeedback=e,this}uniform(e,r){let n=this.uniformIndices[e];return n===void 0&&(n=this.uniformCount++,this.uniformIndices[e]=n,this.uniformNames[n]=e),this.uniformValues[n]=r,this}texture(e,r){let n=this.currentProgram.samplers[e];return this.textures[n]=r,this}uniformBlock(e,r){let n=this.currentProgram.uniformBlocks[e];return this.uniformBuffers[n]=r,this}drawRanges(...e){this.numDraws=e.length,this.offsets.length<this.numDraws&&(this.offsets=new Int32Array(this.numDraws)),this.numElements.length<this.numDraws&&(this.numElements=new Int32Array(this.numDraws)),this.numInstances.length<this.numDraws&&(this.numInstances=new Int32Array(this.numDraws)),this.baseInstances.length<this.numDraws&&(this.baseInstances=new Uint32Array(this.numDraws)),this.baseVertices.length<this.numDraws&&(this.baseVertices=new Int32Array(this.numDraws));for(let r=0;r<this.numDraws;++r){let n=e[r];this.offsets[r]=n[0],this.numElements[r]=n[1],this.numInstances[r]=n[2]||1,this.baseInstances[r]=n[3]||0,this.baseVertices[r]=n[4]||0,this.hasBaseVertices=this.hasBaseVertices||this.baseVertices[r],this.hasBaseInstances=this.hasBaseInstances||this.baseInstances[r],this.hasBaseInstancesOrBaseVertices=this.hasBaseInstances||this.hasBaseVertices}return this.drawCountsFromVertexArray=!1,this}draw(){let e=this.uniformNames,r=this.uniformValues,n=this.uniformBuffers,s=this.currentProgram.uniformBlockCount,a=this.textures,l=this.currentProgram.samplerCount,o=!1;this.currentProgram.bind(),this.currentVertexArray&&(this.currentVertexArray.bind(),o=this.currentVertexArray.indexed,this.drawCountsFromVertexArray&&(this.numElements[0]=this.currentVertexArray.numElements,this.numInstances[0]=this.currentVertexArray.numInstances));for(let u=0;u<this.uniformCount;++u)this.currentProgram.uniform(e[u],r[u]);for(let u=0;u<s;++u)n[u].bind(u);for(let u=0;u<l;++u)a[u].bind(u);if(this.currentTransformFeedback?(this.currentTransformFeedback.bind(),this.gl.beginTransformFeedback(this.drawPrimitive)):this.appState.transformFeedback&&(this.gl.bindTransformFeedback(i.TRANSFORM_FEEDBACK,null),this.appState.transformFeedback=null),this.hasBaseInstancesOrBaseVertices&&!(q.DRAW_INSTANCED_BASE_VERTEX_BASE_INSTANCE||q.MULTI_DRAW_INSTANCED_BASE_VERTEX_BASE_INSTANCE)&&!this.missingExtensionWarningDispatched&&(console.warn("DrawCall.draw 'baseInstances' or 'baseVertices' have been set but supporting WebGL extensions are not available; Without 'WEBGL_multidraw_instanced_base_vertex_base_instance' or 'WEBGL_draw_instanced_base_vertex_base_instance' are needed for optimal performance."),this.missingExtensionWarningDispatched=!0),q.MULTI_DRAW_INSTANCED_BASE_VERTEX_BASE_INSTANCE){let u=this.appState.extensions.multiDrawInstancedBaseVertexBaseInstance;o?u.multiDrawElementsInstancedBaseVertexBaseInstanceWEBGL(this.drawPrimitive,this.numElements,0,this.currentVertexArray.indexType,this.offsets,0,this.numInstances,0,this.baseVertices,0,this.baseInstances,0,this.numDraws):u.multiDrawArraysInstancedBaseInstanceWEBGL(this.drawPrimitive,this.offsets,0,this.numElements,0,this.numInstances,0,this.baseInstances,0,this.numDraws)}else if(this.hasBaseInstancesOrBaseVertices&&q.DRAW_INSTANCED_BASE_VERTEX_BASE_INSTANCE){let u=this.appState.extensions.drawInstancedBaseVertexBaseInstance;if(o)for(let h=0;h<this.numDraws;++h)u.drawElementsInstancedBaseVertexBaseInstanceWEBGL(this.drawPrimitive,this.numElements[h],this.currentVertexArray.indexType,this.offsets[h],this.numInstances[h],this.baseVertices[h],this.baseInstances[h]);else for(let h=0;h<this.numDraws;++h)u.drawArraysInstancedBaseInstanceWEBGL(this.drawPrimitive,this.offsets[h],this.numElements[h],this.numInstances[h],this.baseInstances[h])}else if(q.MULTI_DRAW_INSTANCED&&!this.hasBaseInstancesOrBaseVertices){let u=this.appState.extensions.multiDrawInstanced;o?u.multiDrawElementsInstancedWEBGL(this.drawPrimitive,this.numElements,0,this.currentVertexArray.indexType,this.offsets,0,this.numInstances,0,this.numDraws):u.multiDrawArraysInstancedWEBGL(this.drawPrimitive,this.offsets,0,this.numElements,0,this.numInstances,0,this.numDraws)}else if(o)for(let u=0;u<this.numDraws;++u)this.hasBaseInstances&&this.currentVertexArray&&this.currentVertexArray.baseOffsetInstanceAttributeBuffers(this.baseInstances[u]),this.gl.drawElementsInstanced(this.drawPrimitive,this.numElements[u],this.currentVertexArray.indexType,this.offsets[u],this.numInstances[u]);else for(let u=0;u<this.numDraws;++u)this.hasBaseInstances&&this.currentVertexArray&&this.currentVertexArray.baseOffsetInstanceAttributeBuffers(this.baseInstances[u]),this.gl.drawArraysInstanced(this.drawPrimitive,this.offsets[u],this.numElements[u],this.numInstances[u]);return this.currentTransformFeedback&&this.gl.endTransformFeedback(),this}}class ft{constructor(e,r,n,s,a=s.width,l=s.height,o,u,h=Ze){if(this.gl=e,this.binding=n,this.texture=null,this.width=a||0,this.height=l||0,this.depth=o||0,this.is3D=u,this.appState=r,this.compressed=!!bt[h.internalFormat],h.format!==void 0&&(console.warn("Texture option 'format' is deprecated and will be removed. Use 'internalFormat' with a sized format instead."),this.compressed=!!bt[h.format],h.type===void 0&&(h.type=h.format===i.DEPTH_COMPONENT?i.UNSIGNED_SHORT:i.UNSIGNED_BYTE),h.internalFormat===void 0&&(this.compressed?h.internalFormat=h.format:h.internalFormat=Yn[h.type][h.format])),this.compressed)this.internalFormat=h.internalFormat,this.format=this.internalFormat,this.type=i.UNSIGNED_BYTE;else{this.internalFormat=h.internalFormat!==void 0?h.internalFormat:i.RGBA8;let ee=Wn[this.internalFormat];this.format=ee[0],this.type=h.type!==void 0?h.type:ee[1]}this.currentUnit=-1;let{minFilter:m=s?i.LINEAR_MIPMAP_NEAREST:i.NEAREST,magFilter:f=s?i.LINEAR:i.NEAREST,wrapS:A=i.REPEAT,wrapT:x=i.REPEAT,wrapR:C=i.REPEAT,compareMode:b=i.NONE,compareFunc:G=i.LEQUAL,minLOD:B=null,maxLOD:g=null,baseLevel:d=null,maxLevel:V=null,maxAnisotropy:W=1,flipY:k=!1,premultiplyAlpha:Y=!1}=h;this.minFilter=m,this.magFilter=f,this.wrapS=A,this.wrapT=x,this.wrapR=C,this.compareMode=b,this.compareFunc=G,this.minLOD=B,this.maxLOD=g,this.baseLevel=d,this.maxLevel=V,this.maxAnisotropy=Math.min(W,q.MAX_TEXTURE_ANISOTROPY),this.flipY=k,this.premultiplyAlpha=Y,this.mipmaps=m===i.LINEAR_MIPMAP_NEAREST||m===i.LINEAR_MIPMAP_LINEAR,this.restore(s)}restore(e){return this.texture=null,this.resize(this.width,this.height,this.depth),e&&this.data(e),this}resize(e,r,n){if(n=n||0,this.texture&&e===this.width&&r===this.height&&n===this.depth)return this;this.gl.deleteTexture(this.texture),this.currentUnit!==-1&&(this.appState.textures[this.currentUnit]=null),this.texture=this.gl.createTexture(),this.bind(Math.max(this.currentUnit,0)),this.width=e,this.height=r,this.depth=n,this.gl.texParameteri(this.binding,i.TEXTURE_MIN_FILTER,this.minFilter),this.gl.texParameteri(this.binding,i.TEXTURE_MAG_FILTER,this.magFilter),this.gl.texParameteri(this.binding,i.TEXTURE_WRAP_S,this.wrapS),this.gl.texParameteri(this.binding,i.TEXTURE_WRAP_T,this.wrapT),this.gl.texParameteri(this.binding,i.TEXTURE_WRAP_R,this.wrapR),this.gl.texParameteri(this.binding,i.TEXTURE_COMPARE_FUNC,this.compareFunc),this.gl.texParameteri(this.binding,i.TEXTURE_COMPARE_MODE,this.compareMode),this.minLOD!==null&&this.gl.texParameterf(this.binding,i.TEXTURE_MIN_LOD,this.minLOD),this.maxLOD!==null&&this.gl.texParameterf(this.binding,i.TEXTURE_MAX_LOD,this.maxLOD),this.baseLevel!==null&&this.gl.texParameteri(this.binding,i.TEXTURE_BASE_LEVEL,this.baseLevel),this.maxLevel!==null&&this.gl.texParameteri(this.binding,i.TEXTURE_MAX_LEVEL,this.maxLevel),this.maxAnisotropy>1&&this.gl.texParameteri(this.binding,i.TEXTURE_MAX_ANISOTROPY_EXT,this.maxAnisotropy);let s;return this.is3D?(this.mipmaps?s=Math.floor(Math.log2(Math.max(Math.max(this.width,this.height),this.depth)))+1:s=1,this.gl.texStorage3D(this.binding,s,this.internalFormat,this.width,this.height,this.depth)):(this.mipmaps?s=Math.floor(Math.log2(Math.max(this.width,this.height)))+1:s=1,this.gl.texStorage2D(this.binding,s,this.internalFormat,this.width,this.height)),this}data(e){Array.isArray(e)||(Lt[0]=e,e=Lt);let r=this.mipmaps?e.length:1,n=this.width,s=this.height,a=this.depth,l=this.mipmaps&&e.length===1,o;if(this.bind(Math.max(this.currentUnit,0)),this.gl.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,this.flipY),this.gl.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.premultiplyAlpha),this.compressed)if(this.is3D)for(o=0;o<r;++o)this.gl.compressedTexSubImage3D(this.binding,o,0,0,0,n,s,a,this.format,e[o]),n=Math.max(n>>1,1),s=Math.max(s>>1,1),a=Math.max(a>>1,1);else for(o=0;o<r;++o)this.gl.compressedTexSubImage2D(this.binding,o,0,0,n,s,this.format,e[o]),n=Math.max(n>>1,1),s=Math.max(s>>1,1);else if(this.is3D)for(o=0;o<r;++o)this.gl.texSubImage3D(this.binding,o,0,0,0,n,s,a,this.format,this.type,e[o]),n=Math.max(n>>1,1),s=Math.max(s>>1,1),a=Math.max(a>>1,1);else for(o=0;o<r;++o)this.gl.texSubImage2D(this.binding,o,0,0,n,s,this.format,this.type,e[o]),n=Math.max(n>>1,1),s=Math.max(s>>1,1);return l&&this.gl.generateMipmap(this.binding),this}delete(){return this.texture&&(this.gl.deleteTexture(this.texture),this.texture=null,this.currentUnit!==-1&&this.appState.textures[this.currentUnit]===this&&(this.appState.textures[this.currentUnit]=null,this.currentUnit=-1)),this}bind(e){let r=this.appState.textures[e];return this.appState.activeTexture!==e&&(this.gl.activeTexture(i.TEXTURE0+e),this.appState.activeTexture=e),r!==this&&(r&&(r.currentUnit=-1),this.currentUnit!==-1&&(this.appState.textures[this.currentUnit]=null),this.gl.bindTexture(this.binding,this.texture),this.appState.textures[e]=this,this.currentUnit=e),this}}class Nr{constructor(e,r,n,s,a=0){this.gl=e,this.renderbuffer=null,this.width=r,this.height=n,this.internalFormat=s,this.samples=a,this.restore()}restore(){return this.renderbuffer=this.gl.createRenderbuffer(),this.resize(this.width,this.height),this}resize(e,r){return this.width=e,this.height=r,this.gl.bindRenderbuffer(i.RENDERBUFFER,this.renderbuffer),this.gl.renderbufferStorageMultisample(i.RENDERBUFFER,this.samples,this.internalFormat,this.width,this.height),this.gl.bindRenderbuffer(i.RENDERBUFFER,null),this}delete(){return this.gl.deleteRenderbuffer(this.renderbuffer),this.renderbuffer=null,this}}class Zi{constructor(e,r){this.gl=e,this.framebuffer=null,this.appState=r,this.numColorTargets=0,this.colorAttachments=[],this.colorAttachmentEnums=[],this.colorAttachmentTargets=[],this.depthAttachment=null,this.depthAttachmentTarget=null,this.width=0,this.height=0,this.restore()}restore(){let e=this.appState.framebuffers;for(let r in e)e[r]===this&&(e[r]=null);return this.framebuffer=this.gl.createFramebuffer(),this}colorTarget(e,r,n=r.is3D?0:i.TEXTURE_2D){if(e>=this.numColorTargets){let l=e+1;this.colorAttachmentEnums.length=l,this.colorAttachments.length=l,this.colorAttachmentTargets.length=l;for(let o=this.numColorTargets;o<l-1;++o)this.colorAttachmentEnums[o]=i.NONE,this.colorAttachments[o]=null,this.colorAttachmentTargets[o]=0;this.numColorTargets=l}this.colorAttachmentEnums[e]=i.COLOR_ATTACHMENT0+e,this.colorAttachments[e]=r,this.colorAttachmentTargets[e]=n;let s=this.bindAndCaptureState(),a=this.appState.drawFramebufferBinding;return r instanceof Nr?this.gl.framebufferRenderbuffer(a,this.colorAttachmentEnums[e],i.RENDERBUFFER,r.renderbuffer):r.is3D?this.gl.framebufferTextureLayer(a,this.colorAttachmentEnums[e],r.texture,0,n):this.gl.framebufferTexture2D(a,this.colorAttachmentEnums[e],n,r.texture,0),this.gl.drawBuffers(this.colorAttachmentEnums),this.width=r.width,this.height=r.height,this.restoreState(s),this}depthTarget(e,r=e.is3D?0:i.TEXTURE_2D){let n=this.bindAndCaptureState(),s=this.appState.drawFramebufferBinding;return this.depthAttachment=e,this.depthAttachmentTarget=r,e instanceof Nr?this.gl.framebufferRenderbuffer(s,i.DEPTH_ATTACHMENT,i.RENDERBUFFER,e.renderbuffer):e.is3D?this.gl.framebufferTextureLayer(s,i.DEPTH_ATTACHMENT,e.texture,0,r):this.gl.framebufferTexture2D(s,i.DEPTH_ATTACHMENT,r,e.texture,0),this.width=e.width,this.height=e.height,this.restoreState(n),this}resize(e=this.gl.drawingBufferWidth,r=this.gl.drawingBufferHeight){let n=this.bindAndCaptureState(),s=this.appState.drawFramebufferBinding;for(let a=0;a<this.numColorTargets;++a){let l=this.colorAttachments[a];l&&(l.resize(e,r),l instanceof ft&&(l.is3D?this.gl.framebufferTextureLayer(s,this.colorAttachmentEnums[a],l.texture,0,this.colorAttachmentTargets[a]):this.gl.framebufferTexture2D(s,this.colorAttachmentEnums[a],this.colorAttachmentTargets[a],l.texture,0)))}return this.depthAttachment&&(this.depthAttachment.resize(e,r),this.depthAttachment instanceof ft&&(this.depthAttachment.is3D?this.gl.framebufferTextureLayer(s,i.DEPTH_ATTACHMENT,this.depthAttachment.texture,0,this.depthAttachmentTarget):this.gl.framebufferTexture2D(s,i.DEPTH_ATTACHMENT,this.depthAttachmentTarget,this.depthAttachment.texture,0))),this.width=e,this.height=r,this.restoreState(n),this}delete(){if(this.framebuffer){this.gl.deleteFramebuffer(this.framebuffer),this.framebuffer=null;let e=this.appState.framebuffers;for(let r in e)e[r]===this&&(this.gl.bindFramebuffer(r,null),e[r]=null)}return this}getStatus(){let e=this.bindAndCaptureState(),r=this.appState.drawFramebufferBinding,n=this.gl.checkFramebufferStatus(r);return this.restoreState(e),n}bindForDraw(){let e=this.appState.drawFramebufferBinding,r=this.appState.framebuffers;return r[e]!==this&&(this.gl.bindFramebuffer(e,this.framebuffer),r[e]=this),this}bindForRead(){let e=this.appState.readFramebufferBinding,r=this.appState.framebuffers;return r[e]!==this&&(this.gl.bindFramebuffer(e,this.framebuffer),r[e]=this),this}bindAndCaptureState(){let e=this.appState.drawFramebufferBinding,r=this.appState.framebuffers[e];return r!==this&&this.gl.bindFramebuffer(e,this.framebuffer),r}restoreState(e){if(e!==this){let r=this.appState.drawFramebufferBinding;this.gl.bindFramebuffer(r,e?e.framebuffer:null)}return this}get colorTextures(){return console.error("Framebuffer.colorTextures is deprecated and will be removed. Please use Framebuffer.colorAttachments."),this.colorAttachments}get depthTexture(){return console.error("Framebuffer.depthTexture is deprecated and will be removed. Please use Framebuffer.depthAttachment."),this.depthAttachment}}class ht{constructor(e,r,n,s){this.gl=e,this.appState=r,this.shader=null,this.type=n,this.source=s.trim(),this.restore()}restore(){return this.shader=this.gl.createShader(this.type),this.gl.shaderSource(this.shader,this.source),this.gl.compileShader(this.shader),this}translatedSource(){return q.DEBUG_SHADERS?this.appState.extensions.debugShaders.getTranslatedShaderSource(this.shader):"(Unavailable)"}delete(){return this.shader&&(this.gl.deleteShader(this.shader),this.shader=null),this}checkCompilation(){if(!this.gl.getShaderParameter(this.shader,i.COMPILE_STATUS)){let e,r;for(console.error(this.gl.getShaderInfoLog(this.shader)),r=this.source.split(`
`),e=0;e<r.length;++e)console.error(`${e+1}: ${r[e]}`)}return this}}const Z={};Z[i.BOOL]="uniform1i";Z[i.INT]="uniform1i";Z[i.SAMPLER_2D]="uniform1i";Z[i.INT_SAMPLER_2D]="uniform1i";Z[i.UNSIGNED_INT_SAMPLER_2D]="uniform1i";Z[i.SAMPLER_2D_SHADOW]="uniform1i";Z[i.SAMPLER_2D_ARRAY]="uniform1i";Z[i.INT_SAMPLER_2D_ARRAY]="uniform1i";Z[i.UNSIGNED_INT_SAMPLER_2D_ARRAY]="uniform1i";Z[i.SAMPLER_2D_ARRAY_SHADOW]="uniform1i";Z[i.SAMPLER_CUBE]="uniform1i";Z[i.INT_SAMPLER_CUBE]="uniform1i";Z[i.UNSIGNED_INT_SAMPLER_CUBE]="uniform1i";Z[i.SAMPLER_CUBE_SHADOW]="uniform1i";Z[i.SAMPLER_3D]="uniform1i";Z[i.INT_SAMPLER_3D]="uniform1i";Z[i.UNSIGNED_INT_SAMPLER_3D]="uniform1i";Z[i.UNSIGNED_INT]="uniform1ui";Z[i.FLOAT]="uniform1f";Z[i.FLOAT_VEC2]="uniform2f";Z[i.FLOAT_VEC3]="uniform3f";Z[i.FLOAT_VEC4]="uniform4f";Z[i.INT_VEC2]="uniform2i";Z[i.INT_VEC3]="uniform3i";Z[i.INT_VEC4]="uniform4i";Z[i.UNSIGNED_INT_VEC2]="uniform2ui";Z[i.UNSIGNED_INT_VEC3]="uniform3ui";Z[i.UNSIGNED_INT_VEC4]="uniform4ui";Z[i.BOOL_VEC2]="uniform2i";Z[i.BOOL_VEC3]="uniform3i";Z[i.BOOL_VEC4]="uniform4i";Z[i.FLOAT_MAT2]="uniformMatrix2fv";Z[i.FLOAT_MAT3]="uniformMatrix3fv";Z[i.FLOAT_MAT4]="uniformMatrix4fv";Z[i.FLOAT_MAT2x3]="uniformMatrix2x3fv";Z[i.FLOAT_MAT2x4]="uniformMatrix2x4fv";Z[i.FLOAT_MAT3x2]="uniformMatrix3x2fv";Z[i.FLOAT_MAT3x4]="uniformMatrix3x4fv";Z[i.FLOAT_MAT4x2]="uniformMatrix4x2fv";Z[i.FLOAT_MAT4x3]="uniformMatrix4x3fv";const J={};J[i.BOOL]=1;J[i.INT]=1;J[i.SAMPLER_2D]=1;J[i.INT_SAMPLER_2D]=1;J[i.UNSIGNED_INT_SAMPLER_2D]=1;J[i.SAMPLER_2D_SHADOW]=1;J[i.SAMPLER_2D_ARRAY]=1;J[i.INT_SAMPLER_2D_ARRAY]=1;J[i.UNSIGNED_INT_SAMPLER_2D_ARRAY]=1;J[i.SAMPLER_2D_ARRAY_SHADOW]=1;J[i.SAMPLER_CUBE]=1;J[i.INT_SAMPLER_CUBE]=1;J[i.UNSIGNED_INT_SAMPLER_CUBE]=1;J[i.SAMPLER_CUBE_SHADOW]=1;J[i.SAMPLER_3D]=1;J[i.INT_SAMPLER_3D]=1;J[i.UNSIGNED_INT_SAMPLER_3D]=1;J[i.UNSIGNED_INT]=1;J[i.FLOAT]=1;J[i.FLOAT_VEC2]=2;J[i.FLOAT_VEC3]=3;J[i.FLOAT_VEC4]=4;J[i.INT_VEC2]=2;J[i.INT_VEC3]=3;J[i.INT_VEC4]=4;J[i.UNSIGNED_INT_VEC2]=2;J[i.UNSIGNED_INT_VEC3]=3;J[i.UNSIGNED_INT_VEC4]=4;J[i.BOOL_VEC2]=2;J[i.BOOL_VEC3]=3;J[i.BOOL_VEC4]=4;J[i.FLOAT_MAT2]=4;J[i.FLOAT_MAT3]=9;J[i.FLOAT_MAT4]=16;J[i.FLOAT_MAT2x3]=6;J[i.FLOAT_MAT2x4]=8;J[i.FLOAT_MAT3x2]=6;J[i.FLOAT_MAT3x4]=12;J[i.FLOAT_MAT4x2]=8;J[i.FLOAT_MAT4x3]=12;const ce={};ce[i.INT]=Int32Array;ce[i.SAMPLER_2D]=Int32Array;ce[i.INT_SAMPLER_2D]=Int32Array;ce[i.UNSIGNED_INT_SAMPLER_2D]=Int32Array;ce[i.SAMPLER_2D_SHADOW]=Int32Array;ce[i.SAMPLER_2D_ARRAY]=Int32Array;ce[i.INT_SAMPLER_2D_ARRAY]=Int32Array;ce[i.UNSIGNED_INT_SAMPLER_2D_ARRAY]=Int32Array;ce[i.SAMPLER_2D_ARRAY_SHADOW]=Int32Array;ce[i.SAMPLER_CUBE]=Int32Array;ce[i.INT_SAMPLER_CUBE]=Int32Array;ce[i.UNSIGNED_INT_SAMPLER_CUBE]=Int32Array;ce[i.SAMPLER_CUBE_SHADOW]=Int32Array;ce[i.SAMPLER_3D]=Int32Array;ce[i.INT_SAMPLER_3D]=Int32Array;ce[i.UNSIGNED_INT_SAMPLER_3D]=Int32Array;ce[i.UNSIGNED_INT]=Uint32Array;ce[i.FLOAT]=Float32Array;ce[i.FLOAT_VEC2]=Float32Array;ce[i.FLOAT_VEC3]=Float32Array;ce[i.FLOAT_VEC4]=Float32Array;ce[i.INT_VEC2]=Int32Array;ce[i.INT_VEC3]=Int32Array;ce[i.INT_VEC4]=Int32Array;ce[i.UNSIGNED_INT_VEC2]=Uint32Array;ce[i.UNSIGNED_INT_VEC3]=Uint32Array;ce[i.UNSIGNED_INT_VEC4]=Uint32Array;class qr{constructor(e,r,n){this.gl=e,this.handle=r,this.glFuncName=Z[n],this.cache=n===i.BOOL?!1:0}set(e){this.cache!==e&&(this.gl[this.glFuncName](this.handle,e),this.cache=e)}}class Zr{constructor(e,r,n,s){this.gl=e,this.handle=r,this.glFuncName=Z[n]+"v",this.count=s,this.cache=new ce[n](J[n]*s)}set(e){for(let r=0,n=e.length;r<n;++r)if(this.cache[r]!==e[r]){this.gl[this.glFuncName](this.handle,e),this.cache.set(e);return}}}class Qr{constructor(e,r,n,s){this.gl=e,this.handle=r,this.glFuncName=Z[n]+"v",this.count=s,this.cache=new Array(J[n]*s).fill(!1)}set(e){for(let r=0,n=e.length;r<n;++r)if(this.cache[r]!==e[r]){this.gl[this.glFuncName](this.handle,e);for(let s=r;s<n;s++)this.cache[s]=e[s];return}}}class Qi{constructor(e,r,n,s){this.gl=e,this.handle=r,this.glFuncName=Z[n],this.count=s,this.cache=new Float32Array(J[n]*s)}set(e){for(let r=0,n=e.length;r<n;++r)if(this.cache[r]!==e[r]){this.gl[this.glFuncName](this.handle,!1,e),this.cache.set(e);return}}}class Jr{constructor(e,r,n,s,a,l,o){this.gl=e,this.appState=r,this.program=null,this.transformFeedbackVaryings=a||null,this.transformFeedbackMode=o||i.SEPARATE_ATTRIBS,this.attributeLocations=l||null,this.uniforms={},this.uniformBlocks={},this.uniformBlockCount=0,this.samplers={},this.samplerCount=0,this.vertexSource=null,this.vertexShader=null,this.fragmentSource=null,this.fragmentShader=null,this.linked=!1,typeof n=="string"?this.vertexSource=n:this.vertexShader=n,typeof s=="string"?this.fragmentSource=s:this.fragmentShader=s,this.initialize()}restore(){return this.initialize(),this.link(),this.checkLinkage(),this}translatedVertexSource(){if(this.vertexShader)return this.vertexShader.translatedSource();{let e=new ht(this.gl,this.appState,i.VERTEX_SHADER,this.vertexSource),r=e.translatedSource();return e.delete(),r}}translatedFragmentSource(){if(this.fragmentShader)return this.fragmentShader.translatedSource();{let e=new ht(this.gl,this.appState,i.FRAGMENT_SHADER,this.fragmentSource),r=e.translatedSource();return e.delete(),r}}delete(){return this.program&&(this.gl.deleteProgram(this.program),this.program=null,this.appState.program===this&&(this.gl.useProgram(null),this.appState.program=null)),this}initialize(){return this.appState.program===this&&(this.gl.useProgram(null),this.appState.program=null),this.linked=!1,this.uniformBlockCount=0,this.samplerCount=0,this.vertexSource&&(this.vertexShader=new ht(this.gl,this.appState,i.VERTEX_SHADER,this.vertexSource)),this.fragmentSource&&(this.fragmentShader=new ht(this.gl,this.appState,i.FRAGMENT_SHADER,this.fragmentSource)),this.program=this.gl.createProgram(),this}link(){if(this.gl.attachShader(this.program,this.vertexShader.shader),this.gl.attachShader(this.program,this.fragmentShader.shader),this.transformFeedbackVaryings&&this.gl.transformFeedbackVaryings(this.program,this.transformFeedbackVaryings,this.transformFeedbackMode),this.attributeLocations)for(let e in this.attributeLocations)this.gl.bindAttribLocation(this.program,this.attributeLocations[e],e);return this.gl.linkProgram(this.program),this}checkCompletion(){return q.PARALLEL_SHADER_COMPILE?this.gl.getProgramParameter(this.program,i.COMPLETION_STATUS_KHR):!0}checkLinkage(){return this.linked?this:(this.gl.getProgramParameter(this.program,i.LINK_STATUS)?(this.linked=!0,this.initVariables()):(console.error(this.gl.getProgramInfoLog(this.program)),this.vertexShader.checkCompilation(),this.fragmentShader.checkCompilation()),this.vertexSource&&(this.vertexShader.delete(),this.vertexShader=null),this.fragmentSource&&(this.fragmentShader.delete(),this.fragmentShader=null),this)}initVariables(){this.bind();let e=this.gl.getProgramParameter(this.program,i.ACTIVE_UNIFORMS),r;for(let s=0;s<e;++s){let a=this.gl.getActiveUniform(this.program,s),l=this.gl.getUniformLocation(this.program,a.name),o=null,u=a.type,h=a.size;switch(u){case i.SAMPLER_2D:case i.INT_SAMPLER_2D:case i.UNSIGNED_INT_SAMPLER_2D:case i.SAMPLER_2D_SHADOW:case i.SAMPLER_2D_ARRAY:case i.INT_SAMPLER_2D_ARRAY:case i.UNSIGNED_INT_SAMPLER_2D_ARRAY:case i.SAMPLER_2D_ARRAY_SHADOW:case i.SAMPLER_CUBE:case i.INT_SAMPLER_CUBE:case i.UNSIGNED_INT_SAMPLER_CUBE:case i.SAMPLER_CUBE_SHADOW:case i.SAMPLER_3D:case i.INT_SAMPLER_3D:case i.UNSIGNED_INT_SAMPLER_3D:r=this.samplerCount++,this.samplers[a.name]=r,this.gl.uniform1i(l,r);break;case i.INT:case i.UNSIGNED_INT:case i.FLOAT:o=h>1?Zr:qr;break;case i.BOOL:o=h>1?Qr:qr;break;case i.FLOAT_VEC2:case i.INT_VEC2:case i.UNSIGNED_INT_VEC2:case i.FLOAT_VEC3:case i.INT_VEC3:case i.UNSIGNED_INT_VEC3:case i.FLOAT_VEC4:case i.INT_VEC4:case i.UNSIGNED_INT_VEC4:o=Zr;break;case i.BOOL_VEC2:case i.BOOL_VEC3:case i.BOOL_VEC4:o=Qr;break;case i.FLOAT_MAT2:case i.FLOAT_MAT3:case i.FLOAT_MAT4:case i.FLOAT_MAT2x3:case i.FLOAT_MAT2x4:case i.FLOAT_MAT3x2:case i.FLOAT_MAT3x4:case i.FLOAT_MAT4x2:case i.FLOAT_MAT4x3:o=Qi;break;default:console.error("Unrecognized type for uniform ",a.name);break}o&&(this.uniforms[a.name]=new o(this.gl,l,u,h))}let n=this.gl.getProgramParameter(this.program,i.ACTIVE_UNIFORM_BLOCKS);for(let s=0;s<n;++s){let a=this.gl.getActiveUniformBlockName(this.program,s),l=this.gl.getUniformBlockIndex(this.program,a),o=this.uniformBlockCount++;this.gl.uniformBlockBinding(this.program,l,o),this.uniformBlocks[a]=o}}uniform(e,r){return this.uniforms[e]&&this.uniforms[e].set(r),this}bind(){return this.appState.program!==this&&(this.gl.useProgram(this.program),this.appState.program=this),this}}class jn{constructor(e,r){this.gl=e,this.query=null,this.target=r,this.active=!1,this.result=null,this.restore()}restore(){return this.query=this.gl.createQuery(),this.active=!1,this.result=null,this}begin(){return this.active||(this.gl.beginQuery(this.target,this.query),this.result=null),this}end(){return this.active||(this.gl.endQuery(this.target),this.active=!0),this}ready(){return this.active&&this.gl.getQueryParameter(this.query,i.QUERY_RESULT_AVAILABLE)?(this.active=!1,this.result=Number(this.gl.getQueryParameter(this.query,i.QUERY_RESULT)),!0):!1}delete(){return this.query&&(this.gl.deleteQuery(this.query),this.query=null),this}}class Ji{constructor(e){this.gl=e,this.cpuTimer=window.performance||window.Date,this.gpuTimerQuery=null,this.cpuStartTime=0,this.cpuTime=0,this.gpuTime=0,this.restore()}restore(){return q.GPU_TIMER&&(this.gpuTimerQuery?this.gpuTimerQuery.restore():this.gpuTimerQuery=new jn(this.gl,i.TIME_ELAPSED_EXT)),this.cpuStartTime=0,this.cpuTime=0,this.gpuTime=0,this}start(){return q.GPU_TIMER?this.gpuTimerQuery.active||(this.gpuTimerQuery.begin(),this.cpuStartTime=this.cpuTimer.now()):this.cpuStartTime=this.cpuTimer.now(),this}end(){return q.GPU_TIMER?this.gpuTimerQuery.active||(this.gpuTimerQuery.end(),this.cpuTime=this.cpuTimer.now()-this.cpuStartTime):this.cpuTime=this.cpuTimer.now()-this.cpuStartTime,this}ready(){if(q.GPU_TIMER){if(!this.gpuTimerQuery.active)return!1;var e=this.gpuTimerQuery.ready(),r=this.gl.getParameter(i.GPU_DISJOINT_EXT);return e&&!r?(this.gpuTime=this.gpuTimerQuery.result/1e6,!0):!1}else return!!this.cpuStartTime}delete(){return this.gpuTimerQuery&&(this.gpuTimerQuery.delete(),this.gpuTimerQuery=null),this}}class es{constructor(e,r){this.gl=e,this.appState=r,this.transformFeedback=null,this.restore()}restore(){return this.appState.transformFeedback===this&&(this.appState.transformFeedback=null),this.transformFeedback=this.gl.createTransformFeedback(),this}feedbackBuffer(e,r){return this.gl.bindTransformFeedback(i.TRANSFORM_FEEDBACK,this.transformFeedback),this.gl.bindBufferBase(i.TRANSFORM_FEEDBACK_BUFFER,e,r.buffer),this.gl.bindTransformFeedback(i.TRANSFORM_FEEDBACK,null),this.gl.bindBufferBase(i.TRANSFORM_FEEDBACK_BUFFER,e,null),this}delete(){return this.transformFeedback&&(this.gl.deleteTransformFeedback(this.transformFeedback),this.transformFeedback=null,this.appState.transformFeedback===this&&(this.gl.bindTransformFeedback(i.TRANSFORM_FEEDBACK,null),this.appState.transformFeedback=null)),this}bind(){return this.appState.transformFeedback!==this&&(this.gl.bindTransformFeedback(i.TRANSFORM_FEEDBACK,this.transformFeedback),this.appState.transformFeedback=this),this}}class ts{constructor(e,r,n,s=e.DYNAMIC_DRAW){this.gl=e,this.buffer=null,this.dataViews={},this.offsets=new Array(n.length),this.sizes=new Array(n.length),this.types=new Array(n.length),this.size=0,this.usage=s,this.appState=r,this.currentBase=-1;for(let a=0,l=n.length;a<l;++a){let o=n[a];switch(o){case i.FLOAT:case i.INT:case i.UNSIGNED_INT:case i.BOOL:this.offsets[a]=this.size,this.sizes[a]=1,o===i.INT?this.types[a]=i.INT:o===i.UNSIGNED_INT?this.types[a]=i.UNSIGNED_INT:this.types[a]=i.FLOAT,this.size++;break;case i.FLOAT_VEC2:case i.INT_VEC2:case i.UNSIGNED_INT_VEC2:case i.BOOL_VEC2:this.size+=this.size%2,this.offsets[a]=this.size,this.sizes[a]=2,o===i.INT_VEC2?this.types[a]=i.INT:o===i.UNSIGNED_INT_VEC2?this.types[a]=i.UNSIGNED_INT:this.types[a]=i.FLOAT,this.size+=2;break;case i.FLOAT_VEC3:case i.INT_VEC3:case i.UNSIGNED_INT_VEC3:case i.BOOL_VEC3:case i.FLOAT_VEC4:case i.INT_VEC4:case i.UNSIGNED_INT_VEC4:case i.BOOL_VEC4:this.size+=(4-this.size%4)%4,this.offsets[a]=this.size,this.sizes[a]=4,o===i.INT_VEC4||o===i.INT_VEC3?this.types[a]=i.INT:o===i.UNSIGNED_INT_VEC4||o===i.UNSIGNED_INT_VEC3?this.types[a]=i.UNSIGNED_INT:this.types[a]=i.FLOAT,this.size+=4;break;case i.FLOAT_MAT2:case i.FLOAT_MAT2x3:case i.FLOAT_MAT2x4:this.size+=(4-this.size%4)%4,this.offsets[a]=this.size,this.sizes[a]=8,this.types[a]=i.FLOAT,this.size+=8;break;case i.FLOAT_MAT3:case i.FLOAT_MAT3x2:case i.FLOAT_MAT3x4:this.size+=(4-this.size%4)%4,this.offsets[a]=this.size,this.sizes[a]=12,this.types[a]=i.FLOAT,this.size+=12;break;case i.FLOAT_MAT4:case i.FLOAT_MAT4x2:case i.FLOAT_MAT4x3:this.size+=(4-this.size%4)%4,this.offsets[a]=this.size,this.sizes[a]=16,this.types[a]=i.FLOAT,this.size+=16;break;default:console.error("Unsupported type for uniform buffer.")}}this.size+=(4-this.size%4)%4,this.data=new Float32Array(this.size),this.dataViews[i.FLOAT]=this.data,this.dataViews[i.INT]=new Int32Array(this.data.buffer),this.dataViews[i.UNSIGNED_INT]=new Uint32Array(this.data.buffer),this.dirtyStart=this.size,this.dirtyEnd=0,this.restore()}restore(){return this.currentBase!==-1&&this.appState.uniformBuffers[this.currentBase]===this&&(this.appState.uniformBuffers[this.currentBase]=null),this.buffer=this.gl.createBuffer(),this.gl.bindBuffer(i.UNIFORM_BUFFER,this.buffer),this.gl.bufferData(i.UNIFORM_BUFFER,this.size*4,this.usage),this.gl.bindBuffer(i.UNIFORM_BUFFER,null),this}set(e,r){let n=this.dataViews[this.types[e]],s=this.offsets[e],a=this.sizes[e];return this.sizes[e]===1?n[s]=r:n.set(r,s),s<this.dirtyStart&&(this.dirtyStart=s),this.dirtyEnd<s+a&&(this.dirtyEnd=s+a),this}update(){if(this.dirtyStart>=this.dirtyEnd)return this;let e=this.data.subarray(this.dirtyStart,this.dirtyEnd),r=this.dirtyStart*4;return this.gl.bindBuffer(this.gl.UNIFORM_BUFFER,this.buffer),this.gl.bufferSubData(this.gl.UNIFORM_BUFFER,r,e),this.gl.bindBuffer(this.gl.UNIFORM_BUFFER,null),this.dirtyStart=this.size,this.dirtyEnd=0,this}delete(){return this.buffer&&(this.gl.deleteBuffer(this.buffer),this.buffer=null,this.currentBase!==-1&&this.appState.uniformBuffers[this.currentBase]===this&&(this.appState.uniformBuffers[this.currentBase]=null),this.currentBase=-1),this}bind(e){let r=this.appState.uniformBuffers[e];return r!==this&&(r&&(r.currentBase=-1),this.currentBase!==-1&&(this.appState.uniformBuffers[this.currentBase]=null),this.gl.bindBufferBase(this.gl.UNIFORM_BUFFER,e,this.buffer),this.appState.uniformBuffers[e]=this,this.currentBase=e),this}}class rs{constructor(e,r){this.gl=e,this.appState=r,this.vertexArray=null,this.indexType=null,this.indexed=!1,this.numElements=0,this.numInstances=1,this.offsets=0,this.numDraws=1,this.instanceAttributeBuffers={}}restore(){return this.appState.vertexArray===this&&(this.appState.vertexArray=null),this.vertexArray!==null&&(this.vertexArray=this.gl.createVertexArray()),this}vertexAttributeBuffer(e,r,n=Ze){return this.attributeBuffer(e,r,n,!1),this}instanceAttributeBuffer(e,r,n=Ze){return this.attributeBuffer(e,r,n,!0),this.instanceAttributeBuffers[e]={vertexBuffer:r,options:n},this}baseOffsetInstanceAttributeBuffers(e=0){Object.entries(this.instanceAttributeBuffers).forEach(([r,{vertexBuffer:n,options:s}])=>{this.attributeBuffer(Number(r),n,s,!0,e)})}indexBuffer(e){return this.vertexArray===null&&(this.vertexArray=this.gl.createVertexArray()),this.bind(),this.gl.bindBuffer(i.ELEMENT_ARRAY_BUFFER,e.buffer),this.numElements=e.numItems*3,this.indexType=e.type,this.indexed=!0,this}delete(){return this.vertexArray&&(this.gl.deleteVertexArray(this.vertexArray),this.vertexArray=null,this.appState.vertexArray===this&&(this.gl.bindVertexArray(null),this.appState.vertexArray=null)),this}bind(){return this.appState.vertexArray!==this&&(this.gl.bindVertexArray(this.vertexArray),this.appState.vertexArray=this),this}attributeBuffer(e,r,n={},s,a=0){this.vertexArray===null&&(this.vertexArray=this.gl.createVertexArray()),this.bind(),this.gl.bindBuffer(i.ARRAY_BUFFER,r.buffer);let{type:l=r.type,size:o=r.itemSize,stride:u=0,offset:h=0,normalized:m=!1,integer:f=!!(r.integer&&!m)}=n,A=r.numColumns;u===0&&(u=A*o*Bt[l]);let x=Math.ceil((r.byteLength-h)/u);for(let C=0;C<A;++C)f?this.gl.vertexAttribIPointer(e+C,o,l,u,h+C*o*Bt[l]+a*u):this.gl.vertexAttribPointer(e+C,o,l,m,u,h+C*o*Bt[l]+a*u),s&&this.gl.vertexAttribDivisor(e+C,1),this.gl.enableVertexAttribArray(e+C);return this.numDraws===1&&(s?this.numInstances=x:this.indexed||(this.numElements=x)),this.gl.bindBuffer(i.ARRAY_BUFFER,null),this}}const ns={[i.BYTE]:!0,[i.UNSIGNED_BYTE]:!0,[i.SHORT]:!0,[i.UNSIGNED_SHORT]:!0,[i.INT]:!0,[i.UNSIGNED_INT]:!0};class It{constructor(e,r,n,s,a,l=e.STATIC_DRAW,o){let u;switch(n){case i.FLOAT_MAT4:case i.FLOAT_MAT4x2:case i.FLOAT_MAT4x3:u=4;break;case i.FLOAT_MAT3:case i.FLOAT_MAT3x2:case i.FLOAT_MAT3x4:u=3;break;case i.FLOAT_MAT2:case i.FLOAT_MAT2x3:case i.FLOAT_MAT2x4:u=2;break;default:u=1}switch(n){case i.FLOAT_MAT4:case i.FLOAT_MAT3x4:case i.FLOAT_MAT2x4:s=4,n=i.FLOAT;break;case i.FLOAT_MAT3:case i.FLOAT_MAT4x3:case i.FLOAT_MAT2x3:s=3,n=i.FLOAT;break;case i.FLOAT_MAT2:case i.FLOAT_MAT3x2:case i.FLOAT_MAT4x2:s=2,n=i.FLOAT;break}let h,m;typeof a=="number"?(h=a,n&&(a*=Bt[n]),m=a):(h=a.length,m=a.byteLength),this.gl=e,this.buffer=null,this.appState=r,this.type=n,this.itemSize=s,this.numItems=n?h/(s*u):m/s,this.numColumns=u,this.byteLength=m,this.usage=l,this.indexArray=!!o,this.integer=!!ns[this.type],this.binding=this.indexArray?i.ELEMENT_ARRAY_BUFFER:i.ARRAY_BUFFER,this.restore(a)}restore(e){return e||(e=this.byteLength),this.appState.vertexArray&&(this.gl.bindVertexArray(null),this.appState.vertexArray=null),this.buffer=this.gl.createBuffer(),this.gl.bindBuffer(this.binding,this.buffer),this.gl.bufferData(this.binding,e,this.usage),this.gl.bindBuffer(this.binding,null),this}data(e,r=0){return this.appState.vertexArray&&(this.gl.bindVertexArray(null),this.appState.vertexArray=null),this.gl.bindBuffer(this.binding,this.buffer),this.gl.bufferSubData(this.binding,r,e),this.gl.bindBuffer(this.binding,null),this}delete(){return this.buffer&&(this.gl.deleteBuffer(this.buffer),this.buffer=null),this}}class is{constructor(e){this.gl=e,this.canvas=e.canvas,this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this.viewportX=0,this.viewportY=0,this.viewportWidth=0,this.viewportHeight=0,this.currentDrawCalls=null,this.emptyFragmentShader=null,this.state={program:null,vertexArray:null,transformFeedback:null,activeTexture:-1,textures:new Array(q.MAX_TEXTURE_UNITS),uniformBuffers:new Array(q.MAX_UNIFORM_BUFFERS),freeUniformBufferBases:[],framebuffers:{},drawFramebufferBinding:i.DRAW_FRAMEBUFFER,readFramebufferBinding:i.READ_FRAMEBUFFER,extensions:{}},this.clearBits=this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT|this.gl.STENCIL_BUFFER_BIT,this.cpuTime=0,this.gpuTime=0,this.viewport(0,0,this.width,this.height),this.contextLostExt=null,this.contextLostListener=null,this.contextRestoredListener=null,this.contextRestoredHandler=null,this.initExtensions()}loseContext(){return this.contextLostExt&&this.contextLostExt.loseContext(),this}restoreContext(){return this.contextLostExt&&this.contextLostExt.restoreContext(),this}onContextRestored(e){return this.contextRestoredHandler=e,this.initContextListeners(),this}enable(e){return this.gl.enable(e),this}disable(e){return this.gl.disable(e),this}colorMask(e,r,n,s){return this.gl.colorMask(e,r,n,s),this}clearColor(e,r,n,s){return this.gl.clearColor(e,r,n,s),this}clearMask(e){return this.clearBits=e,this}clear(){return this.gl.clear(this.clearBits),this}drawFramebuffer(e){return e.bindForDraw(),this}readFramebuffer(e){return e.bindForRead(),this}defaultDrawFramebuffer(){let e=this.state.drawFramebufferBinding;return this.state.framebuffers[e]!==null&&(this.gl.bindFramebuffer(e,null),this.state.framebuffers[e]=null),this}defaultReadFramebuffer(){let e=this.state.readFramebufferBinding;return this.state.framebuffers[e]!==null&&(this.gl.bindFramebuffer(e,null),this.state.framebuffers[e]=null),this}blitFramebuffer(e,r=Ze){let n=this.state.readFramebufferBinding,s=this.state.drawFramebufferBinding,a=this.state.framebuffers[n],l=this.state.framebuffers[s],o=a?a.width:this.width,u=a?a.height:this.height,h=l?l.width:this.width,m=l?l.height:this.height,{srcStartX:f=0,srcStartY:A=0,srcEndX:x=o,srcEndY:C=u,dstStartX:b=0,dstStartY:G=0,dstEndX:B=h,dstEndY:g=m,filter:d=i.NEAREST}=r;return this.gl.blitFramebuffer(f,A,x,C,b,G,B,g,e,d),this}depthRange(e,r){return this.gl.depthRange(e,r),this}depthMask(e){return this.gl.depthMask(e),this}depthFunc(e){return this.gl.depthFunc(e),this}blendFunc(e,r){return this.gl.blendFunc(e,r),this}blendFuncSeparate(e,r,n,s){return this.gl.blendFuncSeparate(e,r,n,s),this}blendEquation(e){return this.gl.blendEquation(e),this}stencilMask(e){return this.gl.stencilMask(e),this}stencilMaskSeparate(e,r){return this.gl.stencilMaskSeparate(e,r),this}stencilFunc(e,r,n){return this.gl.stencilFunc(e,r,n),this}stencilFuncSeparate(e,r,n,s){return this.gl.stencilFuncSeparate(e,r,n,s),this}stencilOp(e,r,n){return this.gl.stencilOp(e,r,n),this}stencilOpSeparate(e,r,n,s){return this.gl.stencilOpSeparate(e,r,n,s),this}scissor(e,r,n,s){return this.gl.scissor(e,r,n,s),this}polygonOffset(e,r){return this.gl.polygonOffset(e,r),this}readPixel(e,r,n,s=Ze){let{format:a=i.RGBA,type:l=i.UNSIGNED_BYTE}=s;return this.gl.readPixels(e,r,1,1,a,l,n),this}viewport(e,r,n,s){return(this.viewportWidth!==n||this.viewportHeight!==s||this.viewportX!==e||this.viewportY!==r)&&(this.viewportX=e,this.viewportY=r,this.viewportWidth=n,this.viewportHeight=s,this.gl.viewport(e,r,this.viewportWidth,this.viewportHeight)),this}defaultViewport(){return this.viewport(0,0,this.width,this.height),this}resize(e,r){return this.canvas.width=e,this.canvas.height=r,this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this.viewport(0,0,this.width,this.height),this}createProgram(e,r,n={}){let{transformFeedbackVaryings:s,attributeLocations:a,transformFeedbackMode:l}=n;return new Jr(this.gl,this.state,e,r,s,a,l).link().checkLinkage()}createPrograms(...e){return new Promise((r,n)=>{let s=e.length,a=new Array(s),l=new Array(s),o=s;for(let h=0;h<s;++h){let m=e[h],f=m[0],A=m[1],x=m[2]||{},{transformFeedbackVaryings:C,attributeLocations:b,transformFeedbackMode:G}=x;a[h]=new Jr(this.gl,this.state,f,A,C,b,G),l[h]=a[h]}for(let h=0;h<s;++h)a[h].link();let u=()=>{let h=0;for(let m=0;m<o;++m)if(l[m].checkCompletion())if(l[m].checkLinkage(),l[m].linked)++h;else{n(new Error("Program linkage failed"));return}else l[m-h]=l[m];o-=h,o===0?r(a):requestAnimationFrame(u)};u()})}restorePrograms(...e){return new Promise((r,n)=>{let s=e.length,a=e.slice(),l=s;for(let u=0;u<s;++u)e[u].initialize();for(let u=0;u<s;++u)e[u].link();for(let u=0;u<s;++u)e[u].checkCompletion();let o=()=>{let u=0;for(let h=0;h<l;++h)if(a[h].checkCompletion())if(a[h].checkLinkage(),a[h].linked)++u;else{n(new Error("Program linkage failed"));return}else a[h-u]=a[h];l-=u,l===0?r():requestAnimationFrame(o)};o()})}createShader(e,r){return new ht(this.gl,this.state,e,r)}createVertexArray(){return new rs(this.gl,this.state)}createTransformFeedback(){return new es(this.gl,this.state)}createVertexBuffer(e,r,n,s){return new It(this.gl,this.state,e,r,n,s)}createMatrixBuffer(e,r,n){return new It(this.gl,this.state,e,0,r,n)}createInterleavedBuffer(e,r,n){return new It(this.gl,this.state,null,e,r,n)}createIndexBuffer(e,r,n,s){return ArrayBuffer.isView(r)&&(s=n,n=r,r=3),new It(this.gl,this.state,e,r,n,s,!0)}createUniformBuffer(e,r){return new ts(this.gl,this.state,e,r)}createTexture2D(e,r,n,s){return typeof e=="number"?(s=n,n=r,r=e,e=null):n===void 0&&(s=r,r=e.width,n=e.height),new ft(this.gl,this.state,this.gl.TEXTURE_2D,e,r,n,void 0,!1,s)}createTextureArray(e,r,n,s,a){return typeof e=="number"&&(a=s,s=n,n=r,r=e,e=null),new ft(this.gl,this.state,this.gl.TEXTURE_2D_ARRAY,e,r,n,s,!0,a)}createTexture3D(e,r,n,s,a){return typeof e=="number"&&(a=s,s=n,n=r,r=e,e=null),new ft(this.gl,this.state,this.gl.TEXTURE_3D,e,r,n,s,!0,a)}createCubemap(e){return new ji(this.gl,this.state,e)}createRenderbuffer(e,r,n,s=0){return new Nr(this.gl,e,r,n,s)}createFramebuffer(){return new Zi(this.gl,this.state)}createQuery(e){return new jn(this.gl,e)}createTimer(){return new Ji(this.gl)}createDrawCall(e,r,n){return new qi(this.gl,this.state,e,r,n)}initExtensions(){this.gl.getExtension("EXT_color_buffer_float"),this.gl.getExtension("OES_texture_float_linear"),this.gl.getExtension("WEBGL_compressed_texture_s3tc"),this.gl.getExtension("WEBGL_compressed_texture_s3tc_srgb"),this.gl.getExtension("WEBGL_compressed_texture_etc"),this.gl.getExtension("WEBGL_compressed_texture_astc"),this.gl.getExtension("WEBGL_compressed_texture_pvrtc"),this.gl.getExtension("EXT_disjoint_timer_query_webgl2"),this.gl.getExtension("EXT_disjoint_timer_query"),this.gl.getExtension("EXT_texture_filter_anisotropic"),this.state.extensions.debugShaders=this.gl.getExtension("WEBGL_debug_shaders"),this.contextLostExt=this.gl.getExtension("WEBGL_lose_context"),this.gl.getExtension("KHR_parallel_shader_compile"),this.state.extensions.multiDrawInstanced=this.gl.getExtension("WEBGL_multi_draw_instanced"),this.state.extensions.drawInstancedBaseVertexBaseInstance=this.gl.getExtension("WEBGL_draw_instanced_base_vertex_base_instance"),this.state.extensions.multiDrawInstancedBaseVertexBaseInstance=this.gl.getExtension("WEBGL_multi_draw_instanced_base_vertex_base_instance")}initContextListeners(){this.contextRestoredHandler?(this.contextLostListener=e=>{e.preventDefault()},this.contextRestoredListener=()=>{this.initExtensions(),this.contextRestoredHandler()},this.canvas.addEventListener("webglcontextlost",this.contextLostListener),this.canvas.addEventListener("webglcontextrestored",this.contextRestoredListener)):(this.canvas.removeEventListener("webglcontextlost",this.contextLostListener),this.canvas.removeEventListener("webglcontextrestored",this.contextRestoredListener),this.contextLostListener=null,this.contextRestoredListener=null)}depthTest(){return console.warn("App.depthTest is deprecated. Use App.enable(PicoGL.DEPTH_TEST) instead."),this.enable(i.DEPTH_TEST),this}noDepthTest(){return console.warn("App.noDepthTest is deprecated. Use App.disable(PicoGL.DEPTH_TEST) instead."),this.disable(i.DEPTH_TEST),this}blend(){return console.warn("App.blend is deprecated. Use App.enable(PicoGL.BLEND) instead."),this.enable(i.BLEND),this}noBlend(){return console.warn("App.noBlend is deprecated. Use App.disable(PicoGL.BLEND) instead."),this.disable(i.BLEND),this}stencilTest(){return console.warn("App.stencilTest is deprecated. Use App.enable(PicoGL.STENCIL_TEST) instead."),this.enable(i.STENCIL_TEST),this}noStencilTest(){return console.warn("App.noStencilTest is deprecated. Use App.disable(PicoGL.STENCIL_TEST) instead."),this.disable(i.STENCIL_TEST),this}scissorTest(){return console.warn("App.scissorTest is deprecated. Use App.enable(PicoGL.SCISSOR_TEST) instead."),this.enable(i.SCISSOR_TEST),this}noScissorTest(){return console.warn("App.noScissorTest is deprecated. Use App.disable(PicoGL.SCISSOR_TEST) instead."),this.disable(i.SCISSOR_TEST),this}rasterize(){return console.warn("App.noRasterize is deprecated. Use App.disable(PicoGL.RASTERIZER_DISCARD) instead."),this.disable(i.RASTERIZER_DISCARD),this}noRasterize(){return console.warn("App.rasterize is deprecated. Use App.enable(PicoGL.RASTERIZER_DISCARD) instead."),this.enable(i.RASTERIZER_DISCARD),this}cullBackfaces(){return console.warn("App.cullBackfaces is deprecated. Use App.enable(PicoGL.CULL_FACE) instead."),this.enable(i.CULL_FACE),this}drawBackfaces(){return console.warn("App.drawBackfaces is deprecated. Use App.disable(PicoGL.CULL_FACE) instead."),this.disable(i.CULL_FACE),this}}let en=!1;const M=Object.assign({version:"0.17.9",WEBGL_INFO:q,createApp(t,e){return t.tagName==="CANVAS"&&(t=t.getContext("webgl2",e)),en||(q.MAX_TEXTURE_UNITS=t.getParameter(i.MAX_COMBINED_TEXTURE_IMAGE_UNITS),q.MAX_UNIFORM_BUFFERS=t.getParameter(i.MAX_UNIFORM_BUFFER_BINDINGS),q.MAX_UNIFORMS=Math.min(t.getParameter(i.MAX_VERTEX_UNIFORM_VECTORS),t.getParameter(i.MAX_FRAGMENT_UNIFORM_VECTORS)),q.SAMPLES=t.getParameter(i.SAMPLES),q.VENDOR="(Unknown)",q.RENDERER="(Unknown)",q.FLOAT_RENDER_TARGETS=!!t.getExtension("EXT_color_buffer_float"),q.LINEAR_FLOAT_TEXTURES=!!t.getExtension("OES_texture_float_linear"),q.S3TC_TEXTURES=!!t.getExtension("WEBGL_compressed_texture_s3tc"),q.S3TC_SRGB_TEXTURES=!!t.getExtension("WEBGL_compressed_texture_s3tc_srgb"),q.ETC_TEXTURES=!!t.getExtension("WEBGL_compressed_texture_etc"),q.ASTC_TEXTURES=!!t.getExtension("WEBGL_compressed_texture_astc"),q.PVRTC_TEXTURES=!!t.getExtension("WEBGL_compressed_texture_pvrtc"),q.LOSE_CONTEXT=!!t.getExtension("WEBGL_lose_context"),q.DEBUG_SHADERS=!!t.getExtension("WEBGL_debug_shaders"),q.GPU_TIMER=!!(t.getExtension("EXT_disjoint_timer_query_webgl2")||t.getExtension("EXT_disjoint_timer_query")),q.TEXTURE_ANISOTROPY=!!t.getExtension("EXT_texture_filter_anisotropic"),q.MAX_TEXTURE_ANISOTROPY=q.TEXTURE_ANISOTROPY?t.getParameter(i.MAX_TEXTURE_MAX_ANISOTROPY_EXT):1,q.DEBUG_RENDERER_INFO=!!t.getExtension("WEBGL_debug_renderer_info"),q.DEBUG_RENDERER_INFO&&(q.VENDOR=t.getParameter(i.UNMASKED_VENDOR_WEBGL),q.RENDERER=t.getParameter(i.UNMASKED_RENDERER_WEBGL)),q.PARALLEL_SHADER_COMPILE=!!t.getExtension("KHR_parallel_shader_compile"),q.MULTI_DRAW_INSTANCED=!!t.getExtension("WEBGL_multi_draw_instanced"),q.DRAW_INSTANCED_BASE_VERTEX_BASE_INSTANCE=!!t.getExtension("WEBGL_draw_instanced_base_vertex_base_instance"),q.MULTI_DRAW_INSTANCED_BASE_VERTEX_BASE_INSTANCE=!!t.getExtension("WEBGL_multi_draw_instanced_base_vertex_base_instance"),en=!0),new is(t)}},i);var ye=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ss(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var ie={},as={get exports(){return ie},set exports(t){ie=t}},wt={},os={get exports(){return wt},set exports(t){wt=t}},tn;function ls(){return tn||(tn=1,function(t,e){(function(r,n){t.exports=n()})(ye,function(){var r={isEqual:!0,isMatchingKey:!0,isPromise:!0,maxSize:!0,onCacheAdd:!0,onCacheChange:!0,onCacheHit:!0,transformKey:!0},n=Array.prototype.slice;function s(f){var A=f.length;return A?A===1?[f[0]]:A===2?[f[0],f[1]]:A===3?[f[0],f[1],f[2]]:n.call(f,0):[]}function a(f){var A={};for(var x in f)r[x]||(A[x]=f[x]);return A}function l(f){return typeof f=="function"&&f.isMemoized}function o(f,A){return f===A||f!==f&&A!==A}function u(f,A){var x={};for(var C in f)x[C]=f[C];for(var C in A)x[C]=A[C];return x}var h=function(){function f(A){this.keys=[],this.values=[],this.options=A;var x=typeof A.isMatchingKey=="function";x?this.getKeyIndex=this._getKeyIndexFromMatchingKey:A.maxSize>1?this.getKeyIndex=this._getKeyIndexForMany:this.getKeyIndex=this._getKeyIndexForSingle,this.canTransformKey=typeof A.transformKey=="function",this.shouldCloneArguments=this.canTransformKey||x,this.shouldUpdateOnAdd=typeof A.onCacheAdd=="function",this.shouldUpdateOnChange=typeof A.onCacheChange=="function",this.shouldUpdateOnHit=typeof A.onCacheHit=="function"}return Object.defineProperty(f.prototype,"size",{get:function(){return this.keys.length},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"snapshot",{get:function(){return{keys:s(this.keys),size:this.size,values:s(this.values)}},enumerable:!1,configurable:!0}),f.prototype._getKeyIndexFromMatchingKey=function(A){var x=this.options,C=x.isMatchingKey,b=x.maxSize,G=this.keys,B=G.length;if(!B)return-1;if(C(G[0],A))return 0;if(b>1){for(var g=1;g<B;g++)if(C(G[g],A))return g}return-1},f.prototype._getKeyIndexForMany=function(A){var x=this.options.isEqual,C=this.keys,b=C.length;if(!b)return-1;if(b===1)return this._getKeyIndexForSingle(A);var G=A.length,B,g;if(G>1){for(var d=0;d<b;d++)if(B=C[d],B.length===G){for(g=0;g<G&&x(B[g],A[g]);g++);if(g===G)return d}}else for(var d=0;d<b;d++)if(B=C[d],B.length===G&&x(B[0],A[0]))return d;return-1},f.prototype._getKeyIndexForSingle=function(A){var x=this.keys;if(!x.length)return-1;var C=x[0],b=C.length;if(A.length!==b)return-1;var G=this.options.isEqual;if(b>1){for(var B=0;B<b;B++)if(!G(C[B],A[B]))return-1;return 0}return G(C[0],A[0])?0:-1},f.prototype.orderByLru=function(A,x,C){for(var b=this.keys,G=this.values,B=b.length,g=C;g--;)b[g+1]=b[g],G[g+1]=G[g];b[0]=A,G[0]=x;var d=this.options.maxSize;B===d&&C===B?(b.pop(),G.pop()):C>=d&&(b.length=G.length=d)},f.prototype.updateAsyncCache=function(A){var x=this,C=this.options,b=C.onCacheChange,G=C.onCacheHit,B=this.keys[0],g=this.values[0];this.values[0]=g.then(function(d){return x.shouldUpdateOnHit&&G(x,x.options,A),x.shouldUpdateOnChange&&b(x,x.options,A),d},function(d){var V=x.getKeyIndex(B);throw V!==-1&&(x.keys.splice(V,1),x.values.splice(V,1)),d})},f}();function m(f,A){if(A===void 0&&(A={}),l(f))return m(f.fn,u(f.options,A));if(typeof f!="function")throw new TypeError("You must pass a function to `memoize`.");var x=A.isEqual,C=x===void 0?o:x,b=A.isMatchingKey,G=A.isPromise,B=G===void 0?!1:G,g=A.maxSize,d=g===void 0?1:g,V=A.onCacheAdd,W=A.onCacheChange,k=A.onCacheHit,Y=A.transformKey,ee=u({isEqual:C,isMatchingKey:b,isPromise:B,maxSize:d,onCacheAdd:V,onCacheChange:W,onCacheHit:k,transformKey:Y},a(A)),se=new h(ee),_e=se.keys,T=se.values,H=se.canTransformKey,$=se.shouldCloneArguments,N=se.shouldUpdateOnAdd,S=se.shouldUpdateOnChange,z=se.shouldUpdateOnHit,X=function(){var Q=$?s(arguments):arguments;H&&(Q=Y(Q));var le=_e.length?se.getKeyIndex(Q):-1;if(le!==-1)z&&k(se,ee,X),le&&(se.orderByLru(_e[le],T[le],le),S&&W(se,ee,X));else{var ue=f.apply(this,arguments),L=$?Q:s(arguments);se.orderByLru(L,ue,_e.length),B&&se.updateAsyncCache(X),N&&V(se,ee,X),S&&W(se,ee,X)}return T[0]};return X.cache=se,X.fn=f,X.isMemoized=!0,X.options=ee,X}return m})}(os)),wt}var Et={},us={get exports(){return Et},set exports(t){Et=t}},rn;function hs(){return rn||(rn=1,function(t,e){(function(r,n){n(e)})(ye,function(r){var n=typeof WeakMap=="function",s=Object.keys;function a(T,H){return T===H||T!==T&&H!==H}function l(T){return T.constructor===Object||T.constructor==null}function o(T){return!!T&&typeof T.then=="function"}function u(T){return!!(T&&T.$$typeof)}function h(){var T=[];return{delete:function(H){for(var $=0;$<T.length;++$)if(T[$][0]===H){T.splice($,1);return}},get:function(H){for(var $=0;$<T.length;++$)if(T[$][0]===H)return T[$][1]},set:function(H,$){for(var N=0;N<T.length;++N)if(T[N][0]===H){T[N][1]=$;return}T.push([H,$])}}}var m=function(T){return T?function(){return new WeakMap}:h}(n);function f(T){return function($){var N=T||$;return function(z,X,Q,le,ue,L,E){E===void 0&&(E=m());var R=!!z&&typeof z=="object",I=!!X&&typeof X=="object";if(R!==I)return!1;if(!R&&!I)return N(z,X,E);var U=E.get(z);if(U&&E.get(X))return U===X;E.set(z,X),E.set(X,z);var p=N(z,X,E);return E.delete(z),E.delete(X),p}}}function A(T,H,$,N){var S=T.length;if(H.length!==S)return!1;for(;S-- >0;)if(!$(T[S],H[S],S,S,T,H,N))return!1;return!0}function x(T,H,$,N){var S=T.size===H.size;if(S&&T.size){var z={},X=0;T.forEach(function(Q,le){if(S){var ue=!1,L=0;H.forEach(function(E,R){!ue&&!z[L]&&(ue=$(le,R,X,L,T,H,N)&&$(Q,E,le,R,T,H,N),ue&&(z[L]=!0)),L++}),X++,S=ue}})}return S}var C="_owner",b=Function.prototype.bind.call(Function.prototype.call,Object.prototype.hasOwnProperty);function G(T,H,$,N){var S=s(T),z=S.length;if(s(H).length!==z)return!1;if(z)for(var X=void 0;z-- >0;){if(X=S[z],X===C){var Q=u(T),le=u(H);if((Q||le)&&Q!==le)return!1}if(!b(H,X)||!$(T[X],H[X],X,X,T,H,N))return!1}return!0}var B=function(){return/foo/g.flags==="g"?function(H,$){return H.source===$.source&&H.flags===$.flags}:function(H,$){return H.source===$.source&&H.global===$.global&&H.ignoreCase===$.ignoreCase&&H.multiline===$.multiline&&H.unicode===$.unicode&&H.sticky===$.sticky&&H.lastIndex===$.lastIndex}}();function g(T,H,$,N){var S=T.size===H.size;if(S&&T.size){var z={};T.forEach(function(X,Q){if(S){var le=!1,ue=0;H.forEach(function(L,E){!le&&!z[ue]&&(le=$(X,L,Q,E,T,H,N),le&&(z[ue]=!0)),ue++}),S=le}})}return S}var d=typeof Map=="function",V=typeof Set=="function",W=Object.prototype.valueOf;function k(T){var H=typeof T=="function"?T($):function(N,S,z,X,Q,le,ue){return $(N,S,ue)};function $(N,S,z){if(N===S)return!0;if(N&&S&&typeof N=="object"&&typeof S=="object"){if(l(N)&&l(S))return G(N,S,H,z);var X=Array.isArray(N),Q=Array.isArray(S);return X||Q?X===Q&&A(N,S,H,z):(X=N instanceof Date,Q=S instanceof Date,X||Q?X===Q&&a(N.getTime(),S.getTime()):(X=N instanceof RegExp,Q=S instanceof RegExp,X||Q?X===Q&&B(N,S):o(N)||o(S)?N===S:d&&(X=N instanceof Map,Q=S instanceof Map,X||Q)?X===Q&&x(N,S,H,z):V&&(X=N instanceof Set,Q=S instanceof Set,X||Q)?X===Q&&g(N,S,H,z):N.valueOf!==W||S.valueOf!==W?a(N.valueOf(),S.valueOf()):G(N,S,H,z)))}return N!==N&&S!==S}return $}var Y=k(),ee=k(function(){return a}),se=k(f()),_e=k(f(a));r.circularDeepEqual=se,r.circularShallowEqual=_e,r.createCustomEqual=k,r.deepEqual=Y,r.sameValueZeroEqual=a,r.shallowEqual=ee,Object.defineProperty(r,"__esModule",{value:!0})})}(us,Et)),Et}(function(t,e){(function(r,n){t.exports=n(ls(),hs())})(ye,function(r,n){function s(){return s=Object.assign?Object.assign.bind():function(c){for(var _=1;_<arguments.length;_++){var D=arguments[_];for(var v in D)Object.prototype.hasOwnProperty.call(D,v)&&(c[v]=D[v])}return c},s.apply(this,arguments)}function a(c,_){if(c==null)return{};var D={},v=Object.keys(c),O,F;for(F=0;F<v.length;F++)O=v[F],!(_.indexOf(O)>=0)&&(D[O]=c[O]);return D}var l={isDeepEqual:!1,isPromise:!1,isReact:!1,isSerialized:!1,isShallowEqual:!1,matchesArg:void 0,matchesKey:void 0,maxAge:void 0,maxArgs:void 0,maxSize:1,onExpire:void 0,profileName:void 0,serializer:void 0,updateCacheForKey:void 0,transformArgs:void 0,updateExpire:!1};function o(){for(var c=arguments.length,_=new Array(c),D=0;D<c;D++)_[D]=arguments[D];return _.reduce(function(v,O){if(typeof v=="function")return typeof O=="function"?function(){v.apply(this,arguments),O.apply(this,arguments)}:v;if(typeof O=="function")return O})}function u(){for(var c=arguments.length,_=new Array(c),D=0;D<c;D++)_[D]=arguments[D];return _.reduce(function(v,O){if(typeof v=="function")return typeof O=="function"?function(){return v(O.apply(this,arguments))}:v;if(typeof O=="function")return O})}function h(c,_){for(var D=0;D<c.length;D++)if(c[D].key===_)return D;return-1}function m(c,_){var D=typeof _=="function"?_:function(v,O){for(var F=0;F<O.length;F++)if(!c(v[F],O[F]))return!1;return!0};return function(v,O){for(var F=0;F<v.length;F++)if(v[F].length===O.length&&D(v[F],O))return F;return-1}}function f(c,_){return!_||_===l?c:s({},c,_,{onCacheAdd:o(c.onCacheAdd,_.onCacheAdd),onCacheChange:o(c.onCacheChange,_.onCacheChange),onCacheHit:o(c.onCacheHit,_.onCacheHit),transformArgs:u(c.transformArgs,_.transformArgs)})}function A(c){return typeof c=="function"&&c.isMoized}function x(c,_,D){try{var v=D||_||"anonymous";Object.defineProperty(c,"name",{configurable:!0,enumerable:!1,value:"moized("+v+")",writable:!0})}catch{}}function C(c,_,D){var v=h(c,_);v!==-1&&(clearTimeout(c[v].timeoutId),D&&c.splice(v,1))}function b(c,_){var D=setTimeout(c,_);return typeof D.unref=="function"&&D.unref(),D}function G(c,_,D,v){var O=_.maxAge;return function F(P,j,Ee){var he=P.keys[0];if(h(c,he)===-1){var de=function(){var ve=m(D,v),Ie=ve(P.keys,he),Xe=P.values[Ie];~Ie&&(P.keys.splice(Ie,1),P.values.splice(Ie,1),typeof _.onCacheChange=="function"&&_.onCacheChange(P,j,Ee)),C(c,he,!0),typeof _.onExpire=="function"&&_.onExpire(he)===!1&&(P.keys.unshift(he),P.values.unshift(Xe),F(P,j,Ee),typeof _.onCacheChange=="function"&&_.onCacheChange(P,j,Ee))};c.push({expirationMethod:de,key:he,timeoutId:b(de,O)})}}}function B(c,_){return function(v){var O=v.keys[0],F=h(c,O);~F&&(C(c,O,!1),c[F].timeoutId=b(c[F].expirationMethod,_.maxAge))}}function g(c,_,D,v){var O=typeof _.maxAge=="number"&&isFinite(_.maxAge)?G(c,_,D,v):void 0;return{onCacheAdd:O,onCacheHit:O&&_.updateExpire?B(c,_):void 0}}var d={anonymousProfileNameCounter:1,isCollectingStats:!1,profiles:{}},V=!1;function W(c){c?delete d.profiles[c]:d.profiles={}}function k(c){c===void 0&&(c=!0),d.isCollectingStats=c}function Y(c){var _=c.profileName;return function(){_&&!d.profiles[_]&&(d.profiles[_]={calls:0,hits:0}),d.profiles[_].calls++}}function ee(c){return function(){var _=d.profiles,D=c.profileName;_[D]||(_[D]={calls:0,hits:0}),_[D].calls++,_[D].hits++}}function se(c){return c.displayName||c.name||"Anonymous "+d.anonymousProfileNameCounter++}function _e(c,_){return c?(_/c*100).toFixed(4)+"%":"0.0000%"}function T(c){!d.isCollectingStats&&!V&&(console.warn('Stats are not currently being collected, please run "collectStats" to enable them.'),V=!0);var _=d.profiles;if(c){if(!_[c])return{calls:0,hits:0,usage:"0.0000%"};var D=_[c];return s({},D,{usage:_e(D.calls,D.hits)})}var v=Object.keys(d.profiles).reduce(function(O,F){return O.calls+=_[F].calls,O.hits+=_[F].hits,O},{calls:0,hits:0});return s({},v,{profiles:Object.keys(_).reduce(function(O,F){return O[F]=T(F),O},{}),usage:_e(v.calls,v.hits)})}function H(c){return d.isCollectingStats?{onCacheAdd:Y(c),onCacheHit:ee(c)}:{}}var $={arguments:!0,callee:!0,caller:!0,constructor:!0,length:!0,name:!0,prototype:!0};function N(c,_,D){D===void 0&&(D=[]),Object.getOwnPropertyNames(c).forEach(function(v){if(!$[v]&&D.indexOf(v)===-1){var O=Object.getOwnPropertyDescriptor(c,v);O.get||O.set?Object.defineProperty(_,v,O):_[v]=c[v]}})}function S(c,_){var D=_.expirations,v=c.options,O=m(v.isEqual,v.isMatchingKey),F=c;F.clear=function(){var P=F._microMemoizeOptions.onCacheChange,j=F.cache;return j.keys.length=0,j.values.length=0,P&&P(j,F.options,F),!0},F.clearStats=function(){W(F.options.profileName)},F.get=function(P){var j=F._microMemoizeOptions.transformKey,Ee=F.cache,he=j?j(P):P,de=O(Ee.keys,he);return de!==-1?F.apply(this,P):void 0},F.getStats=function(){return T(F.options.profileName)},F.has=function(P){var j=F._microMemoizeOptions.transformKey,Ee=j?j(P):P;return O(F.cache.keys,Ee)!==-1},F.keys=function(){return F.cacheSnapshot.keys},F.remove=function(P){var j=F._microMemoizeOptions,Ee=j.onCacheChange,he=j.transformKey,de=F.cache,Se=O(de.keys,he?he(P):P);if(Se===-1)return!1;var ve=de.keys[Se];return de.keys.splice(Se,1),de.values.splice(Se,1),Ee&&Ee(de,F.options,F),C(D,ve,!0),!0},F.set=function(P,j){var Ee=F._microMemoizeOptions,he=F.cache,de=F.options,Se=Ee.onCacheAdd,ve=Ee.onCacheChange,Ie=Ee.transformKey,Xe=Ie?Ie(P):P,be=O(he.keys,Xe);if(be===-1){var ke=de.maxSize-1;he.size>ke&&(he.keys.length=ke,he.values.length=ke),he.keys.unshift(Xe),he.values.unshift(j),de.isPromise&&he.updateAsyncCache(F),Se&&Se(he,de,F),ve&&ve(he,de,F)}else{var Ct=he.keys[be];he.values[be]=j,be>0&&he.orderByLru(Ct,j,be),de.isPromise&&he.updateAsyncCache(F),typeof ve=="function"&&ve(he,de,F)}},F.values=function(){return F.cacheSnapshot.values}}function z(c,_){var D=_.expirations,v=_.options,O=_.originalFunction,F=c.options;Object.defineProperties(c,{_microMemoizeOptions:{configurable:!0,get:function(){return F}},cacheSnapshot:{configurable:!0,get:function(){var Ee=c.cache;return{keys:Ee.keys.slice(0),size:Ee.size,values:Ee.values.slice(0)}}},expirations:{configurable:!0,get:function(){return D}},expirationsSnapshot:{configurable:!0,get:function(){return D.slice(0)}},isMoized:{configurable:!0,get:function(){return!0}},options:{configurable:!0,get:function(){return v}},originalFunction:{configurable:!0,get:function(){return O}}});var P=c;N(O,P)}function X(c,_){return S(c,_),z(c,_),c}var Q=typeof Symbol=="function"&&Symbol.for?Symbol.for("react.element"):60103;function le(c,_,D){var v=c(s({maxArgs:2,isShallowEqual:!0},D,{isReact:!1}));_.displayName||(_.displayName=_.name||"Component");function O(F,P,j){this.props=F,this.context=P,this.updater=j,this.MoizedComponent=v(_)}return O.prototype.isReactComponent={},O.prototype.render=function(){return{$$typeof:Q,type:this.MoizedComponent,props:this.props,ref:null,key:null,_owner:null}},N(_,O,["contextType","contextTypes"]),O.displayName="Moized("+(_.displayName||_.name||"Component")+")",x(O,_.name,D.profileName),O}function ue(c){return function(_){if(c>=_.length)return _;if(c===0)return[];if(c===1)return[_[0]];if(c===2)return[_[0],_[1]];if(c===3)return[_[0],_[1],_[2]];for(var D=[],v=0;v<c;v++)D[v]=_[v];return D}}function L(c,_){for(var D=c.length,v=0;v<D;++v)if(c[v]===_)return v+1;return 0}function E(){var c=[],_=[];return function(v,O){var F=typeof O;if(F==="function"||F==="symbol")return O.toString();if(typeof O=="object"){if(c.length){var P=L(c,this);P===0?c[c.length]=this:(c.splice(P),_.splice(P)),_[_.length]=v;var j=L(c,O);if(j!==0)return"[ref="+(_.slice(0,j).join(".")||".")+"]"}else c[0]=O,_[0]=v;return O}return""+O}}function R(c){var _=typeof c;return c&&(_==="object"||_==="function")?JSON.stringify(c,E()):c}function I(c){for(var _="|",D=0;D<c.length;D++)_+=R(c[D])+"|";return[_]}function U(c){return typeof c.serializer=="function"?c.serializer:I}function p(c,_){return c[0]===_[0]}function y(c){if(typeof c=="function")return function(_,D,v){return c(v.cache,v.options,v)}}function w(c){return c.matchesArg||c.isDeepEqual&&n.deepEqual||c.isShallowEqual&&n.shallowEqual||n.sameValueZeroEqual}function ne(c){return c.matchesKey||c.isSerialized&&p||void 0}function ae(c){return u(c.isSerialized&&U(c),typeof c.transformArgs=="function"&&c.transformArgs,typeof c.maxArgs=="number"&&ue(c.maxArgs))}function fe(c){var _=c.options.updateCacheForKey,D=function(){for(var O=arguments.length,F=new Array(O),P=0;P<O;P++)F[P]=arguments[P];if(!_(F))return c.apply(this,F);var j=c.fn.apply(this,F);return c.set(F,j),j};return N(c,D),D}var oe=["matchesArg","isDeepEqual","isPromise","isReact","isSerialized","isShallowEqual","matchesKey","maxAge","maxArgs","maxSize","onCacheAdd","onCacheChange","onCacheHit","onExpire","profileName","serializer","updateCacheForKey","transformArgs","updateExpire"],K=function c(_,D){var v=D||l;if(A(_)){var O=_.originalFunction,F=f(_.options,v);return c(O,F)}if(typeof _=="object")return function(tr,Ki){if(typeof tr=="function"){var Wi=f(_,Ki);return c(tr,Wi)}var Yi=f(_,tr);return c(Yi)};if(v.isReact)return le(c,_,v);var P=s({},l,v,{maxAge:typeof v.maxAge=="number"&&v.maxAge>=0?v.maxAge:l.maxAge,maxArgs:typeof v.maxArgs=="number"&&v.maxArgs>=0?v.maxArgs:l.maxArgs,maxSize:typeof v.maxSize=="number"&&v.maxSize>=0?v.maxSize:l.maxSize,profileName:v.profileName||se(_)}),j=[];P.matchesArg,P.isDeepEqual;var Ee=P.isPromise;P.isReact,P.isSerialized,P.isShallowEqual,P.matchesKey,P.maxAge,P.maxArgs;var he=P.maxSize,de=P.onCacheAdd,Se=P.onCacheChange,ve=P.onCacheHit;P.onExpire,P.profileName,P.serializer;var Ie=P.updateCacheForKey;P.transformArgs,P.updateExpire;var Xe=a(P,oe),be=w(P),ke=ne(P),Ct=g(j,P,be,ke),jr=H(P),ki=ae(P),zi=s({},Xe,{isEqual:be,isMatchingKey:ke,isPromise:Ee,maxSize:he,onCacheAdd:y(o(de,Ct.onCacheAdd,jr.onCacheAdd)),onCacheChange:y(Se),onCacheHit:y(o(ve,Ct.onCacheHit,jr.onCacheHit)),transformKey:ki}),$i=r(_,zi),Nt=X($i,{expirations:j,options:P,originalFunction:_});return Ie&&(Nt=fe(Nt)),x(Nt,_.name,v.profileName),Nt};K.clearStats=W,K.collectStats=k,K.compose=function(){return u.apply(void 0,arguments)||K},K.deep=K({isDeepEqual:!0}),K.getStats=T,K.infinite=K({maxSize:1/0}),K.isCollectingStats=function(){return d.isCollectingStats},K.isMoized=function(_){return typeof _=="function"&&!!_.isMoized},K.matchesArg=function(c){return K({matchesArg:c})},K.matchesKey=function(c){return K({matchesKey:c})};function re(c,_){if(_===!0)return K({maxAge:c,updateExpire:_});if(typeof _=="object"){var D=_.onExpire,v=_.updateExpire;return K({maxAge:c,onExpire:D,updateExpire:v})}return K(typeof _=="function"?{maxAge:c,onExpire:_,updateExpire:!0}:{maxAge:c})}return K.maxAge=re,K.maxArgs=function(c){return K({maxArgs:c})},K.maxSize=function(c){return K({maxSize:c})},K.profile=function(c){return K({profileName:c})},K.promise=K({isPromise:!0,updateExpire:!0}),K.react=K({isReact:!0}),K.serialize=K({isSerialized:!0}),K.serializeWith=function(c){return K({isSerialized:!0,serializer:c})},K.shallow=K({isShallowEqual:!0}),K.transformArgs=function(c){return K({transformArgs:c})},K.updateCacheForKey=function(c){return K({updateCacheForKey:c})},Object.defineProperty(K,"default",{configurable:!1,enumerable:!1,value:K,writable:!1}),K})})(as);var cs=`#version 300 es
precision highp float;
precision highp int;

layout(location=0) in vec3 currentPosition;
layout(location=1) in vec4 currentColor;
layout(location=2) in float currentSize;
layout(location=3) in float currentEmphasis;
layout(location=4) in vec3 targetPosition;
layout(location=5) in vec4 targetColor;
layout(location=6) in float targetSize;
layout(location=7) in float targetEmphasis;

layout(location=8) in uint vertexPosition;

out vec3 vTargetPosition;
out vec3 vUpdatedPosition;
out vec4 vUpdatedColor;
out float vUpdatedSize;
out float vUpdatedEmphasis;

uniform float uMixRatio;
uniform vec2 mousePosition;
uniform vec2 bufferDimensions;

flat out int vertexID;
flat out vec2 uv;

float bump(float x, float q, float w) {
  float clamped_x = clamp(x/w, -0.5, 0.5);
  float y = pow(exp(1.0 - 1.0 / (1.0 - pow(2.0*clamped_x, 2.0))), q);
  return y;
}

void main() {
  vTargetPosition = targetPosition;
  float nearness = bump(length(mousePosition - currentPosition.xy), 100.0, 20.0);
  float mixRatio = uMixRatio;
  vUpdatedSize = mix(currentSize, targetSize, mixRatio);

  
  vec3 delta = targetPosition - currentPosition;
  float distance = length(delta);

  vUpdatedPosition = currentPosition + normalize(delta)*min(0.005, distance/200.0);
  vUpdatedPosition = mix(currentPosition, targetPosition, mixRatio);
  vUpdatedColor = mix(currentColor, targetColor, mixRatio);
  vUpdatedEmphasis = mix(currentEmphasis, targetEmphasis, mixRatio);

  uint v = uint(gl_VertexID);
  
  vertexID = int(v);
  
  uv = vec2(
    float(int(v) % int(bufferDimensions.x)),
    float(int(v) / int(bufferDimensions.x))
  );
  
  uv = uv / float(bufferDimensions);
  uv += vec2(0.5/bufferDimensions.x, 0.5/bufferDimensions.y);
  
  
  
  
  gl_Position = vec4(uv*2.0 - 1.0, 0.0, 1.0);
  gl_PointSize = 1.0;
  
}`,fs=`#version 300 es
precision highp float;
precision highp int;

in vec3 vUpdatedPosition;
in vec3 vTargetPosition;
in vec4 vUpdatedColor;
in float vUpdatedSize;
in float vUpdatedEmphasis;

flat in int vertexID;

layout(location = 1) out vec4 position;
layout(location = 2) out vec4 color;
layout(location = 3) out vec4 size;
layout(location = 4) out vec4 emphasis;

uniform vec2 bufferDimensions;

void main() {
  position = vec4(vUpdatedPosition, 1.0);
  
  
  
  

  color = vUpdatedColor;
  size = vec4(vUpdatedSize,0,0,1);
  emphasis = vec4(vUpdatedEmphasis,0,0,1);
}`,Es=`#version 300 es
precision highp float;
precision highp int;

layout(location=0) in ivec2 edgeIndices;
layout(location=1) in vec3 segmentOffset;
layout(location=2) in lowp uint segmentParameter;

out vec4 color;
flat out vec4 sourceColor;
flat out vec4 targetColor;
out vec4 position;
out float size;
flat out vec2 edgeDirection;
flat out float edgeLength;
flat out float edgeLength2D;
out float isSource;
out float isTarget;
out float emphasis;
out float v;
out float y;

uniform vec2 mousePosition;

uniform cameras {
  mat4 projection;
  mat4 view;
  mat4 orthoFixedProjection;
  mat4 orthoFixedView;
  mat4 orthoZoomedProjection;
  mat4 orthoZoomedView;
};

struct CameraMatrices {
  mat4 projection;
  mat4 view;
  mat4 orthoFixedProjection;
  mat4 orthoFixedView;
  mat4 orthoZoomedProjection;
  mat4 orthoZoomedView;
};

struct NodeGeometryBundle {
  vec3 globalNDC;
  vec4 globalClipPosition;
  vec4 orthoFixedClipPosition;
  vec4 orthoZoomedClipPosition;
  vec4 orthographicClipPosition;
};

NodeGeometryBundle nodeGeometry(
  in vec3 nodePosition,
  in vec3 vertexPosition,
  float scale,
  in CameraMatrices cam
) {
  vec4 globalClipPosition = cam.projection * cam.view * vec4(nodePosition, 1.0);
  vec3 globalNDC = globalClipPosition.xyz / globalClipPosition.w;

  vec4 orthoFixedClipPosition = cam.orthoFixedProjection * cam.orthoFixedView * vec4(vertexPosition*scale, 1.0);
  vec3 orthoFixedNDC = orthoFixedClipPosition.xyz / orthoFixedClipPosition.w;
  
  vec4 orthoZoomedClipPosition = cam.orthoZoomedProjection * cam.orthoZoomedView * vec4(vertexPosition*scale, 1.0)*0.5;
  vec3 orthoZoomedNDC = orthoZoomedClipPosition.xyz / orthoZoomedClipPosition.w;

  vec3 localNDC = mix(orthoZoomedNDC, orthoFixedNDC, 0.5);

  
  vec3 orthographicNDC = vec3(localNDC.xy + globalNDC.xy, globalNDC.z + (localNDC.z - 0.99)*0.2 );
  
  vec4 orthographicClipPosition = vec4(orthographicNDC * globalClipPosition.w, globalClipPosition.w);
  
  return NodeGeometryBundle(
    globalNDC,
    globalClipPosition,
    orthoFixedClipPosition,
    orthoZoomedClipPosition,
    orthographicClipPosition
  );
}

uniform sampler2D positionTexture;
uniform sampler2D colorTexture;
uniform sampler2D sizeTexture;
uniform sampler2D emphasisTexture;
uniform ivec2 textureDimensions;

uniform bool selected;
uniform bool hovered;

vec3 desaturate(vec3 color, float amount) {
  float average = (color.r + color.g + color.b) / 3.0;
  return mix(color, vec3(average), amount);
}

ivec2 getTextureIndex(int index, ivec2 textureDimensions) {
  int textureLength = textureDimensions.x * textureDimensions.y;
  

  
  int x = index % textureDimensions.x;
  int y = index / textureDimensions.x;

  return ivec2(x,y);
}

vec4 edgeGeometry(
  in vec3 nodePosition,
  in vec3 vertexPosition,
  in vec2 edgeDirection,
  float scale,
  float flatness,
  in CameraMatrices cam
) {
  vec2 edgePerpendicular = vec2(-edgeDirection.y, edgeDirection.x)*scale/3.0;
  vec4 position = cam.projection * cam.view * vec4(nodePosition, 1.0);
  vec4 positionNDC = position / position.w;
  
  

  vec4 positionClip = vec4(position.xy + vertexPosition.y*1.0 * edgePerpendicular, position.zw);

  vec4 positionFixedStrokeNDC = positionNDC + vec4(vertexPosition.y * edgePerpendicular, 0.0, 0.0);
  vec4 positionFixedStrokeClip = positionFixedStrokeNDC * position.w;

  
  return mix(positionFixedStrokeClip, positionClip, 1.0-flatness);
}

float bump(float x, float q, float w) {
  float clamped_x = clamp(x/w, -0.5, 0.5);
  float y = pow(exp(1.0 - 1.0 / (1.0 - pow(2.0*clamped_x, 2.0))), q);
  return y;
}

void main() {
  isSource = segmentOffset.x;
  isTarget = 1.0-segmentOffset.x;
  
  float sourceEmphasis = texelFetch(emphasisTexture, getTextureIndex(edgeIndices.x, textureDimensions), 0).r;
  float targetEmphasis = texelFetch(emphasisTexture, getTextureIndex(edgeIndices.y, textureDimensions), 0).r;

  emphasis = max(sourceEmphasis, targetEmphasis);
  
  position = vec4(0);
  vec3 vertexOffset = segmentOffset + vec3(0.0, -0.5, 0.0);

  vec3 sourceNodePosition = texelFetch(positionTexture, getTextureIndex(edgeIndices.x, textureDimensions), 0).xyz;
  vec3 targetNodePosition = texelFetch(positionTexture, getTextureIndex(edgeIndices.y, textureDimensions), 0).xyz;
  vec3 nodePosition = sourceNodePosition*isSource + targetNodePosition*isTarget;
  
  float sourceSize = texelFetch(sizeTexture, getTextureIndex(edgeIndices.x, textureDimensions), 0).r;
  float targetSize = texelFetch(sizeTexture, getTextureIndex(edgeIndices.y, textureDimensions), 0).r;

  size = sourceSize*isSource + targetSize*isTarget;
  size *= mix(0.3, 0.1, emphasis);
  
  vec4 targetPositionClip = projection * view * vec4(targetNodePosition, 1.0);
  vec4 sourcePositionClip = projection * view * vec4(sourceNodePosition, 1.0);
  
  edgeDirection = normalize(targetPositionClip.xyz/targetPositionClip.w - sourcePositionClip.xyz/sourcePositionClip.w).xy;
  edgeLength = length(targetNodePosition.xyz - sourceNodePosition.xyz);
  edgeLength2D = length((targetPositionClip.xy/targetPositionClip.w - sourcePositionClip.xy/sourcePositionClip.w));

  position = edgeGeometry(
    nodePosition,
    vertexOffset,
    edgeDirection,
    size,
    mix(0.5, 1.0, emphasis),
    CameraMatrices(
      projection,
      view,
      orthoFixedProjection,
      orthoFixedView,
      orthoZoomedProjection,
      orthoZoomedView
    )
  );

  
  position.z += 0.01 * position.w * bump(vertexOffset.x, 4.0, 0.125);

  vec4 sourceColor = texelFetch(colorTexture, getTextureIndex(edgeIndices.x, textureDimensions), 0);
  vec4 targetColor = texelFetch(colorTexture, getTextureIndex(edgeIndices.y, textureDimensions), 0);
  color += sourceColor*isSource;
  color += targetColor*isTarget;

  
  color.rgb = desaturate(color.rgb, 1.0-emphasis);
  color.a *= mix(0.25, 1.0, emphasis);

  
  
  
  

  
  

  gl_Position = position;
  y = vertexOffset.y;
  v = segmentOffset.y;

  float distance = length(mousePosition - position.xy);
  
}`,_s=`#version 300 es
precision highp float;

in vec4 color;
in vec4 position;
in float emphasis;
in float size;
flat in vec2 edgeDirection;
flat in float edgeLength;
flat in float edgeLength2D;
in float isTarget;
in float isSource;
in float y;

out vec4 fragColor;

const float PI = 3.1415926535897932384626433832795;
const float freq = 1.0;

uniform float time;

float bump(float x, float q, float w) {
  float clamped_x = clamp(x/w, -0.5, 0.5);
  float y = pow(exp(1.0 - 1.0 / (1.0 - pow(2.0*clamped_x, 2.0))), q);
  return y;
}
float sdEgg( in vec2 p, in float ra, in float rb )
{
    const float k = sqrt(3.0);
    p.x = abs(p.x);
    float r = ra - rb;
    return ((p.y<0.0)       ? length(vec2(p.x,  p.y    )) - r :
            (k*(p.x+r)<p.y) ? length(vec2(p.x,  p.y-k*r)) :
                              length(vec2(p.x+r,p.y    )) - 2.0*r) - rb;
}

float sdEquilateralTriangle( in vec2 p )
{
    const float k = sqrt(3.0);
    p.x = abs(p.x) - 1.0;
    p.y = p.y + 1.0/k;
    if( p.x+k*p.y>0.0 ) p = vec2(p.x-k*p.y,-k*p.x-p.y)/2.0;
    p.x -= clamp( p.x, -2.0, 0.0 );
    return -length(p)*sign(p.y);
}

float wave(float t, float freq){ return pow(sin(t * freq * PI), 2.0); }
void main() {
  float u = isTarget;
  
  
  
  float d = sdEquilateralTriangle(vec2(y*4.0, (isSource-0.5)*edgeLength2D*10.0/size));
  float triangle = d < 0.0 ? 1.0 : 0.0;

  fragColor = color;
  
  
  
  
  
  
  fragColor.a *= bump(y, 1.0, 1.0);

  
  fragColor.a *= mix(1.0, wave(u + time/20.0, 50.0), mix(0.1, 1.0, emphasis));
  
  
  

  
  fragColor.a = min(1.0-triangle/3.0, fragColor.a);
  
  fragColor.a *= mix(0.5, 1.0, emphasis);
  
  
  fragColor.rgb *= mix(1.0, bump(position.x/position.w, 2.0, 1.0), 0.5);

  
  
}`,ds=`#version 300 es
precision highp float;
precision highp int;

layout(location=0) in vec3 nodePosition;
layout(location=1) in vec4 nodeColor;
layout(location=2) in float nodeSize;

layout(location=3) in vec3 vertexPosition;
layout(location=4) in vec3 vertexNormal;

uniform cameras {
  mat4 projection;
  mat4 view;
  mat4 orthoFixedProjection;
  mat4 orthoFixedView;
  mat4 orthoZoomedProjection;
  mat4 orthoZoomedView;
};

struct CameraMatrices {
  mat4 projection;
  mat4 view;
  mat4 orthoFixedProjection;
  mat4 orthoFixedView;
  mat4 orthoZoomedProjection;
  mat4 orthoZoomedView;
};

struct NodeGeometryBundle {
  vec3 globalNDC;
  vec4 globalClipPosition;
  vec4 orthoFixedClipPosition;
  vec4 orthoZoomedClipPosition;
  vec4 orthographicClipPosition;
};

NodeGeometryBundle nodeGeometry(
  in vec3 nodePosition,
  in vec3 vertexPosition,
  float scale,
  in CameraMatrices cam
) {
  vec4 globalClipPosition = cam.projection * cam.view * vec4(nodePosition, 1.0);
  vec3 globalNDC = globalClipPosition.xyz / globalClipPosition.w;

  vec4 orthoFixedClipPosition = cam.orthoFixedProjection * cam.orthoFixedView * vec4(vertexPosition*scale, 1.0);
  vec3 orthoFixedNDC = orthoFixedClipPosition.xyz / orthoFixedClipPosition.w;
  
  vec4 orthoZoomedClipPosition = cam.orthoZoomedProjection * cam.orthoZoomedView * vec4(vertexPosition*scale, 1.0)*0.5;
  vec3 orthoZoomedNDC = orthoZoomedClipPosition.xyz / orthoZoomedClipPosition.w;

  vec3 localNDC = mix(orthoZoomedNDC, orthoFixedNDC, 0.5);

  
  vec3 orthographicNDC = vec3(localNDC.xy + globalNDC.xy, globalNDC.z + (localNDC.z - 0.99)*0.2 );
  
  vec4 orthographicClipPosition = vec4(orthographicNDC * globalClipPosition.w, globalClipPosition.w);
  
  return NodeGeometryBundle(
    globalNDC,
    globalClipPosition,
    orthoFixedClipPosition,
    orthoZoomedClipPosition,
    orthographicClipPosition
  );
}

uniform vec2 mousePosition;

uniform int selectedIndex;

#ifdef PICKER
  flat out vec4 color;
#else
  out vec4 color;
#endif

out vec3 position;
out vec3 normal;

float bump(float x, float q, float w) {
  float clamped_x = clamp(x/w, -0.5, 0.5);
  float y = pow(exp(1.0 - 1.0 / (1.0 - pow(2.0*clamped_x, 2.0))), q);
  return y;
}

void main() {
  float scale = nodeSize;
  float isSelected = float(gl_InstanceID == selectedIndex);
  scale *= mix(1.0, 1.1, isSelected);
  
  #ifdef PICKER
    scale *= 1.25;
  #endif

  NodeGeometryBundle geo = nodeGeometry(
    nodePosition,
    vertexPosition,
    scale,
    CameraMatrices(
      projection,
      view,
      orthoFixedProjection,
      orthoFixedView,
      orthoZoomedProjection,
      orthoZoomedView
    )
  );
  
  
  float distance = length(geo.globalNDC.xy - mousePosition);
  float nearness = bump(distance, 2.0, 1.0);

  vec4 clipPosition = geo.orthographicClipPosition;
  
  vec4 selectedColor = vec4(1.0, 1.0, 1.0, 1.0);
  
  #ifdef PICKER
    color = instanceIdToColor();
  #else
    color = mix(nodeColor, selectedColor, float(gl_InstanceID == selectedIndex));
  #endif

  normal = mat3(orthoFixedView) * vertexNormal;
  gl_Position = clipPosition;
}`,As=`#version 300 es
precision highp float;
in vec4 color;
in vec3 normal;

in vec3 position;
out vec4 fragColor;

void main() {
  
  
  const vec3 lightDirection = normalize(vec3(0.0, 0.0, 1.0));
  float light = dot(normal, lightDirection);
  

  
  fragColor = vec4(color.xyz*light, color.a);
  
}`,Ts=`#version 300 es
precision lowp float;

vec4 instanceIdToColor() {
  int instanceId = gl_InstanceID+1;
  float r = float(instanceId & 0x0000FF) / 255.0;
  float g = float((instanceId & 0x00FF00) >> 8) / 255.0;
  float b = float((instanceId & 0xFF0000) >> 16) / 255.0;

  return vec4(r, g, b, 1.0);
}

#define PICKER
layout(location=0) in vec3 nodePosition;
layout(location=1) in vec4 nodeColor;
layout(location=2) in float nodeSize;

layout(location=3) in vec3 vertexPosition;
layout(location=4) in vec3 vertexNormal;

uniform cameras {
  mat4 projection;
  mat4 view;
  mat4 orthoFixedProjection;
  mat4 orthoFixedView;
  mat4 orthoZoomedProjection;
  mat4 orthoZoomedView;
};

struct CameraMatrices {
  mat4 projection;
  mat4 view;
  mat4 orthoFixedProjection;
  mat4 orthoFixedView;
  mat4 orthoZoomedProjection;
  mat4 orthoZoomedView;
};

struct NodeGeometryBundle {
  vec3 globalNDC;
  vec4 globalClipPosition;
  vec4 orthoFixedClipPosition;
  vec4 orthoZoomedClipPosition;
  vec4 orthographicClipPosition;
};

NodeGeometryBundle nodeGeometry(
  in vec3 nodePosition,
  in vec3 vertexPosition,
  float scale,
  in CameraMatrices cam
) {
  vec4 globalClipPosition = cam.projection * cam.view * vec4(nodePosition, 1.0);
  vec3 globalNDC = globalClipPosition.xyz / globalClipPosition.w;

  vec4 orthoFixedClipPosition = cam.orthoFixedProjection * cam.orthoFixedView * vec4(vertexPosition*scale, 1.0);
  vec3 orthoFixedNDC = orthoFixedClipPosition.xyz / orthoFixedClipPosition.w;
  
  vec4 orthoZoomedClipPosition = cam.orthoZoomedProjection * cam.orthoZoomedView * vec4(vertexPosition*scale, 1.0)*0.5;
  vec3 orthoZoomedNDC = orthoZoomedClipPosition.xyz / orthoZoomedClipPosition.w;

  vec3 localNDC = mix(orthoZoomedNDC, orthoFixedNDC, 0.5);

  
  vec3 orthographicNDC = vec3(localNDC.xy + globalNDC.xy, globalNDC.z + (localNDC.z - 0.99)*0.2 );
  
  vec4 orthographicClipPosition = vec4(orthographicNDC * globalClipPosition.w, globalClipPosition.w);
  
  return NodeGeometryBundle(
    globalNDC,
    globalClipPosition,
    orthoFixedClipPosition,
    orthoZoomedClipPosition,
    orthographicClipPosition
  );
}

uniform vec2 mousePosition;

uniform int selectedIndex;

#ifdef PICKER
  flat out vec4 color;
#else
  out vec4 color;
#endif

out vec3 position;
out vec3 normal;

float bump(float x, float q, float w) {
  float clamped_x = clamp(x/w, -0.5, 0.5);
  float y = pow(exp(1.0 - 1.0 / (1.0 - pow(2.0*clamped_x, 2.0))), q);
  return y;
}

void main() {
  float scale = nodeSize;
  float isSelected = float(gl_InstanceID == selectedIndex);
  scale *= mix(1.0, 1.1, isSelected);
  
  #ifdef PICKER
    scale *= 1.25;
  #endif

  NodeGeometryBundle geo = nodeGeometry(
    nodePosition,
    vertexPosition,
    scale,
    CameraMatrices(
      projection,
      view,
      orthoFixedProjection,
      orthoFixedView,
      orthoZoomedProjection,
      orthoZoomedView
    )
  );
  
  
  float distance = length(geo.globalNDC.xy - mousePosition);
  float nearness = bump(distance, 2.0, 1.0);

  vec4 clipPosition = geo.orthographicClipPosition;
  
  vec4 selectedColor = vec4(1.0, 1.0, 1.0, 1.0);
  
  #ifdef PICKER
    color = instanceIdToColor();
  #else
    color = mix(nodeColor, selectedColor, float(gl_InstanceID == selectedIndex));
  #endif

  normal = mat3(orthoFixedView) * vertexNormal;
  gl_Position = clipPosition;
}`,ms=`#version 300 es
precision lowp float;

flat in vec4 color;
out vec4 fragColor;

void main() {
  fragColor = color;
}`;function ps(t,e,r,n,s,a){t===void 0&&(t=1),e===void 0&&(e=t),r===void 0&&(r=t),n===void 0&&(n=1),s===void 0&&(s=n),a===void 0&&(a=n);var l=0,o=[],u=[],h=[],m=[];function f(A,x,C,b,G,B,g,d,V,W){for(var k=l,Y=0;Y<=g;Y++)for(var ee=0;ee<=B;ee++){var se=o[l]=[0,0,0];se[A]=(-b/2+ee*b/B)*V,se[x]=(-G/2+Y*G/g)*W,se[C]=d;var _e=u[l]=[0,0,0];_e[A]=0,_e[x]=0,_e[C]=d/Math.abs(d);var T=h[l]=[0,0];T[0]=ee/B,T[1]=1-Y/g,++l}for(var Y=0;Y<g;Y++)for(var ee=0;ee<B;ee++){var H=k+Y*(B+1)+ee;m.push([H,H+B+1,H+B+2]),m.push([H,H+B+2,H+1])}}return f(0,1,2,t,e,n,s,r/2,1,-1),f(0,1,2,t,e,n,s,-r/2,-1,-1),f(2,1,0,r,e,a,s,-t/2,1,-1),f(2,1,0,r,e,a,s,t/2,-1,-1),f(0,2,1,t,r,n,a,e/2,1,1),f(0,2,1,t,r,n,a,-e/2,1,-1),{positions:o,normals:u,uvs:h,cells:m}}var Rs=ps,gs=1e-6,xs=function(t,e,r){for(var n=e.length,s=new Array(n),a=r===void 0?gs:r,l=0;l<n;++l)s[l]=[0,0,0];for(var l=0;l<t.length;++l)for(var o=t[l],u=0,h=o[o.length-1],m=o[0],f=0;f<o.length;++f){u=h,h=m,m=o[(f+1)%o.length];for(var A=e[u],x=e[h],C=e[m],b=new Array(3),G=0,B=new Array(3),g=0,d=0;d<3;++d)b[d]=A[d]-x[d],G+=b[d]*b[d],B[d]=C[d]-x[d],g+=B[d]*B[d];if(G*g>a)for(var V=s[h],W=1/Math.sqrt(G*g),d=0;d<3;++d){var k=(d+1)%3,Y=(d+2)%3;V[d]+=W*(B[k]*b[Y]-B[Y]*b[k])}}for(var l=0;l<n;++l){for(var V=s[l],ee=0,d=0;d<3;++d)ee+=V[d]*V[d];if(ee>a)for(var W=1/Math.sqrt(ee),d=0;d<3;++d)V[d]*=W;else for(var d=0;d<3;++d)V[d]=0}return s};function qn(t,e,r){var n=t[r]|0;if(n<=0)return[];var s=new Array(n),a;if(r===t.length-1)for(a=0;a<n;++a)s[a]=e;else for(a=0;a<n;++a)s[a]=qn(t,e,r+1);return s}function Ss(t,e){var r,n;for(r=new Array(t),n=0;n<t;++n)r[n]=e;return r}function vs(t,e){switch(typeof e>"u"&&(e=0),typeof t){case"number":if(t>0)return Ss(t|0,e);break;case"object":if(typeof t.length=="number")return qn(t,e,0);break}return[]}var Cs=vs,rr=Cs;function Ue(t,e,r){return t+(r+1)*e}function Ns(t,e,r,n,s){r=r||[0,0],(!n||n.length<r.length)&&(n=rr(r.length),r.length>0&&(n[0]=1)),(!s||s.length<r.length)&&(s=rr(r.length),r.length>1&&(s[1]=1));var a=[],l=rr([(t+1)*(e+1),r.length]),o,u,h,m,f=r.length;for(u=0;u<e;++u)for(o=0;o<t;++o)a.push([Ue(o,u,t),Ue(o+1,u,t),Ue(o,u+1,t)]),a.push([Ue(o+1,u,t),Ue(o+1,u+1,t),Ue(o,u+1,t)]);for(u=0;u<=e;++u)for(o=0;o<=t;++o)for(m=l[Ue(o,u,t)],h=0;h<f;++h)m[h]=r[h]+n[h]*o+s[h]*u;return{positions:l,cells:a}}var Is=Ns;const Ds=ie(()=>te().createProgram(ds,As)),Fs=ie(()=>te().createProgram(Ts,ms)),ys=ie.infinite(()=>{const t=Rs(1),e=t.positions,r=t.cells,n=xs(r,e),s=te().createVertexBuffer(M.FLOAT,3,new Float32Array(e.flat())),a=te().createIndexBuffer(M.UNSIGNED_SHORT,new Uint16Array(r.flat())),l=te().createVertexBuffer(M.FLOAT,3,new Float32Array(n.flat()));return te().createVertexArray().vertexAttributeBuffer(3,s).vertexAttributeBuffer(4,l).indexBuffer(a)}),Zn=()=>{const t=ys(),e=me().current,r=ge().current,n=xe().current;return t.instanceAttributeBuffer(0,e).instanceAttributeBuffer(1,r).instanceAttributeBuffer(2,n)},nn=ie.infinite(t=>{const e=te(),r=e.width,n=e.height;let s=e.createTexture2D(r,n,{internalFormat:M.RGBA8,minFilter:M.NEAREST,magFilter:M.NEAREST}),a=e.createRenderbuffer(r,n,M.DEPTH_COMPONENT16);return e.createFramebuffer().colorTarget(0,s).depthTarget(a)});class Bs{constructor(e,r){this.A=e,this.B=r,this._current=e}swap(){this._current=this.current===this.A?this.B:this.A}get current(){return this._current}get other(){return this._current===this.A?this.B:this.A}}const Qn=ie.infinite(()=>{te();const t=nn("A"),e=nn("B");return new Bs(t,e)}),Ps=ie.infinite(()=>{const t=Fs(),e=Zn();return te().createDrawCall(t,e).primitive(M.TRIANGLES)}),Ms=ie.infinite(()=>{const t=Ds(),e=Zn();return te().createDrawCall(t,e).primitive(M.TRIANGLES)}),Os=ie(()=>te().createProgram(Es,_s)),Jn=20,ei=1,Ut=Is(Jn,ei);Ut.positions=Ut.positions.map(([t,e])=>[t/Jn,e/ei]);ie.infinite(t=>{const e=new Uint32Array(t.flat());return te().createIndexBuffer(M.UNSIGNED_INT,e)});const bs=ie.infinite(t=>{const e=new Int32Array(t.flat());return te().createVertexBuffer(M.INT,2,e)}),Ls=ie.infinite(()=>te().createVertexBuffer(M.FLOAT,2,new Float32Array(Ut.positions.flat()))),ws=ie.infinite(()=>te().createIndexBuffer(M.UNSIGNED_SHORT,new Uint16Array(Ut.cells.flat()))),Us=ie.infinite(()=>te().createVertexArray()),Gs=ie.infinite(t=>{const e=Us(),r=bs(t),n=Ls(),s=ws();return e.instanceAttributeBuffer(0,r).vertexAttributeBuffer(1,n).indexBuffer(s)});let ti;const Hs=t=>{ti=t},Vs=()=>Gs(ti),Xs=ie.infinite(()=>{const t=Os(),e=Vs();return te().createDrawCall(t,e).primitive(M.TRIANGLES)}),ri=Symbol("Comlink.proxy"),ks=Symbol("Comlink.endpoint"),zs=Symbol("Comlink.releaseProxy"),Ir=Symbol("Comlink.thrown"),ni=t=>typeof t=="object"&&t!==null||typeof t=="function",$s={canHandle:t=>ni(t)&&t[ri],serialize(t){const{port1:e,port2:r}=new MessageChannel;return si(t,e),[r,[r]]},deserialize(t){return t.start(),Yt(t)}},Ks={canHandle:t=>ni(t)&&Ir in t,serialize({value:t}){let e;return t instanceof Error?e={isError:!0,value:{message:t.message,name:t.name,stack:t.stack}}:e={isError:!1,value:t},[e,[]]},deserialize(t){throw t.isError?Object.assign(new Error(t.value.message),t.value):t.value}},ii=new Map([["proxy",$s],["throw",Ks]]);function si(t,e=self){e.addEventListener("message",function r(n){if(!n||!n.data)return;const{id:s,type:a,path:l}=Object.assign({path:[]},n.data),o=(n.data.argumentList||[]).map(He);let u;try{const h=l.slice(0,-1).reduce((f,A)=>f[A],t),m=l.reduce((f,A)=>f[A],t);switch(a){case"GET":u=m;break;case"SET":h[l.slice(-1)[0]]=He(n.data.value),u=!0;break;case"APPLY":u=m.apply(h,o);break;case"CONSTRUCT":{const f=new m(...o);u=Tt(f)}break;case"ENDPOINT":{const{port1:f,port2:A}=new MessageChannel;si(t,A),u=js(f,[f])}break;case"RELEASE":u=void 0;break;default:return}}catch(h){u={value:h,[Ir]:0}}Promise.resolve(u).catch(h=>({value:h,[Ir]:0})).then(h=>{const[m,f]=Xr(h);e.postMessage(Object.assign(Object.assign({},m),{id:s}),f),a==="RELEASE"&&(e.removeEventListener("message",r),ai(e))})}),e.start&&e.start()}function Ws(t){return t.constructor.name==="MessagePort"}function ai(t){Ws(t)&&t.close()}function Yt(t,e){return Dr(t,[],e)}function Dt(t){if(t)throw new Error("Proxy has been released and is not useable")}function Dr(t,e=[],r=function(){}){let n=!1;const s=new Proxy(r,{get(a,l){if(Dt(n),l===zs)return()=>ze(t,{type:"RELEASE",path:e.map(o=>o.toString())}).then(()=>{ai(t),n=!0});if(l==="then"){if(e.length===0)return{then:()=>s};const o=ze(t,{type:"GET",path:e.map(u=>u.toString())}).then(He);return o.then.bind(o)}return Dr(t,[...e,l])},set(a,l,o){Dt(n);const[u,h]=Xr(o);return ze(t,{type:"SET",path:[...e,l].map(m=>m.toString()),value:u},h).then(He)},apply(a,l,o){Dt(n);const u=e[e.length-1];if(u===ks)return ze(t,{type:"ENDPOINT"}).then(He);if(u==="bind")return Dr(t,e.slice(0,-1));const[h,m]=sn(o);return ze(t,{type:"APPLY",path:e.map(f=>f.toString()),argumentList:h},m).then(He)},construct(a,l){Dt(n);const[o,u]=sn(l);return ze(t,{type:"CONSTRUCT",path:e.map(h=>h.toString()),argumentList:o},u).then(He)}});return s}function Ys(t){return Array.prototype.concat.apply([],t)}function sn(t){const e=t.map(Xr);return[e.map(r=>r[0]),Ys(e.map(r=>r[1]))]}const oi=new WeakMap;function js(t,e){return oi.set(t,e),t}function Tt(t){return Object.assign(t,{[ri]:!0})}function Xr(t){for(const[e,r]of ii)if(r.canHandle(t)){const[n,s]=r.serialize(t);return[{type:"HANDLER",name:e,value:n},s]}return[{type:"RAW",value:t},oi.get(t)||[]]}function He(t){switch(t.type){case"HANDLER":return ii.get(t.name).deserialize(t.value);case"RAW":return t.value}}function ze(t,e,r){return new Promise(n=>{const s=qs();t.addEventListener("message",function a(l){!l.data||!l.data.id||l.data.id!==s||(t.removeEventListener("message",a),n(l.data))}),t.start&&t.start(),t.postMessage(Object.assign({id:s},e),r)})}function qs(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}var Zs=typeof global=="object"&&global&&global.Object===Object&&global;const Qs=Zs;var Js=typeof self=="object"&&self&&self.Object===Object&&self,ea=Qs||Js||Function("return this")();const St=ea;var ta=St.Symbol;const Gt=ta;var li=Object.prototype,ra=li.hasOwnProperty,na=li.toString,at=Gt?Gt.toStringTag:void 0;function ia(t){var e=ra.call(t,at),r=t[at];try{t[at]=void 0;var n=!0}catch{}var s=na.call(t);return n&&(e?t[at]=r:delete t[at]),s}var sa=Object.prototype,aa=sa.toString;function oa(t){return aa.call(t)}var la="[object Null]",ua="[object Undefined]",an=Gt?Gt.toStringTag:void 0;function ui(t){return t==null?t===void 0?ua:la:an&&an in Object(t)?ia(t):oa(t)}function ha(t){return t!=null&&typeof t=="object"}var ca="[object Symbol]";function fa(t){return typeof t=="symbol"||ha(t)&&ui(t)==ca}var Ea=/\s/;function _a(t){for(var e=t.length;e--&&Ea.test(t.charAt(e)););return e}var da=/^\s+/;function Aa(t){return t&&t.slice(0,_a(t)+1).replace(da,"")}function Qe(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}var on=0/0,Ta=/^[-+]0x[0-9a-f]+$/i,ma=/^0b[01]+$/i,pa=/^0o[0-7]+$/i,Ra=parseInt;function ln(t){if(typeof t=="number")return t;if(fa(t))return on;if(Qe(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=Qe(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=Aa(t);var r=ma.test(t);return r||pa.test(t)?Ra(t.slice(2),r?2:8):Ta.test(t)?on:+t}function Je(t){return t}var ga="[object AsyncFunction]",xa="[object Function]",Sa="[object GeneratorFunction]",va="[object Proxy]";function Ca(t){if(!Qe(t))return!1;var e=ui(t);return e==xa||e==Sa||e==ga||e==va}var Na=St["__core-js_shared__"];const nr=Na;var un=function(){var t=/[^.]+$/.exec(nr&&nr.keys&&nr.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}();function Ia(t){return!!un&&un in t}var Da=Function.prototype,Fa=Da.toString;function ya(t){if(t!=null){try{return Fa.call(t)}catch{}try{return t+""}catch{}}return""}var Ba=/[\\^$.*+?()[\]{}|]/g,Pa=/^\[object .+?Constructor\]$/,Ma=Function.prototype,Oa=Object.prototype,ba=Ma.toString,La=Oa.hasOwnProperty,wa=RegExp("^"+ba.call(La).replace(Ba,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function Ua(t){if(!Qe(t)||Ia(t))return!1;var e=Ca(t)?wa:Pa;return e.test(ya(t))}function Ga(t,e){return t?.[e]}function kr(t,e){var r=Ga(t,e);return Ua(r)?r:void 0}function Ha(){}function Va(t,e,r,n){for(var s=t.length,a=r+(n?1:-1);n?a--:++a<s;)if(e(t[a],a,t))return a;return-1}function Xa(t){return t!==t}function ka(t,e,r){for(var n=r-1,s=t.length;++n<s;)if(t[n]===e)return n;return-1}function za(t,e,r){return e===e?ka(t,e,r):Va(t,Xa,r)}function $a(t,e){var r=t==null?0:t.length;return!!r&&za(t,e,0)>-1}function Ka(t,e){return t===e||t!==t&&e!==e}var Wa=kr(Object,"create");const mt=Wa;function Ya(){this.__data__=mt?mt(null):{},this.size=0}function ja(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}var qa="__lodash_hash_undefined__",Za=Object.prototype,Qa=Za.hasOwnProperty;function Ja(t){var e=this.__data__;if(mt){var r=e[t];return r===qa?void 0:r}return Qa.call(e,t)?e[t]:void 0}var eo=Object.prototype,to=eo.hasOwnProperty;function ro(t){var e=this.__data__;return mt?e[t]!==void 0:to.call(e,t)}var no="__lodash_hash_undefined__";function io(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=mt&&e===void 0?no:e,this}function Ve(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}Ve.prototype.clear=Ya;Ve.prototype.delete=ja;Ve.prototype.get=Ja;Ve.prototype.has=ro;Ve.prototype.set=io;function so(){this.__data__=[],this.size=0}function jt(t,e){for(var r=t.length;r--;)if(Ka(t[r][0],e))return r;return-1}var ao=Array.prototype,oo=ao.splice;function lo(t){var e=this.__data__,r=jt(e,t);if(r<0)return!1;var n=e.length-1;return r==n?e.pop():oo.call(e,r,1),--this.size,!0}function uo(t){var e=this.__data__,r=jt(e,t);return r<0?void 0:e[r][1]}function ho(t){return jt(this.__data__,t)>-1}function co(t,e){var r=this.__data__,n=jt(r,t);return n<0?(++this.size,r.push([t,e])):r[n][1]=e,this}function nt(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}nt.prototype.clear=so;nt.prototype.delete=lo;nt.prototype.get=uo;nt.prototype.has=ho;nt.prototype.set=co;var fo=kr(St,"Map");const Eo=fo;function _o(){this.size=0,this.__data__={hash:new Ve,map:new(Eo||nt),string:new Ve}}function Ao(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}function qt(t,e){var r=t.__data__;return Ao(e)?r[typeof e=="string"?"string":"hash"]:r.map}function To(t){var e=qt(this,t).delete(t);return this.size-=e?1:0,e}function mo(t){return qt(this,t).get(t)}function po(t){return qt(this,t).has(t)}function Ro(t,e){var r=qt(this,t),n=r.size;return r.set(t,e),this.size+=r.size==n?0:1,this}function it(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}it.prototype.clear=_o;it.prototype.delete=To;it.prototype.get=mo;it.prototype.has=po;it.prototype.set=Ro;var go=kr(St,"Set");const ir=go;var xo="__lodash_hash_undefined__";function So(t){return this.__data__.set(t,xo),this}function vo(t){return this.__data__.has(t)}function Ht(t){var e=-1,r=t==null?0:t.length;for(this.__data__=new it;++e<r;)this.add(t[e])}Ht.prototype.add=Ht.prototype.push=So;Ht.prototype.has=vo;function Co(t,e){return t.has(e)}function hi(t){var e=-1,r=Array(t.size);return t.forEach(function(n){r[++e]=n}),r}var No=function(){return St.Date.now()};const sr=No;var Io="Expected a function",Do=Math.max,Fo=Math.min;function ci(t,e,r){var n,s,a,l,o,u,h=0,m=!1,f=!1,A=!0;if(typeof t!="function")throw new TypeError(Io);e=ln(e)||0,Qe(r)&&(m=!!r.leading,f="maxWait"in r,a=f?Do(ln(r.maxWait)||0,e):a,A="trailing"in r?!!r.trailing:A);function x(k){var Y=n,ee=s;return n=s=void 0,h=k,l=t.apply(ee,Y),l}function C(k){return h=k,o=setTimeout(B,e),m?x(k):l}function b(k){var Y=k-u,ee=k-h,se=e-Y;return f?Fo(se,a-ee):se}function G(k){var Y=k-u,ee=k-h;return u===void 0||Y>=e||Y<0||f&&ee>=a}function B(){var k=sr();if(G(k))return g(k);o=setTimeout(B,b(k))}function g(k){return o=void 0,A&&n?x(k):(n=s=void 0,l)}function d(){o!==void 0&&clearTimeout(o),h=0,n=u=s=o=void 0}function V(){return o===void 0?l:g(sr())}function W(){var k=sr(),Y=G(k);if(n=arguments,s=this,u=k,Y){if(o===void 0)return C(u);if(f)return clearTimeout(o),o=setTimeout(B,e),x(u)}return o===void 0&&(o=setTimeout(B,e)),l}return W.cancel=d,W.flush=V,W}function yo(t,e,r){for(var n=-1,s=t==null?0:t.length;++n<s;)if(r(e,t[n]))return!0;return!1}function $e(t){for(var e=-1,r=t==null?0:t.length,n={};++e<r;){var s=t[e];n[s[0]]=s[1]}return n}var Bo="Expected a function";function Fr(t,e,r){var n=!0,s=!0;if(typeof t!="function")throw new TypeError(Bo);return Qe(r)&&(n="leading"in r?!!r.leading:n,s="trailing"in r?!!r.trailing:s),ci(t,e,{leading:n,maxWait:e,trailing:s})}var Po=1/0,Mo=ir&&1/hi(new ir([,-0]))[1]==Po?function(t){return new ir(t)}:Ha;const Oo=Mo;var bo=200;function Lo(t,e,r){var n=-1,s=$a,a=t.length,l=!0,o=[],u=o;if(r)l=!1,s=yo;else if(a>=bo){var h=e?null:Oo(t);if(h)return hi(h);l=!1,s=Co,u=new Ht}else u=e?[]:o;e:for(;++n<a;){var m=t[n],f=e?e(m):m;if(m=r||m!==0?m:0,l&&f===f){for(var A=u.length;A--;)if(u[A]===f)continue e;e&&u.push(f),o.push(m)}else s(u,f,r)||(u!==o&&u.push(f),o.push(m))}return o}function wo(t,e){return e=typeof e=="function"?e:void 0,t&&t.length?Lo(t,void 0,e):[]}const Vt=ie.infinite(()=>te().createUniformBuffer([M.FLOAT_MAT4,M.FLOAT_MAT4,M.FLOAT_MAT4,M.FLOAT_MAT4,M.FLOAT_MAT4,M.FLOAT_MAT4,M.UNSIGNED_INT])),Uo=Tt(Fr((t,e,r,n,s,a)=>{Vt().set(0,t).set(1,e).set(2,r).set(3,n).set(4,s).set(5,a).update()},1));var vt={};function Go(t){if(typeof t=="object"){if("buttons"in t)return t.buttons;if("which"in t){var e=t.which;if(e===2)return 4;if(e===3)return 2;if(e>0)return 1<<e-1}else if("button"in t){var e=t.button;if(e===1)return 4;if(e===2)return 2;if(e>=0)return 1<<e}}return 0}vt.buttons=Go;function zr(t){return t.target||t.srcElement||window}vt.element=zr;function Ho(t){if(typeof t=="object"){if("offsetX"in t)return t.offsetX;var e=zr(t),r=e.getBoundingClientRect();return t.clientX-r.left}return 0}vt.x=Ho;function Vo(t){if(typeof t=="object"){if("offsetY"in t)return t.offsetY;var e=zr(t),r=e.getBoundingClientRect();return t.clientY-r.top}return 0}vt.y=Vo;var Xo=ko,ot=vt;function ko(t,e){e||(e=t,t=window);var r=0,n=0,s=0,a={shift:!1,alt:!1,control:!1,meta:!1},l=!1;function o(g){var d=!1;return"altKey"in g&&(d=d||g.altKey!==a.alt,a.alt=!!g.altKey),"shiftKey"in g&&(d=d||g.shiftKey!==a.shift,a.shift=!!g.shiftKey),"ctrlKey"in g&&(d=d||g.ctrlKey!==a.control,a.control=!!g.ctrlKey),"metaKey"in g&&(d=d||g.metaKey!==a.meta,a.meta=!!g.metaKey),d}function u(g,d){var V=ot.x(d),W=ot.y(d);"buttons"in d&&(g=d.buttons|0),(g!==r||V!==n||W!==s||o(d))&&(r=g|0,n=V||0,s=W||0,e&&e(r,n,s,a))}function h(g){u(0,g)}function m(){(r||n||s||a.shift||a.alt||a.meta||a.control)&&(n=s=0,r=0,a.shift=a.alt=a.control=a.meta=!1,e&&e(0,0,0,a))}function f(g){o(g)&&e&&e(r,n,s,a)}function A(g){ot.buttons(g)===0?u(0,g):u(r,g)}function x(g){u(r|ot.buttons(g),g)}function C(g){u(r&~ot.buttons(g),g)}function b(){l||(l=!0,t.addEventListener("mousemove",A),t.addEventListener("mousedown",x),t.addEventListener("mouseup",C),t.addEventListener("mouseleave",h),t.addEventListener("mouseenter",h),t.addEventListener("mouseout",h),t.addEventListener("mouseover",h),t.addEventListener("blur",m),t.addEventListener("keyup",f),t.addEventListener("keydown",f),t.addEventListener("keypress",f),t!==window&&(window.addEventListener("blur",m),window.addEventListener("keyup",f),window.addEventListener("keydown",f),window.addEventListener("keypress",f)))}function G(){l&&(l=!1,t.removeEventListener("mousemove",A),t.removeEventListener("mousedown",x),t.removeEventListener("mouseup",C),t.removeEventListener("mouseleave",h),t.removeEventListener("mouseenter",h),t.removeEventListener("mouseout",h),t.removeEventListener("mouseover",h),t.removeEventListener("blur",m),t.removeEventListener("keyup",f),t.removeEventListener("keydown",f),t.removeEventListener("keypress",f),t!==window&&(window.removeEventListener("blur",m),window.removeEventListener("keyup",f),window.removeEventListener("keydown",f),window.removeEventListener("keypress",f)))}b();var B={element:t};return Object.defineProperties(B,{enabled:{get:function(){return l},set:function(g){g?b():G()},enumerable:!0},buttons:{get:function(){return r},enumerable:!0},x:{get:function(){return n},enumerable:!0},y:{get:function(){return s},enumerable:!0},mods:{get:function(){return a},enumerable:!0}}),B}var zo={left:0,top:0},$o=Ko;function Ko(t,e,r){e=e||t.currentTarget||t.srcElement,Array.isArray(r)||(r=[0,0]);var n=t.clientX||0,s=t.clientY||0,a=Wo(e);return r[0]=n-a.left,r[1]=s-a.top,r}function Wo(t){return t===window||t===document||t===document.body?zo:t.getBoundingClientRect()}var Xt={},Yo={get exports(){return Xt},set exports(t){Xt=t}},yr={},jo={get exports(){return yr},set exports(t){yr=t}},qo=void 0,fi=function(t){return t!==qo&&t!==null},Zo=fi,Qo={object:!0,function:!0,undefined:!0},Jo=function(t){return Zo(t)?hasOwnProperty.call(Qo,typeof t):!1},el=Jo,tl=function(t){if(!el(t))return!1;try{return t.constructor?t.constructor.prototype===t:!1}catch{return!1}},rl=tl,nl=function(t){if(typeof t!="function"||!hasOwnProperty.call(t,"length"))return!1;try{if(typeof t.length!="number"||typeof t.call!="function"||typeof t.apply!="function")return!1}catch{return!1}return!rl(t)},il=nl,sl=/^\s*class[\s{/}]/,al=Function.prototype.toString,ol=function(t){return!(!il(t)||sl.test(al.call(t)))},ll=function(){var t=Object.assign,e;return typeof t!="function"?!1:(e={foo:"raz"},t(e,{bar:"dwa"},{trzy:"trzy"}),e.foo+e.bar+e.trzy==="razdwatrzy")},ar,hn;function ul(){return hn||(hn=1,ar=function(){try{return Object.keys("primitive"),!0}catch{return!1}}),ar}var hl=function(){},cl=hl(),$r=function(t){return t!==cl&&t!==null},or,cn;function fl(){if(cn)return or;cn=1;var t=$r,e=Object.keys;return or=function(r){return e(t(r)?Object(r):r)},or}var lr,fn;function El(){return fn||(fn=1,lr=ul()()?Object.keys:fl()),lr}var ur,En;function _l(){if(En)return ur;En=1;var t=$r;return ur=function(e){if(!t(e))throw new TypeError("Cannot use null or undefined");return e},ur}var hr,_n;function dl(){if(_n)return hr;_n=1;var t=El(),e=_l(),r=Math.max;return hr=function(n,s){var a,l,o=r(arguments.length,2),u;for(n=Object(e(n)),u=function(h){try{n[h]=s[h]}catch(m){a||(a=m)}},l=1;l<o;++l)s=arguments[l],t(s).forEach(u);if(a!==void 0)throw a;return n},hr}var Al=ll()?Object.assign:dl(),Tl=$r,ml=Array.prototype.forEach,pl=Object.create,Rl=function(t,e){var r;for(r in t)e[r]=t[r]},gl=function(t){var e=pl(null);return ml.call(arguments,function(r){Tl(r)&&Rl(Object(r),e)}),e},cr="razdwatrzy",xl=function(){return typeof cr.contains!="function"?!1:cr.contains("dwa")===!0&&cr.contains("foo")===!1},fr,dn;function Sl(){if(dn)return fr;dn=1;var t=String.prototype.indexOf;return fr=function(e){return t.call(this,e,arguments[1])>-1},fr}var vl=xl()?String.prototype.contains:Sl(),Pt=fi,An=ol,Ei=Al,_i=gl,_t=vl,Cl=jo.exports=function(t,e){var r,n,s,a,l;return arguments.length<2||typeof t!="string"?(a=e,e=t,t=null):a=arguments[2],Pt(t)?(r=_t.call(t,"c"),n=_t.call(t,"e"),s=_t.call(t,"w")):(r=s=!0,n=!1),l={value:e,configurable:r,enumerable:n,writable:s},a?Ei(_i(a),l):l};Cl.gs=function(t,e,r){var n,s,a,l;return typeof t!="string"?(a=r,r=e,e=t,t=null):a=arguments[3],Pt(e)?An(e)?Pt(r)?An(r)||(a=r,r=void 0):r=void 0:(a=e,e=r=void 0):e=void 0,Pt(t)?(n=_t.call(t,"c"),s=_t.call(t,"e")):(n=!0,s=!1),l={get:e,set:r,configurable:n,enumerable:s},a?Ei(_i(a),l):l};var Nl=function(t){if(typeof t!="function")throw new TypeError(t+" is not a function");return t};(function(t,e){var r=yr,n=Nl,s=Function.prototype.apply,a=Function.prototype.call,l=Object.create,o=Object.defineProperty,u=Object.defineProperties,h=Object.prototype.hasOwnProperty,m={configurable:!0,enumerable:!1,writable:!0},f,A,x,C,b,G,B;f=function(g,d){var V;return n(d),h.call(this,"__ee__")?V=this.__ee__:(V=m.value=l(null),o(this,"__ee__",m),m.value=null),V[g]?typeof V[g]=="object"?V[g].push(d):V[g]=[V[g],d]:V[g]=d,this},A=function(g,d){var V,W;return n(d),W=this,f.call(this,g,V=function(){x.call(W,g,V),s.call(d,this,arguments)}),V.__eeOnceListener__=d,this},x=function(g,d){var V,W,k,Y;if(n(d),!h.call(this,"__ee__"))return this;if(V=this.__ee__,!V[g])return this;if(W=V[g],typeof W=="object")for(Y=0;k=W[Y];++Y)(k===d||k.__eeOnceListener__===d)&&(W.length===2?V[g]=W[Y?0:1]:W.splice(Y,1));else(W===d||W.__eeOnceListener__===d)&&delete V[g];return this},C=function(g){var d,V,W,k,Y;if(h.call(this,"__ee__")&&(k=this.__ee__[g],!!k))if(typeof k=="object"){for(V=arguments.length,Y=new Array(V-1),d=1;d<V;++d)Y[d-1]=arguments[d];for(k=k.slice(),d=0;W=k[d];++d)s.call(W,this,Y)}else switch(arguments.length){case 1:a.call(k,this);break;case 2:a.call(k,this,arguments[1]);break;case 3:a.call(k,this,arguments[1],arguments[2]);break;default:for(V=arguments.length,Y=new Array(V-1),d=1;d<V;++d)Y[d-1]=arguments[d];s.call(k,this,Y)}},b={on:f,once:A,off:x,emit:C},G={on:r(f),once:r(A),off:r(x),emit:r(C)},B=u({},G),t.exports=e=function(g){return g==null?l(B):u(Object(g),G)},e.methods=b})(Yo,Xt);var Br=Fl,Il=Xo,Ke=$o,Dl=Xt;function Fl(t){t=t||window;var e=Dl(),r=[null,null],n=[null,null],s=[null,null],a=[null,null],l=0,o={},u,h,m=t===window?function(){u=window.innerWidth,h=window.innerHeight}:function(){u=t.clientWidth,h=t.clientHeight},f=0,A,x,C={},b=Il(t,function(N,S,z,X){A=S,x=z,f=N,C=X});function G(N){Ke(N,t,s),m(),o.buttons=f,o.mods=C,o.x0=o.x=o.x1=2*s[0]/u-1,o.y0=o.y=o.y1=1-2*s[1]/h,o.x2=null,o.y2=null,o.dx=2*N.deltaX/u,o.dy=-2*N.deltaY/h,o.dz=2*N.deltaZ/u,o.active=1,o.zoomx=1,o.zoomy=1,o.theta=0,o.dtheta=0,o.originalEvent=N,e.emit("wheel",o),r[0]=s[0],r[1]=s[1]}var B=null,g=null,d=0;function V(N){Ke(N,t,s),d=0,m(),o.buttons=f,o.mods=C,o.x=o.x1=2*s[0]/u-1,o.y=o.y1=1-2*s[1]/h,o.x2=null,o.y2=null,o.active=d,o.x0=2*B/u-1,o.y0=1-2*g/h,o.dx=0,o.dy=0,o.dz=0,o.zoomx=1,o.zoomy=1,o.theta=0,o.dtheta=0,o.originalEvent=N,e.emit("mouseup",o),B=g=null,r[0]=s[0],r[1]=s[1]}function W(N){Ke(N,t,s),d=1,m(),B=A,g=x,o.buttons=f,o.mods=C,o.x=o.x0=o.x1=2*s[0]/u-1,o.y=o.y0=o.y1=1-2*s[1]/h,o.x2=null,o.y2=null,o.active=d,o.dx=0,o.dy=0,o.dz=0,o.zoomx=1,o.zoomy=1,o.theta=0,o.dtheta=0,o.originalEvent=N,e.emit("mousedown",o),r[0]=s[0],r[1]=s[1]}function k(N){Ke(N,t,s),m(),o.buttons=f,o.mods=C,o.x0=2*B/u-1,o.y0=1-2*g/h,o.x=o.x1=2*s[0]/u-1,o.y=o.y1=1-2*s[1]/h,o.x2=null,o.y2=null,o.dx=2*(s[0]-r[0])/u,o.dy=-2*(s[1]-r[1])/h,o.active=d,o.dz=0,o.zoomx=1,o.zoomy=1,o.theta=0,o.dtheta=0,o.originalEvent=N,e.emit("mousemove",o),r[0]=s[0],r[1]=s[1]}function Y(N){for(var S=N.identifier,z=0;z<a.length;z++)if(a[z]&&a[z].touch&&a[z].touch.identifier===S)return z;return-1}function ee(N){n[0]=null,n[1]=null;for(var S=0;S<N.changedTouches.length;S++){var z=N.changedTouches[S],X=z.identifier,Q=Y(X);if(Q===-1&&l<2){var le=a[0]?1:0,ue=a[0]?0:1,L={position:[0,0],touch:null};a[le]=L,l++,L.touch=z,Ke(z,t,L.position),a[ue]&&a[ue].touch}}for(var E=0,R=0,I=0,S=0;S<a.length;S++)a[S]&&(E+=a[S].position[0],R+=a[S].position[1],I++);if(E/=I,R/=I,l>0){if(o.theta=0,I>1){var U=a[1].position[0]-a[0].position[0],p=(a[0].position[1]-a[1].position[1])*u/h;o.theta=Math.atan2(p,U)}m(),o.buttons=0,o.mods={},o.active=l,B=E,g=R,o.x0=2*B/u-1,o.y0=1-2*g/h,o.x=2*E/u-1,o.y=1-2*R/h,o.x1=2*a[0].position[0]/u-1,o.y1=1-2*a[0].position[1]/h,l>1&&(o.x2=2*a[1].position[0]/u-1,o.y2=1-2*a[1].position[1]/h),o.active=l,o.dx=0,o.dy=0,o.dz=0,o.zoomx=1,o.zoomy=1,o.dtheta=0,o.originalEvent=N,e.emit(l===1?"touchstart":"pinchstart",o)}}function se(N){for(var S,z=!1,X=0;X<N.changedTouches.length;X++){var Q=N.changedTouches[X];S=Y(Q),S!==-1&&(z=!0,a[S].touch=Q,Ke(Q,t,a[S].position))}if(z){if(l===1){for(S=0;S<a.length&&!a[S];S++);if(a[S]&&n[S]){var le=a[S].position[0],ue=a[S].position[1],L=le-n[S][0],E=ue-n[S][1];o.buttons=0,o.mods={},o.active=l,o.x=o.x1=2*le/u-1,o.y=o.y1=1-2*ue/h,o.x2=null,o.y2=null,o.x0=2*B/u-1,o.y0=1-2*g/h,o.dx=2*L/u,o.dy=-2*E/h,o.dz=0,o.zoomx=1,o.zoomy=1,o.theta=0,o.dtheta=0,o.originalEvent=N,e.emit("touchmove",o)}}else if(l===2&&n[0]&&n[1]){var R=n[0],I=n[1],U=I[0]-R[0],p=(I[1]-R[1])*u/h,y=a[0].position,w=a[1].position,ne=w[0]-y[0],ae=(y[1]-w[1])*u/h,fe=Math.sqrt(U*U+p*p)*.5,oe=Math.atan2(p,U),K=Math.sqrt(ne*ne+ae*ae)*.5,re=Math.atan2(ae,ne),c=(I[0]+R[0])*.5,_=(I[1]+R[1])*.5,L=.5*(w[0]+y[0]-R[0]-I[0]),E=.5*(w[1]+y[1]-R[1]-I[1]),D=K/fe,v=re-oe;o.buttons=0,o.mods=C,o.active=l,o.x=2*c/u-1,o.y=1-2*_/h,o.x0=2*B/u-1,o.y0=1-2*g/h,o.x1=2*y[0]/u-1,o.y1=1-2*y[1]/h,o.x2=2*w[0]/u-1,o.y2=1-2*w[1]/h,o.dx=2*L/u,o.dy=-2*E/h,o.dz=0,o.zoomx=D,o.zoomy=D,o.theta=re,o.dtheta=v,o.originalEvent=N,e.emit("pinchmove",o)}}a[0]&&(n[0]=a[0].position.slice()),a[1]&&(n[1]=a[1].position.slice())}function _e(N){for(var S,z=0;z<N.changedTouches.length;z++){var X=N.changedTouches[z],Q=Y(X);if(Q!==-1){S=a[Q],a[Q]=null,l--;var le=Q===0?1:0;a[le]&&a[le].touch}}var ue=0,L=0;if(l===0)S&&(ue=S.position[0],L=S.position[1]);else{for(var E=0,z=0;z<a.length;z++)a[z]&&(ue+=a[z].position[0],L+=a[z].position[1],E++);ue/=E,L/=E}l<2&&(o.buttons=0,o.mods=C,o.active=l,o.x=2*ue/u-1,o.y=1-2*L/h,o.x0=2*B/u-1,o.y0=1-2*g/h,o.dx=0,o.dy=0,o.dz=0,o.zoomx=1,o.zoomy=1,o.theta=0,o.dtheta=0,o.originalEvent=N,e.emit(l===0?"touchend":"pinchend",o)),l===0&&(B=g=null)}var T=!1;function H(){T||(T=!0,b.enabled=!0,t.addEventListener("wheel",G,!1),t.addEventListener("mousedown",W,!1),window.addEventListener("mousemove",k,!1),window.addEventListener("mouseup",V,!1),t.addEventListener("touchstart",ee,!1),window.addEventListener("touchmove",se,!1),window.addEventListener("touchend",_e,!1),window.addEventListener("touchcancel",_e,!1))}function $(){T&&(T=!1,b.enabled=!1,t.removeEventListener("wheel",G,!1),t.removeEventListener("mousedown",W,!1),window.removeEventListener("mousemove",k,!1),window.removeEventListener("mouseup",V,!1),t.removeEventListener("touchstart",ee,!1),window.removeEventListener("touchmove",se,!1),window.removeEventListener("touchend",_e,!1),window.removeEventListener("touchcancel",_e,!1))}return H(),e.enable=H,e.disable=$,e}function yl(){return new Worker("/dat-garden-visualization/assets/graph-db-worker-ec6241cf.js",{type:"module"})}function Bl(){return new Worker("/dat-garden-visualization/assets/graph-layout-worker-7e84d6b4.js",{type:"module"})}const di=new Array(128).fill(void 0);di.push(void 0,null,!0,!1);const Pl=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});Pl.decode();di.length;const Er=new TextEncoder("utf-8");Er.encodeInto;var Ai={};(function(t){var e=ye&&ye.__extends||function(){var L=function(E,R){return L=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(I,U){I.__proto__=U}||function(I,U){for(var p in U)Object.prototype.hasOwnProperty.call(U,p)&&(I[p]=U[p])},L(E,R)};return function(E,R){if(typeof R!="function"&&R!==null)throw new TypeError("Class extends value "+String(R)+" is not a constructor or null");L(E,R);function I(){this.constructor=E}E.prototype=R===null?Object.create(R):(I.prototype=R.prototype,new I)}}(),r=ye&&ye.__classPrivateFieldSet||function(L,E,R){if(!E.has(L))throw new TypeError("attempted to set private field on non-instance");return E.set(L,R),R},n=ye&&ye.__classPrivateFieldGet||function(L,E){if(!E.has(L))throw new TypeError("attempted to get private field on non-instance");return E.get(L)},s,a,l,o,u,h,m,f,A,x,C,b,G,B,g,d,V,W,k,Y,ee,se;t.__esModule=!0,t.default=void 0;var _e=function(L){var E=131,R=137,I=0;L+="x";for(var U=Math.floor(9007199254740991/R),p=0;p<L.length;p++)I>U&&(I=Math.floor(I/R)),I=I*E+L.charCodeAt(p);return I},T="0123456789abcdef".split(""),H=[-2147483648,8388608,32768,128],$=[24,16,8,0],N=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],S=[],z=function(){function L(E,R){E===void 0&&(E=!1),R===void 0&&(R=!1),s.set(this,void 0),a.set(this,void 0),l.set(this,void 0),o.set(this,void 0),u.set(this,void 0),h.set(this,void 0),m.set(this,void 0),f.set(this,void 0),A.set(this,void 0),x.set(this,void 0),C.set(this,void 0),b.set(this,void 0),G.set(this,void 0),B.set(this,void 0),g.set(this,void 0),d.set(this,void 0),V.set(this,0),W.set(this,void 0),this.init(E,R)}return L.prototype.init=function(E,R){R?(S[0]=S[16]=S[1]=S[2]=S[3]=S[4]=S[5]=S[6]=S[7]=S[8]=S[9]=S[10]=S[11]=S[12]=S[13]=S[14]=S[15]=0,r(this,a,S)):r(this,a,[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),E?(r(this,h,3238371032),r(this,m,914150663),r(this,f,812702999),r(this,A,4144912697),r(this,x,4290775857),r(this,C,1750603025),r(this,b,1694076839),r(this,G,3204075428)):(r(this,h,1779033703),r(this,m,3144134277),r(this,f,1013904242),r(this,A,2773480762),r(this,x,1359893119),r(this,C,2600822924),r(this,b,528734635),r(this,G,1541459225)),r(this,s,r(this,W,r(this,l,r(this,g,0)))),r(this,o,r(this,B,!1)),r(this,u,!0),r(this,d,E)},L.prototype.update=function(E){if(n(this,o))return this;var R;E instanceof ArrayBuffer?R=new Uint8Array(E):R=E;for(var I=0,U=R.length,p=n(this,a);I<U;){var y=void 0;if(n(this,B)&&(r(this,B,!1),p[0]=n(this,s),p[16]=p[1]=p[2]=p[3]=p[4]=p[5]=p[6]=p[7]=p[8]=p[9]=p[10]=p[11]=p[12]=p[13]=p[14]=p[15]=0),typeof R!="string")for(y=n(this,W);I<U&&y<64;++I)p[y>>2]|=R[I]<<$[y++&3];else for(y=n(this,W);I<U&&y<64;++I){var w=R.charCodeAt(I);w<128?p[y>>2]|=w<<$[y++&3]:w<2048?(p[y>>2]|=(192|w>>6)<<$[y++&3],p[y>>2]|=(128|w&63)<<$[y++&3]):w<55296||w>=57344?(p[y>>2]|=(224|w>>12)<<$[y++&3],p[y>>2]|=(128|w>>6&63)<<$[y++&3],p[y>>2]|=(128|w&63)<<$[y++&3]):(w=65536+((w&1023)<<10|R.charCodeAt(++I)&1023),p[y>>2]|=(240|w>>18)<<$[y++&3],p[y>>2]|=(128|w>>12&63)<<$[y++&3],p[y>>2]|=(128|w>>6&63)<<$[y++&3],p[y>>2]|=(128|w&63)<<$[y++&3])}r(this,V,y),r(this,l,n(this,l)+(y-n(this,W))),y>=64?(r(this,s,p[16]),r(this,W,y-64),this.hash(),r(this,B,!0)):r(this,W,y)}return n(this,l)>4294967295&&(r(this,g,n(this,g)+(n(this,l)/4294967296<<0)),r(this,l,n(this,l)%4294967296)),this},L.prototype.finalize=function(){if(!n(this,o)){r(this,o,!0);var E=n(this,a),R=n(this,V);E[16]=n(this,s),E[R>>2]|=H[R&3],r(this,s,E[16]),R>=56&&(n(this,B)||this.hash(),E[0]=n(this,s),E[16]=E[1]=E[2]=E[3]=E[4]=E[5]=E[6]=E[7]=E[8]=E[9]=E[10]=E[11]=E[12]=E[13]=E[14]=E[15]=0),E[14]=n(this,g)<<3|n(this,l)>>>29,E[15]=n(this,l)<<3,this.hash()}},L.prototype.hash=function(){for(var E=n(this,h),R=n(this,m),I=n(this,f),U=n(this,A),p=n(this,x),y=n(this,C),w=n(this,b),ne=n(this,G),ae=n(this,a),fe,oe,K,re,c,_,D,v,O,F,P=16;P<64;++P)re=ae[P-15],fe=(re>>>7|re<<25)^(re>>>18|re<<14)^re>>>3,re=ae[P-2],oe=(re>>>17|re<<15)^(re>>>19|re<<13)^re>>>10,ae[P]=ae[P-16]+fe+ae[P-7]+oe<<0;F=R&I;for(var j=0;j<64;j+=4)n(this,u)?(n(this,d)?(D=300032,re=ae[0]-1413257819,ne=re-150054599<<0,U=re+24177077<<0):(D=704751109,re=ae[0]-210244248,ne=re-1521486534<<0,U=re+143694565<<0),r(this,u,!1)):(fe=(E>>>2|E<<30)^(E>>>13|E<<19)^(E>>>22|E<<10),oe=(p>>>6|p<<26)^(p>>>11|p<<21)^(p>>>25|p<<7),D=E&R,K=D^E&I^F,_=p&y^~p&w,re=ne+oe+_+N[j]+ae[j],c=fe+K,ne=U+re<<0,U=re+c<<0),fe=(U>>>2|U<<30)^(U>>>13|U<<19)^(U>>>22|U<<10),oe=(ne>>>6|ne<<26)^(ne>>>11|ne<<21)^(ne>>>25|ne<<7),v=U&E,K=v^U&R^D,_=ne&p^~ne&y,re=w+oe+_+N[j+1]+ae[j+1],c=fe+K,w=I+re<<0,I=re+c<<0,fe=(I>>>2|I<<30)^(I>>>13|I<<19)^(I>>>22|I<<10),oe=(w>>>6|w<<26)^(w>>>11|w<<21)^(w>>>25|w<<7),O=I&U,K=O^I&E^v,_=w&ne^~w&p,re=y+oe+_+N[j+2]+ae[j+2],c=fe+K,y=R+re<<0,R=re+c<<0,fe=(R>>>2|R<<30)^(R>>>13|R<<19)^(R>>>22|R<<10),oe=(y>>>6|y<<26)^(y>>>11|y<<21)^(y>>>25|y<<7),F=R&I,K=F^R&U^O,_=y&w^~y&ne,re=p+oe+_+N[j+3]+ae[j+3],c=fe+K,p=E+re<<0,E=re+c<<0;r(this,h,n(this,h)+E<<0),r(this,m,n(this,m)+R<<0),r(this,f,n(this,f)+I<<0),r(this,A,n(this,A)+U<<0),r(this,x,n(this,x)+p<<0),r(this,C,n(this,C)+y<<0),r(this,b,n(this,b)+w<<0),r(this,G,n(this,G)+ne<<0)},L.prototype.hex=function(){this.finalize();var E=n(this,h),R=n(this,m),I=n(this,f),U=n(this,A),p=n(this,x),y=n(this,C),w=n(this,b),ne=n(this,G),ae=T[E>>28&15]+T[E>>24&15]+T[E>>20&15]+T[E>>16&15]+T[E>>12&15]+T[E>>8&15]+T[E>>4&15]+T[E&15]+T[R>>28&15]+T[R>>24&15]+T[R>>20&15]+T[R>>16&15]+T[R>>12&15]+T[R>>8&15]+T[R>>4&15]+T[R&15]+T[I>>28&15]+T[I>>24&15]+T[I>>20&15]+T[I>>16&15]+T[I>>12&15]+T[I>>8&15]+T[I>>4&15]+T[I&15]+T[U>>28&15]+T[U>>24&15]+T[U>>20&15]+T[U>>16&15]+T[U>>12&15]+T[U>>8&15]+T[U>>4&15]+T[U&15]+T[p>>28&15]+T[p>>24&15]+T[p>>20&15]+T[p>>16&15]+T[p>>12&15]+T[p>>8&15]+T[p>>4&15]+T[p&15]+T[y>>28&15]+T[y>>24&15]+T[y>>20&15]+T[y>>16&15]+T[y>>12&15]+T[y>>8&15]+T[y>>4&15]+T[y&15]+T[w>>28&15]+T[w>>24&15]+T[w>>20&15]+T[w>>16&15]+T[w>>12&15]+T[w>>8&15]+T[w>>4&15]+T[w&15];return n(this,d)||(ae+=T[ne>>28&15]+T[ne>>24&15]+T[ne>>20&15]+T[ne>>16&15]+T[ne>>12&15]+T[ne>>8&15]+T[ne>>4&15]+T[ne&15]),ae},L.prototype.toString=function(){return this.hex()},L.prototype.digest=function(){this.finalize();var E=n(this,h),R=n(this,m),I=n(this,f),U=n(this,A),p=n(this,x),y=n(this,C),w=n(this,b),ne=n(this,G),ae=[E>>24&255,E>>16&255,E>>8&255,E&255,R>>24&255,R>>16&255,R>>8&255,R&255,I>>24&255,I>>16&255,I>>8&255,I&255,U>>24&255,U>>16&255,U>>8&255,U&255,p>>24&255,p>>16&255,p>>8&255,p&255,y>>24&255,y>>16&255,y>>8&255,y&255,w>>24&255,w>>16&255,w>>8&255,w&255];return n(this,d)||ae.push(ne>>24&255,ne>>16&255,ne>>8&255,ne&255),ae},L.prototype.array=function(){return this.digest()},L.prototype.arrayBuffer=function(){this.finalize();var E=new ArrayBuffer(n(this,d)?28:32),R=new DataView(E);return R.setUint32(0,n(this,h)),R.setUint32(4,n(this,m)),R.setUint32(8,n(this,f)),R.setUint32(12,n(this,A)),R.setUint32(16,n(this,x)),R.setUint32(20,n(this,C)),R.setUint32(24,n(this,b)),n(this,d)||R.setUint32(28,n(this,G)),E},L}();s=new WeakMap,a=new WeakMap,l=new WeakMap,o=new WeakMap,u=new WeakMap,h=new WeakMap,m=new WeakMap,f=new WeakMap,A=new WeakMap,x=new WeakMap,C=new WeakMap,b=new WeakMap,G=new WeakMap,B=new WeakMap,g=new WeakMap,d=new WeakMap,V=new WeakMap,W=new WeakMap,function(L){e(E,L);function E(R,I,U){I===void 0&&(I=!1),U===void 0&&(U=!1);var p=L.call(this,I,U)||this;k.set(p,void 0),Y.set(p,void 0),ee.set(p,void 0),se.set(p,void 0);var y;if(typeof R=="string"){for(var w=[],ne=R.length,ae=0,fe=0;fe<ne;++fe){var oe=R.charCodeAt(fe);oe<128?w[ae++]=oe:oe<2048?(w[ae++]=192|oe>>6,w[ae++]=128|oe&63):oe<55296||oe>=57344?(w[ae++]=224|oe>>12,w[ae++]=128|oe>>6&63,w[ae++]=128|oe&63):(oe=65536+((oe&1023)<<10|R.charCodeAt(++fe)&1023),w[ae++]=240|oe>>18,w[ae++]=128|oe>>12&63,w[ae++]=128|oe>>6&63,w[ae++]=128|oe&63)}y=w}else R instanceof ArrayBuffer?y=new Uint8Array(R):y=R;y.length>64&&(y=new z(I,!0).update(y).array());for(var K=[],re=[],fe=0;fe<64;++fe){var c=y[fe]||0;K[fe]=92^c,re[fe]=54^c}return p.update(re),r(p,ee,K),r(p,k,!0),r(p,Y,I),r(p,se,U),p}return E.prototype.finalize=function(){if(L.prototype.finalize.call(this),n(this,k)){r(this,k,!1);var R=this.array();L.prototype.init.call(this,n(this,Y),n(this,se)),this.update(n(this,ee)),this.update(R),L.prototype.finalize.call(this)}},E}(z),k=new WeakMap,Y=new WeakMap,ee=new WeakMap,se=new WeakMap;function X(L){var E=new z;return E.update(L),parseInt(E.hex().substring(0,8),16)}var Q=function(L){var E="#";return L.forEach(function(R){R<16&&(E+=0),E+=R.toString(16)}),E},le=function(L,E,R){L/=360;var I=R<.5?R*(1+E):R+E-R*E,U=2*R-I;return[L+1/3,L,L-1/3].map(function(p){return p<0&&p++,p>1&&p--,p<1/6?p=U+(I-U)*6*p:p<.5?p=I:p<2/3?p=U+(I-U)*6*(2/3-p):p=U,Math.round(p*255)})},ue=function(){function L(E){E===void 0&&(E={});var R=[E.lightness,E.saturation].map(function(p){return p=p!==void 0?p:[.35,.5,.65],Array.isArray(p)?p.concat():[p]}),I=R[0],U=R[1];this.L=I,this.S=U,typeof E.hue=="number"&&(E.hue={min:E.hue,max:E.hue}),typeof E.hue=="object"&&!Array.isArray(E.hue)&&(E.hue=[E.hue]),typeof E.hue>"u"&&(E.hue=[]),this.hueRanges=E.hue.map(function(p){return{min:typeof p.min>"u"?0:p.min,max:typeof p.max>"u"?360:p.max}}),this.hash=X,typeof E.hash=="function"&&(this.hash=E.hash),E.hash==="bkdr"&&(this.hash=_e)}return L.prototype.hsl=function(E){var R,I,U,p=this.hash(E),y=727;if(this.hueRanges.length){var w=this.hueRanges[p%this.hueRanges.length];R=p/this.hueRanges.length%y*(w.max-w.min)/y+w.min}else R=p%359;return p=Math.ceil(p/360),I=this.S[p%this.S.length],p=Math.ceil(p/this.S.length),U=this.L[p%this.L.length],[R,I,U]},L.prototype.rgb=function(E){var R=this.hsl(E);return le.apply(this,R)},L.prototype.hex=function(E){var R=this.rgb(E);return Q(R)},L}();t.default=ue})(Ai);const Ml=ss(Ai),Ol=new Ml({saturation:.7,lightness:.6}),bl=async()=>{const t="https://dat-ecosystem.org/dat-garden-rake/",e=await fetch(`${t}index.json`).then(l=>l.json()),r=`${t}${e.latest}`,[n,s,a]=await Promise.all([fetch(r+"/../valuenetwork.json").then(l=>l.json()),fetch(r+"/../projects.json").then(l=>l.json()),fetch(r+"/../organizations.json").then(l=>l.json())]);return{valueNetworkData:n,projectsData:s,organizationsData:a}},Ti=ie.promise(bl),mi=Yt(new yl),pi=Yt(new Bl),Ll=t=>Math.max(4*Math.log(2*(t?.length||1)**1.2),2),wl=t=>t.replace(/^(https?:\/\/)?(www\.)?([a-z0-9-]+\.)+[a-z0-9-]+/i,"").replace(/\/$/,"").replace(/^\//,"").replace(/[^A-Za-z0-9\.]/gi,"-").replace(/-+/g,"-").replace(/^package-/,"").replace(/-v-/,"-"),Me=ie.promise(async()=>{const{valueNetworkData:t,projectsData:e,organizationsData:r}=await Ti(),n=Object.entries(t).map(([h,{dependents:m,owner:f,dependencies:A}],x)=>({index:x,project:h,id:h,data:e[h],navId:wl(h),owner:f,ownerData:r[f],color:[...Ol.rgb(f||h||String(x)).map(C=>C/255),1],size:Ll(m),dependents:m,dependencies:A}));$e(n.map(h=>[h.index,h]));const s=$e(n.map(h=>[h.project,h])),a=$e(n.map(h=>[h.data.name,h])),l=$e(n.map(h=>[h.navId,h]));let o=Object.entries(t).flatMap(([h,{dependents:m,dependencies:f}])=>(m||[]).map(A=>({source:A,sourceNode:s[A],sourceIndex:n.find(x=>x.project===A).index,target:h,targetNode:s[h],targetIndex:n.find(x=>x.project===h).index})).concat((f||[]).map(A=>({source:h,sourceNode:s[h],sourceIndex:n.find(x=>x.project===h).index,target:A,targetNode:s[A],targetIndex:n.find(x=>x.project===A).index})))).filter(h=>h);o=wo(o,(h,m)=>h.sourceIndex===m.sourceIndex&&h.targetIndex===m.targetIndex);const u=o.map(({sourceIndex:h,targetIndex:m})=>[h,m]);return $e(u.map(([h,m],f)=>[`${h}-${m}`,f])),$e(u.map(([h,m],f)=>[`${h}-${m}`,o[f]])),{nodes:n,links:o,linkIndexPairs:u,nodesByNavId:l,nodesByProject:s,nodesByProjectName:a}}),Ul=async()=>{const t=await Ti();return await mi.buildGraph(t)},Gl=async(t,e=pi.useD3ForceSimulator)=>await e(t,Tt(r=>{me()?.targetData(r)})),Ri=t=>{const e=me().mostRecentData,r=t.index;return[e[r*3],e[r*3+1],e[r*3+2]]},Hl=async t=>await Gl(t||await prepareVisualizerData(),pi.useD3ForceSimulator),{doQuery:Vl,buildGraph:nh}=mi;function Xl(){return new Worker("/dat-garden-visualization/assets/animation-worker-193e3d63.js",{type:"module"})}var _r;const kt=window,et=kt.trustedTypes,Tn=et?et.createPolicy("lit-html",{createHTML:t=>t}):void 0,Pr="$lit$",we=`lit$${(Math.random()+"").slice(9)}$`,gi="?"+we,kl=`<${gi}>`,tt=document,pt=()=>tt.createComment(""),Rt=t=>t===null||typeof t!="object"&&typeof t!="function",xi=Array.isArray,zl=t=>xi(t)||typeof t?.[Symbol.iterator]=="function",dr=`[ 	
\f\r]`,lt=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,mn=/-->/g,pn=/>/g,Ge=RegExp(`>|${dr}(?:([^\\s"'>=/]+)(${dr}*=${dr}*(?:[^ 	
\f\r"'\`<>=]|("|')|))|$)`,"g"),Rn=/'/g,gn=/"/g,Si=/^(?:script|style|textarea|title)$/i,$l=t=>(e,...r)=>({_$litType$:t,strings:e,values:r}),Fe=$l(1),gt=Symbol.for("lit-noChange"),Te=Symbol.for("lit-nothing"),xn=new WeakMap,je=tt.createTreeWalker(tt,129,null,!1),Kl=(t,e)=>{const r=t.length-1,n=[];let s,a=e===2?"<svg>":"",l=lt;for(let u=0;u<r;u++){const h=t[u];let m,f,A=-1,x=0;for(;x<h.length&&(l.lastIndex=x,f=l.exec(h),f!==null);)x=l.lastIndex,l===lt?f[1]==="!--"?l=mn:f[1]!==void 0?l=pn:f[2]!==void 0?(Si.test(f[2])&&(s=RegExp("</"+f[2],"g")),l=Ge):f[3]!==void 0&&(l=Ge):l===Ge?f[0]===">"?(l=s??lt,A=-1):f[1]===void 0?A=-2:(A=l.lastIndex-f[2].length,m=f[1],l=f[3]===void 0?Ge:f[3]==='"'?gn:Rn):l===gn||l===Rn?l=Ge:l===mn||l===pn?l=lt:(l=Ge,s=void 0);const C=l===Ge&&t[u+1].startsWith("/>")?" ":"";a+=l===lt?h+kl:A>=0?(n.push(m),h.slice(0,A)+Pr+h.slice(A)+we+C):h+we+(A===-2?(n.push(void 0),u):C)}const o=a+(t[r]||"<?>")+(e===2?"</svg>":"");if(!Array.isArray(t)||!t.hasOwnProperty("raw"))throw Error("invalid template strings array");return[Tn!==void 0?Tn.createHTML(o):o,n]};class xt{constructor({strings:e,_$litType$:r},n){let s;this.parts=[];let a=0,l=0;const o=e.length-1,u=this.parts,[h,m]=Kl(e,r);if(this.el=xt.createElement(h,n),je.currentNode=this.el.content,r===2){const f=this.el.content,A=f.firstChild;A.remove(),f.append(...A.childNodes)}for(;(s=je.nextNode())!==null&&u.length<o;){if(s.nodeType===1){if(s.hasAttributes()){const f=[];for(const A of s.getAttributeNames())if(A.endsWith(Pr)||A.startsWith(we)){const x=m[l++];if(f.push(A),x!==void 0){const C=s.getAttribute(x.toLowerCase()+Pr).split(we),b=/([.?@])?(.*)/.exec(x);u.push({type:1,index:a,name:b[2],strings:C,ctor:b[1]==="."?Yl:b[1]==="?"?ql:b[1]==="@"?Zl:Zt})}else u.push({type:6,index:a})}for(const A of f)s.removeAttribute(A)}if(Si.test(s.tagName)){const f=s.textContent.split(we),A=f.length-1;if(A>0){s.textContent=et?et.emptyScript:"";for(let x=0;x<A;x++)s.append(f[x],pt()),je.nextNode(),u.push({type:2,index:++a});s.append(f[A],pt())}}}else if(s.nodeType===8)if(s.data===gi)u.push({type:2,index:a});else{let f=-1;for(;(f=s.data.indexOf(we,f+1))!==-1;)u.push({type:7,index:a}),f+=we.length-1}a++}}static createElement(e,r){const n=tt.createElement("template");return n.innerHTML=e,n}}function rt(t,e,r=t,n){var s,a,l,o;if(e===gt)return e;let u=n!==void 0?(s=r._$Co)===null||s===void 0?void 0:s[n]:r._$Cl;const h=Rt(e)?void 0:e._$litDirective$;return u?.constructor!==h&&((a=u?._$AO)===null||a===void 0||a.call(u,!1),h===void 0?u=void 0:(u=new h(t),u._$AT(t,r,n)),n!==void 0?((l=(o=r)._$Co)!==null&&l!==void 0?l:o._$Co=[])[n]=u:r._$Cl=u),u!==void 0&&(e=rt(t,u._$AS(t,e.values),u,n)),e}class Wl{constructor(e,r){this._$AV=[],this._$AN=void 0,this._$AD=e,this._$AM=r}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(e){var r;const{el:{content:n},parts:s}=this._$AD,a=((r=e?.creationScope)!==null&&r!==void 0?r:tt).importNode(n,!0);je.currentNode=a;let l=je.nextNode(),o=0,u=0,h=s[0];for(;h!==void 0;){if(o===h.index){let m;h.type===2?m=new Kr(l,l.nextSibling,this,e):h.type===1?m=new h.ctor(l,h.name,h.strings,this,e):h.type===6&&(m=new Ql(l,this,e)),this._$AV.push(m),h=s[++u]}o!==h?.index&&(l=je.nextNode(),o++)}return a}v(e){let r=0;for(const n of this._$AV)n!==void 0&&(n.strings!==void 0?(n._$AI(e,n,r),r+=n.strings.length-2):n._$AI(e[r])),r++}}let Kr=class vi{constructor(e,r,n,s){var a;this.type=2,this._$AH=Te,this._$AN=void 0,this._$AA=e,this._$AB=r,this._$AM=n,this.options=s,this._$Cp=(a=s?.isConnected)===null||a===void 0||a}get _$AU(){var e,r;return(r=(e=this._$AM)===null||e===void 0?void 0:e._$AU)!==null&&r!==void 0?r:this._$Cp}get parentNode(){let e=this._$AA.parentNode;const r=this._$AM;return r!==void 0&&e?.nodeType===11&&(e=r.parentNode),e}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(e,r=this){e=rt(this,e,r),Rt(e)?e===Te||e==null||e===""?(this._$AH!==Te&&this._$AR(),this._$AH=Te):e!==this._$AH&&e!==gt&&this._(e):e._$litType$!==void 0?this.g(e):e.nodeType!==void 0?this.$(e):zl(e)?this.T(e):this._(e)}k(e){return this._$AA.parentNode.insertBefore(e,this._$AB)}$(e){this._$AH!==e&&(this._$AR(),this._$AH=this.k(e))}_(e){this._$AH!==Te&&Rt(this._$AH)?this._$AA.nextSibling.data=e:this.$(tt.createTextNode(e)),this._$AH=e}g(e){var r;const{values:n,_$litType$:s}=e,a=typeof s=="number"?this._$AC(e):(s.el===void 0&&(s.el=xt.createElement(s.h,this.options)),s);if(((r=this._$AH)===null||r===void 0?void 0:r._$AD)===a)this._$AH.v(n);else{const l=new Wl(a,this),o=l.u(this.options);l.v(n),this.$(o),this._$AH=l}}_$AC(e){let r=xn.get(e.strings);return r===void 0&&xn.set(e.strings,r=new xt(e)),r}T(e){xi(this._$AH)||(this._$AH=[],this._$AR());const r=this._$AH;let n,s=0;for(const a of e)s===r.length?r.push(n=new vi(this.k(pt()),this.k(pt()),this,this.options)):n=r[s],n._$AI(a),s++;s<r.length&&(this._$AR(n&&n._$AB.nextSibling,s),r.length=s)}_$AR(e=this._$AA.nextSibling,r){var n;for((n=this._$AP)===null||n===void 0||n.call(this,!1,!0,r);e&&e!==this._$AB;){const s=e.nextSibling;e.remove(),e=s}}setConnected(e){var r;this._$AM===void 0&&(this._$Cp=e,(r=this._$AP)===null||r===void 0||r.call(this,e))}};class Zt{constructor(e,r,n,s,a){this.type=1,this._$AH=Te,this._$AN=void 0,this.element=e,this.name=r,this._$AM=s,this.options=a,n.length>2||n[0]!==""||n[1]!==""?(this._$AH=Array(n.length-1).fill(new String),this.strings=n):this._$AH=Te}get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}_$AI(e,r=this,n,s){const a=this.strings;let l=!1;if(a===void 0)e=rt(this,e,r,0),l=!Rt(e)||e!==this._$AH&&e!==gt,l&&(this._$AH=e);else{const o=e;let u,h;for(e=a[0],u=0;u<a.length-1;u++)h=rt(this,o[n+u],r,u),h===gt&&(h=this._$AH[u]),l||(l=!Rt(h)||h!==this._$AH[u]),h===Te?e=Te:e!==Te&&(e+=(h??"")+a[u+1]),this._$AH[u]=h}l&&!s&&this.j(e)}j(e){e===Te?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,e??"")}}class Yl extends Zt{constructor(){super(...arguments),this.type=3}j(e){this.element[this.name]=e===Te?void 0:e}}const jl=et?et.emptyScript:"";class ql extends Zt{constructor(){super(...arguments),this.type=4}j(e){e&&e!==Te?this.element.setAttribute(this.name,jl):this.element.removeAttribute(this.name)}}class Zl extends Zt{constructor(e,r,n,s,a){super(e,r,n,s,a),this.type=5}_$AI(e,r=this){var n;if((e=(n=rt(this,e,r,0))!==null&&n!==void 0?n:Te)===gt)return;const s=this._$AH,a=e===Te&&s!==Te||e.capture!==s.capture||e.once!==s.once||e.passive!==s.passive,l=e!==Te&&(s===Te||a);a&&this.element.removeEventListener(this.name,this,s),l&&this.element.addEventListener(this.name,this,e),this._$AH=e}handleEvent(e){var r,n;typeof this._$AH=="function"?this._$AH.call((n=(r=this.options)===null||r===void 0?void 0:r.host)!==null&&n!==void 0?n:this.element,e):this._$AH.handleEvent(e)}}class Ql{constructor(e,r,n){this.element=e,this.type=6,this._$AN=void 0,this._$AM=r,this.options=n}get _$AU(){return this._$AM._$AU}_$AI(e){rt(this,e)}}const Sn=kt.litHtmlPolyfillSupport;Sn?.(xt,Kr),((_r=kt.litHtmlVersions)!==null&&_r!==void 0?_r:kt.litHtmlVersions=[]).push("2.7.1");const Mr=(t,e,r)=>{var n,s;const a=(n=r?.renderBefore)!==null&&n!==void 0?n:e;let l=a._$litPart$;if(l===void 0){const o=(s=r?.renderBefore)!==null&&s!==void 0?s:null;a._$litPart$=l=new Kr(e.insertBefore(pt(),o),o,void 0,r??{})}return l._$AI(t),l},Jl=t=>`
  PREFIX dependson: <http://dat-ecosystem.org#dependson>
  SELECT DISTINCT ?dependent ?dependency WHERE {
    ?dependency dependson:* <${t}> .
    ?dependent dependson: ?dependency .
  }
`,Ci=({color:t})=>t,eu=ie.infinite(async(t=Je)=>{const{nodes:e,links:r}=await Me();return new Float32Array(e.map(Ci).flatMap(t))}),Ni=({size:t})=>Math.sqrt(t)/40,tu=ie.infinite(async(t=Je)=>{const{nodes:e,links:r}=await Me();return new Float32Array(e.map(Ni).map(t))}),Ii=async({colorMap:t=Je,sizeMap:e=Je,immediate:r=!1}={})=>{const n=ge(),s=xe(),a=Pe(),l=await eu(t),o=await tu(e);n.targetData(l,{immediate:r}),s.targetData(o,{immediate:r}),a.targetData(new Float32Array(a.target.numItems).fill(0),{immediate:r})},Ar=async(t,{colorMap:e=Je,sizeMap:r=Je,emphasis:n=0,immediate:s=!1}={})=>{const a=new Float32Array(e(Ci(t))),l=new Float32Array([r(Ni(t))]),o=new Float32Array([n]),u=ge(),h=xe(),m=Pe();u.targetData(a,{offset:t.index,immediate:s}),h.targetData(l,{offset:t.index,immediate:s}),m.targetData(o,{offset:t.index,immediate:s})},ru={colorMap:t=>{const e=t.slice(0,3).reduce((r,n)=>r+n,0)/3;return[...t.slice(0,3).map(r=>e),.5]},sizeMap:t=>t*.5},Di=async(t=!1)=>{await Ii({...ru,immediate:t})},vn="this.parentNode.style.display='none'",Cn="this.parentNode.style.display='initial'",nu=t=>Fe`
  <div class="project">
    <h3><a target="_blank" href="${t.data?.homepage}">${t.data.name}</a></h3>
    <div class="description">${t.data.description}</div>
    <div class="links">
      <span class="owner">
        <div class="owner-name-container">
          ${t.ownerData.html_url?Fe`<a target="_blank" href="${t.ownerData.html_url}">${t.ownerData.name}</a>`:Fe`<span>${t.ownerData.name}</span>`}
        </div>
        <div class="avatar-container">
          <img class="avatar-stroke" src="${t.ownerData?.avatar_url}" onerror=${vn} onload=${Cn} alt="">
          <img class="avatar" src="${t.ownerData?.avatar_url}" onerror=${vn} onload=${Cn} alt="${t.ownerData?.name}">
        </div>
      </span>
      <span><a target="_blank" href="${t.project}">NPM</a></span>
      ${t.data?.repository?Fe`<span><a target="_blank" href="${t.data.repository}">Git</a></span>`:Fe``}
      ${t.data?.bugs?Fe`<span><a target="_blank" href="${t.data.bugs}">Issues</a></span>`:Fe``}
      <!-- <a href="${t.ownerData.html_url}">Owner Profile</a> -->
    </div>
  </div>

`,iu=ci(t=>{const e=document.getElementById("selection-info");if(t){const r=nu(t);Mr(r,e)}else Mr(Fe``,e)},0),Fi=async(t,e=!0)=>{const r=n=>n*2;if(t){Or(t.index);const n=Ri(t),s=Jl(t.project),{nodesByProject:a,links:l}=await Me();Di().then(()=>{Ar(t,{sizeMap:r,emphasis:1}),Vl(s,Tt((o,u)=>{u(["dependent","dependency"]).then(({dependent:h,dependency:m})=>{Ar(a[h.value],{sizeMap:r,emphasis:1}),Ar(a[m.value],{sizeMap:r,emphasis:1})})}),Tt(()=>{})),e&&In(n),e&&Dn(Pi||75)})}else e&&Dn(Mi||1500),e&&In([0,0,0],4e3),Ii(),Or(-1);iu(t)},su=()=>{Fi(null)};window.initializeSelectionVisuals=Di;let yi=-1;const Be=()=>yi,Or=t=>{yi=t},au=async()=>{const t=Be(),{nodes:e}=await Me();return e[t]};var qe={},ou=(t,e)=>{qe[t]??(qe[t]=[]),qe[t].push(e)},lu=(t,e)=>{var r;(r=qe[t])==null||r.splice(qe[t].indexOf(e),1)},Nn=async(t,e,r)=>{for(const n of qe[t]??[])await n(e,r)},Tr=t=>t.length>1&&t.endsWith("/")?t.slice(0,-1):t,uu=t=>{var e;const r=(e=t.match(/(:[^/]+)/g))==null?void 0:e.map(n=>n.substring(1));return r&&{keys:r,regExp:new RegExp("^"+t.replace(/(:[^/]+)/g,"([^/]+)")+"$")}},hu=(t,e)=>Object.fromEntries(e.map((r,n)=>[r,t[n+1]])),Bi=[],We,cu=t=>{for(const e of Bi){const{pattern:r,regExp:n,keys:s}=e,a=n?t.match(n):r==="*"||r===t;if(a){const l=Array.isArray(a)?hu(a,s):void 0;return{definition:e,params:l}}}},ut=async(t,e)=>{const r=cu(t),n=!!r,s=r?.params??{},a=We;We={path:t,params:s,matches:n,trigger:e},await Nn("before-route",We,a),await r?.definition.action(s,We,a),await Nn("route",We,a)},Qt={get currentRoute(){return We},on:ou,off:lu,start({handleInitial:t=!0}={}){const e=window.location.hash!=""&&window.location.hash;t&&ut(e||window.location.pathname||"/","init"),window.addEventListener("popstate",()=>ut(window.location.pathname,"popstate")),window.addEventListener("hashchange",()=>{ut(window.location.hash,"hashchange")})},route(t,e){const r=Tr(t),{regExp:n,keys:s=[]}=uu(t)||{};Bi.push({pattern:r,action:e,regExp:n,keys:s})},push(t){window.history.pushState(null,"",Tr(t)),ut(t,"push")},replace(t){window.history.replaceState(null,"",Tr(t)),ut(t,"replace")}};Qt.route("#-",()=>{su()});Qt.route("#project/:id",async(t,{trigger:e})=>{const{nodesByNavId:r}=await Me(),n=r[t.id];Fi(n,e!=="init")});const fu=t=>{const n=te().canvas.getBoundingClientRect(),s=(t.clientX-n.left)/n.width,a=(t.clientY-n.top)/n.height;return{x:s*2-1,y:-(a*2-1)}},br=Yt(new Xl),{globalCamera:Mt,updateCameras:Eu,setCameraCenter:In,setCameraDistance:Dn,zoomGlobalCamera:Fn,panGlobalCamera:yn,startZooming:Bn,startPanning:Pn,stopPanning:Mn,computeScreenPosition:_u}=br;let Pi,Mi;const Oi=500,du=Oi,On=async()=>{br.stopZooming();const t=Be(),e=(await br.getGlobalCameraParams()).distance;t>-1?Pi=Math.min(e,Oi):Mi=Math.max(e,du)},pe={},bn=new Uint8Array(4).fill(0);let dt=-1,zt=!1,bi=0;const Au=()=>zt?!1:Date.now()-bi<200;let Lr=0,$t=0;const mr=()=>{Lr++},pr=()=>[pe.canvasX,pe.canvasY],Kt=()=>[pe.x,pe.y],Ot=({x:t,y:e})=>{const r=te();pe.x=t,pe.y=e,pe.canvasX=(t+1)/2*r.width,pe.canvasY=(e+1)/2*r.height;const n=window.devicePixelRatio||1;pe.pickerX=Math.floor(pe.canvasX/n),pe.pickerY=Math.floor(pe.canvasY/n)};let Wt=-1;const Tu=()=>Wt,mu=async()=>{const{nodes:t}=await Me();return t[Wt]},pu=ie.infinite(()=>{const e=te().canvas;Br(e).on("touchmove",Ot).on("mousemove",Ot),Br(e).on("touchmove",mr).on("pinchmove",mr).on("mousemove",mr),e.addEventListener("pointerdown",r=>{Ot(fu(r)),zt=!0,Lr=0,$t=0}),e.addEventListener("pointerup",()=>{const r=$t>.03||Lr>5;zt=!1,r||(wr=!0,setTimeout(()=>{const n=Be();Or(dt===n?-1:dt),Su().then(s=>{e.dispatchEvent(new CustomEvent("selected",{detail:{selectedIndex:n,info:s}}))}),e.dispatchEvent(new CustomEvent("tap",{detail:{selectedIndex:n}}))},50))}),e.addEventListener("selected",r=>{const n=r.detail.info;Qt.push(n?`#project/${n?.navId}`:"#-")}),e.addEventListener("hover",async r=>{const{nodes:n}=await Me(),s=r.detail.wasHoveredIndex;s>-1&&n[s];const a=r.detail.nowHoveredIndex,l=a>-1?n[a]:null;Be()>-1&&n[Be()],l&&Au()?Wt=l?.index||-1:Wt=-1})}),Ft=Math.PI/3,Ru=()=>{const e=te().canvas;e.addEventListener("wheel",r=>{const n=Math.exp(r.deltaY/e.clientHeight*2)-1,s=Math.sign(n);Bn(),Fn(0,0,s*Math.min(Math.abs(n),.06)),r.preventDefault(),On()},{passive:!1}),Br(e).on("mousemove",function(r){bi=Date.now(),!(!r.active||r.buttons!==1)&&($t+=Math.sqrt(Math.pow(r.dx,2)+Math.pow(r.dy,2)),r.mods.shift?(Pn(),yn(r.dx,r.dy)):r.mods.meta?Mt.pivot(r.dx,r.dy):(Mt.rotate(-r.dx*Ft,-r.dy*Ft),Mn()),r.originalEvent.preventDefault())}).on("touchmove",function(r){Ot(r),r.active&&($t+=Math.sqrt(Math.pow(r.dx,2)+Math.pow(r.dy,2)),Mt.rotate(-r.dx*Ft,-r.dy*Ft))}).on("pinchmove",function(r){r.active&&(zt=!0,Pn(),Bn(),Fn(0,0,1-r.zoomx),yn(r.dx,r.dy))}).on("touchstart",r=>r.originalEvent.preventDefault()).on("pinchstart",r=>r.originalEvent.preventDefault()).on("pinchend",()=>{Mn(),On()})};let wr=!0;const gu=t=>t[0]+t[1]*256+t[2]*256*256-1,xu=()=>{const t=te(),e=Qn(),r=100,n=[pr()[0]-r/2,pr()[1]-r/2,r,r];t.drawFramebuffer(e.current.resize(t.width,t.height)).enable(M.SCISSOR_TEST).scissor(...n);const s=Ps().uniformBlock("cameras",Vt()).uniform("mousePosition",Kt()).uniform("selectedIndex",Be());t.defaultViewport().clear(),s.draw();{t.readFramebuffer(e.other).readPixel(...pr(),bn);const a=gu(bn);dt!==a&&t.canvas.dispatchEvent(new CustomEvent("hover",{detail:{wasHoveredIndex:dt,nowHoveredIndex:a}})),dt=a,e.swap(),wr=!1}},Su=async()=>{const{nodes:t}=await Me();return t[Be()]},Wr=({classes:t,htmlTemplate:e,applyScreenPositionStyle:r}={})=>{r=r||((u,h)=>{h.style.left=`${u[0]}vw`,h.style.bottom=`${u[1]}vh`});const n=document.createElement("div");n.classList.add("cursor"),t?.forEach(u=>n.classList.add(u)),document.body.appendChild(n);const s=u=>{r(u,n)},a=u=>{const h=[(u[0]+1)/2*100,(u[1]+1)/2*100];s(h)},l=Fr(async u=>{const h=Ri(u),m=await _u(h);a(m)},50),o=Fr(async u=>{u?(await l(u),n.classList.add("focused")):n.classList.remove("focused"),u&&e&&Mr(e(u),n)},50);return{element:n,alignToScreenPosition:s,alignToNDCPosition:a,alignToNode:l,highlightNode:o,destroy:()=>n.remove()}},vu=Wr({classes:["selected-cursor"]}),Cu=Wr({classes:["hovered-tooltip"],htmlTemplate:t=>Fe`
    <div class="node-name">${t.data.name}</div>
  `,applyScreenPositionStyle(t,e){e.style.left=`calc(min(${t[0]}vw, calc(100vw - 15em)))`,e.style.bottom=`${t[1]}vh`}}),Nu=Wr({classes:["hovered-cursor"]}),Iu=`#version 300 es
in vec2 position;
in vec2 uv;
out vec2 vUV;

void main() {
  vUV = uv;
  gl_Position = vec4(position, 0.0, 1.0);
}`,Du=`#version 300 es
precision mediump float;
in vec2 vUV;
uniform sampler2D uTexture;
out vec4 fragColor;

void main() {
  fragColor = texture(uTexture, vUV);
  fragColor.a = 1.0;
}`,Fu=new Float32Array([-1,-1,1,-1,-1,1,1,1]),yu=new Float32Array([0,0,1,0,0,1,1,1]),Bu=ie.infinite(()=>{const t=te(),e=t.createVertexArray().vertexAttributeBuffer(0,t.createVertexBuffer(M.FLOAT,2,Fu)).vertexAttributeBuffer(1,t.createVertexBuffer(M.FLOAT,2,yu)).indexBuffer(t.createIndexBuffer(M.UNSIGNED_SHORT,3,new Uint16Array([0,1,2,2,1,3]))),r=t.createProgram(Iu,Du);return t.createDrawCall(r,e)}),Pu=t=>{Bu().texture("uTexture",t).draw()};var Mu={grad:.9,turn:360,rad:360/(2*Math.PI)},De=function(t){return typeof t=="string"?t.length>0:typeof t=="number"},Ae=function(t,e,r){return e===void 0&&(e=0),r===void 0&&(r=Math.pow(10,e)),Math.round(r*t)/r+0},Re=function(t,e,r){return e===void 0&&(e=0),r===void 0&&(r=1),t>r?r:t>e?t:e},Li=function(t){return(t=isFinite(t)?t%360:0)>0?t:t+360},Ln=function(t){return{r:Re(t.r,0,255),g:Re(t.g,0,255),b:Re(t.b,0,255),a:Re(t.a)}},Rr=function(t){return{r:Ae(t.r),g:Ae(t.g),b:Ae(t.b),a:Ae(t.a,3)}},Ou=/^#([0-9a-f]{3,8})$/i,yt=function(t){var e=t.toString(16);return e.length<2?"0"+e:e},wi=function(t){var e=t.r,r=t.g,n=t.b,s=t.a,a=Math.max(e,r,n),l=a-Math.min(e,r,n),o=l?a===e?(r-n)/l:a===r?2+(n-e)/l:4+(e-r)/l:0;return{h:60*(o<0?o+6:o),s:a?l/a*100:0,v:a/255*100,a:s}},Ui=function(t){var e=t.h,r=t.s,n=t.v,s=t.a;e=e/360*6,r/=100,n/=100;var a=Math.floor(e),l=n*(1-r),o=n*(1-(e-a)*r),u=n*(1-(1-e+a)*r),h=a%6;return{r:255*[n,o,l,l,u,n][h],g:255*[u,n,n,o,l,l][h],b:255*[l,l,u,n,n,o][h],a:s}},wn=function(t){return{h:Li(t.h),s:Re(t.s,0,100),l:Re(t.l,0,100),a:Re(t.a)}},Un=function(t){return{h:Ae(t.h),s:Ae(t.s),l:Ae(t.l),a:Ae(t.a,3)}},Gn=function(t){return Ui((r=(e=t).s,{h:e.h,s:(r*=((n=e.l)<50?n:100-n)/100)>0?2*r/(n+r)*100:0,v:n+r,a:e.a}));var e,r,n},At=function(t){return{h:(e=wi(t)).h,s:(s=(200-(r=e.s))*(n=e.v)/100)>0&&s<200?r*n/100/(s<=100?s:200-s)*100:0,l:s/2,a:e.a};var e,r,n,s},bu=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s*,\s*([+-]?\d*\.?\d+)%\s*,\s*([+-]?\d*\.?\d+)%\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Lu=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s+([+-]?\d*\.?\d+)%\s+([+-]?\d*\.?\d+)%\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,wu=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Uu=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Hn={string:[[function(t){var e=Ou.exec(t);return e?(t=e[1]).length<=4?{r:parseInt(t[0]+t[0],16),g:parseInt(t[1]+t[1],16),b:parseInt(t[2]+t[2],16),a:t.length===4?Ae(parseInt(t[3]+t[3],16)/255,2):1}:t.length===6||t.length===8?{r:parseInt(t.substr(0,2),16),g:parseInt(t.substr(2,2),16),b:parseInt(t.substr(4,2),16),a:t.length===8?Ae(parseInt(t.substr(6,2),16)/255,2):1}:null:null},"hex"],[function(t){var e=wu.exec(t)||Uu.exec(t);return e?e[2]!==e[4]||e[4]!==e[6]?null:Ln({r:Number(e[1])/(e[2]?100/255:1),g:Number(e[3])/(e[4]?100/255:1),b:Number(e[5])/(e[6]?100/255:1),a:e[7]===void 0?1:Number(e[7])/(e[8]?100:1)}):null},"rgb"],[function(t){var e=bu.exec(t)||Lu.exec(t);if(!e)return null;var r,n,s=wn({h:(r=e[1],n=e[2],n===void 0&&(n="deg"),Number(r)*(Mu[n]||1)),s:Number(e[3]),l:Number(e[4]),a:e[5]===void 0?1:Number(e[5])/(e[6]?100:1)});return Gn(s)},"hsl"]],object:[[function(t){var e=t.r,r=t.g,n=t.b,s=t.a,a=s===void 0?1:s;return De(e)&&De(r)&&De(n)?Ln({r:Number(e),g:Number(r),b:Number(n),a:Number(a)}):null},"rgb"],[function(t){var e=t.h,r=t.s,n=t.l,s=t.a,a=s===void 0?1:s;if(!De(e)||!De(r)||!De(n))return null;var l=wn({h:Number(e),s:Number(r),l:Number(n),a:Number(a)});return Gn(l)},"hsl"],[function(t){var e=t.h,r=t.s,n=t.v,s=t.a,a=s===void 0?1:s;if(!De(e)||!De(r)||!De(n))return null;var l=function(o){return{h:Li(o.h),s:Re(o.s,0,100),v:Re(o.v,0,100),a:Re(o.a)}}({h:Number(e),s:Number(r),v:Number(n),a:Number(a)});return Ui(l)},"hsv"]]},Vn=function(t,e){for(var r=0;r<e.length;r++){var n=e[r][0](t);if(n)return[n,e[r][1]]}return[null,void 0]},Gu=function(t){return typeof t=="string"?Vn(t.trim(),Hn.string):typeof t=="object"&&t!==null?Vn(t,Hn.object):[null,void 0]},gr=function(t,e){var r=At(t);return{h:r.h,s:Re(r.s+100*e,0,100),l:r.l,a:r.a}},xr=function(t){return(299*t.r+587*t.g+114*t.b)/1e3/255},Xn=function(t,e){var r=At(t);return{h:r.h,s:r.s,l:Re(r.l+100*e,0,100),a:r.a}},kn=function(){function t(e){this.parsed=Gu(e)[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return t.prototype.isValid=function(){return this.parsed!==null},t.prototype.brightness=function(){return Ae(xr(this.rgba),2)},t.prototype.isDark=function(){return xr(this.rgba)<.5},t.prototype.isLight=function(){return xr(this.rgba)>=.5},t.prototype.toHex=function(){return e=Rr(this.rgba),r=e.r,n=e.g,s=e.b,l=(a=e.a)<1?yt(Ae(255*a)):"","#"+yt(r)+yt(n)+yt(s)+l;var e,r,n,s,a,l},t.prototype.toRgb=function(){return Rr(this.rgba)},t.prototype.toRgbString=function(){return e=Rr(this.rgba),r=e.r,n=e.g,s=e.b,(a=e.a)<1?"rgba("+r+", "+n+", "+s+", "+a+")":"rgb("+r+", "+n+", "+s+")";var e,r,n,s,a},t.prototype.toHsl=function(){return Un(At(this.rgba))},t.prototype.toHslString=function(){return e=Un(At(this.rgba)),r=e.h,n=e.s,s=e.l,(a=e.a)<1?"hsla("+r+", "+n+"%, "+s+"%, "+a+")":"hsl("+r+", "+n+"%, "+s+"%)";var e,r,n,s,a},t.prototype.toHsv=function(){return e=wi(this.rgba),{h:Ae(e.h),s:Ae(e.s),v:Ae(e.v),a:Ae(e.a,3)};var e},t.prototype.invert=function(){return Ce({r:255-(e=this.rgba).r,g:255-e.g,b:255-e.b,a:e.a});var e},t.prototype.saturate=function(e){return e===void 0&&(e=.1),Ce(gr(this.rgba,e))},t.prototype.desaturate=function(e){return e===void 0&&(e=.1),Ce(gr(this.rgba,-e))},t.prototype.grayscale=function(){return Ce(gr(this.rgba,-1))},t.prototype.lighten=function(e){return e===void 0&&(e=.1),Ce(Xn(this.rgba,e))},t.prototype.darken=function(e){return e===void 0&&(e=.1),Ce(Xn(this.rgba,-e))},t.prototype.rotate=function(e){return e===void 0&&(e=15),this.hue(this.hue()+e)},t.prototype.alpha=function(e){return typeof e=="number"?Ce({r:(r=this.rgba).r,g:r.g,b:r.b,a:e}):Ae(this.rgba.a,3);var r},t.prototype.hue=function(e){var r=At(this.rgba);return typeof e=="number"?Ce({h:e,s:r.s,l:r.l,a:r.a}):Ae(r.h)},t.prototype.isEqual=function(e){return this.toHex()===Ce(e).toHex()},t}(),Ce=function(t){return t instanceof kn?t:new kn(t)};let Ur=!0,Gr=!0;window.addEventListener("keydown",t=>{t.key==="e"&&(Ur=!Ur),t.key==="n"&&(Gr=!Gr)});const Gi=()=>[Ce(document.body.style.backgroundColor).toRgb()].flatMap(({r:t,g:e,b:r,a:n})=>[t,e,r,n].map(s=>s/255)),Hi=()=>{const t=window.devicePixelRatio||1,e=window.innerWidth,r=window.innerHeight,n=Math.floor(e*t),s=Math.floor(r*t);return{width:n,height:s}},te=ie.infinite(()=>{const t=document.createElement("canvas");document.body.appendChild(t),t.getContext("webgl2")?console.log("WebGL2 initialized"):console.error("WebGL2 failed to initialize");const{width:r,height:n}=Hi();return M.createApp(t,{antialias:!0,extensions:["OES_texture_float","EXT_color_buffer_float","ANGLE_instanced_arrays"]}).viewport(0,0,r,n).enable(M.BLEND).blendFunc(M.SRC_ALPHA,M.ONE_MINUS_SRC_ALPHA).enable(M.DEPTH_TEST).depthFunc(M.LEQUAL).clearColor(...Gi())}),Hu=()=>{const t=te(),{width:e,height:r}=Hi();t.resize(e,r),Mt.resize(e/r);const n=t.canvas;n.style.position="absolute",n.style.top="0px",n.style.left="0px",n.style.height="100vh"},Vi=()=>{Eu(Uo,window.innerWidth,window.innerHeight);const t=te();Hu(),au().then(a=>{vu.highlightNode(a)}),mu().then(a=>{Cu.highlightNode(a),Nu.highlightNode(a)});const e=ku();t.drawFramebuffer(e).scissor(0,0,e.width,e.height).enable(M.SCISSOR_TEST).viewport(0,0,e.width,e.height).clearColor(0,0,0,1),ju().uniform("uMixRatio",.05).draw(),xu(),t.defaultDrawFramebuffer().defaultViewport().clearColor(...Gi()).disable(M.SCISSOR_TEST);const n=Ms().uniformBlock("cameras",Vt()).uniform("mousePosition",Kt()).uniform("selectedIndex",Be()).uniform("hoveringIndex",Tu()).uniform("time",performance.now()/1e3),s=Xs().uniformBlock("cameras",Vt()).texture("positionTexture",me().texture).texture("colorTexture",ge().texture).texture("sizeTexture",xe().texture).texture("emphasisTexture",Pe().texture).uniform("textureDimensions",[e.width,e.height]).uniform("mousePosition",Kt()).uniform("selectedIndex",Be()).uniform("time",performance.now()/1e3);t.clear(),Gr&&n.draw(),Ur&&s.draw(),window.lolDrawThatThing=a=>{a==="color"&&(window.lolDrawThat=ge().texture),a==="position"&&(window.lolDrawThat=me().texture),a==="size"&&(window.lolDrawThat=xe().texture),a==="picker"?window.lolDrawThat=Qn().current.colorAttachments[0]:window.lolDrawThat=null},window.lolDrawThat&&Pu(window.lolDrawThat),Xu(),requestAnimationFrame(Vi)},Vu=(t,e)=>{let r;switch(`${t}${e}`){case`${M.FLOAT}4`:r=M.RGBA32F;break;case`${M.FLOAT}3`:r=M.RGBA32F;break;case`${M.FLOAT}2`:r=M.RG32F;break;case`${M.FLOAT}1`:r=M.R32F;break;case`${M.UNSIGNED_BYTE}3`:r=M.RGB8;break;case`${M.UNSIGNED_BYTE}4`:r=M.RGBA8;break;case`${M.UNSIGNED_SHORT}3`:r=M.RGB16UI;break;case`${M.UNSIGNED_SHORT}4`:r=M.RGBA16UI;break;case`${M.UNSIGNED_INT}3`:r=M.RGB32UI;break;case`${M.UNSIGNED_INT}4`:r=M.RGBA32UI;break}return r};class Jt{constructor(e,r,n){this.positionSwap=!1,this.makeBuffer=ie.infinite((s,a)=>te().createVertexBuffer(this._type,this._itemSize,s*this._itemSize)),this.makeTexture=ie.infinite(s=>{const a=te(),l=Math.ceil(Math.sqrt(s+1)),o={width:l,height:l,internalFormat:Vu(this._type,this._itemSize),type:this._type,flipY:!0,minFilter:M.NEAREST,magFilter:M.NEAREST,premultiplyAlpha:!0,wrapY:M.CLAMP_TO_EDGE,wrapX:M.CLAMP_TO_EDGE};return a.createTexture2D(l,l,o)}),this.makeTextureIndicesVertexBuffer=ie.infinite(s=>{const a=te(),l=new Uint32Array(s).map((o,u)=>u);return a.createVertexBuffer(M.UNSIGNED_INT,1,l)}),this.targetData=(s,{offset:a=-1,immediate:l=!1}={})=>{let o;a>-1?o=this._target.numItems:(a=0,o=ArrayBuffer.isView(s)?s.byteLength/this._itemSize/4:s,this._readbackBuffer=this.makeBuffer(100,"readback")),this._currentA=this.makeBuffer(o,"currentA"),this._currentB=this.makeBuffer(o,"currentB"),this._target=this.makeBuffer(o,"target"),this._texture=this.makeTexture(o),this._texturePixelPositions=this.makeTextureIndicesVertexBuffer(o),ArrayBuffer.isView(s)&&(this._target.data(s,a*this._itemSize*4),this._mostRecentData=s,l&&(this._currentA.data(s,a*this._itemSize*4),this._currentB.data(s,a*this._itemSize*4)))},this._type=e,this._itemSize=r,this.targetData(n)}swap(){this.positionSwap=!this.positionSwap}readBack(e){const n=te().gl;let s;this._type===M.FLOAT?s=new Float32Array(this._itemSize):this._type===M.UNSIGNED_BYTE?s=new Uint8Array(this._itemSize):this._type===M.UNSIGNED_SHORT?s=new Uint16Array(this._itemSize):this._type===M.UNSIGNED_INT?s=new Uint32Array(this._itemSize):s=new ArrayBuffer(this._itemSize*4),n.bindBufferBase(n.TRANSFORM_FEEDBACK_BUFFER,0,null),n.bindBufferBase(n.TRANSFORM_FEEDBACK_BUFFER,1,null),n.bindBufferBase(n.TRANSFORM_FEEDBACK_BUFFER,2,null),n.bindBufferBase(n.TRANSFORM_FEEDBACK_BUFFER,3,null);const a=e*this._itemSize*4;n.bindBuffer(M.COPY_READ_BUFFER,this.target.buffer),n.bindBuffer(M.COPY_WRITE_BUFFER,this._readbackBuffer.buffer),n.copyBufferSubData(M.COPY_READ_BUFFER,M.COPY_WRITE_BUFFER,a,0,this._itemSize*4);const l=new DataView(s.buffer);return n.getBufferSubData(n.COPY_WRITE_BUFFER,0,l),n.bindBuffer(M.COPY_READ_BUFFER,null),s}get current(){return this.positionSwap?this._currentA:this._currentB}get texture(){return this._texture}get texturePixelPositions(){return this._texturePixelPositions}get updated(){return this.positionSwap?this._currentB:this._currentA}get target(){return this._target}get mostRecentData(){return this._mostRecentData}}const me=ie.infinite(()=>new Jt(M.FLOAT,3,1)),ge=ie.infinite(()=>new Jt(M.FLOAT,4,1)),xe=ie.infinite(()=>new Jt(M.FLOAT,1,1)),Pe=ie.infinite(()=>new Jt(M.FLOAT,1,1)),Xu=()=>{me().swap(),xe().swap(),ge().swap(),Pe().swap()},Hr=ie.infinite(()=>te().createFramebuffer());ie.infinite(t=>te().createTexture2D(t,t,{internalFormat:M.DEPTH_COMPONENT32F}));const ku=()=>{te();const t=Hr(),e=me().texture,r=ge().texture,n=xe().texture,s=Pe().texture;return t.colorTarget(1,e),t.colorTarget(2,r),t.colorTarget(3,n),t.colorTarget(4,s),t},zu=ie.infinite(()=>te().createProgram(cs,fs,{transformFeedbackVaryings:["vUpdatedPosition","vUpdatedColor","vUpdatedSize","vUpdatedEmphasis"],transformFeedbackMode:M.SEPARATE_ATTRIBS})),$u=ie.infinite(()=>te().createVertexArray()),Ku=()=>(te(),$u().vertexAttributeBuffer(0,me().current).vertexAttributeBuffer(1,ge().current).vertexAttributeBuffer(2,xe().current).vertexAttributeBuffer(3,Pe().current).vertexAttributeBuffer(4,me().target).vertexAttributeBuffer(5,ge().target).vertexAttributeBuffer(6,xe().target).vertexAttributeBuffer(7,Pe().target).vertexAttributeBuffer(8,me().texturePixelPositions)),Wu=ie.infinite(()=>te().createTransformFeedback()),Yu=()=>Wu().feedbackBuffer(0,me().updated).feedbackBuffer(1,ge().updated).feedbackBuffer(2,xe().updated).feedbackBuffer(3,Pe().updated),ju=()=>{const t=te(),e=zu(),r=Ku(),n=Yu();return t.createDrawCall(e,r).primitive(M.POINTS).transformFeedback(n).uniform("mousePosition",Kt()).uniform("bufferDimensions",[Hr().width,Hr().height])},Oe=document.createElement("div");document.body.appendChild(Oe);Oe.id="fps-indicator";Oe.classList.add("overlay");Oe.classList.add("debug");Oe.innerHTML=`
<div class="value">FPS: 0</div>
<canvas width="60" height="20" class="graph"></canvas>
`;Oe.style.position="absolute";Oe.style.top="0px";Oe.style.left="0px";Oe.style.color="white";const qu=document.querySelector("#fps-indicator .value"),Ye=document.querySelector("#fps-indicator .graph"),Le=Ye.getContext("2d");let Sr=performance.now(),zn=performance.now(),vr=0,ct=[];const $n=5,Zu=()=>ct.slice(0,$n).reduce((t,e)=>t+e,0)/$n,Yr=()=>{const t=Zu(),e=performance.now();vr++,e>Sr+100&&(ct=[Math.round(vr*1e3/(e-Sr)/2),...ct].slice(0,1e3),Le?.clearRect(0,0,Ye.width,Ye.height),Le?.beginPath(),Le?.moveTo(0,Ye.height),ct.forEach((r,n)=>{Le?.lineTo(n,Ye.height-r)}),Le?.lineTo(ct.length,Ye.height),Le.fillStyle="rgba(255, 255, 255, 0.5)",Le?.fill(),Le?.stroke(),Sr=e,vr=0),e>zn+1e3&&(zn=e,qu.innerText=`FPS: ${t}`),requestAnimationFrame(Yr)};Yr();const Qu=te();Qu.clear();Ru();pu();let er;er=await Me();await Ul();const{nodes:Ne,linkIndexPairs:Xi}=er;console.log("nodes",Ne);const Kn=[Hl],Ju=async()=>{const t=Kn[Math.floor(Math.random()*Kn.length)];await t(er)};await Ju();Hs(Xi);const eh=new Float32Array(Ne.flatMap(({color:t})=>t));ge().targetData(eh);const Vr=new Float32Array(Ne.length);for(let t=0;t<Vr.length;t++)Vr[t]=Math.sqrt(Ne[t].size)/40;xe().targetData(Vr);const Cr=40,th=()=>[Math.random()*Cr-1,Math.random()*Cr-1,Math.random()*Cr-1],rh=new Float32Array(Ne.flatMap(th));me().targetData(rh);Pe().targetData(new Float32Array(Ne.length).fill(0));const st=document.createElement("div");st.classList.add("overlay");st.classList.add("debug");st.style.top="0";st.style.right="0";document.body.appendChild(st);st.innerHTML=`
    <div>Nodes: ${Ne.length}</div>
    <div>Edges: ${Xi.length}</div>
`;Vi();Yr();Qt.start();window.setNodePositions=t=>{me().targetData(new Float32Array(new Array(Ne.length*3).fill(0).flatMap(t)))};window.setNodeColors=t=>{ge().targetData(new Float32Array(new Array(Ne.length*4).fill(0).flatMap(t)))};window.setNodeSizes=t=>{xe().targetData(new Float32Array(new Array(Ne.length).fill(0).flatMap(t)))};window.graphData=er;window.addEventListener("keydown",t=>{const e=document.querySelector("#debug-style").sheet,r=e.cssRules[0].styleMap.get("display").value!=="none";t.key==="d"&&e.cssRules[0].styleMap.set("display",r?"none":"block")})})();