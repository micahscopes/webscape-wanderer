(async()=>{(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&n(l)}).observe(document,{childList:!0,subtree:!0});function r(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(s){if(s.ep)return;s.ep=!0;const o=r(s);fetch(s.href,o)}})();const i={DEPTH_BUFFER_BIT:256,STENCIL_BUFFER_BIT:1024,COLOR_BUFFER_BIT:16384,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,ZERO:0,ONE:1,SRC_COLOR:768,ONE_MINUS_SRC_COLOR:769,SRC_ALPHA:770,ONE_MINUS_SRC_ALPHA:771,DST_ALPHA:772,ONE_MINUS_DST_ALPHA:773,DST_COLOR:774,ONE_MINUS_DST_COLOR:775,SRC_ALPHA_SATURATE:776,FUNC_ADD:32774,BLEND_EQUATION:32777,BLEND_EQUATION_RGB:32777,BLEND_EQUATION_ALPHA:34877,FUNC_SUBTRACT:32778,FUNC_REVERSE_SUBTRACT:32779,BLEND_DST_RGB:32968,BLEND_SRC_RGB:32969,BLEND_DST_ALPHA:32970,BLEND_SRC_ALPHA:32971,CONSTANT_COLOR:32769,ONE_MINUS_CONSTANT_COLOR:32770,CONSTANT_ALPHA:32771,ONE_MINUS_CONSTANT_ALPHA:32772,BLEND_COLOR:32773,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,ARRAY_BUFFER_BINDING:34964,ELEMENT_ARRAY_BUFFER_BINDING:34965,STREAM_DRAW:35040,STATIC_DRAW:35044,DYNAMIC_DRAW:35048,BUFFER_SIZE:34660,BUFFER_USAGE:34661,CURRENT_VERTEX_ATTRIB:34342,FRONT:1028,BACK:1029,FRONT_AND_BACK:1032,CULL_FACE:2884,BLEND:3042,DITHER:3024,STENCIL_TEST:2960,DEPTH_TEST:2929,SCISSOR_TEST:3089,POLYGON_OFFSET_FILL:32823,SAMPLE_ALPHA_TO_COVERAGE:32926,SAMPLE_COVERAGE:32928,NO_ERROR:0,INVALID_ENUM:1280,INVALID_VALUE:1281,INVALID_OPERATION:1282,OUT_OF_MEMORY:1285,CW:2304,CCW:2305,LINE_WIDTH:2849,ALIASED_POINT_SIZE_RANGE:33901,ALIASED_LINE_WIDTH_RANGE:33902,CULL_FACE_MODE:2885,FRONT_FACE:2886,DEPTH_RANGE:2928,DEPTH_WRITEMASK:2930,DEPTH_CLEAR_VALUE:2931,DEPTH_FUNC:2932,STENCIL_CLEAR_VALUE:2961,STENCIL_FUNC:2962,STENCIL_FAIL:2964,STENCIL_PASS_DEPTH_FAIL:2965,STENCIL_PASS_DEPTH_PASS:2966,STENCIL_REF:2967,STENCIL_VALUE_MASK:2963,STENCIL_WRITEMASK:2968,STENCIL_BACK_FUNC:34816,STENCIL_BACK_FAIL:34817,STENCIL_BACK_PASS_DEPTH_FAIL:34818,STENCIL_BACK_PASS_DEPTH_PASS:34819,STENCIL_BACK_REF:36003,STENCIL_BACK_VALUE_MASK:36004,STENCIL_BACK_WRITEMASK:36005,VIEWPORT:2978,SCISSOR_BOX:3088,COLOR_CLEAR_VALUE:3106,COLOR_WRITEMASK:3107,UNPACK_ALIGNMENT:3317,PACK_ALIGNMENT:3333,MAX_TEXTURE_SIZE:3379,MAX_VIEWPORT_DIMS:3386,SUBPIXEL_BITS:3408,RED_BITS:3410,GREEN_BITS:3411,BLUE_BITS:3412,ALPHA_BITS:3413,DEPTH_BITS:3414,STENCIL_BITS:3415,POLYGON_OFFSET_UNITS:10752,POLYGON_OFFSET_FACTOR:32824,TEXTURE_BINDING_2D:32873,SAMPLE_BUFFERS:32936,SAMPLES:32937,SAMPLE_COVERAGE_VALUE:32938,SAMPLE_COVERAGE_INVERT:32939,COMPRESSED_TEXTURE_FORMATS:34467,DONT_CARE:4352,FASTEST:4353,NICEST:4354,GENERATE_MIPMAP_HINT:33170,BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DEPTH_COMPONENT:6402,ALPHA:6406,RGB:6407,RGBA:6408,LUMINANCE:6409,LUMINANCE_ALPHA:6410,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,FRAGMENT_SHADER:35632,VERTEX_SHADER:35633,MAX_VERTEX_ATTRIBS:34921,MAX_VERTEX_UNIFORM_VECTORS:36347,MAX_VARYING_VECTORS:36348,MAX_COMBINED_TEXTURE_IMAGE_UNITS:35661,MAX_VERTEX_TEXTURE_IMAGE_UNITS:35660,MAX_TEXTURE_IMAGE_UNITS:34930,MAX_FRAGMENT_UNIFORM_VECTORS:36349,SHADER_TYPE:35663,DELETE_STATUS:35712,LINK_STATUS:35714,VALIDATE_STATUS:35715,ATTACHED_SHADERS:35717,ACTIVE_UNIFORMS:35718,ACTIVE_ATTRIBUTES:35721,SHADING_LANGUAGE_VERSION:35724,CURRENT_PROGRAM:35725,NEVER:512,LESS:513,EQUAL:514,LEQUAL:515,GREATER:516,NOTEQUAL:517,GEQUAL:518,ALWAYS:519,KEEP:7680,REPLACE:7681,INCR:7682,DECR:7683,INVERT:5386,INCR_WRAP:34055,DECR_WRAP:34056,VENDOR:7936,RENDERER:7937,VERSION:7938,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987,TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,TEXTURE_2D:3553,TEXTURE:5890,TEXTURE_CUBE_MAP:34067,TEXTURE_BINDING_CUBE_MAP:34068,TEXTURE_CUBE_MAP_POSITIVE_X:34069,TEXTURE_CUBE_MAP_NEGATIVE_X:34070,TEXTURE_CUBE_MAP_POSITIVE_Y:34071,TEXTURE_CUBE_MAP_NEGATIVE_Y:34072,TEXTURE_CUBE_MAP_POSITIVE_Z:34073,TEXTURE_CUBE_MAP_NEGATIVE_Z:34074,MAX_CUBE_MAP_TEXTURE_SIZE:34076,TEXTURE0:33984,TEXTURE1:33985,TEXTURE2:33986,TEXTURE3:33987,TEXTURE4:33988,TEXTURE5:33989,TEXTURE6:33990,TEXTURE7:33991,TEXTURE8:33992,TEXTURE9:33993,TEXTURE10:33994,TEXTURE11:33995,TEXTURE12:33996,TEXTURE13:33997,TEXTURE14:33998,TEXTURE15:33999,TEXTURE16:34e3,TEXTURE17:34001,TEXTURE18:34002,TEXTURE19:34003,TEXTURE20:34004,TEXTURE21:34005,TEXTURE22:34006,TEXTURE23:34007,TEXTURE24:34008,TEXTURE25:34009,TEXTURE26:34010,TEXTURE27:34011,TEXTURE28:34012,TEXTURE29:34013,TEXTURE30:34014,TEXTURE31:34015,ACTIVE_TEXTURE:34016,REPEAT:10497,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,SAMPLER_2D:35678,SAMPLER_CUBE:35680,VERTEX_ATTRIB_ARRAY_ENABLED:34338,VERTEX_ATTRIB_ARRAY_SIZE:34339,VERTEX_ATTRIB_ARRAY_STRIDE:34340,VERTEX_ATTRIB_ARRAY_TYPE:34341,VERTEX_ATTRIB_ARRAY_NORMALIZED:34922,VERTEX_ATTRIB_ARRAY_POINTER:34373,VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:34975,IMPLEMENTATION_COLOR_READ_TYPE:35738,IMPLEMENTATION_COLOR_READ_FORMAT:35739,COMPILE_STATUS:35713,LOW_FLOAT:36336,MEDIUM_FLOAT:36337,HIGH_FLOAT:36338,LOW_INT:36339,MEDIUM_INT:36340,HIGH_INT:36341,FRAMEBUFFER:36160,RENDERBUFFER:36161,RGBA4:32854,RGB5_A1:32855,RGB565:36194,DEPTH_COMPONENT16:33189,STENCIL_INDEX:6401,STENCIL_INDEX8:36168,DEPTH_STENCIL:34041,RENDERBUFFER_WIDTH:36162,RENDERBUFFER_HEIGHT:36163,RENDERBUFFER_INTERNAL_FORMAT:36164,RENDERBUFFER_RED_SIZE:36176,RENDERBUFFER_GREEN_SIZE:36177,RENDERBUFFER_BLUE_SIZE:36178,RENDERBUFFER_ALPHA_SIZE:36179,RENDERBUFFER_DEPTH_SIZE:36180,RENDERBUFFER_STENCIL_SIZE:36181,FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:36048,FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:36049,FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL:36050,FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE:36051,COLOR_ATTACHMENT0:36064,DEPTH_ATTACHMENT:36096,STENCIL_ATTACHMENT:36128,DEPTH_STENCIL_ATTACHMENT:33306,NONE:0,FRAMEBUFFER_COMPLETE:36053,FRAMEBUFFER_INCOMPLETE_ATTACHMENT:36054,FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:36055,FRAMEBUFFER_INCOMPLETE_DIMENSIONS:36057,FRAMEBUFFER_UNSUPPORTED:36061,FRAMEBUFFER_BINDING:36006,RENDERBUFFER_BINDING:36007,MAX_RENDERBUFFER_SIZE:34024,INVALID_FRAMEBUFFER_OPERATION:1286,UNPACK_FLIP_Y_WEBGL:37440,UNPACK_PREMULTIPLY_ALPHA_WEBGL:37441,CONTEXT_LOST_WEBGL:37442,UNPACK_COLORSPACE_CONVERSION_WEBGL:37443,BROWSER_DEFAULT_WEBGL:37444,READ_BUFFER:3074,UNPACK_ROW_LENGTH:3314,UNPACK_SKIP_ROWS:3315,UNPACK_SKIP_PIXELS:3316,PACK_ROW_LENGTH:3330,PACK_SKIP_ROWS:3331,PACK_SKIP_PIXELS:3332,COLOR:6144,DEPTH:6145,STENCIL:6146,RED:6403,RGB8:32849,RGBA8:32856,RGB10_A2:32857,TEXTURE_BINDING_3D:32874,UNPACK_SKIP_IMAGES:32877,UNPACK_IMAGE_HEIGHT:32878,TEXTURE_3D:32879,TEXTURE_WRAP_R:32882,MAX_3D_TEXTURE_SIZE:32883,UNSIGNED_INT_2_10_10_10_REV:33640,MAX_ELEMENTS_VERTICES:33e3,MAX_ELEMENTS_INDICES:33001,TEXTURE_MIN_LOD:33082,TEXTURE_MAX_LOD:33083,TEXTURE_BASE_LEVEL:33084,TEXTURE_MAX_LEVEL:33085,MIN:32775,MAX:32776,DEPTH_COMPONENT24:33190,MAX_TEXTURE_LOD_BIAS:34045,TEXTURE_COMPARE_MODE:34892,TEXTURE_COMPARE_FUNC:34893,CURRENT_QUERY:34917,QUERY_RESULT:34918,QUERY_RESULT_AVAILABLE:34919,STREAM_READ:35041,STREAM_COPY:35042,STATIC_READ:35045,STATIC_COPY:35046,DYNAMIC_READ:35049,DYNAMIC_COPY:35050,MAX_DRAW_BUFFERS:34852,DRAW_BUFFER0:34853,DRAW_BUFFER1:34854,DRAW_BUFFER2:34855,DRAW_BUFFER3:34856,DRAW_BUFFER4:34857,DRAW_BUFFER5:34858,DRAW_BUFFER6:34859,DRAW_BUFFER7:34860,DRAW_BUFFER8:34861,DRAW_BUFFER9:34862,DRAW_BUFFER10:34863,DRAW_BUFFER11:34864,DRAW_BUFFER12:34865,DRAW_BUFFER13:34866,DRAW_BUFFER14:34867,DRAW_BUFFER15:34868,MAX_FRAGMENT_UNIFORM_COMPONENTS:35657,MAX_VERTEX_UNIFORM_COMPONENTS:35658,SAMPLER_3D:35679,SAMPLER_2D_SHADOW:35682,FRAGMENT_SHADER_DERIVATIVE_HINT:35723,PIXEL_PACK_BUFFER:35051,PIXEL_UNPACK_BUFFER:35052,PIXEL_PACK_BUFFER_BINDING:35053,PIXEL_UNPACK_BUFFER_BINDING:35055,FLOAT_MAT2x3:35685,FLOAT_MAT2x4:35686,FLOAT_MAT3x2:35687,FLOAT_MAT3x4:35688,FLOAT_MAT4x2:35689,FLOAT_MAT4x3:35690,SRGB:35904,SRGB8:35905,SRGB8_ALPHA8:35907,COMPARE_REF_TO_TEXTURE:34894,RGBA32F:34836,RGB32F:34837,RGBA16F:34842,RGB16F:34843,VERTEX_ATTRIB_ARRAY_INTEGER:35069,MAX_ARRAY_TEXTURE_LAYERS:35071,MIN_PROGRAM_TEXEL_OFFSET:35076,MAX_PROGRAM_TEXEL_OFFSET:35077,MAX_VARYING_COMPONENTS:35659,TEXTURE_2D_ARRAY:35866,TEXTURE_BINDING_2D_ARRAY:35869,R11F_G11F_B10F:35898,UNSIGNED_INT_10F_11F_11F_REV:35899,RGB9_E5:35901,UNSIGNED_INT_5_9_9_9_REV:35902,TRANSFORM_FEEDBACK_BUFFER_MODE:35967,MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS:35968,TRANSFORM_FEEDBACK_VARYINGS:35971,TRANSFORM_FEEDBACK_BUFFER_START:35972,TRANSFORM_FEEDBACK_BUFFER_SIZE:35973,TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN:35976,RASTERIZER_DISCARD:35977,MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS:35978,MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS:35979,INTERLEAVED_ATTRIBS:35980,SEPARATE_ATTRIBS:35981,TRANSFORM_FEEDBACK_BUFFER:35982,TRANSFORM_FEEDBACK_BUFFER_BINDING:35983,RGBA32UI:36208,RGB32UI:36209,RGBA16UI:36214,RGB16UI:36215,RGBA8UI:36220,RGB8UI:36221,RGBA32I:36226,RGB32I:36227,RGBA16I:36232,RGB16I:36233,RGBA8I:36238,RGB8I:36239,RED_INTEGER:36244,RGB_INTEGER:36248,RGBA_INTEGER:36249,SAMPLER_2D_ARRAY:36289,SAMPLER_2D_ARRAY_SHADOW:36292,SAMPLER_CUBE_SHADOW:36293,UNSIGNED_INT_VEC2:36294,UNSIGNED_INT_VEC3:36295,UNSIGNED_INT_VEC4:36296,INT_SAMPLER_2D:36298,INT_SAMPLER_3D:36299,INT_SAMPLER_CUBE:36300,INT_SAMPLER_2D_ARRAY:36303,UNSIGNED_INT_SAMPLER_2D:36306,UNSIGNED_INT_SAMPLER_3D:36307,UNSIGNED_INT_SAMPLER_CUBE:36308,UNSIGNED_INT_SAMPLER_2D_ARRAY:36311,DEPTH_COMPONENT32F:36012,DEPTH32F_STENCIL8:36013,FLOAT_32_UNSIGNED_INT_24_8_REV:36269,FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING:33296,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE:33297,FRAMEBUFFER_ATTACHMENT_RED_SIZE:33298,FRAMEBUFFER_ATTACHMENT_GREEN_SIZE:33299,FRAMEBUFFER_ATTACHMENT_BLUE_SIZE:33300,FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE:33301,FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE:33302,FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE:33303,FRAMEBUFFER_DEFAULT:33304,UNSIGNED_INT_24_8:34042,DEPTH24_STENCIL8:35056,UNSIGNED_NORMALIZED:35863,DRAW_FRAMEBUFFER_BINDING:36006,READ_FRAMEBUFFER:36008,DRAW_FRAMEBUFFER:36009,READ_FRAMEBUFFER_BINDING:36010,RENDERBUFFER_SAMPLES:36011,FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER:36052,MAX_COLOR_ATTACHMENTS:36063,COLOR_ATTACHMENT1:36065,COLOR_ATTACHMENT2:36066,COLOR_ATTACHMENT3:36067,COLOR_ATTACHMENT4:36068,COLOR_ATTACHMENT5:36069,COLOR_ATTACHMENT6:36070,COLOR_ATTACHMENT7:36071,COLOR_ATTACHMENT8:36072,COLOR_ATTACHMENT9:36073,COLOR_ATTACHMENT10:36074,COLOR_ATTACHMENT11:36075,COLOR_ATTACHMENT12:36076,COLOR_ATTACHMENT13:36077,COLOR_ATTACHMENT14:36078,COLOR_ATTACHMENT15:36079,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE:36182,MAX_SAMPLES:36183,HALF_FLOAT:5131,RG:33319,RG_INTEGER:33320,R8:33321,RG8:33323,R16F:33325,R32F:33326,RG16F:33327,RG32F:33328,R8I:33329,R8UI:33330,R16I:33331,R16UI:33332,R32I:33333,R32UI:33334,RG8I:33335,RG8UI:33336,RG16I:33337,RG16UI:33338,RG32I:33339,RG32UI:33340,VERTEX_ARRAY_BINDING:34229,R8_SNORM:36756,RG8_SNORM:36757,RGB8_SNORM:36758,RGBA8_SNORM:36759,SIGNED_NORMALIZED:36764,COPY_READ_BUFFER:36662,COPY_WRITE_BUFFER:36663,COPY_READ_BUFFER_BINDING:36662,COPY_WRITE_BUFFER_BINDING:36663,UNIFORM_BUFFER:35345,UNIFORM_BUFFER_BINDING:35368,UNIFORM_BUFFER_START:35369,UNIFORM_BUFFER_SIZE:35370,MAX_VERTEX_UNIFORM_BLOCKS:35371,MAX_FRAGMENT_UNIFORM_BLOCKS:35373,MAX_COMBINED_UNIFORM_BLOCKS:35374,MAX_UNIFORM_BUFFER_BINDINGS:35375,MAX_UNIFORM_BLOCK_SIZE:35376,MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS:35377,MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS:35379,UNIFORM_BUFFER_OFFSET_ALIGNMENT:35380,ACTIVE_UNIFORM_BLOCKS:35382,UNIFORM_TYPE:35383,UNIFORM_SIZE:35384,UNIFORM_BLOCK_INDEX:35386,UNIFORM_OFFSET:35387,UNIFORM_ARRAY_STRIDE:35388,UNIFORM_MATRIX_STRIDE:35389,UNIFORM_IS_ROW_MAJOR:35390,UNIFORM_BLOCK_BINDING:35391,UNIFORM_BLOCK_DATA_SIZE:35392,UNIFORM_BLOCK_ACTIVE_UNIFORMS:35394,UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES:35395,UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER:35396,UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER:35398,INVALID_INDEX:4294967295,MAX_VERTEX_OUTPUT_COMPONENTS:37154,MAX_FRAGMENT_INPUT_COMPONENTS:37157,MAX_SERVER_WAIT_TIMEOUT:37137,OBJECT_TYPE:37138,SYNC_CONDITION:37139,SYNC_STATUS:37140,SYNC_FLAGS:37141,SYNC_FENCE:37142,SYNC_GPU_COMMANDS_COMPLETE:37143,UNSIGNALED:37144,SIGNALED:37145,ALREADY_SIGNALED:37146,TIMEOUT_EXPIRED:37147,CONDITION_SATISFIED:37148,WAIT_FAILED:37149,SYNC_FLUSH_COMMANDS_BIT:1,VERTEX_ATTRIB_ARRAY_DIVISOR:35070,ANY_SAMPLES_PASSED:35887,ANY_SAMPLES_PASSED_CONSERVATIVE:36202,SAMPLER_BINDING:35097,RGB10_A2UI:36975,INT_2_10_10_10_REV:36255,TRANSFORM_FEEDBACK:36386,TRANSFORM_FEEDBACK_PAUSED:36387,TRANSFORM_FEEDBACK_ACTIVE:36388,TRANSFORM_FEEDBACK_BINDING:36389,TEXTURE_IMMUTABLE_FORMAT:37167,MAX_ELEMENT_INDEX:36203,TEXTURE_IMMUTABLE_LEVELS:33503,TIMEOUT_IGNORED:-1,MAX_CLIENT_WAIT_TIMEOUT_WEBGL:37447,QUERY_COUNTER_BITS_EXT:34916,TIME_ELAPSED_EXT:35007,TIMESTAMP_EXT:36392,GPU_DISJOINT_EXT:36795,TEXTURE_MAX_ANISOTROPY_EXT:34046,MAX_TEXTURE_MAX_ANISOTROPY_EXT:34047,UNMASKED_VENDOR_WEBGL:37445,UNMASKED_RENDERER_WEBGL:37446,COMPLETION_STATUS_KHR:37297,COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_EXT:33778,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_SRGB_S3TC_DXT1_EXT:35916,COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT:35917,COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT:35918,COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT:35919,COMPRESSED_R11_EAC:37488,COMPRESSED_SIGNED_R11_EAC:37489,COMPRESSED_RG11_EAC:37490,COMPRESSED_SIGNED_RG11_EAC:37491,COMPRESSED_RGB8_ETC2:37492,COMPRESSED_SRGB8_ETC2:37493,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:37494,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:37495,COMPRESSED_RGBA8_ETC2_EAC:37496,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:37497,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGBA_ASTC_4x4_KHR:37808,COMPRESSED_RGBA_ASTC_5x4_KHR:37809,COMPRESSED_RGBA_ASTC_5x5_KHR:37810,COMPRESSED_RGBA_ASTC_6x5_KHR:37811,COMPRESSED_RGBA_ASTC_6x6_KHR:37812,COMPRESSED_RGBA_ASTC_8x5_KHR:37813,COMPRESSED_RGBA_ASTC_8x6_KHR:37814,COMPRESSED_RGBA_ASTC_8x8_KHR:37815,COMPRESSED_RGBA_ASTC_10x5_KHR:37816,COMPRESSED_RGBA_ASTC_10x6_KHR:37817,COMPRESSED_RGBA_ASTC_10x8_KHR:37818,COMPRESSED_RGBA_ASTC_10x10_KHR:37819,COMPRESSED_RGBA_ASTC_12x10_KHR:37820,COMPRESSED_RGBA_ASTC_12x12_KHR:37821,COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:37840,COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:37841,COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:37842,COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:37843,COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:37844,COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:37845,COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:37846,COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:37847,COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:37848,COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:37849,COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:37850,COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:37851,COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:37852,COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:37853},St={[i.BYTE]:1,[i.UNSIGNED_BYTE]:1,[i.SHORT]:2,[i.UNSIGNED_SHORT]:2,[i.INT]:4,[i.UNSIGNED_INT]:4,[i.FLOAT]:4},ci={[i.R8]:[i.RED,i.UNSIGNED_BYTE],[i.R8_SNORM]:[i.RED,i.BYTE],[i.R16F]:[i.RED,i.FLOAT],[i.R32F]:[i.RED,i.FLOAT],[i.R8UI]:[i.RED_INTEGER,i.UNSIGNED_BYTE],[i.R8I]:[i.RED_INTEGER,i.BYTE],[i.R16UI]:[i.RED_INTEGER,i.UNSIGNED_SHORT],[i.R16I]:[i.RED_INTEGER,i.SHORT],[i.R32UI]:[i.RED_INTEGER,i.UNSIGNED_INT],[i.R32I]:[i.RED_INTEGER,i.INT],[i.RG8]:[i.RG,i.UNSIGNED_BYTE],[i.RG8_SNORM]:[i.RG,i.BYTE],[i.RG16F]:[i.RG,i.FLOAT],[i.RG32F]:[i.RG,i.FLOAT],[i.RG8UI]:[i.RG_INTEGER,i.UNSIGNED_BYTE],[i.RG8I]:[i.RG_INTEGER,i.BYTE],[i.RG16UI]:[i.RG_INTEGER,i.UNSIGNED_SHORT],[i.RG16I]:[i.RG_INTEGER,i.SHORT],[i.RG32UI]:[i.RG_INTEGER,i.UNSIGNED_INT],[i.RG32I]:[i.RG_INTEGER,i.INT],[i.RGB8]:[i.RGB,i.UNSIGNED_BYTE],[i.SRGB8]:[i.RGB,i.UNSIGNED_BYTE],[i.RGB565]:[i.RGB,i.UNSIGNED_SHORT_5_6_5],[i.RGB8_SNORM]:[i.RGB,i.BYTE],[i.R11F_G11F_B10F]:[i.RGB,i.UNSIGNED_INT_10F_11F_11F_REV],[i.RGB9_E5]:[i.RGB,i.UNSIGNED_INT_5_9_9_9_REV],[i.RGB16F]:[i.RGB,i.FLOAT],[i.RGB32F]:[i.RGB,i.FLOAT],[i.RGB8UI]:[i.RGB_INTEGER,i.UNSIGNED_BYTE],[i.RGB8I]:[i.RGB_INTEGER,i.BYTE],[i.RGB16UI]:[i.RGB_INTEGER,i.UNSIGNED_SHORT],[i.RGB16I]:[i.RGB_INTEGER,i.SHORT],[i.RGB32UI]:[i.RGB_INTEGER,i.UNSIGNED_INT],[i.RGB32I]:[i.RGB_INTEGER,i.INT],[i.RGBA8]:[i.RGBA,i.UNSIGNED_BYTE],[i.SRGB8_ALPHA8]:[i.RGBA,i.UNSIGNED_BYTE],[i.RGBA8_SNORM]:[i.RGBA,i.BYTE],[i.RGB5_A1]:[i.RGBA,i.UNSIGNED_SHORT_5_5_5_1],[i.RGBA4]:[i.RGBA,i.UNSIGNED_SHORT_4_4_4_4],[i.RGB10_A2]:[i.RGBA,i.UNSIGNED_INT_2_10_10_10_REV],[i.RGBA16F]:[i.RGBA,i.FLOAT],[i.RGBA32F]:[i.RGBA,i.FLOAT],[i.RGBA8UI]:[i.RGBA_INTEGER,i.UNSIGNED_BYTE],[i.RGBA8I]:[i.RGBA_INTEGER,i.BYTE],[i.RGB10_A2UI]:[i.RGBA_INTEGER,i.UNSIGNED_INT_2_10_10_10_REV],[i.RGBA16UI]:[i.RGBA_INTEGER,i.UNSIGNED_SHORT],[i.RGBA16I]:[i.RGBA_INTEGER,i.SHORT],[i.RGBA32I]:[i.RGBA_INTEGER,i.INT],[i.RGBA32UI]:[i.RGBA_INTEGER,i.UNSIGNED_INT],[i.DEPTH_COMPONENT16]:[i.DEPTH_COMPONENT,i.UNSIGNED_SHORT],[i.DEPTH_COMPONENT24]:[i.DEPTH_COMPONENT,i.UNSIGNED_INT],[i.DEPTH_COMPONENT32F]:[i.DEPTH_COMPONENT,i.FLOAT],[i.DEPTH24_STENCIL8]:[i.DEPTH_STENCIL,i.UNSIGNED_INT_24_8],[i.DEPTH32F_STENCIL8]:[i.DEPTH_STENCIL,i.FLOAT_32_UNSIGNED_INT_24_8_REV]},Dt={[i.COMPRESSED_RGB_S3TC_DXT1_EXT]:!0,[i.COMPRESSED_RGBA_S3TC_DXT1_EXT]:!0,[i.COMPRESSED_RGBA_S3TC_DXT3_EXT]:!0,[i.COMPRESSED_RGBA_S3TC_DXT5_EXT]:!0,[i.COMPRESSED_SRGB_S3TC_DXT1_EXT]:!0,[i.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT]:!0,[i.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT]:!0,[i.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT]:!0,[i.COMPRESSED_R11_EAC]:!0,[i.COMPRESSED_SIGNED_R11_EAC]:!0,[i.COMPRESSED_RG11_EAC]:!0,[i.COMPRESSED_SIGNED_RG11_EAC]:!0,[i.COMPRESSED_RGB8_ETC2]:!0,[i.COMPRESSED_SRGB8_ETC2]:!0,[i.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2]:!0,[i.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2]:!0,[i.COMPRESSED_RGBA8_ETC2_EAC]:!0,[i.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC]:!0,[i.COMPRESSED_RGBA_ASTC_4x4_KHR]:!0,[i.COMPRESSED_RGBA_ASTC_5x4_KHR]:!0,[i.COMPRESSED_RGBA_ASTC_5x5_KHR]:!0,[i.COMPRESSED_RGBA_ASTC_6x5_KHR]:!0,[i.COMPRESSED_RGBA_ASTC_6x6_KHR]:!0,[i.COMPRESSED_RGBA_ASTC_8x5_KHR]:!0,[i.COMPRESSED_RGBA_ASTC_8x6_KHR]:!0,[i.COMPRESSED_RGBA_ASTC_8x8_KHR]:!0,[i.COMPRESSED_RGBA_ASTC_10x5_KHR]:!0,[i.COMPRESSED_RGBA_ASTC_10x6_KHR]:!0,[i.COMPRESSED_RGBA_ASTC_10x8_KHR]:!0,[i.COMPRESSED_RGBA_ASTC_10x10_KHR]:!0,[i.COMPRESSED_RGBA_ASTC_12x10_KHR]:!0,[i.COMPRESSED_RGBA_ASTC_12x12_KHR]:!0,[i.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR]:!0,[i.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR]:!0,[i.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR]:!0,[i.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR]:!0,[i.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR]:!0,[i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR]:!0,[i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR]:!0,[i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR]:!0,[i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR]:!0,[i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR]:!0,[i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR]:!0,[i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR]:!0,[i.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR]:!0,[i.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR]:!0,[i.COMPRESSED_RGB_PVRTC_4BPPV1_IMG]:!0,[i.COMPRESSED_RGB_PVRTC_2BPPV1_IMG]:!0,[i.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG]:!0,[i.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG]:!0},q={},Pt=new Array(1),Ve={},fi={[i.UNSIGNED_BYTE]:{[i.RED]:i.R8,[i.RG]:i.RG8,[i.RGB]:i.RGB8,[i.RGBA]:i.RGBA8},[i.UNSIGNED_SHORT]:{[i.DEPTH_COMPONENT]:i.DEPTH_COMPONENT16},[i.FLOAT]:{[i.RED]:i.R16F,[i.RG]:i.RG16F,[i.RGB]:i.RGB16F,[i.RGBA]:i.RGBA16F,[i.DEPTH_COMPONENT]:i.DEPTH_COMPONENT32F}};class Ji{constructor(e,r,n){if(this.gl=e,this.texture=null,this.appState=r,this.compressed=Dt[n.internalFormat],n.format!==void 0&&(console.warn("Cubemap option 'format' is deprecated and will be removed. Use 'internalFormat' with a sized format instead."),this.compressed=!!Dt[n.format],n.type===void 0&&(n.type=n.format===i.DEPTH_COMPONENT?i.UNSIGNED_SHORT:i.UNSIGNED_BYTE),n.internalFormat===void 0&&(this.compressed?n.internalFormat=n.format:n.internalFormat=fi[n.type][n.format])),this.compressed)this.internalFormat=n.internalFormat,this.format=n.internalFormat,this.type=i.UNSIGNED_BYTE;else{this.internalFormat=n.internalFormat!==void 0?n.internalFormat:i.RGBA8;let W=ci[this.internalFormat];this.format=W[0],this.type=n.type!==void 0?n.type:W[1]}this.currentUnit=-1;let s=Array.isArray(n.negX),o=s?n.negX[0]:n.negX,{width:l=o.width,height:a=o.height,flipY:u=!1,premultiplyAlpha:h=!1,minFilter:p=o?i.LINEAR_MIPMAP_NEAREST:i.NEAREST,magFilter:f=o?i.LINEAR:i.NEAREST,wrapS:T=i.REPEAT,wrapT:S=i.REPEAT,compareMode:v=i.NONE,compareFunc:O=i.LEQUAL,minLOD:b=null,maxLOD:B=null,baseLevel:x=null,maxLevel:d=null,maxAnisotropy:V=1}=n;this.width=l,this.height=a,this.flipY=u,this.premultiplyAlpha=h,this.minFilter=p,this.magFilter=f,this.wrapS=T,this.wrapT=S,this.compareMode=v,this.compareFunc=O,this.minLOD=b,this.maxLOD=B,this.baseLevel=x,this.maxLevel=d,this.maxAnisotropy=Math.min(V,q.MAX_TEXTURE_ANISOTROPY),this.mipmaps=p===i.LINEAR_MIPMAP_NEAREST||p===i.LINEAR_MIPMAP_LINEAR,this.miplevelsProvided=s&&n.negX.length>1,this.levels=this.mipmaps?Math.floor(Math.log2(Math.min(this.width,this.height)))+1:1,this.restore(n)}restore(e=Ve){this.texture=this.gl.createTexture(),this.currentUnit!==-1&&(this.appState.textures[this.currentUnit]=null),this.bind(0),this.gl.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_MAG_FILTER,this.magFilter),this.gl.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_MIN_FILTER,this.minFilter),this.gl.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_WRAP_S,this.wrapS),this.gl.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_WRAP_T,this.wrapT),this.gl.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_COMPARE_FUNC,this.compareFunc),this.gl.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_COMPARE_MODE,this.compareMode),this.baseLevel!==null&&this.gl.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_BASE_LEVEL,this.baseLevel),this.maxLevel!==null&&this.gl.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_MAX_LEVEL,this.maxLevel),this.minLOD!==null&&this.gl.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_MIN_LOD,this.minLOD),this.maxLOD!==null&&this.gl.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_MAX_LOD,this.maxLOD),this.maxAnisotropy>1&&this.gl.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_MAX_ANISOTROPY_EXT,this.maxAnisotropy),this.gl.texStorage2D(i.TEXTURE_CUBE_MAP,this.levels,this.internalFormat,this.width,this.height);let{negX:r,posX:n,negY:s,posY:o,negZ:l,posZ:a}=e;return r&&(this.faceData(i.TEXTURE_CUBE_MAP_NEGATIVE_X,r),this.faceData(i.TEXTURE_CUBE_MAP_POSITIVE_X,n),this.faceData(i.TEXTURE_CUBE_MAP_NEGATIVE_Y,s),this.faceData(i.TEXTURE_CUBE_MAP_POSITIVE_Y,o),this.faceData(i.TEXTURE_CUBE_MAP_NEGATIVE_Z,l),this.faceData(i.TEXTURE_CUBE_MAP_POSITIVE_Z,a)),this.mipmaps&&!this.miplevelsProvided&&this.gl.generateMipmap(i.TEXTURE_CUBE_MAP),this}delete(){return this.texture&&(this.gl.deleteTexture(this.texture),this.texture=null,this.appState.textures[this.currentUnit]=null,this.currentUnit=-1),this}faceData(e,r){Array.isArray(r)||(Pt[0]=r,r=Pt);let n=this.mipmaps?r.length:1,s=this.width,o=this.height,l;if(this.gl.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,this.flipY),this.gl.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.premultiplyAlpha),this.compressed)for(l=0;l<n;++l)this.gl.compressedTexSubImage2D(e,l,0,0,s,o,this.format,r[l]),s=Math.max(s>>1,1),o=Math.max(o>>1,1);else for(l=0;l<n;++l)this.gl.texSubImage2D(e,l,0,0,s,o,this.format,this.type,r[l]),s=Math.max(s>>1,1),o=Math.max(o>>1,1);return this}bind(e){let r=this.appState.textures[e];return this.appState.activeTexture!==e&&(this.gl.activeTexture(i.TEXTURE0+e),this.appState.activeTexture=e),r!==this&&(r&&(r.currentUnit=-1),this.currentUnit!==-1&&(this.appState.textures[this.currentUnit]=null),this.gl.bindTexture(i.TEXTURE_CUBE_MAP,this.texture),this.appState.textures[e]=this,this.currentUnit=e),this}}class en{constructor(e,r,n,s=null,o){this.gl=e,this.currentProgram=n,this.drawPrimitive=i.TRIANGLES,this.currentVertexArray=s,this.currentTransformFeedback=null,this.appState=r,this.uniformIndices={},this.uniformNames=new Array(q.MAX_UNIFORMS),this.uniformValues=new Array(q.MAX_UNIFORMS),this.uniformCount=0,this.uniformBuffers=new Array(q.MAX_UNIFORM_BUFFERS),this.uniformBlockNames=new Array(q.MAX_UNIFORM_BUFFERS),this.uniformBlockCount=0,this.textures=new Array(q.MAX_TEXTURE_UNITS),this.textureCount=0,this.offsets=new Int32Array(1),this.numElements=new Int32Array(1),this.numInstances=new Int32Array(1),this.baseVertices=new Int32Array(1),this.baseInstances=new Uint32Array(1),this.hasBaseInstancesOrBaseVertices=!1,this.missingExtensionWarningDispatched=!1,this.numDraws=1,this.drawCountsFromVertexArray=!0,o!==void 0&&(console.warn("Primitive argument to 'App.createDrawCall' is deprecated and will be removed. Use 'DrawCall.primitive' instead."),this.primitive(o))}primitive(e){return this.drawPrimitive=e,this}transformFeedback(e){return this.currentTransformFeedback=e,this}uniform(e,r){let n=this.uniformIndices[e];return n===void 0&&(n=this.uniformCount++,this.uniformIndices[e]=n,this.uniformNames[n]=e),this.uniformValues[n]=r,this}texture(e,r){let n=this.currentProgram.samplers[e];return this.textures[n]=r,this}uniformBlock(e,r){let n=this.currentProgram.uniformBlocks[e];return this.uniformBuffers[n]=r,this}drawRanges(...e){this.numDraws=e.length,this.offsets.length<this.numDraws&&(this.offsets=new Int32Array(this.numDraws)),this.numElements.length<this.numDraws&&(this.numElements=new Int32Array(this.numDraws)),this.numInstances.length<this.numDraws&&(this.numInstances=new Int32Array(this.numDraws)),this.baseInstances.length<this.numDraws&&(this.baseInstances=new Uint32Array(this.numDraws)),this.baseVertices.length<this.numDraws&&(this.baseVertices=new Int32Array(this.numDraws));for(let r=0;r<this.numDraws;++r){let n=e[r];this.offsets[r]=n[0],this.numElements[r]=n[1],this.numInstances[r]=n[2]||1,this.baseInstances[r]=n[3]||0,this.baseVertices[r]=n[4]||0,this.hasBaseVertices=this.hasBaseVertices||this.baseVertices[r],this.hasBaseInstances=this.hasBaseInstances||this.baseInstances[r],this.hasBaseInstancesOrBaseVertices=this.hasBaseInstances||this.hasBaseVertices}return this.drawCountsFromVertexArray=!1,this}draw(){let e=this.uniformNames,r=this.uniformValues,n=this.uniformBuffers,s=this.currentProgram.uniformBlockCount,o=this.textures,l=this.currentProgram.samplerCount,a=!1;this.currentProgram.bind(),this.currentVertexArray&&(this.currentVertexArray.bind(),a=this.currentVertexArray.indexed,this.drawCountsFromVertexArray&&(this.numElements[0]=this.currentVertexArray.numElements,this.numInstances[0]=this.currentVertexArray.numInstances));for(let u=0;u<this.uniformCount;++u)this.currentProgram.uniform(e[u],r[u]);for(let u=0;u<s;++u)n[u].bind(u);for(let u=0;u<l;++u)o[u].bind(u);if(this.currentTransformFeedback?(this.currentTransformFeedback.bind(),this.gl.beginTransformFeedback(this.drawPrimitive)):this.appState.transformFeedback&&(this.gl.bindTransformFeedback(i.TRANSFORM_FEEDBACK,null),this.appState.transformFeedback=null),this.hasBaseInstancesOrBaseVertices&&!(q.DRAW_INSTANCED_BASE_VERTEX_BASE_INSTANCE||q.MULTI_DRAW_INSTANCED_BASE_VERTEX_BASE_INSTANCE)&&!this.missingExtensionWarningDispatched&&(console.warn("DrawCall.draw 'baseInstances' or 'baseVertices' have been set but supporting WebGL extensions are not available; Without 'WEBGL_multidraw_instanced_base_vertex_base_instance' or 'WEBGL_draw_instanced_base_vertex_base_instance' are needed for optimal performance."),this.missingExtensionWarningDispatched=!0),q.MULTI_DRAW_INSTANCED_BASE_VERTEX_BASE_INSTANCE){let u=this.appState.extensions.multiDrawInstancedBaseVertexBaseInstance;a?u.multiDrawElementsInstancedBaseVertexBaseInstanceWEBGL(this.drawPrimitive,this.numElements,0,this.currentVertexArray.indexType,this.offsets,0,this.numInstances,0,this.baseVertices,0,this.baseInstances,0,this.numDraws):u.multiDrawArraysInstancedBaseInstanceWEBGL(this.drawPrimitive,this.offsets,0,this.numElements,0,this.numInstances,0,this.baseInstances,0,this.numDraws)}else if(this.hasBaseInstancesOrBaseVertices&&q.DRAW_INSTANCED_BASE_VERTEX_BASE_INSTANCE){let u=this.appState.extensions.drawInstancedBaseVertexBaseInstance;if(a)for(let h=0;h<this.numDraws;++h)u.drawElementsInstancedBaseVertexBaseInstanceWEBGL(this.drawPrimitive,this.numElements[h],this.currentVertexArray.indexType,this.offsets[h],this.numInstances[h],this.baseVertices[h],this.baseInstances[h]);else for(let h=0;h<this.numDraws;++h)u.drawArraysInstancedBaseInstanceWEBGL(this.drawPrimitive,this.offsets[h],this.numElements[h],this.numInstances[h],this.baseInstances[h])}else if(q.MULTI_DRAW_INSTANCED&&!this.hasBaseInstancesOrBaseVertices){let u=this.appState.extensions.multiDrawInstanced;a?u.multiDrawElementsInstancedWEBGL(this.drawPrimitive,this.numElements,0,this.currentVertexArray.indexType,this.offsets,0,this.numInstances,0,this.numDraws):u.multiDrawArraysInstancedWEBGL(this.drawPrimitive,this.offsets,0,this.numElements,0,this.numInstances,0,this.numDraws)}else if(a)for(let u=0;u<this.numDraws;++u)this.hasBaseInstances&&this.currentVertexArray&&this.currentVertexArray.baseOffsetInstanceAttributeBuffers(this.baseInstances[u]),this.gl.drawElementsInstanced(this.drawPrimitive,this.numElements[u],this.currentVertexArray.indexType,this.offsets[u],this.numInstances[u]);else for(let u=0;u<this.numDraws;++u)this.hasBaseInstances&&this.currentVertexArray&&this.currentVertexArray.baseOffsetInstanceAttributeBuffers(this.baseInstances[u]),this.gl.drawArraysInstanced(this.drawPrimitive,this.offsets[u],this.numElements[u],this.numInstances[u]);return this.currentTransformFeedback&&this.gl.endTransformFeedback(),this}}class tt{constructor(e,r,n,s,o=s.width,l=s.height,a,u,h=Ve){if(this.gl=e,this.binding=n,this.texture=null,this.width=o||0,this.height=l||0,this.depth=a||0,this.is3D=u,this.appState=r,this.compressed=!!Dt[h.internalFormat],h.format!==void 0&&(console.warn("Texture option 'format' is deprecated and will be removed. Use 'internalFormat' with a sized format instead."),this.compressed=!!Dt[h.format],h.type===void 0&&(h.type=h.format===i.DEPTH_COMPONENT?i.UNSIGNED_SHORT:i.UNSIGNED_BYTE),h.internalFormat===void 0&&(this.compressed?h.internalFormat=h.format:h.internalFormat=fi[h.type][h.format])),this.compressed)this.internalFormat=h.internalFormat,this.format=this.internalFormat,this.type=i.UNSIGNED_BYTE;else{this.internalFormat=h.internalFormat!==void 0?h.internalFormat:i.RGBA8;let ee=ci[this.internalFormat];this.format=ee[0],this.type=h.type!==void 0?h.type:ee[1]}this.currentUnit=-1;let{minFilter:p=s?i.LINEAR_MIPMAP_NEAREST:i.NEAREST,magFilter:f=s?i.LINEAR:i.NEAREST,wrapS:T=i.REPEAT,wrapT:S=i.REPEAT,wrapR:v=i.REPEAT,compareMode:O=i.NONE,compareFunc:b=i.LEQUAL,minLOD:B=null,maxLOD:x=null,baseLevel:d=null,maxLevel:V=null,maxAnisotropy:W=1,flipY:k=!1,premultiplyAlpha:Y=!1}=h;this.minFilter=p,this.magFilter=f,this.wrapS=T,this.wrapT=S,this.wrapR=v,this.compareMode=O,this.compareFunc=b,this.minLOD=B,this.maxLOD=x,this.baseLevel=d,this.maxLevel=V,this.maxAnisotropy=Math.min(W,q.MAX_TEXTURE_ANISOTROPY),this.flipY=k,this.premultiplyAlpha=Y,this.mipmaps=p===i.LINEAR_MIPMAP_NEAREST||p===i.LINEAR_MIPMAP_LINEAR,this.restore(s)}restore(e){return this.texture=null,this.resize(this.width,this.height,this.depth),e&&this.data(e),this}resize(e,r,n){if(n=n||0,this.texture&&e===this.width&&r===this.height&&n===this.depth)return this;this.gl.deleteTexture(this.texture),this.currentUnit!==-1&&(this.appState.textures[this.currentUnit]=null),this.texture=this.gl.createTexture(),this.bind(Math.max(this.currentUnit,0)),this.width=e,this.height=r,this.depth=n,this.gl.texParameteri(this.binding,i.TEXTURE_MIN_FILTER,this.minFilter),this.gl.texParameteri(this.binding,i.TEXTURE_MAG_FILTER,this.magFilter),this.gl.texParameteri(this.binding,i.TEXTURE_WRAP_S,this.wrapS),this.gl.texParameteri(this.binding,i.TEXTURE_WRAP_T,this.wrapT),this.gl.texParameteri(this.binding,i.TEXTURE_WRAP_R,this.wrapR),this.gl.texParameteri(this.binding,i.TEXTURE_COMPARE_FUNC,this.compareFunc),this.gl.texParameteri(this.binding,i.TEXTURE_COMPARE_MODE,this.compareMode),this.minLOD!==null&&this.gl.texParameterf(this.binding,i.TEXTURE_MIN_LOD,this.minLOD),this.maxLOD!==null&&this.gl.texParameterf(this.binding,i.TEXTURE_MAX_LOD,this.maxLOD),this.baseLevel!==null&&this.gl.texParameteri(this.binding,i.TEXTURE_BASE_LEVEL,this.baseLevel),this.maxLevel!==null&&this.gl.texParameteri(this.binding,i.TEXTURE_MAX_LEVEL,this.maxLevel),this.maxAnisotropy>1&&this.gl.texParameteri(this.binding,i.TEXTURE_MAX_ANISOTROPY_EXT,this.maxAnisotropy);let s;return this.is3D?(this.mipmaps?s=Math.floor(Math.log2(Math.max(Math.max(this.width,this.height),this.depth)))+1:s=1,this.gl.texStorage3D(this.binding,s,this.internalFormat,this.width,this.height,this.depth)):(this.mipmaps?s=Math.floor(Math.log2(Math.max(this.width,this.height)))+1:s=1,this.gl.texStorage2D(this.binding,s,this.internalFormat,this.width,this.height)),this}data(e){Array.isArray(e)||(Pt[0]=e,e=Pt);let r=this.mipmaps?e.length:1,n=this.width,s=this.height,o=this.depth,l=this.mipmaps&&e.length===1,a;if(this.bind(Math.max(this.currentUnit,0)),this.gl.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,this.flipY),this.gl.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.premultiplyAlpha),this.compressed)if(this.is3D)for(a=0;a<r;++a)this.gl.compressedTexSubImage3D(this.binding,a,0,0,0,n,s,o,this.format,e[a]),n=Math.max(n>>1,1),s=Math.max(s>>1,1),o=Math.max(o>>1,1);else for(a=0;a<r;++a)this.gl.compressedTexSubImage2D(this.binding,a,0,0,n,s,this.format,e[a]),n=Math.max(n>>1,1),s=Math.max(s>>1,1);else if(this.is3D)for(a=0;a<r;++a)this.gl.texSubImage3D(this.binding,a,0,0,0,n,s,o,this.format,this.type,e[a]),n=Math.max(n>>1,1),s=Math.max(s>>1,1),o=Math.max(o>>1,1);else for(a=0;a<r;++a)this.gl.texSubImage2D(this.binding,a,0,0,n,s,this.format,this.type,e[a]),n=Math.max(n>>1,1),s=Math.max(s>>1,1);return l&&this.gl.generateMipmap(this.binding),this}delete(){return this.texture&&(this.gl.deleteTexture(this.texture),this.texture=null,this.currentUnit!==-1&&this.appState.textures[this.currentUnit]===this&&(this.appState.textures[this.currentUnit]=null,this.currentUnit=-1)),this}bind(e){let r=this.appState.textures[e];return this.appState.activeTexture!==e&&(this.gl.activeTexture(i.TEXTURE0+e),this.appState.activeTexture=e),r!==this&&(r&&(r.currentUnit=-1),this.currentUnit!==-1&&(this.appState.textures[this.currentUnit]=null),this.gl.bindTexture(this.binding,this.texture),this.appState.textures[e]=this,this.currentUnit=e),this}}class hr{constructor(e,r,n,s,o=0){this.gl=e,this.renderbuffer=null,this.width=r,this.height=n,this.internalFormat=s,this.samples=o,this.restore()}restore(){return this.renderbuffer=this.gl.createRenderbuffer(),this.resize(this.width,this.height),this}resize(e,r){return this.width=e,this.height=r,this.gl.bindRenderbuffer(i.RENDERBUFFER,this.renderbuffer),this.gl.renderbufferStorageMultisample(i.RENDERBUFFER,this.samples,this.internalFormat,this.width,this.height),this.gl.bindRenderbuffer(i.RENDERBUFFER,null),this}delete(){return this.gl.deleteRenderbuffer(this.renderbuffer),this.renderbuffer=null,this}}class tn{constructor(e,r){this.gl=e,this.framebuffer=null,this.appState=r,this.numColorTargets=0,this.colorAttachments=[],this.colorAttachmentEnums=[],this.colorAttachmentTargets=[],this.depthAttachment=null,this.depthAttachmentTarget=null,this.width=0,this.height=0,this.restore()}restore(){let e=this.appState.framebuffers;for(let r in e)e[r]===this&&(e[r]=null);return this.framebuffer=this.gl.createFramebuffer(),this}colorTarget(e,r,n=r.is3D?0:i.TEXTURE_2D){if(e>=this.numColorTargets){let l=e+1;this.colorAttachmentEnums.length=l,this.colorAttachments.length=l,this.colorAttachmentTargets.length=l;for(let a=this.numColorTargets;a<l-1;++a)this.colorAttachmentEnums[a]=i.NONE,this.colorAttachments[a]=null,this.colorAttachmentTargets[a]=0;this.numColorTargets=l}this.colorAttachmentEnums[e]=i.COLOR_ATTACHMENT0+e,this.colorAttachments[e]=r,this.colorAttachmentTargets[e]=n;let s=this.bindAndCaptureState(),o=this.appState.drawFramebufferBinding;return r instanceof hr?this.gl.framebufferRenderbuffer(o,this.colorAttachmentEnums[e],i.RENDERBUFFER,r.renderbuffer):r.is3D?this.gl.framebufferTextureLayer(o,this.colorAttachmentEnums[e],r.texture,0,n):this.gl.framebufferTexture2D(o,this.colorAttachmentEnums[e],n,r.texture,0),this.gl.drawBuffers(this.colorAttachmentEnums),this.width=r.width,this.height=r.height,this.restoreState(s),this}depthTarget(e,r=e.is3D?0:i.TEXTURE_2D){let n=this.bindAndCaptureState(),s=this.appState.drawFramebufferBinding;return this.depthAttachment=e,this.depthAttachmentTarget=r,e instanceof hr?this.gl.framebufferRenderbuffer(s,i.DEPTH_ATTACHMENT,i.RENDERBUFFER,e.renderbuffer):e.is3D?this.gl.framebufferTextureLayer(s,i.DEPTH_ATTACHMENT,e.texture,0,r):this.gl.framebufferTexture2D(s,i.DEPTH_ATTACHMENT,r,e.texture,0),this.width=e.width,this.height=e.height,this.restoreState(n),this}resize(e=this.gl.drawingBufferWidth,r=this.gl.drawingBufferHeight){let n=this.bindAndCaptureState(),s=this.appState.drawFramebufferBinding;for(let o=0;o<this.numColorTargets;++o){let l=this.colorAttachments[o];l&&(l.resize(e,r),l instanceof tt&&(l.is3D?this.gl.framebufferTextureLayer(s,this.colorAttachmentEnums[o],l.texture,0,this.colorAttachmentTargets[o]):this.gl.framebufferTexture2D(s,this.colorAttachmentEnums[o],this.colorAttachmentTargets[o],l.texture,0)))}return this.depthAttachment&&(this.depthAttachment.resize(e,r),this.depthAttachment instanceof tt&&(this.depthAttachment.is3D?this.gl.framebufferTextureLayer(s,i.DEPTH_ATTACHMENT,this.depthAttachment.texture,0,this.depthAttachmentTarget):this.gl.framebufferTexture2D(s,i.DEPTH_ATTACHMENT,this.depthAttachmentTarget,this.depthAttachment.texture,0))),this.width=e,this.height=r,this.restoreState(n),this}delete(){if(this.framebuffer){this.gl.deleteFramebuffer(this.framebuffer),this.framebuffer=null;let e=this.appState.framebuffers;for(let r in e)e[r]===this&&(this.gl.bindFramebuffer(r,null),e[r]=null)}return this}getStatus(){let e=this.bindAndCaptureState(),r=this.appState.drawFramebufferBinding,n=this.gl.checkFramebufferStatus(r);return this.restoreState(e),n}bindForDraw(){let e=this.appState.drawFramebufferBinding,r=this.appState.framebuffers;return r[e]!==this&&(this.gl.bindFramebuffer(e,this.framebuffer),r[e]=this),this}bindForRead(){let e=this.appState.readFramebufferBinding,r=this.appState.framebuffers;return r[e]!==this&&(this.gl.bindFramebuffer(e,this.framebuffer),r[e]=this),this}bindAndCaptureState(){let e=this.appState.drawFramebufferBinding,r=this.appState.framebuffers[e];return r!==this&&this.gl.bindFramebuffer(e,this.framebuffer),r}restoreState(e){if(e!==this){let r=this.appState.drawFramebufferBinding;this.gl.bindFramebuffer(r,e?e.framebuffer:null)}return this}get colorTextures(){return console.error("Framebuffer.colorTextures is deprecated and will be removed. Please use Framebuffer.colorAttachments."),this.colorAttachments}get depthTexture(){return console.error("Framebuffer.depthTexture is deprecated and will be removed. Please use Framebuffer.depthAttachment."),this.depthAttachment}}class Je{constructor(e,r,n,s){this.gl=e,this.appState=r,this.shader=null,this.type=n,this.source=s.trim(),this.restore()}restore(){return this.shader=this.gl.createShader(this.type),this.gl.shaderSource(this.shader,this.source),this.gl.compileShader(this.shader),this}translatedSource(){return q.DEBUG_SHADERS?this.appState.extensions.debugShaders.getTranslatedShaderSource(this.shader):"(Unavailable)"}delete(){return this.shader&&(this.gl.deleteShader(this.shader),this.shader=null),this}checkCompilation(){if(!this.gl.getShaderParameter(this.shader,i.COMPILE_STATUS)){let e,r;for(console.error(this.gl.getShaderInfoLog(this.shader)),r=this.source.split(`
`),e=0;e<r.length;++e)console.error(`${e+1}: ${r[e]}`)}return this}}const Z={};Z[i.BOOL]="uniform1i";Z[i.INT]="uniform1i";Z[i.SAMPLER_2D]="uniform1i";Z[i.INT_SAMPLER_2D]="uniform1i";Z[i.UNSIGNED_INT_SAMPLER_2D]="uniform1i";Z[i.SAMPLER_2D_SHADOW]="uniform1i";Z[i.SAMPLER_2D_ARRAY]="uniform1i";Z[i.INT_SAMPLER_2D_ARRAY]="uniform1i";Z[i.UNSIGNED_INT_SAMPLER_2D_ARRAY]="uniform1i";Z[i.SAMPLER_2D_ARRAY_SHADOW]="uniform1i";Z[i.SAMPLER_CUBE]="uniform1i";Z[i.INT_SAMPLER_CUBE]="uniform1i";Z[i.UNSIGNED_INT_SAMPLER_CUBE]="uniform1i";Z[i.SAMPLER_CUBE_SHADOW]="uniform1i";Z[i.SAMPLER_3D]="uniform1i";Z[i.INT_SAMPLER_3D]="uniform1i";Z[i.UNSIGNED_INT_SAMPLER_3D]="uniform1i";Z[i.UNSIGNED_INT]="uniform1ui";Z[i.FLOAT]="uniform1f";Z[i.FLOAT_VEC2]="uniform2f";Z[i.FLOAT_VEC3]="uniform3f";Z[i.FLOAT_VEC4]="uniform4f";Z[i.INT_VEC2]="uniform2i";Z[i.INT_VEC3]="uniform3i";Z[i.INT_VEC4]="uniform4i";Z[i.UNSIGNED_INT_VEC2]="uniform2ui";Z[i.UNSIGNED_INT_VEC3]="uniform3ui";Z[i.UNSIGNED_INT_VEC4]="uniform4ui";Z[i.BOOL_VEC2]="uniform2i";Z[i.BOOL_VEC3]="uniform3i";Z[i.BOOL_VEC4]="uniform4i";Z[i.FLOAT_MAT2]="uniformMatrix2fv";Z[i.FLOAT_MAT3]="uniformMatrix3fv";Z[i.FLOAT_MAT4]="uniformMatrix4fv";Z[i.FLOAT_MAT2x3]="uniformMatrix2x3fv";Z[i.FLOAT_MAT2x4]="uniformMatrix2x4fv";Z[i.FLOAT_MAT3x2]="uniformMatrix3x2fv";Z[i.FLOAT_MAT3x4]="uniformMatrix3x4fv";Z[i.FLOAT_MAT4x2]="uniformMatrix4x2fv";Z[i.FLOAT_MAT4x3]="uniformMatrix4x3fv";const J={};J[i.BOOL]=1;J[i.INT]=1;J[i.SAMPLER_2D]=1;J[i.INT_SAMPLER_2D]=1;J[i.UNSIGNED_INT_SAMPLER_2D]=1;J[i.SAMPLER_2D_SHADOW]=1;J[i.SAMPLER_2D_ARRAY]=1;J[i.INT_SAMPLER_2D_ARRAY]=1;J[i.UNSIGNED_INT_SAMPLER_2D_ARRAY]=1;J[i.SAMPLER_2D_ARRAY_SHADOW]=1;J[i.SAMPLER_CUBE]=1;J[i.INT_SAMPLER_CUBE]=1;J[i.UNSIGNED_INT_SAMPLER_CUBE]=1;J[i.SAMPLER_CUBE_SHADOW]=1;J[i.SAMPLER_3D]=1;J[i.INT_SAMPLER_3D]=1;J[i.UNSIGNED_INT_SAMPLER_3D]=1;J[i.UNSIGNED_INT]=1;J[i.FLOAT]=1;J[i.FLOAT_VEC2]=2;J[i.FLOAT_VEC3]=3;J[i.FLOAT_VEC4]=4;J[i.INT_VEC2]=2;J[i.INT_VEC3]=3;J[i.INT_VEC4]=4;J[i.UNSIGNED_INT_VEC2]=2;J[i.UNSIGNED_INT_VEC3]=3;J[i.UNSIGNED_INT_VEC4]=4;J[i.BOOL_VEC2]=2;J[i.BOOL_VEC3]=3;J[i.BOOL_VEC4]=4;J[i.FLOAT_MAT2]=4;J[i.FLOAT_MAT3]=9;J[i.FLOAT_MAT4]=16;J[i.FLOAT_MAT2x3]=6;J[i.FLOAT_MAT2x4]=8;J[i.FLOAT_MAT3x2]=6;J[i.FLOAT_MAT3x4]=12;J[i.FLOAT_MAT4x2]=8;J[i.FLOAT_MAT4x3]=12;const ce={};ce[i.INT]=Int32Array;ce[i.SAMPLER_2D]=Int32Array;ce[i.INT_SAMPLER_2D]=Int32Array;ce[i.UNSIGNED_INT_SAMPLER_2D]=Int32Array;ce[i.SAMPLER_2D_SHADOW]=Int32Array;ce[i.SAMPLER_2D_ARRAY]=Int32Array;ce[i.INT_SAMPLER_2D_ARRAY]=Int32Array;ce[i.UNSIGNED_INT_SAMPLER_2D_ARRAY]=Int32Array;ce[i.SAMPLER_2D_ARRAY_SHADOW]=Int32Array;ce[i.SAMPLER_CUBE]=Int32Array;ce[i.INT_SAMPLER_CUBE]=Int32Array;ce[i.UNSIGNED_INT_SAMPLER_CUBE]=Int32Array;ce[i.SAMPLER_CUBE_SHADOW]=Int32Array;ce[i.SAMPLER_3D]=Int32Array;ce[i.INT_SAMPLER_3D]=Int32Array;ce[i.UNSIGNED_INT_SAMPLER_3D]=Int32Array;ce[i.UNSIGNED_INT]=Uint32Array;ce[i.FLOAT]=Float32Array;ce[i.FLOAT_VEC2]=Float32Array;ce[i.FLOAT_VEC3]=Float32Array;ce[i.FLOAT_VEC4]=Float32Array;ce[i.INT_VEC2]=Int32Array;ce[i.INT_VEC3]=Int32Array;ce[i.INT_VEC4]=Int32Array;ce[i.UNSIGNED_INT_VEC2]=Uint32Array;ce[i.UNSIGNED_INT_VEC3]=Uint32Array;ce[i.UNSIGNED_INT_VEC4]=Uint32Array;class Fr{constructor(e,r,n){this.gl=e,this.handle=r,this.glFuncName=Z[n],this.cache=n===i.BOOL?!1:0}set(e){this.cache!==e&&(this.gl[this.glFuncName](this.handle,e),this.cache=e)}}class Br{constructor(e,r,n,s){this.gl=e,this.handle=r,this.glFuncName=Z[n]+"v",this.count=s,this.cache=new ce[n](J[n]*s)}set(e){for(let r=0,n=e.length;r<n;++r)if(this.cache[r]!==e[r]){this.gl[this.glFuncName](this.handle,e),this.cache.set(e);return}}}class yr{constructor(e,r,n,s){this.gl=e,this.handle=r,this.glFuncName=Z[n]+"v",this.count=s,this.cache=new Array(J[n]*s).fill(!1)}set(e){for(let r=0,n=e.length;r<n;++r)if(this.cache[r]!==e[r]){this.gl[this.glFuncName](this.handle,e);for(let s=r;s<n;s++)this.cache[s]=e[s];return}}}class rn{constructor(e,r,n,s){this.gl=e,this.handle=r,this.glFuncName=Z[n],this.count=s,this.cache=new Float32Array(J[n]*s)}set(e){for(let r=0,n=e.length;r<n;++r)if(this.cache[r]!==e[r]){this.gl[this.glFuncName](this.handle,!1,e),this.cache.set(e);return}}}class Mr{constructor(e,r,n,s,o,l,a){this.gl=e,this.appState=r,this.program=null,this.transformFeedbackVaryings=o||null,this.transformFeedbackMode=a||i.SEPARATE_ATTRIBS,this.attributeLocations=l||null,this.uniforms={},this.uniformBlocks={},this.uniformBlockCount=0,this.samplers={},this.samplerCount=0,this.vertexSource=null,this.vertexShader=null,this.fragmentSource=null,this.fragmentShader=null,this.linked=!1,typeof n=="string"?this.vertexSource=n:this.vertexShader=n,typeof s=="string"?this.fragmentSource=s:this.fragmentShader=s,this.initialize()}restore(){return this.initialize(),this.link(),this.checkLinkage(),this}translatedVertexSource(){if(this.vertexShader)return this.vertexShader.translatedSource();{let e=new Je(this.gl,this.appState,i.VERTEX_SHADER,this.vertexSource),r=e.translatedSource();return e.delete(),r}}translatedFragmentSource(){if(this.fragmentShader)return this.fragmentShader.translatedSource();{let e=new Je(this.gl,this.appState,i.FRAGMENT_SHADER,this.fragmentSource),r=e.translatedSource();return e.delete(),r}}delete(){return this.program&&(this.gl.deleteProgram(this.program),this.program=null,this.appState.program===this&&(this.gl.useProgram(null),this.appState.program=null)),this}initialize(){return this.appState.program===this&&(this.gl.useProgram(null),this.appState.program=null),this.linked=!1,this.uniformBlockCount=0,this.samplerCount=0,this.vertexSource&&(this.vertexShader=new Je(this.gl,this.appState,i.VERTEX_SHADER,this.vertexSource)),this.fragmentSource&&(this.fragmentShader=new Je(this.gl,this.appState,i.FRAGMENT_SHADER,this.fragmentSource)),this.program=this.gl.createProgram(),this}link(){if(this.gl.attachShader(this.program,this.vertexShader.shader),this.gl.attachShader(this.program,this.fragmentShader.shader),this.transformFeedbackVaryings&&this.gl.transformFeedbackVaryings(this.program,this.transformFeedbackVaryings,this.transformFeedbackMode),this.attributeLocations)for(let e in this.attributeLocations)this.gl.bindAttribLocation(this.program,this.attributeLocations[e],e);return this.gl.linkProgram(this.program),this}checkCompletion(){return q.PARALLEL_SHADER_COMPILE?this.gl.getProgramParameter(this.program,i.COMPLETION_STATUS_KHR):!0}checkLinkage(){return this.linked?this:(this.gl.getProgramParameter(this.program,i.LINK_STATUS)?(this.linked=!0,this.initVariables()):(console.error(this.gl.getProgramInfoLog(this.program)),this.vertexShader.checkCompilation(),this.fragmentShader.checkCompilation()),this.vertexSource&&(this.vertexShader.delete(),this.vertexShader=null),this.fragmentSource&&(this.fragmentShader.delete(),this.fragmentShader=null),this)}initVariables(){this.bind();let e=this.gl.getProgramParameter(this.program,i.ACTIVE_UNIFORMS),r;for(let s=0;s<e;++s){let o=this.gl.getActiveUniform(this.program,s),l=this.gl.getUniformLocation(this.program,o.name),a=null,u=o.type,h=o.size;switch(u){case i.SAMPLER_2D:case i.INT_SAMPLER_2D:case i.UNSIGNED_INT_SAMPLER_2D:case i.SAMPLER_2D_SHADOW:case i.SAMPLER_2D_ARRAY:case i.INT_SAMPLER_2D_ARRAY:case i.UNSIGNED_INT_SAMPLER_2D_ARRAY:case i.SAMPLER_2D_ARRAY_SHADOW:case i.SAMPLER_CUBE:case i.INT_SAMPLER_CUBE:case i.UNSIGNED_INT_SAMPLER_CUBE:case i.SAMPLER_CUBE_SHADOW:case i.SAMPLER_3D:case i.INT_SAMPLER_3D:case i.UNSIGNED_INT_SAMPLER_3D:r=this.samplerCount++,this.samplers[o.name]=r,this.gl.uniform1i(l,r);break;case i.INT:case i.UNSIGNED_INT:case i.FLOAT:a=h>1?Br:Fr;break;case i.BOOL:a=h>1?yr:Fr;break;case i.FLOAT_VEC2:case i.INT_VEC2:case i.UNSIGNED_INT_VEC2:case i.FLOAT_VEC3:case i.INT_VEC3:case i.UNSIGNED_INT_VEC3:case i.FLOAT_VEC4:case i.INT_VEC4:case i.UNSIGNED_INT_VEC4:a=Br;break;case i.BOOL_VEC2:case i.BOOL_VEC3:case i.BOOL_VEC4:a=yr;break;case i.FLOAT_MAT2:case i.FLOAT_MAT3:case i.FLOAT_MAT4:case i.FLOAT_MAT2x3:case i.FLOAT_MAT2x4:case i.FLOAT_MAT3x2:case i.FLOAT_MAT3x4:case i.FLOAT_MAT4x2:case i.FLOAT_MAT4x3:a=rn;break;default:console.error("Unrecognized type for uniform ",o.name);break}a&&(this.uniforms[o.name]=new a(this.gl,l,u,h))}let n=this.gl.getProgramParameter(this.program,i.ACTIVE_UNIFORM_BLOCKS);for(let s=0;s<n;++s){let o=this.gl.getActiveUniformBlockName(this.program,s),l=this.gl.getUniformBlockIndex(this.program,o),a=this.uniformBlockCount++;this.gl.uniformBlockBinding(this.program,l,a),this.uniformBlocks[o]=a}}uniform(e,r){return this.uniforms[e]&&this.uniforms[e].set(r),this}bind(){return this.appState.program!==this&&(this.gl.useProgram(this.program),this.appState.program=this),this}}class Ei{constructor(e,r){this.gl=e,this.query=null,this.target=r,this.active=!1,this.result=null,this.restore()}restore(){return this.query=this.gl.createQuery(),this.active=!1,this.result=null,this}begin(){return this.active||(this.gl.beginQuery(this.target,this.query),this.result=null),this}end(){return this.active||(this.gl.endQuery(this.target),this.active=!0),this}ready(){return this.active&&this.gl.getQueryParameter(this.query,i.QUERY_RESULT_AVAILABLE)?(this.active=!1,this.result=Number(this.gl.getQueryParameter(this.query,i.QUERY_RESULT)),!0):!1}delete(){return this.query&&(this.gl.deleteQuery(this.query),this.query=null),this}}class nn{constructor(e){this.gl=e,this.cpuTimer=window.performance||window.Date,this.gpuTimerQuery=null,this.cpuStartTime=0,this.cpuTime=0,this.gpuTime=0,this.restore()}restore(){return q.GPU_TIMER&&(this.gpuTimerQuery?this.gpuTimerQuery.restore():this.gpuTimerQuery=new Ei(this.gl,i.TIME_ELAPSED_EXT)),this.cpuStartTime=0,this.cpuTime=0,this.gpuTime=0,this}start(){return q.GPU_TIMER?this.gpuTimerQuery.active||(this.gpuTimerQuery.begin(),this.cpuStartTime=this.cpuTimer.now()):this.cpuStartTime=this.cpuTimer.now(),this}end(){return q.GPU_TIMER?this.gpuTimerQuery.active||(this.gpuTimerQuery.end(),this.cpuTime=this.cpuTimer.now()-this.cpuStartTime):this.cpuTime=this.cpuTimer.now()-this.cpuStartTime,this}ready(){if(q.GPU_TIMER){if(!this.gpuTimerQuery.active)return!1;var e=this.gpuTimerQuery.ready(),r=this.gl.getParameter(i.GPU_DISJOINT_EXT);return e&&!r?(this.gpuTime=this.gpuTimerQuery.result/1e6,!0):!1}else return!!this.cpuStartTime}delete(){return this.gpuTimerQuery&&(this.gpuTimerQuery.delete(),this.gpuTimerQuery=null),this}}class sn{constructor(e,r){this.gl=e,this.appState=r,this.transformFeedback=null,this.restore()}restore(){return this.appState.transformFeedback===this&&(this.appState.transformFeedback=null),this.transformFeedback=this.gl.createTransformFeedback(),this}feedbackBuffer(e,r){return this.gl.bindTransformFeedback(i.TRANSFORM_FEEDBACK,this.transformFeedback),this.gl.bindBufferBase(i.TRANSFORM_FEEDBACK_BUFFER,e,r.buffer),this.gl.bindTransformFeedback(i.TRANSFORM_FEEDBACK,null),this.gl.bindBufferBase(i.TRANSFORM_FEEDBACK_BUFFER,e,null),this}delete(){return this.transformFeedback&&(this.gl.deleteTransformFeedback(this.transformFeedback),this.transformFeedback=null,this.appState.transformFeedback===this&&(this.gl.bindTransformFeedback(i.TRANSFORM_FEEDBACK,null),this.appState.transformFeedback=null)),this}bind(){return this.appState.transformFeedback!==this&&(this.gl.bindTransformFeedback(i.TRANSFORM_FEEDBACK,this.transformFeedback),this.appState.transformFeedback=this),this}}class an{constructor(e,r,n,s=e.DYNAMIC_DRAW){this.gl=e,this.buffer=null,this.dataViews={},this.offsets=new Array(n.length),this.sizes=new Array(n.length),this.types=new Array(n.length),this.size=0,this.usage=s,this.appState=r,this.currentBase=-1;for(let o=0,l=n.length;o<l;++o){let a=n[o];switch(a){case i.FLOAT:case i.INT:case i.UNSIGNED_INT:case i.BOOL:this.offsets[o]=this.size,this.sizes[o]=1,a===i.INT?this.types[o]=i.INT:a===i.UNSIGNED_INT?this.types[o]=i.UNSIGNED_INT:this.types[o]=i.FLOAT,this.size++;break;case i.FLOAT_VEC2:case i.INT_VEC2:case i.UNSIGNED_INT_VEC2:case i.BOOL_VEC2:this.size+=this.size%2,this.offsets[o]=this.size,this.sizes[o]=2,a===i.INT_VEC2?this.types[o]=i.INT:a===i.UNSIGNED_INT_VEC2?this.types[o]=i.UNSIGNED_INT:this.types[o]=i.FLOAT,this.size+=2;break;case i.FLOAT_VEC3:case i.INT_VEC3:case i.UNSIGNED_INT_VEC3:case i.BOOL_VEC3:case i.FLOAT_VEC4:case i.INT_VEC4:case i.UNSIGNED_INT_VEC4:case i.BOOL_VEC4:this.size+=(4-this.size%4)%4,this.offsets[o]=this.size,this.sizes[o]=4,a===i.INT_VEC4||a===i.INT_VEC3?this.types[o]=i.INT:a===i.UNSIGNED_INT_VEC4||a===i.UNSIGNED_INT_VEC3?this.types[o]=i.UNSIGNED_INT:this.types[o]=i.FLOAT,this.size+=4;break;case i.FLOAT_MAT2:case i.FLOAT_MAT2x3:case i.FLOAT_MAT2x4:this.size+=(4-this.size%4)%4,this.offsets[o]=this.size,this.sizes[o]=8,this.types[o]=i.FLOAT,this.size+=8;break;case i.FLOAT_MAT3:case i.FLOAT_MAT3x2:case i.FLOAT_MAT3x4:this.size+=(4-this.size%4)%4,this.offsets[o]=this.size,this.sizes[o]=12,this.types[o]=i.FLOAT,this.size+=12;break;case i.FLOAT_MAT4:case i.FLOAT_MAT4x2:case i.FLOAT_MAT4x3:this.size+=(4-this.size%4)%4,this.offsets[o]=this.size,this.sizes[o]=16,this.types[o]=i.FLOAT,this.size+=16;break;default:console.error("Unsupported type for uniform buffer.")}}this.size+=(4-this.size%4)%4,this.data=new Float32Array(this.size),this.dataViews[i.FLOAT]=this.data,this.dataViews[i.INT]=new Int32Array(this.data.buffer),this.dataViews[i.UNSIGNED_INT]=new Uint32Array(this.data.buffer),this.dirtyStart=this.size,this.dirtyEnd=0,this.restore()}restore(){return this.currentBase!==-1&&this.appState.uniformBuffers[this.currentBase]===this&&(this.appState.uniformBuffers[this.currentBase]=null),this.buffer=this.gl.createBuffer(),this.gl.bindBuffer(i.UNIFORM_BUFFER,this.buffer),this.gl.bufferData(i.UNIFORM_BUFFER,this.size*4,this.usage),this.gl.bindBuffer(i.UNIFORM_BUFFER,null),this}set(e,r){let n=this.dataViews[this.types[e]],s=this.offsets[e],o=this.sizes[e];return this.sizes[e]===1?n[s]=r:n.set(r,s),s<this.dirtyStart&&(this.dirtyStart=s),this.dirtyEnd<s+o&&(this.dirtyEnd=s+o),this}update(){if(this.dirtyStart>=this.dirtyEnd)return this;let e=this.data.subarray(this.dirtyStart,this.dirtyEnd),r=this.dirtyStart*4;return this.gl.bindBuffer(this.gl.UNIFORM_BUFFER,this.buffer),this.gl.bufferSubData(this.gl.UNIFORM_BUFFER,r,e),this.gl.bindBuffer(this.gl.UNIFORM_BUFFER,null),this.dirtyStart=this.size,this.dirtyEnd=0,this}delete(){return this.buffer&&(this.gl.deleteBuffer(this.buffer),this.buffer=null,this.currentBase!==-1&&this.appState.uniformBuffers[this.currentBase]===this&&(this.appState.uniformBuffers[this.currentBase]=null),this.currentBase=-1),this}bind(e){let r=this.appState.uniformBuffers[e];return r!==this&&(r&&(r.currentBase=-1),this.currentBase!==-1&&(this.appState.uniformBuffers[this.currentBase]=null),this.gl.bindBufferBase(this.gl.UNIFORM_BUFFER,e,this.buffer),this.appState.uniformBuffers[e]=this,this.currentBase=e),this}}class on{constructor(e,r){this.gl=e,this.appState=r,this.vertexArray=null,this.indexType=null,this.indexed=!1,this.numElements=0,this.numInstances=1,this.offsets=0,this.numDraws=1,this.instanceAttributeBuffers={}}restore(){return this.appState.vertexArray===this&&(this.appState.vertexArray=null),this.vertexArray!==null&&(this.vertexArray=this.gl.createVertexArray()),this}vertexAttributeBuffer(e,r,n=Ve){return this.attributeBuffer(e,r,n,!1),this}instanceAttributeBuffer(e,r,n=Ve){return this.attributeBuffer(e,r,n,!0),this.instanceAttributeBuffers[e]={vertexBuffer:r,options:n},this}baseOffsetInstanceAttributeBuffers(e=0){Object.entries(this.instanceAttributeBuffers).forEach(([r,{vertexBuffer:n,options:s}])=>{this.attributeBuffer(Number(r),n,s,!0,e)})}indexBuffer(e){return this.vertexArray===null&&(this.vertexArray=this.gl.createVertexArray()),this.bind(),this.gl.bindBuffer(i.ELEMENT_ARRAY_BUFFER,e.buffer),this.numElements=e.numItems*3,this.indexType=e.type,this.indexed=!0,this}delete(){return this.vertexArray&&(this.gl.deleteVertexArray(this.vertexArray),this.vertexArray=null,this.appState.vertexArray===this&&(this.gl.bindVertexArray(null),this.appState.vertexArray=null)),this}bind(){return this.appState.vertexArray!==this&&(this.gl.bindVertexArray(this.vertexArray),this.appState.vertexArray=this),this}attributeBuffer(e,r,n={},s,o=0){this.vertexArray===null&&(this.vertexArray=this.gl.createVertexArray()),this.bind(),this.gl.bindBuffer(i.ARRAY_BUFFER,r.buffer);let{type:l=r.type,size:a=r.itemSize,stride:u=0,offset:h=0,normalized:p=!1,integer:f=!!(r.integer&&!p)}=n,T=r.numColumns;u===0&&(u=T*a*St[l]);let S=Math.ceil((r.byteLength-h)/u);for(let v=0;v<T;++v)f?this.gl.vertexAttribIPointer(e+v,a,l,u,h+v*a*St[l]+o*u):this.gl.vertexAttribPointer(e+v,a,l,p,u,h+v*a*St[l]+o*u),s&&this.gl.vertexAttribDivisor(e+v,1),this.gl.enableVertexAttribArray(e+v);return this.numDraws===1&&(s?this.numInstances=S:this.indexed||(this.numElements=S)),this.gl.bindBuffer(i.ARRAY_BUFFER,null),this}}const ln={[i.BYTE]:!0,[i.UNSIGNED_BYTE]:!0,[i.SHORT]:!0,[i.UNSIGNED_SHORT]:!0,[i.INT]:!0,[i.UNSIGNED_INT]:!0};class pt{constructor(e,r,n,s,o,l=e.STATIC_DRAW,a){let u;switch(n){case i.FLOAT_MAT4:case i.FLOAT_MAT4x2:case i.FLOAT_MAT4x3:u=4;break;case i.FLOAT_MAT3:case i.FLOAT_MAT3x2:case i.FLOAT_MAT3x4:u=3;break;case i.FLOAT_MAT2:case i.FLOAT_MAT2x3:case i.FLOAT_MAT2x4:u=2;break;default:u=1}switch(n){case i.FLOAT_MAT4:case i.FLOAT_MAT3x4:case i.FLOAT_MAT2x4:s=4,n=i.FLOAT;break;case i.FLOAT_MAT3:case i.FLOAT_MAT4x3:case i.FLOAT_MAT2x3:s=3,n=i.FLOAT;break;case i.FLOAT_MAT2:case i.FLOAT_MAT3x2:case i.FLOAT_MAT4x2:s=2,n=i.FLOAT;break}let h,p;typeof o=="number"?(h=o,n&&(o*=St[n]),p=o):(h=o.length,p=o.byteLength),this.gl=e,this.buffer=null,this.appState=r,this.type=n,this.itemSize=s,this.numItems=n?h/(s*u):p/s,this.numColumns=u,this.byteLength=p,this.usage=l,this.indexArray=!!a,this.integer=!!ln[this.type],this.binding=this.indexArray?i.ELEMENT_ARRAY_BUFFER:i.ARRAY_BUFFER,this.restore(o)}restore(e){return e||(e=this.byteLength),this.appState.vertexArray&&(this.gl.bindVertexArray(null),this.appState.vertexArray=null),this.buffer=this.gl.createBuffer(),this.gl.bindBuffer(this.binding,this.buffer),this.gl.bufferData(this.binding,e,this.usage),this.gl.bindBuffer(this.binding,null),this}data(e,r=0){return this.appState.vertexArray&&(this.gl.bindVertexArray(null),this.appState.vertexArray=null),this.gl.bindBuffer(this.binding,this.buffer),this.gl.bufferSubData(this.binding,r,e),this.gl.bindBuffer(this.binding,null),this}delete(){return this.buffer&&(this.gl.deleteBuffer(this.buffer),this.buffer=null),this}}class un{constructor(e){this.gl=e,this.canvas=e.canvas,this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this.viewportX=0,this.viewportY=0,this.viewportWidth=0,this.viewportHeight=0,this.currentDrawCalls=null,this.emptyFragmentShader=null,this.state={program:null,vertexArray:null,transformFeedback:null,activeTexture:-1,textures:new Array(q.MAX_TEXTURE_UNITS),uniformBuffers:new Array(q.MAX_UNIFORM_BUFFERS),freeUniformBufferBases:[],framebuffers:{},drawFramebufferBinding:i.DRAW_FRAMEBUFFER,readFramebufferBinding:i.READ_FRAMEBUFFER,extensions:{}},this.clearBits=this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT|this.gl.STENCIL_BUFFER_BIT,this.cpuTime=0,this.gpuTime=0,this.viewport(0,0,this.width,this.height),this.contextLostExt=null,this.contextLostListener=null,this.contextRestoredListener=null,this.contextRestoredHandler=null,this.initExtensions()}loseContext(){return this.contextLostExt&&this.contextLostExt.loseContext(),this}restoreContext(){return this.contextLostExt&&this.contextLostExt.restoreContext(),this}onContextRestored(e){return this.contextRestoredHandler=e,this.initContextListeners(),this}enable(e){return this.gl.enable(e),this}disable(e){return this.gl.disable(e),this}colorMask(e,r,n,s){return this.gl.colorMask(e,r,n,s),this}clearColor(e,r,n,s){return this.gl.clearColor(e,r,n,s),this}clearMask(e){return this.clearBits=e,this}clear(){return this.gl.clear(this.clearBits),this}drawFramebuffer(e){return e.bindForDraw(),this}readFramebuffer(e){return e.bindForRead(),this}defaultDrawFramebuffer(){let e=this.state.drawFramebufferBinding;return this.state.framebuffers[e]!==null&&(this.gl.bindFramebuffer(e,null),this.state.framebuffers[e]=null),this}defaultReadFramebuffer(){let e=this.state.readFramebufferBinding;return this.state.framebuffers[e]!==null&&(this.gl.bindFramebuffer(e,null),this.state.framebuffers[e]=null),this}blitFramebuffer(e,r=Ve){let n=this.state.readFramebufferBinding,s=this.state.drawFramebufferBinding,o=this.state.framebuffers[n],l=this.state.framebuffers[s],a=o?o.width:this.width,u=o?o.height:this.height,h=l?l.width:this.width,p=l?l.height:this.height,{srcStartX:f=0,srcStartY:T=0,srcEndX:S=a,srcEndY:v=u,dstStartX:O=0,dstStartY:b=0,dstEndX:B=h,dstEndY:x=p,filter:d=i.NEAREST}=r;return this.gl.blitFramebuffer(f,T,S,v,O,b,B,x,e,d),this}depthRange(e,r){return this.gl.depthRange(e,r),this}depthMask(e){return this.gl.depthMask(e),this}depthFunc(e){return this.gl.depthFunc(e),this}blendFunc(e,r){return this.gl.blendFunc(e,r),this}blendFuncSeparate(e,r,n,s){return this.gl.blendFuncSeparate(e,r,n,s),this}blendEquation(e){return this.gl.blendEquation(e),this}stencilMask(e){return this.gl.stencilMask(e),this}stencilMaskSeparate(e,r){return this.gl.stencilMaskSeparate(e,r),this}stencilFunc(e,r,n){return this.gl.stencilFunc(e,r,n),this}stencilFuncSeparate(e,r,n,s){return this.gl.stencilFuncSeparate(e,r,n,s),this}stencilOp(e,r,n){return this.gl.stencilOp(e,r,n),this}stencilOpSeparate(e,r,n,s){return this.gl.stencilOpSeparate(e,r,n,s),this}scissor(e,r,n,s){return this.gl.scissor(e,r,n,s),this}polygonOffset(e,r){return this.gl.polygonOffset(e,r),this}readPixel(e,r,n,s=Ve){let{format:o=i.RGBA,type:l=i.UNSIGNED_BYTE}=s;return this.gl.readPixels(e,r,1,1,o,l,n),this}viewport(e,r,n,s){return(this.viewportWidth!==n||this.viewportHeight!==s||this.viewportX!==e||this.viewportY!==r)&&(this.viewportX=e,this.viewportY=r,this.viewportWidth=n,this.viewportHeight=s,this.gl.viewport(e,r,this.viewportWidth,this.viewportHeight)),this}defaultViewport(){return this.viewport(0,0,this.width,this.height),this}resize(e,r){return this.canvas.width=e,this.canvas.height=r,this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this.viewport(0,0,this.width,this.height),this}createProgram(e,r,n={}){let{transformFeedbackVaryings:s,attributeLocations:o,transformFeedbackMode:l}=n;return new Mr(this.gl,this.state,e,r,s,o,l).link().checkLinkage()}createPrograms(...e){return new Promise((r,n)=>{let s=e.length,o=new Array(s),l=new Array(s),a=s;for(let h=0;h<s;++h){let p=e[h],f=p[0],T=p[1],S=p[2]||{},{transformFeedbackVaryings:v,attributeLocations:O,transformFeedbackMode:b}=S;o[h]=new Mr(this.gl,this.state,f,T,v,O,b),l[h]=o[h]}for(let h=0;h<s;++h)o[h].link();let u=()=>{let h=0;for(let p=0;p<a;++p)if(l[p].checkCompletion())if(l[p].checkLinkage(),l[p].linked)++h;else{n(new Error("Program linkage failed"));return}else l[p-h]=l[p];a-=h,a===0?r(o):requestAnimationFrame(u)};u()})}restorePrograms(...e){return new Promise((r,n)=>{let s=e.length,o=e.slice(),l=s;for(let u=0;u<s;++u)e[u].initialize();for(let u=0;u<s;++u)e[u].link();for(let u=0;u<s;++u)e[u].checkCompletion();let a=()=>{let u=0;for(let h=0;h<l;++h)if(o[h].checkCompletion())if(o[h].checkLinkage(),o[h].linked)++u;else{n(new Error("Program linkage failed"));return}else o[h-u]=o[h];l-=u,l===0?r():requestAnimationFrame(a)};a()})}createShader(e,r){return new Je(this.gl,this.state,e,r)}createVertexArray(){return new on(this.gl,this.state)}createTransformFeedback(){return new sn(this.gl,this.state)}createVertexBuffer(e,r,n,s){return new pt(this.gl,this.state,e,r,n,s)}createMatrixBuffer(e,r,n){return new pt(this.gl,this.state,e,0,r,n)}createInterleavedBuffer(e,r,n){return new pt(this.gl,this.state,null,e,r,n)}createIndexBuffer(e,r,n,s){return ArrayBuffer.isView(r)&&(s=n,n=r,r=3),new pt(this.gl,this.state,e,r,n,s,!0)}createUniformBuffer(e,r){return new an(this.gl,this.state,e,r)}createTexture2D(e,r,n,s){return typeof e=="number"?(s=n,n=r,r=e,e=null):n===void 0&&(s=r,r=e.width,n=e.height),new tt(this.gl,this.state,this.gl.TEXTURE_2D,e,r,n,void 0,!1,s)}createTextureArray(e,r,n,s,o){return typeof e=="number"&&(o=s,s=n,n=r,r=e,e=null),new tt(this.gl,this.state,this.gl.TEXTURE_2D_ARRAY,e,r,n,s,!0,o)}createTexture3D(e,r,n,s,o){return typeof e=="number"&&(o=s,s=n,n=r,r=e,e=null),new tt(this.gl,this.state,this.gl.TEXTURE_3D,e,r,n,s,!0,o)}createCubemap(e){return new Ji(this.gl,this.state,e)}createRenderbuffer(e,r,n,s=0){return new hr(this.gl,e,r,n,s)}createFramebuffer(){return new tn(this.gl,this.state)}createQuery(e){return new Ei(this.gl,e)}createTimer(){return new nn(this.gl)}createDrawCall(e,r,n){return new en(this.gl,this.state,e,r,n)}initExtensions(){this.gl.getExtension("EXT_color_buffer_float"),this.gl.getExtension("OES_texture_float_linear"),this.gl.getExtension("WEBGL_compressed_texture_s3tc"),this.gl.getExtension("WEBGL_compressed_texture_s3tc_srgb"),this.gl.getExtension("WEBGL_compressed_texture_etc"),this.gl.getExtension("WEBGL_compressed_texture_astc"),this.gl.getExtension("WEBGL_compressed_texture_pvrtc"),this.gl.getExtension("EXT_disjoint_timer_query_webgl2"),this.gl.getExtension("EXT_disjoint_timer_query"),this.gl.getExtension("EXT_texture_filter_anisotropic"),this.state.extensions.debugShaders=this.gl.getExtension("WEBGL_debug_shaders"),this.contextLostExt=this.gl.getExtension("WEBGL_lose_context"),this.gl.getExtension("KHR_parallel_shader_compile"),this.state.extensions.multiDrawInstanced=this.gl.getExtension("WEBGL_multi_draw_instanced"),this.state.extensions.drawInstancedBaseVertexBaseInstance=this.gl.getExtension("WEBGL_draw_instanced_base_vertex_base_instance"),this.state.extensions.multiDrawInstancedBaseVertexBaseInstance=this.gl.getExtension("WEBGL_multi_draw_instanced_base_vertex_base_instance")}initContextListeners(){this.contextRestoredHandler?(this.contextLostListener=e=>{e.preventDefault()},this.contextRestoredListener=()=>{this.initExtensions(),this.contextRestoredHandler()},this.canvas.addEventListener("webglcontextlost",this.contextLostListener),this.canvas.addEventListener("webglcontextrestored",this.contextRestoredListener)):(this.canvas.removeEventListener("webglcontextlost",this.contextLostListener),this.canvas.removeEventListener("webglcontextrestored",this.contextRestoredListener),this.contextLostListener=null,this.contextRestoredListener=null)}depthTest(){return console.warn("App.depthTest is deprecated. Use App.enable(PicoGL.DEPTH_TEST) instead."),this.enable(i.DEPTH_TEST),this}noDepthTest(){return console.warn("App.noDepthTest is deprecated. Use App.disable(PicoGL.DEPTH_TEST) instead."),this.disable(i.DEPTH_TEST),this}blend(){return console.warn("App.blend is deprecated. Use App.enable(PicoGL.BLEND) instead."),this.enable(i.BLEND),this}noBlend(){return console.warn("App.noBlend is deprecated. Use App.disable(PicoGL.BLEND) instead."),this.disable(i.BLEND),this}stencilTest(){return console.warn("App.stencilTest is deprecated. Use App.enable(PicoGL.STENCIL_TEST) instead."),this.enable(i.STENCIL_TEST),this}noStencilTest(){return console.warn("App.noStencilTest is deprecated. Use App.disable(PicoGL.STENCIL_TEST) instead."),this.disable(i.STENCIL_TEST),this}scissorTest(){return console.warn("App.scissorTest is deprecated. Use App.enable(PicoGL.SCISSOR_TEST) instead."),this.enable(i.SCISSOR_TEST),this}noScissorTest(){return console.warn("App.noScissorTest is deprecated. Use App.disable(PicoGL.SCISSOR_TEST) instead."),this.disable(i.SCISSOR_TEST),this}rasterize(){return console.warn("App.noRasterize is deprecated. Use App.disable(PicoGL.RASTERIZER_DISCARD) instead."),this.disable(i.RASTERIZER_DISCARD),this}noRasterize(){return console.warn("App.rasterize is deprecated. Use App.enable(PicoGL.RASTERIZER_DISCARD) instead."),this.enable(i.RASTERIZER_DISCARD),this}cullBackfaces(){return console.warn("App.cullBackfaces is deprecated. Use App.enable(PicoGL.CULL_FACE) instead."),this.enable(i.CULL_FACE),this}drawBackfaces(){return console.warn("App.drawBackfaces is deprecated. Use App.disable(PicoGL.CULL_FACE) instead."),this.disable(i.CULL_FACE),this}}let Or=!1;const H=Object.assign({version:"0.17.9",WEBGL_INFO:q,createApp(t,e){return t.tagName==="CANVAS"&&(t=t.getContext("webgl2",e)),Or||(q.MAX_TEXTURE_UNITS=t.getParameter(i.MAX_COMBINED_TEXTURE_IMAGE_UNITS),q.MAX_UNIFORM_BUFFERS=t.getParameter(i.MAX_UNIFORM_BUFFER_BINDINGS),q.MAX_UNIFORMS=Math.min(t.getParameter(i.MAX_VERTEX_UNIFORM_VECTORS),t.getParameter(i.MAX_FRAGMENT_UNIFORM_VECTORS)),q.SAMPLES=t.getParameter(i.SAMPLES),q.VENDOR="(Unknown)",q.RENDERER="(Unknown)",q.FLOAT_RENDER_TARGETS=!!t.getExtension("EXT_color_buffer_float"),q.LINEAR_FLOAT_TEXTURES=!!t.getExtension("OES_texture_float_linear"),q.S3TC_TEXTURES=!!t.getExtension("WEBGL_compressed_texture_s3tc"),q.S3TC_SRGB_TEXTURES=!!t.getExtension("WEBGL_compressed_texture_s3tc_srgb"),q.ETC_TEXTURES=!!t.getExtension("WEBGL_compressed_texture_etc"),q.ASTC_TEXTURES=!!t.getExtension("WEBGL_compressed_texture_astc"),q.PVRTC_TEXTURES=!!t.getExtension("WEBGL_compressed_texture_pvrtc"),q.LOSE_CONTEXT=!!t.getExtension("WEBGL_lose_context"),q.DEBUG_SHADERS=!!t.getExtension("WEBGL_debug_shaders"),q.GPU_TIMER=!!(t.getExtension("EXT_disjoint_timer_query_webgl2")||t.getExtension("EXT_disjoint_timer_query")),q.TEXTURE_ANISOTROPY=!!t.getExtension("EXT_texture_filter_anisotropic"),q.MAX_TEXTURE_ANISOTROPY=q.TEXTURE_ANISOTROPY?t.getParameter(i.MAX_TEXTURE_MAX_ANISOTROPY_EXT):1,q.DEBUG_RENDERER_INFO=!!t.getExtension("WEBGL_debug_renderer_info"),q.DEBUG_RENDERER_INFO&&(q.VENDOR=t.getParameter(i.UNMASKED_VENDOR_WEBGL),q.RENDERER=t.getParameter(i.UNMASKED_RENDERER_WEBGL)),q.PARALLEL_SHADER_COMPILE=!!t.getExtension("KHR_parallel_shader_compile"),q.MULTI_DRAW_INSTANCED=!!t.getExtension("WEBGL_multi_draw_instanced"),q.DRAW_INSTANCED_BASE_VERTEX_BASE_INSTANCE=!!t.getExtension("WEBGL_draw_instanced_base_vertex_base_instance"),q.MULTI_DRAW_INSTANCED_BASE_VERTEX_BASE_INSTANCE=!!t.getExtension("WEBGL_multi_draw_instanced_base_vertex_base_instance"),Or=!0),new un(t)}},i);var ve=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function hn(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var ne={},cn={get exports(){return ne},set exports(t){ne=t}},Ft={},fn={get exports(){return Ft},set exports(t){Ft=t}},Lr;function En(){return Lr||(Lr=1,function(t,e){(function(r,n){t.exports=n()})(ve,function(){var r={isEqual:!0,isMatchingKey:!0,isPromise:!0,maxSize:!0,onCacheAdd:!0,onCacheChange:!0,onCacheHit:!0,transformKey:!0},n=Array.prototype.slice;function s(f){var T=f.length;return T?T===1?[f[0]]:T===2?[f[0],f[1]]:T===3?[f[0],f[1],f[2]]:n.call(f,0):[]}function o(f){var T={};for(var S in f)r[S]||(T[S]=f[S]);return T}function l(f){return typeof f=="function"&&f.isMemoized}function a(f,T){return f===T||f!==f&&T!==T}function u(f,T){var S={};for(var v in f)S[v]=f[v];for(var v in T)S[v]=T[v];return S}var h=function(){function f(T){this.keys=[],this.values=[],this.options=T;var S=typeof T.isMatchingKey=="function";S?this.getKeyIndex=this._getKeyIndexFromMatchingKey:T.maxSize>1?this.getKeyIndex=this._getKeyIndexForMany:this.getKeyIndex=this._getKeyIndexForSingle,this.canTransformKey=typeof T.transformKey=="function",this.shouldCloneArguments=this.canTransformKey||S,this.shouldUpdateOnAdd=typeof T.onCacheAdd=="function",this.shouldUpdateOnChange=typeof T.onCacheChange=="function",this.shouldUpdateOnHit=typeof T.onCacheHit=="function"}return Object.defineProperty(f.prototype,"size",{get:function(){return this.keys.length},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"snapshot",{get:function(){return{keys:s(this.keys),size:this.size,values:s(this.values)}},enumerable:!1,configurable:!0}),f.prototype._getKeyIndexFromMatchingKey=function(T){var S=this.options,v=S.isMatchingKey,O=S.maxSize,b=this.keys,B=b.length;if(!B)return-1;if(v(b[0],T))return 0;if(O>1){for(var x=1;x<B;x++)if(v(b[x],T))return x}return-1},f.prototype._getKeyIndexForMany=function(T){var S=this.options.isEqual,v=this.keys,O=v.length;if(!O)return-1;if(O===1)return this._getKeyIndexForSingle(T);var b=T.length,B,x;if(b>1){for(var d=0;d<O;d++)if(B=v[d],B.length===b){for(x=0;x<b&&S(B[x],T[x]);x++);if(x===b)return d}}else for(var d=0;d<O;d++)if(B=v[d],B.length===b&&S(B[0],T[0]))return d;return-1},f.prototype._getKeyIndexForSingle=function(T){var S=this.keys;if(!S.length)return-1;var v=S[0],O=v.length;if(T.length!==O)return-1;var b=this.options.isEqual;if(O>1){for(var B=0;B<O;B++)if(!b(v[B],T[B]))return-1;return 0}return b(v[0],T[0])?0:-1},f.prototype.orderByLru=function(T,S,v){for(var O=this.keys,b=this.values,B=O.length,x=v;x--;)O[x+1]=O[x],b[x+1]=b[x];O[0]=T,b[0]=S;var d=this.options.maxSize;B===d&&v===B?(O.pop(),b.pop()):v>=d&&(O.length=b.length=d)},f.prototype.updateAsyncCache=function(T){var S=this,v=this.options,O=v.onCacheChange,b=v.onCacheHit,B=this.keys[0],x=this.values[0];this.values[0]=x.then(function(d){return S.shouldUpdateOnHit&&b(S,S.options,T),S.shouldUpdateOnChange&&O(S,S.options,T),d},function(d){var V=S.getKeyIndex(B);throw V!==-1&&(S.keys.splice(V,1),S.values.splice(V,1)),d})},f}();function p(f,T){if(T===void 0&&(T={}),l(f))return p(f.fn,u(f.options,T));if(typeof f!="function")throw new TypeError("You must pass a function to `memoize`.");var S=T.isEqual,v=S===void 0?a:S,O=T.isMatchingKey,b=T.isPromise,B=b===void 0?!1:b,x=T.maxSize,d=x===void 0?1:x,V=T.onCacheAdd,W=T.onCacheChange,k=T.onCacheHit,Y=T.transformKey,ee=u({isEqual:v,isMatchingKey:O,isPromise:B,maxSize:d,onCacheAdd:V,onCacheChange:W,onCacheHit:k,transformKey:Y},o(T)),se=new h(ee),_e=se.keys,A=se.values,G=se.canTransformKey,$=se.shouldCloneArguments,N=se.shouldUpdateOnAdd,g=se.shouldUpdateOnChange,z=se.shouldUpdateOnHit,X=function(){var Q=$?s(arguments):arguments;G&&(Q=Y(Q));var le=_e.length?se.getKeyIndex(Q):-1;if(le!==-1)z&&k(se,ee,X),le&&(se.orderByLru(_e[le],A[le],le),g&&W(se,ee,X));else{var ue=f.apply(this,arguments),L=$?Q:s(arguments);se.orderByLru(L,ue,_e.length),B&&se.updateAsyncCache(X),N&&V(se,ee,X),g&&W(se,ee,X)}return A[0]};return X.cache=se,X.fn=f,X.isMemoized=!0,X.options=ee,X}return p})}(fn)),Ft}var rt={},_n={get exports(){return rt},set exports(t){rt=t}},Ur;function dn(){return Ur||(Ur=1,function(t,e){(function(r,n){n(e)})(ve,function(r){var n=typeof WeakMap=="function",s=Object.keys;function o(A,G){return A===G||A!==A&&G!==G}function l(A){return A.constructor===Object||A.constructor==null}function a(A){return!!A&&typeof A.then=="function"}function u(A){return!!(A&&A.$$typeof)}function h(){var A=[];return{delete:function(G){for(var $=0;$<A.length;++$)if(A[$][0]===G){A.splice($,1);return}},get:function(G){for(var $=0;$<A.length;++$)if(A[$][0]===G)return A[$][1]},set:function(G,$){for(var N=0;N<A.length;++N)if(A[N][0]===G){A[N][1]=$;return}A.push([G,$])}}}var p=function(A){return A?function(){return new WeakMap}:h}(n);function f(A){return function($){var N=A||$;return function(z,X,Q,le,ue,L,E){E===void 0&&(E=p());var R=!!z&&typeof z=="object",I=!!X&&typeof X=="object";if(R!==I)return!1;if(!R&&!I)return N(z,X,E);var w=E.get(z);if(w&&E.get(X))return w===X;E.set(z,X),E.set(X,z);var m=N(z,X,E);return E.delete(z),E.delete(X),m}}}function T(A,G,$,N){var g=A.length;if(G.length!==g)return!1;for(;g-- >0;)if(!$(A[g],G[g],g,g,A,G,N))return!1;return!0}function S(A,G,$,N){var g=A.size===G.size;if(g&&A.size){var z={},X=0;A.forEach(function(Q,le){if(g){var ue=!1,L=0;G.forEach(function(E,R){!ue&&!z[L]&&(ue=$(le,R,X,L,A,G,N)&&$(Q,E,le,R,A,G,N),ue&&(z[L]=!0)),L++}),X++,g=ue}})}return g}var v="_owner",O=Function.prototype.bind.call(Function.prototype.call,Object.prototype.hasOwnProperty);function b(A,G,$,N){var g=s(A),z=g.length;if(s(G).length!==z)return!1;if(z)for(var X=void 0;z-- >0;){if(X=g[z],X===v){var Q=u(A),le=u(G);if((Q||le)&&Q!==le)return!1}if(!O(G,X)||!$(A[X],G[X],X,X,A,G,N))return!1}return!0}var B=function(){return/foo/g.flags==="g"?function(G,$){return G.source===$.source&&G.flags===$.flags}:function(G,$){return G.source===$.source&&G.global===$.global&&G.ignoreCase===$.ignoreCase&&G.multiline===$.multiline&&G.unicode===$.unicode&&G.sticky===$.sticky&&G.lastIndex===$.lastIndex}}();function x(A,G,$,N){var g=A.size===G.size;if(g&&A.size){var z={};A.forEach(function(X,Q){if(g){var le=!1,ue=0;G.forEach(function(L,E){!le&&!z[ue]&&(le=$(X,L,Q,E,A,G,N),le&&(z[ue]=!0)),ue++}),g=le}})}return g}var d=typeof Map=="function",V=typeof Set=="function",W=Object.prototype.valueOf;function k(A){var G=typeof A=="function"?A($):function(N,g,z,X,Q,le,ue){return $(N,g,ue)};function $(N,g,z){if(N===g)return!0;if(N&&g&&typeof N=="object"&&typeof g=="object"){if(l(N)&&l(g))return b(N,g,G,z);var X=Array.isArray(N),Q=Array.isArray(g);return X||Q?X===Q&&T(N,g,G,z):(X=N instanceof Date,Q=g instanceof Date,X||Q?X===Q&&o(N.getTime(),g.getTime()):(X=N instanceof RegExp,Q=g instanceof RegExp,X||Q?X===Q&&B(N,g):a(N)||a(g)?N===g:d&&(X=N instanceof Map,Q=g instanceof Map,X||Q)?X===Q&&S(N,g,G,z):V&&(X=N instanceof Set,Q=g instanceof Set,X||Q)?X===Q&&x(N,g,G,z):N.valueOf!==W||g.valueOf!==W?o(N.valueOf(),g.valueOf()):b(N,g,G,z)))}return N!==N&&g!==g}return $}var Y=k(),ee=k(function(){return o}),se=k(f()),_e=k(f(o));r.circularDeepEqual=se,r.circularShallowEqual=_e,r.createCustomEqual=k,r.deepEqual=Y,r.sameValueZeroEqual=o,r.shallowEqual=ee,Object.defineProperty(r,"__esModule",{value:!0})})}(_n,rt)),rt}(function(t,e){(function(r,n){t.exports=n(En(),dn())})(ve,function(r,n){function s(){return s=Object.assign?Object.assign.bind():function(c){for(var _=1;_<arguments.length;_++){var D=arguments[_];for(var C in D)Object.prototype.hasOwnProperty.call(D,C)&&(c[C]=D[C])}return c},s.apply(this,arguments)}function o(c,_){if(c==null)return{};var D={},C=Object.keys(c),M,P;for(P=0;P<C.length;P++)M=C[P],!(_.indexOf(M)>=0)&&(D[M]=c[M]);return D}var l={isDeepEqual:!1,isPromise:!1,isReact:!1,isSerialized:!1,isShallowEqual:!1,matchesArg:void 0,matchesKey:void 0,maxAge:void 0,maxArgs:void 0,maxSize:1,onExpire:void 0,profileName:void 0,serializer:void 0,updateCacheForKey:void 0,transformArgs:void 0,updateExpire:!1};function a(){for(var c=arguments.length,_=new Array(c),D=0;D<c;D++)_[D]=arguments[D];return _.reduce(function(C,M){if(typeof C=="function")return typeof M=="function"?function(){C.apply(this,arguments),M.apply(this,arguments)}:C;if(typeof M=="function")return M})}function u(){for(var c=arguments.length,_=new Array(c),D=0;D<c;D++)_[D]=arguments[D];return _.reduce(function(C,M){if(typeof C=="function")return typeof M=="function"?function(){return C(M.apply(this,arguments))}:C;if(typeof M=="function")return M})}function h(c,_){for(var D=0;D<c.length;D++)if(c[D].key===_)return D;return-1}function p(c,_){var D=typeof _=="function"?_:function(C,M){for(var P=0;P<M.length;P++)if(!c(C[P],M[P]))return!1;return!0};return function(C,M){for(var P=0;P<C.length;P++)if(C[P].length===M.length&&D(C[P],M))return P;return-1}}function f(c,_){return!_||_===l?c:s({},c,_,{onCacheAdd:a(c.onCacheAdd,_.onCacheAdd),onCacheChange:a(c.onCacheChange,_.onCacheChange),onCacheHit:a(c.onCacheHit,_.onCacheHit),transformArgs:u(c.transformArgs,_.transformArgs)})}function T(c){return typeof c=="function"&&c.isMoized}function S(c,_,D){try{var C=D||_||"anonymous";Object.defineProperty(c,"name",{configurable:!0,enumerable:!1,value:"moized("+C+")",writable:!0})}catch{}}function v(c,_,D){var C=h(c,_);C!==-1&&(clearTimeout(c[C].timeoutId),D&&c.splice(C,1))}function O(c,_){var D=setTimeout(c,_);return typeof D.unref=="function"&&D.unref(),D}function b(c,_,D,C){var M=_.maxAge;return function P(y,j,Ee){var he=y.keys[0];if(h(c,he)===-1){var de=function(){var ge=p(D,C),Ce=ge(y.keys,he),Le=y.values[Ce];~Ce&&(y.keys.splice(Ce,1),y.values.splice(Ce,1),typeof _.onCacheChange=="function"&&_.onCacheChange(y,j,Ee)),v(c,he,!0),typeof _.onExpire=="function"&&_.onExpire(he)===!1&&(y.keys.unshift(he),y.values.unshift(Le),P(y,j,Ee),typeof _.onCacheChange=="function"&&_.onCacheChange(y,j,Ee))};c.push({expirationMethod:de,key:he,timeoutId:O(de,M)})}}}function B(c,_){return function(C){var M=C.keys[0],P=h(c,M);~P&&(v(c,M,!1),c[P].timeoutId=O(c[P].expirationMethod,_.maxAge))}}function x(c,_,D,C){var M=typeof _.maxAge=="number"&&isFinite(_.maxAge)?b(c,_,D,C):void 0;return{onCacheAdd:M,onCacheHit:M&&_.updateExpire?B(c,_):void 0}}var d={anonymousProfileNameCounter:1,isCollectingStats:!1,profiles:{}},V=!1;function W(c){c?delete d.profiles[c]:d.profiles={}}function k(c){c===void 0&&(c=!0),d.isCollectingStats=c}function Y(c){var _=c.profileName;return function(){_&&!d.profiles[_]&&(d.profiles[_]={calls:0,hits:0}),d.profiles[_].calls++}}function ee(c){return function(){var _=d.profiles,D=c.profileName;_[D]||(_[D]={calls:0,hits:0}),_[D].calls++,_[D].hits++}}function se(c){return c.displayName||c.name||"Anonymous "+d.anonymousProfileNameCounter++}function _e(c,_){return c?(_/c*100).toFixed(4)+"%":"0.0000%"}function A(c){!d.isCollectingStats&&!V&&(console.warn('Stats are not currently being collected, please run "collectStats" to enable them.'),V=!0);var _=d.profiles;if(c){if(!_[c])return{calls:0,hits:0,usage:"0.0000%"};var D=_[c];return s({},D,{usage:_e(D.calls,D.hits)})}var C=Object.keys(d.profiles).reduce(function(M,P){return M.calls+=_[P].calls,M.hits+=_[P].hits,M},{calls:0,hits:0});return s({},C,{profiles:Object.keys(_).reduce(function(M,P){return M[P]=A(P),M},{}),usage:_e(C.calls,C.hits)})}function G(c){return d.isCollectingStats?{onCacheAdd:Y(c),onCacheHit:ee(c)}:{}}var $={arguments:!0,callee:!0,caller:!0,constructor:!0,length:!0,name:!0,prototype:!0};function N(c,_,D){D===void 0&&(D=[]),Object.getOwnPropertyNames(c).forEach(function(C){if(!$[C]&&D.indexOf(C)===-1){var M=Object.getOwnPropertyDescriptor(c,C);M.get||M.set?Object.defineProperty(_,C,M):_[C]=c[C]}})}function g(c,_){var D=_.expirations,C=c.options,M=p(C.isEqual,C.isMatchingKey),P=c;P.clear=function(){var y=P._microMemoizeOptions.onCacheChange,j=P.cache;return j.keys.length=0,j.values.length=0,y&&y(j,P.options,P),!0},P.clearStats=function(){W(P.options.profileName)},P.get=function(y){var j=P._microMemoizeOptions.transformKey,Ee=P.cache,he=j?j(y):y,de=M(Ee.keys,he);return de!==-1?P.apply(this,y):void 0},P.getStats=function(){return A(P.options.profileName)},P.has=function(y){var j=P._microMemoizeOptions.transformKey,Ee=j?j(y):y;return M(P.cache.keys,Ee)!==-1},P.keys=function(){return P.cacheSnapshot.keys},P.remove=function(y){var j=P._microMemoizeOptions,Ee=j.onCacheChange,he=j.transformKey,de=P.cache,xe=M(de.keys,he?he(y):y);if(xe===-1)return!1;var ge=de.keys[xe];return de.keys.splice(xe,1),de.values.splice(xe,1),Ee&&Ee(de,P.options,P),v(D,ge,!0),!0},P.set=function(y,j){var Ee=P._microMemoizeOptions,he=P.cache,de=P.options,xe=Ee.onCacheAdd,ge=Ee.onCacheChange,Ce=Ee.transformKey,Le=Ce?Ce(y):y,Ie=M(he.keys,Le);if(Ie===-1){var Ue=de.maxSize-1;he.size>Ue&&(he.keys.length=Ue,he.values.length=Ue),he.keys.unshift(Le),he.values.unshift(j),de.isPromise&&he.updateAsyncCache(P),xe&&xe(he,de,P),ge&&ge(he,de,P)}else{var Tt=he.keys[Ie];he.values[Ie]=j,Ie>0&&he.orderByLru(Tt,j,Ie),de.isPromise&&he.updateAsyncCache(P),typeof ge=="function"&&ge(he,de,P)}},P.values=function(){return P.cacheSnapshot.values}}function z(c,_){var D=_.expirations,C=_.options,M=_.originalFunction,P=c.options;Object.defineProperties(c,{_microMemoizeOptions:{configurable:!0,get:function(){return P}},cacheSnapshot:{configurable:!0,get:function(){var Ee=c.cache;return{keys:Ee.keys.slice(0),size:Ee.size,values:Ee.values.slice(0)}}},expirations:{configurable:!0,get:function(){return D}},expirationsSnapshot:{configurable:!0,get:function(){return D.slice(0)}},isMoized:{configurable:!0,get:function(){return!0}},options:{configurable:!0,get:function(){return C}},originalFunction:{configurable:!0,get:function(){return M}}});var y=c;N(M,y)}function X(c,_){return g(c,_),z(c,_),c}var Q=typeof Symbol=="function"&&Symbol.for?Symbol.for("react.element"):60103;function le(c,_,D){var C=c(s({maxArgs:2,isShallowEqual:!0},D,{isReact:!1}));_.displayName||(_.displayName=_.name||"Component");function M(P,y,j){this.props=P,this.context=y,this.updater=j,this.MoizedComponent=C(_)}return M.prototype.isReactComponent={},M.prototype.render=function(){return{$$typeof:Q,type:this.MoizedComponent,props:this.props,ref:null,key:null,_owner:null}},N(_,M,["contextType","contextTypes"]),M.displayName="Moized("+(_.displayName||_.name||"Component")+")",S(M,_.name,D.profileName),M}function ue(c){return function(_){if(c>=_.length)return _;if(c===0)return[];if(c===1)return[_[0]];if(c===2)return[_[0],_[1]];if(c===3)return[_[0],_[1],_[2]];for(var D=[],C=0;C<c;C++)D[C]=_[C];return D}}function L(c,_){for(var D=c.length,C=0;C<D;++C)if(c[C]===_)return C+1;return 0}function E(){var c=[],_=[];return function(C,M){var P=typeof M;if(P==="function"||P==="symbol")return M.toString();if(typeof M=="object"){if(c.length){var y=L(c,this);y===0?c[c.length]=this:(c.splice(y),_.splice(y)),_[_.length]=C;var j=L(c,M);if(j!==0)return"[ref="+(_.slice(0,j).join(".")||".")+"]"}else c[0]=M,_[0]=C;return M}return""+M}}function R(c){var _=typeof c;return c&&(_==="object"||_==="function")?JSON.stringify(c,E()):c}function I(c){for(var _="|",D=0;D<c.length;D++)_+=R(c[D])+"|";return[_]}function w(c){return typeof c.serializer=="function"?c.serializer:I}function m(c,_){return c[0]===_[0]}function F(c){if(typeof c=="function")return function(_,D,C){return c(C.cache,C.options,C)}}function U(c){return c.matchesArg||c.isDeepEqual&&n.deepEqual||c.isShallowEqual&&n.shallowEqual||n.sameValueZeroEqual}function ie(c){return c.matchesKey||c.isSerialized&&m||void 0}function ae(c){return u(c.isSerialized&&w(c),typeof c.transformArgs=="function"&&c.transformArgs,typeof c.maxArgs=="number"&&ue(c.maxArgs))}function fe(c){var _=c.options.updateCacheForKey,D=function(){for(var M=arguments.length,P=new Array(M),y=0;y<M;y++)P[y]=arguments[y];if(!_(P))return c.apply(this,P);var j=c.fn.apply(this,P);return c.set(P,j),j};return N(c,D),D}var oe=["matchesArg","isDeepEqual","isPromise","isReact","isSerialized","isShallowEqual","matchesKey","maxAge","maxArgs","maxSize","onCacheAdd","onCacheChange","onCacheHit","onExpire","profileName","serializer","updateCacheForKey","transformArgs","updateExpire"],K=function c(_,D){var C=D||l;if(T(_)){var M=_.originalFunction,P=f(_.options,C);return c(M,P)}if(typeof _=="object")return function(kt,qi){if(typeof kt=="function"){var Zi=f(_,qi);return c(kt,Zi)}var Qi=f(_,kt);return c(Qi)};if(C.isReact)return le(c,_,C);var y=s({},l,C,{maxAge:typeof C.maxAge=="number"&&C.maxAge>=0?C.maxAge:l.maxAge,maxArgs:typeof C.maxArgs=="number"&&C.maxArgs>=0?C.maxArgs:l.maxArgs,maxSize:typeof C.maxSize=="number"&&C.maxSize>=0?C.maxSize:l.maxSize,profileName:C.profileName||se(_)}),j=[];y.matchesArg,y.isDeepEqual;var Ee=y.isPromise;y.isReact,y.isSerialized,y.isShallowEqual,y.matchesKey,y.maxAge,y.maxArgs;var he=y.maxSize,de=y.onCacheAdd,xe=y.onCacheChange,ge=y.onCacheHit;y.onExpire,y.profileName,y.serializer;var Ce=y.updateCacheForKey;y.transformArgs,y.updateExpire;var Le=o(y,oe),Ie=U(y),Ue=ie(y),Tt=x(j,y,Ie,Ue),Pr=G(y),Wi=ae(y),Yi=s({},Le,{isEqual:Ie,isMatchingKey:Ue,isPromise:Ee,maxSize:he,onCacheAdd:F(a(de,Tt.onCacheAdd,Pr.onCacheAdd)),onCacheChange:F(xe),onCacheHit:F(a(ge,Tt.onCacheHit,Pr.onCacheHit)),transformKey:Wi}),ji=r(_,Yi),mt=X(ji,{expirations:j,options:y,originalFunction:_});return Ce&&(mt=fe(mt)),S(mt,_.name,C.profileName),mt};K.clearStats=W,K.collectStats=k,K.compose=function(){return u.apply(void 0,arguments)||K},K.deep=K({isDeepEqual:!0}),K.getStats=A,K.infinite=K({maxSize:1/0}),K.isCollectingStats=function(){return d.isCollectingStats},K.isMoized=function(_){return typeof _=="function"&&!!_.isMoized},K.matchesArg=function(c){return K({matchesArg:c})},K.matchesKey=function(c){return K({matchesKey:c})};function te(c,_){if(_===!0)return K({maxAge:c,updateExpire:_});if(typeof _=="object"){var D=_.onExpire,C=_.updateExpire;return K({maxAge:c,onExpire:D,updateExpire:C})}return K(typeof _=="function"?{maxAge:c,onExpire:_,updateExpire:!0}:{maxAge:c})}return K.maxAge=te,K.maxArgs=function(c){return K({maxArgs:c})},K.maxSize=function(c){return K({maxSize:c})},K.profile=function(c){return K({profileName:c})},K.promise=K({isPromise:!0,updateExpire:!0}),K.react=K({isReact:!0}),K.serialize=K({isSerialized:!0}),K.serializeWith=function(c){return K({isSerialized:!0,serializer:c})},K.shallow=K({isShallowEqual:!0}),K.transformArgs=function(c){return K({transformArgs:c})},K.updateCacheForKey=function(c){return K({updateCacheForKey:c})},Object.defineProperty(K,"default",{configurable:!1,enumerable:!1,value:K,writable:!1}),K})})(cn);var An=`#version 300 es
precision highp float;
precision highp int;

layout(location=0) in vec3 currentPosition;
layout(location=1) in vec4 currentColor;
layout(location=2) in float currentSize;
layout(location=3) in float currentEmphasis;
layout(location=4) in vec3 targetPosition;
layout(location=5) in vec4 targetColor;
layout(location=6) in float targetSize;
layout(location=7) in float targetEmphasis;

layout(location=8) in uint vertexPosition;

out vec3 vTargetPosition;
out vec3 vUpdatedPosition;
out vec4 vUpdatedColor;
out float vUpdatedSize;
out float vUpdatedEmphasis;

uniform float uMixRatio;
uniform vec2 mousePosition;
uniform vec2 bufferDimensions;

flat out int vertexID;
flat out vec2 uv;

float bump(float x, float q, float w) {
  float clamped_x = clamp(x/w, -0.5, 0.5);
  float y = pow(exp(1.0 - 1.0 / (1.0 - pow(2.0*clamped_x, 2.0))), q);
  return y;
}

void main() {
  vTargetPosition = targetPosition;
  float nearness = bump(length(mousePosition - currentPosition.xy), 100.0, 20.0);
  float mixRatio = uMixRatio;
  vUpdatedSize = mix(currentSize, targetSize, mixRatio);

  
  vec3 delta = targetPosition - currentPosition;
  float distance = length(delta);

  vUpdatedPosition = currentPosition + normalize(delta)*min(0.005, distance/200.0);
  vUpdatedPosition = mix(currentPosition, targetPosition, mixRatio);
  vUpdatedColor = mix(currentColor, targetColor, mixRatio);
  vUpdatedEmphasis = mix(currentEmphasis, targetEmphasis, mixRatio);

  uint v = uint(gl_VertexID);
  
  vertexID = int(v);
  
  uv = vec2(
    float(int(v) % int(bufferDimensions.x)),
    float(int(v) / int(bufferDimensions.x))
  );
  
  uv = uv / float(bufferDimensions);
  uv += vec2(0.5/bufferDimensions.x, 0.5/bufferDimensions.y);
  
  
  
  
  gl_Position = vec4(uv*2.0 - 1.0, 0.0, 1.0);
  gl_PointSize = 1.0;
  
}`,Tn=`#version 300 es
precision highp float;
precision highp int;

in vec3 vUpdatedPosition;
in vec3 vTargetPosition;
in vec4 vUpdatedColor;
in float vUpdatedSize;
in float vUpdatedEmphasis;

flat in int vertexID;

layout(location = 1) out vec4 position;
layout(location = 2) out vec4 color;
layout(location = 3) out vec4 size;
layout(location = 4) out vec4 emphasis;

uniform vec2 bufferDimensions;

void main() {
  position = vec4(vUpdatedPosition, 1.0);
  
  
  
  

  color = vUpdatedColor;
  size = vec4(vUpdatedSize,0,0,1);
  emphasis = vec4(vUpdatedEmphasis,0,0,1);
}`,mn=`#version 300 es
precision highp float;
precision highp int;

layout(location=0) in ivec2 edgeIndices;
layout(location=1) in vec3 segmentOffset;
layout(location=2) in lowp uint segmentParameter;

out vec4 color;
flat out vec4 sourceColor;
flat out vec4 targetColor;
out vec4 position;
out float size;
flat out vec2 edgeDirection;
flat out float edgeLength;
flat out float edgeLength2D;
out float isSource;
out float isTarget;
out float emphasis;
out float v;
out float y;

uniform vec2 mousePosition;

uniform cameras {
  mat4 projection;
  mat4 view;
  mat4 orthoFixedProjection;
  mat4 orthoFixedView;
  mat4 orthoZoomedProjection;
  mat4 orthoZoomedView;
};

struct CameraMatrices {
  mat4 projection;
  mat4 view;
  mat4 orthoFixedProjection;
  mat4 orthoFixedView;
  mat4 orthoZoomedProjection;
  mat4 orthoZoomedView;
};

struct NodeGeometryBundle {
  vec3 globalNDC;
  vec4 globalClipPosition;
  vec4 orthoFixedClipPosition;
  vec4 orthoZoomedClipPosition;
  vec4 orthographicClipPosition;
};

NodeGeometryBundle nodeGeometry(
  in vec3 nodePosition,
  in vec3 vertexPosition,
  float scale,
  in CameraMatrices cam
) {
  vec4 globalClipPosition = cam.projection * cam.view * vec4(nodePosition, 1.0);
  vec3 globalNDC = globalClipPosition.xyz / globalClipPosition.w;

  vec4 orthoFixedClipPosition = cam.orthoFixedProjection * cam.orthoFixedView * vec4(vertexPosition*scale, 1.0);
  vec3 orthoFixedNDC = orthoFixedClipPosition.xyz / orthoFixedClipPosition.w;
  
  vec4 orthoZoomedClipPosition = cam.orthoZoomedProjection * cam.orthoZoomedView * vec4(vertexPosition*scale, 1.0)*0.5;
  vec3 orthoZoomedNDC = orthoZoomedClipPosition.xyz / orthoZoomedClipPosition.w;

  vec3 localNDC = mix(orthoZoomedNDC, orthoFixedNDC, 0.5);

  
  vec3 orthographicNDC = vec3(localNDC.xy + globalNDC.xy, globalNDC.z + (localNDC.z - 0.99)*0.2 );
  
  vec4 orthographicClipPosition = vec4(orthographicNDC * globalClipPosition.w, globalClipPosition.w);
  
  return NodeGeometryBundle(
    globalNDC,
    globalClipPosition,
    orthoFixedClipPosition,
    orthoZoomedClipPosition,
    orthographicClipPosition
  );
}

vec4 edgeGeometry(
  in vec3 nodePosition,
  in vec3 vertexPosition,
  in vec2 edgeDirection,
  float scale,
  in CameraMatrices cam
) {
  vec2 edgePerpendicular = vec2(-edgeDirection.y, edgeDirection.x)*scale/3.0;
  vec4 position = cam.projection * cam.view * vec4(nodePosition, 1.0);
  vec4 positionNDC = position / position.w;
  
  

  vec4 positionClip = vec4(position.xy + vertexPosition.y*1.0 * edgePerpendicular*50.0, position.zw);

  vec4 positionFixedStrokeNDC = positionNDC + vec4(vertexPosition.y * edgePerpendicular, 0.0, 0.0);
  vec4 positionFixedStrokeClip = positionFixedStrokeNDC * position.w;

  
  return mix(positionFixedStrokeClip, positionClip, 0.8);
}

uniform sampler2D positionTexture;
uniform sampler2D colorTexture;
uniform sampler2D sizeTexture;
uniform sampler2D emphasisTexture;
uniform ivec2 textureDimensions;

uniform bool selected;
uniform bool hovered;

ivec2 getTextureIndex(int index, ivec2 textureDimensions) {
  int textureLength = textureDimensions.x * textureDimensions.y;
  

  
  int x = index % textureDimensions.x;
  int y = index / textureDimensions.x;

  return ivec2(x,y);
}

float bump(float x, float q, float w) {
  float clamped_x = clamp(x/w, -0.5, 0.5);
  float y = pow(exp(1.0 - 1.0 / (1.0 - pow(2.0*clamped_x, 2.0))), q);
  return y;
}

void main() {
  isSource = segmentOffset.x;
  isTarget = 1.0-segmentOffset.x;
  
  position = vec4(0);
  vec3 vertexOffset = segmentOffset + vec3(0.0, -0.5, 0.0);

  vec3 sourceNodePosition = texelFetch(positionTexture, getTextureIndex(edgeIndices.x, textureDimensions), 0).xyz;
  vec3 targetNodePosition = texelFetch(positionTexture, getTextureIndex(edgeIndices.y, textureDimensions), 0).xyz;
  vec3 nodePosition = sourceNodePosition*isSource + targetNodePosition*isTarget;
  
  float sourceSize = texelFetch(sizeTexture, getTextureIndex(edgeIndices.x, textureDimensions), 0).r;
  float targetSize = texelFetch(sizeTexture, getTextureIndex(edgeIndices.y, textureDimensions), 0).r;

  size = sourceSize*isSource + targetSize*isTarget;
  size *= 0.1;
  
  vec4 targetPositionClip = projection * view * vec4(targetNodePosition, 1.0);
  vec4 sourcePositionClip = projection * view * vec4(sourceNodePosition, 1.0);
  
  edgeDirection = normalize(targetPositionClip.xyz/targetPositionClip.w - sourcePositionClip.xyz/sourcePositionClip.w).xy;
  edgeLength = length(targetNodePosition.xyz - sourceNodePosition.xyz);
  edgeLength2D = length((targetPositionClip.xy/targetPositionClip.w - sourcePositionClip.xy/sourcePositionClip.w));

  position = edgeGeometry(
    nodePosition,
    vertexOffset,
    edgeDirection,
    size,
    CameraMatrices(
      projection,
      view,
      orthoFixedProjection,
      orthoFixedView,
      orthoZoomedProjection,
      orthoZoomedView
    )
  );

  
  position.z += 0.01 * position.w * bump(vertexOffset.x, 4.0, 0.125);

  vec4 sourceColor = texelFetch(colorTexture, getTextureIndex(edgeIndices.x, textureDimensions), 0);
  vec4 targetColor = texelFetch(colorTexture, getTextureIndex(edgeIndices.y, textureDimensions), 0);
  color += sourceColor*isSource;
  color += targetColor*isTarget;
  
  float sourceEmphasis = texelFetch(emphasisTexture, getTextureIndex(edgeIndices.x, textureDimensions), 0).r;
  float targetEmphasis = texelFetch(emphasisTexture, getTextureIndex(edgeIndices.y, textureDimensions), 0).r;

  emphasis = sourceEmphasis*isSource + targetEmphasis*isTarget;

  
  
  
  

  
  

  gl_Position = position;
  y = vertexOffset.y;
  v = segmentOffset.y;

  float distance = length(mousePosition - position.xy);
  
}`,pn=`#version 300 es
precision highp float;

in vec4 color;
in vec4 position;
in float emphasis;
in float size;
flat in vec2 edgeDirection;
flat in float edgeLength;
flat in float edgeLength2D;
in float isTarget;
in float isSource;
in float y;

out vec4 fragColor;

const float PI = 3.1415926535897932384626433832795;
const float freq = 1.0;

uniform float time;

float bump(float x, float q, float w) {
  float clamped_x = clamp(x/w, -0.5, 0.5);
  float y = pow(exp(1.0 - 1.0 / (1.0 - pow(2.0*clamped_x, 2.0))), q);
  return y;
}
float sdEgg( in vec2 p, in float ra, in float rb )
{
    const float k = sqrt(3.0);
    p.x = abs(p.x);
    float r = ra - rb;
    return ((p.y<0.0)       ? length(vec2(p.x,  p.y    )) - r :
            (k*(p.x+r)<p.y) ? length(vec2(p.x,  p.y-k*r)) :
                              length(vec2(p.x+r,p.y    )) - 2.0*r) - rb;
}

float sdEquilateralTriangle( in vec2 p )
{
    const float k = sqrt(3.0);
    p.x = abs(p.x) - 1.0;
    p.y = p.y + 1.0/k;
    if( p.x+k*p.y>0.0 ) p = vec2(p.x-k*p.y,-k*p.x-p.y)/2.0;
    p.x -= clamp( p.x, -2.0, 0.0 );
    return -length(p)*sign(p.y);
}

float wave(float t, float freq){ return pow(sin(t * freq * PI), 2.0); }
void main() {
  float u = isTarget;
  
  
  
  float d = sdEquilateralTriangle(vec2(y*4.0, (isSource-0.5)*edgeLength2D*10.0/size));
  float triangle = d < 0.0 ? 1.0 : 0.0;

  fragColor = color;
  
  
  
  
  

  
  fragColor.a *= mix(1.0, wave(u + time/20.0, 50.0), mix(0.25, 1.0, emphasis));
  
  
  

  
  fragColor.a = min(1.0-triangle/3.0, fragColor.a);
  
  fragColor.a *= mix(0.5, 1.0, emphasis);
  
  
  fragColor.rgb *= mix(1.0, bump(position.x/position.w, 2.0, 1.0), 0.5);

  
  
}`,Rn=`#version 300 es
precision highp float;
precision highp int;

layout(location=0) in vec3 nodePosition;
layout(location=1) in vec4 nodeColor;
layout(location=2) in float nodeSize;

layout(location=3) in vec3 vertexPosition;
layout(location=4) in vec3 vertexNormal;

uniform cameras {
  mat4 projection;
  mat4 view;
  mat4 orthoFixedProjection;
  mat4 orthoFixedView;
  mat4 orthoZoomedProjection;
  mat4 orthoZoomedView;
};

struct CameraMatrices {
  mat4 projection;
  mat4 view;
  mat4 orthoFixedProjection;
  mat4 orthoFixedView;
  mat4 orthoZoomedProjection;
  mat4 orthoZoomedView;
};

struct NodeGeometryBundle {
  vec3 globalNDC;
  vec4 globalClipPosition;
  vec4 orthoFixedClipPosition;
  vec4 orthoZoomedClipPosition;
  vec4 orthographicClipPosition;
};

NodeGeometryBundle nodeGeometry(
  in vec3 nodePosition,
  in vec3 vertexPosition,
  float scale,
  in CameraMatrices cam
) {
  vec4 globalClipPosition = cam.projection * cam.view * vec4(nodePosition, 1.0);
  vec3 globalNDC = globalClipPosition.xyz / globalClipPosition.w;

  vec4 orthoFixedClipPosition = cam.orthoFixedProjection * cam.orthoFixedView * vec4(vertexPosition*scale, 1.0);
  vec3 orthoFixedNDC = orthoFixedClipPosition.xyz / orthoFixedClipPosition.w;
  
  vec4 orthoZoomedClipPosition = cam.orthoZoomedProjection * cam.orthoZoomedView * vec4(vertexPosition*scale, 1.0)*0.5;
  vec3 orthoZoomedNDC = orthoZoomedClipPosition.xyz / orthoZoomedClipPosition.w;

  vec3 localNDC = mix(orthoZoomedNDC, orthoFixedNDC, 0.5);

  
  vec3 orthographicNDC = vec3(localNDC.xy + globalNDC.xy, globalNDC.z + (localNDC.z - 0.99)*0.2 );
  
  vec4 orthographicClipPosition = vec4(orthographicNDC * globalClipPosition.w, globalClipPosition.w);
  
  return NodeGeometryBundle(
    globalNDC,
    globalClipPosition,
    orthoFixedClipPosition,
    orthoZoomedClipPosition,
    orthographicClipPosition
  );
}

vec4 edgeGeometry(
  in vec3 nodePosition,
  in vec3 vertexPosition,
  in vec2 edgeDirection,
  float scale,
  in CameraMatrices cam
) {
  vec2 edgePerpendicular = vec2(-edgeDirection.y, edgeDirection.x)*scale/3.0;
  vec4 position = cam.projection * cam.view * vec4(nodePosition, 1.0);
  vec4 positionNDC = position / position.w;
  
  

  vec4 positionClip = vec4(position.xy + vertexPosition.y*1.0 * edgePerpendicular*50.0, position.zw);

  vec4 positionFixedStrokeNDC = positionNDC + vec4(vertexPosition.y * edgePerpendicular, 0.0, 0.0);
  vec4 positionFixedStrokeClip = positionFixedStrokeNDC * position.w;

  
  return mix(positionFixedStrokeClip, positionClip, 0.8);
}

uniform vec2 mousePosition;

uniform int selectedIndex;

#ifdef PICKER
  flat out vec4 color;
#else
  out vec4 color;
#endif

out vec3 position;
out vec3 normal;

float bump(float x, float q, float w) {
  float clamped_x = clamp(x/w, -0.5, 0.5);
  float y = pow(exp(1.0 - 1.0 / (1.0 - pow(2.0*clamped_x, 2.0))), q);
  return y;
}

void main() {
  float scale = nodeSize;

  NodeGeometryBundle geo = nodeGeometry(
    nodePosition,
    vertexPosition,
    scale,
    CameraMatrices(
      projection,
      view,
      orthoFixedProjection,
      orthoFixedView,
      orthoZoomedProjection,
      orthoZoomedView
    )
  );
  
  
  float distance = length(geo.globalNDC.xy - mousePosition);
  float nearness = bump(distance, 2.0, 1.0);

  vec4 clipPosition = geo.orthographicClipPosition;
  
  vec4 selectedColor = vec4(1.0, 1.0, 1.0, 1.0);
  
  #ifdef PICKER
    color = instanceIdToColor();
  #else
    color = mix(nodeColor, selectedColor, float(gl_InstanceID == selectedIndex));
  #endif

  normal = mat3(orthoFixedView) * vertexNormal;
  gl_Position = clipPosition;
}`,xn=`#version 300 es
precision highp float;
in vec4 color;
in vec3 normal;

in vec3 position;
out vec4 fragColor;

void main() {
  
  
  const vec3 lightDirection = normalize(vec3(0.0, 0.0, 1.0));
  float light = dot(normal, lightDirection);
  

  
  fragColor = vec4(color.xyz*light, color.a);
  
}`,gn=`#version 300 es
precision lowp float;

vec4 instanceIdToColor() {
  int instanceId = gl_InstanceID+1;
  float r = float(instanceId & 0x0000FF) / 255.0;
  float g = float((instanceId & 0x00FF00) >> 8) / 255.0;
  float b = float((instanceId & 0xFF0000) >> 16) / 255.0;

  return vec4(r, g, b, 1.0);
}

#define PICKER
layout(location=0) in vec3 nodePosition;
layout(location=1) in vec4 nodeColor;
layout(location=2) in float nodeSize;

layout(location=3) in vec3 vertexPosition;
layout(location=4) in vec3 vertexNormal;

uniform cameras {
  mat4 projection;
  mat4 view;
  mat4 orthoFixedProjection;
  mat4 orthoFixedView;
  mat4 orthoZoomedProjection;
  mat4 orthoZoomedView;
};

struct CameraMatrices {
  mat4 projection;
  mat4 view;
  mat4 orthoFixedProjection;
  mat4 orthoFixedView;
  mat4 orthoZoomedProjection;
  mat4 orthoZoomedView;
};

struct NodeGeometryBundle {
  vec3 globalNDC;
  vec4 globalClipPosition;
  vec4 orthoFixedClipPosition;
  vec4 orthoZoomedClipPosition;
  vec4 orthographicClipPosition;
};

NodeGeometryBundle nodeGeometry(
  in vec3 nodePosition,
  in vec3 vertexPosition,
  float scale,
  in CameraMatrices cam
) {
  vec4 globalClipPosition = cam.projection * cam.view * vec4(nodePosition, 1.0);
  vec3 globalNDC = globalClipPosition.xyz / globalClipPosition.w;

  vec4 orthoFixedClipPosition = cam.orthoFixedProjection * cam.orthoFixedView * vec4(vertexPosition*scale, 1.0);
  vec3 orthoFixedNDC = orthoFixedClipPosition.xyz / orthoFixedClipPosition.w;
  
  vec4 orthoZoomedClipPosition = cam.orthoZoomedProjection * cam.orthoZoomedView * vec4(vertexPosition*scale, 1.0)*0.5;
  vec3 orthoZoomedNDC = orthoZoomedClipPosition.xyz / orthoZoomedClipPosition.w;

  vec3 localNDC = mix(orthoZoomedNDC, orthoFixedNDC, 0.5);

  
  vec3 orthographicNDC = vec3(localNDC.xy + globalNDC.xy, globalNDC.z + (localNDC.z - 0.99)*0.2 );
  
  vec4 orthographicClipPosition = vec4(orthographicNDC * globalClipPosition.w, globalClipPosition.w);
  
  return NodeGeometryBundle(
    globalNDC,
    globalClipPosition,
    orthoFixedClipPosition,
    orthoZoomedClipPosition,
    orthographicClipPosition
  );
}

vec4 edgeGeometry(
  in vec3 nodePosition,
  in vec3 vertexPosition,
  in vec2 edgeDirection,
  float scale,
  in CameraMatrices cam
) {
  vec2 edgePerpendicular = vec2(-edgeDirection.y, edgeDirection.x)*scale/3.0;
  vec4 position = cam.projection * cam.view * vec4(nodePosition, 1.0);
  vec4 positionNDC = position / position.w;
  
  

  vec4 positionClip = vec4(position.xy + vertexPosition.y*1.0 * edgePerpendicular*50.0, position.zw);

  vec4 positionFixedStrokeNDC = positionNDC + vec4(vertexPosition.y * edgePerpendicular, 0.0, 0.0);
  vec4 positionFixedStrokeClip = positionFixedStrokeNDC * position.w;

  
  return mix(positionFixedStrokeClip, positionClip, 0.8);
}

uniform vec2 mousePosition;

uniform int selectedIndex;

#ifdef PICKER
  flat out vec4 color;
#else
  out vec4 color;
#endif

out vec3 position;
out vec3 normal;

float bump(float x, float q, float w) {
  float clamped_x = clamp(x/w, -0.5, 0.5);
  float y = pow(exp(1.0 - 1.0 / (1.0 - pow(2.0*clamped_x, 2.0))), q);
  return y;
}

void main() {
  float scale = nodeSize;

  NodeGeometryBundle geo = nodeGeometry(
    nodePosition,
    vertexPosition,
    scale,
    CameraMatrices(
      projection,
      view,
      orthoFixedProjection,
      orthoFixedView,
      orthoZoomedProjection,
      orthoZoomedView
    )
  );
  
  
  float distance = length(geo.globalNDC.xy - mousePosition);
  float nearness = bump(distance, 2.0, 1.0);

  vec4 clipPosition = geo.orthographicClipPosition;
  
  vec4 selectedColor = vec4(1.0, 1.0, 1.0, 1.0);
  
  #ifdef PICKER
    color = instanceIdToColor();
  #else
    color = mix(nodeColor, selectedColor, float(gl_InstanceID == selectedIndex));
  #endif

  normal = mat3(orthoFixedView) * vertexNormal;
  gl_Position = clipPosition;
}`,Sn=`#version 300 es
precision lowp float;

flat in vec4 color;
out vec4 fragColor;

void main() {
  fragColor = color;
}`;function Cn(t,e,r,n,s,o){t===void 0&&(t=1),e===void 0&&(e=t),r===void 0&&(r=t),n===void 0&&(n=1),s===void 0&&(s=n),o===void 0&&(o=n);var l=0,a=[],u=[],h=[],p=[];function f(T,S,v,O,b,B,x,d,V,W){for(var k=l,Y=0;Y<=x;Y++)for(var ee=0;ee<=B;ee++){var se=a[l]=[0,0,0];se[T]=(-O/2+ee*O/B)*V,se[S]=(-b/2+Y*b/x)*W,se[v]=d;var _e=u[l]=[0,0,0];_e[T]=0,_e[S]=0,_e[v]=d/Math.abs(d);var A=h[l]=[0,0];A[0]=ee/B,A[1]=1-Y/x,++l}for(var Y=0;Y<x;Y++)for(var ee=0;ee<B;ee++){var G=k+Y*(B+1)+ee;p.push([G,G+B+1,G+B+2]),p.push([G,G+B+2,G+1])}}return f(0,1,2,t,e,n,s,r/2,1,-1),f(0,1,2,t,e,n,s,-r/2,-1,-1),f(2,1,0,r,e,o,s,-t/2,1,-1),f(2,1,0,r,e,o,s,t/2,-1,-1),f(0,2,1,t,r,n,o,e/2,1,1),f(0,2,1,t,r,n,o,-e/2,1,-1),{positions:a,normals:u,uvs:h,cells:p}}var vn=Cn,Nn=1e-6,In=function(t,e,r){for(var n=e.length,s=new Array(n),o=r===void 0?Nn:r,l=0;l<n;++l)s[l]=[0,0,0];for(var l=0;l<t.length;++l)for(var a=t[l],u=0,h=a[a.length-1],p=a[0],f=0;f<a.length;++f){u=h,h=p,p=a[(f+1)%a.length];for(var T=e[u],S=e[h],v=e[p],O=new Array(3),b=0,B=new Array(3),x=0,d=0;d<3;++d)O[d]=T[d]-S[d],b+=O[d]*O[d],B[d]=v[d]-S[d],x+=B[d]*B[d];if(b*x>o)for(var V=s[h],W=1/Math.sqrt(b*x),d=0;d<3;++d){var k=(d+1)%3,Y=(d+2)%3;V[d]+=W*(B[k]*O[Y]-B[Y]*O[k])}}for(var l=0;l<n;++l){for(var V=s[l],ee=0,d=0;d<3;++d)ee+=V[d]*V[d];if(ee>o)for(var W=1/Math.sqrt(ee),d=0;d<3;++d)V[d]*=W;else for(var d=0;d<3;++d)V[d]=0}return s};function _i(t,e,r){var n=t[r]|0;if(n<=0)return[];var s=new Array(n),o;if(r===t.length-1)for(o=0;o<n;++o)s[o]=e;else for(o=0;o<n;++o)s[o]=_i(t,e,r+1);return s}function Dn(t,e){var r,n;for(r=new Array(t),n=0;n<t;++n)r[n]=e;return r}function Pn(t,e){switch(typeof e>"u"&&(e=0),typeof t){case"number":if(t>0)return Dn(t|0,e);break;case"object":if(typeof t.length=="number")return _i(t,e,0);break}return[]}var Fn=Pn,zt=Fn;function Be(t,e,r){return t+(r+1)*e}function Bn(t,e,r,n,s){r=r||[0,0],(!n||n.length<r.length)&&(n=zt(r.length),r.length>0&&(n[0]=1)),(!s||s.length<r.length)&&(s=zt(r.length),r.length>1&&(s[1]=1));var o=[],l=zt([(t+1)*(e+1),r.length]),a,u,h,p,f=r.length;for(u=0;u<e;++u)for(a=0;a<t;++a)o.push([Be(a,u,t),Be(a+1,u,t),Be(a,u+1,t)]),o.push([Be(a+1,u,t),Be(a+1,u+1,t),Be(a,u+1,t)]);for(u=0;u<=e;++u)for(a=0;a<=t;++a)for(p=l[Be(a,u,t)],h=0;h<f;++h)p[h]=r[h]+n[h]*a+s[h]*u;return{positions:l,cells:o}}var yn=Bn;const Mn=ne(()=>re().createProgram(Rn,xn)),On=ne(()=>re().createProgram(gn,Sn)),Ln=ne.infinite(()=>{const t=vn(1);console.log(t.positions.length,"bunny tris");const e=t.positions,r=t.cells,n=In(r,e),s=re().createVertexBuffer(H.FLOAT,3,new Float32Array(e.flat())),o=re().createIndexBuffer(H.UNSIGNED_SHORT,new Uint16Array(r.flat())),l=re().createVertexBuffer(H.FLOAT,3,new Float32Array(n.flat()));return re().createVertexArray().vertexAttributeBuffer(3,s).vertexAttributeBuffer(4,l).indexBuffer(o)}),di=()=>{const t=Ln(),e=Te().current,r=pe().current,n=Re().current;return t.instanceAttributeBuffer(0,e).instanceAttributeBuffer(1,r).instanceAttributeBuffer(2,n)},wr=ne.infinite(t=>{const e=re(),r=e.width,n=e.height;let s=e.createTexture2D(r,n,{internalFormat:H.RGBA8,minFilter:H.NEAREST,magFilter:H.NEAREST}),o=e.createRenderbuffer(r,n,H.DEPTH_COMPONENT16);return e.createFramebuffer().colorTarget(0,s).depthTarget(o)});class Un{constructor(e,r){this.A=e,this.B=r,this._current=e}swap(){this._current=this.current===this.A?this.B:this.A}get current(){return this._current}get other(){return this._current===this.A?this.B:this.A}}const Ai=ne.infinite(()=>{re();const t=wr("A"),e=wr("B");return new Un(t,e)}),wn=ne.infinite(()=>{const t=On(),e=di();return re().createDrawCall(t,e).primitive(H.TRIANGLES)}),bn=ne.infinite(()=>{const t=Mn(),e=di();return re().createDrawCall(t,e).primitive(H.TRIANGLES)}),Gn=ne(()=>re().createProgram(mn,pn)),Ti=20,mi=1,at=yn(Ti,mi);at.positions=at.positions.map(([t,e])=>[t/Ti,e/mi]);ne.infinite(t=>{const e=new Uint32Array(t.flat());return re().createIndexBuffer(H.UNSIGNED_INT,e)});const Hn=ne.infinite(t=>{const e=new Int32Array(t.flat());return re().createVertexBuffer(H.INT,2,e)}),Vn=ne.infinite(()=>{const t=re().createVertexBuffer(H.FLOAT,2,new Float32Array(at.positions.flat()));return console.log(at),t}),Xn=ne.infinite(()=>re().createIndexBuffer(H.UNSIGNED_SHORT,new Uint16Array(at.cells.flat()))),kn=ne.infinite(()=>re().createVertexArray()),zn=ne.infinite(t=>{const e=kn(),r=Hn(t),n=Vn(),s=Xn();return e.instanceAttributeBuffer(0,r).vertexAttributeBuffer(1,n).indexBuffer(s)});let pi;const $n=t=>{pi=t},Kn=()=>zn(pi),Wn=ne.infinite(()=>{const t=Gn(),e=Kn();return re().createDrawCall(t,e).primitive(H.TRIANGLES)}),Ri=Symbol("Comlink.proxy"),Yn=Symbol("Comlink.endpoint"),jn=Symbol("Comlink.releaseProxy"),cr=Symbol("Comlink.thrown"),xi=t=>typeof t=="object"&&t!==null||typeof t=="function",qn={canHandle:t=>xi(t)&&t[Ri],serialize(t){const{port1:e,port2:r}=new MessageChannel;return Si(t,e),[r,[r]]},deserialize(t){return t.start(),wt(t)}},Zn={canHandle:t=>xi(t)&&cr in t,serialize({value:t}){let e;return t instanceof Error?e={isError:!0,value:{message:t.message,name:t.name,stack:t.stack}}:e={isError:!1,value:t},[e,[]]},deserialize(t){throw t.isError?Object.assign(new Error(t.value.message),t.value):t.value}},gi=new Map([["proxy",qn],["throw",Zn]]);function Si(t,e=self){e.addEventListener("message",function r(n){if(!n||!n.data)return;const{id:s,type:o,path:l}=Object.assign({path:[]},n.data),a=(n.data.argumentList||[]).map(Me);let u;try{const h=l.slice(0,-1).reduce((f,T)=>f[T],t),p=l.reduce((f,T)=>f[T],t);switch(o){case"GET":u=p;break;case"SET":h[l.slice(-1)[0]]=Me(n.data.value),u=!0;break;case"APPLY":u=p.apply(h,a);break;case"CONSTRUCT":{const f=new p(...a);u=ot(f)}break;case"ENDPOINT":{const{port1:f,port2:T}=new MessageChannel;Si(t,T),u=es(f,[f])}break;case"RELEASE":u=void 0;break;default:return}}catch(h){u={value:h,[cr]:0}}Promise.resolve(u).catch(h=>({value:h,[cr]:0})).then(h=>{const[p,f]=Sr(h);e.postMessage(Object.assign(Object.assign({},p),{id:s}),f),o==="RELEASE"&&(e.removeEventListener("message",r),Ci(e))})}),e.start&&e.start()}function Qn(t){return t.constructor.name==="MessagePort"}function Ci(t){Qn(t)&&t.close()}function wt(t,e){return fr(t,[],e)}function Rt(t){if(t)throw new Error("Proxy has been released and is not useable")}function fr(t,e=[],r=function(){}){let n=!1;const s=new Proxy(r,{get(o,l){if(Rt(n),l===jn)return()=>we(t,{type:"RELEASE",path:e.map(a=>a.toString())}).then(()=>{Ci(t),n=!0});if(l==="then"){if(e.length===0)return{then:()=>s};const a=we(t,{type:"GET",path:e.map(u=>u.toString())}).then(Me);return a.then.bind(a)}return fr(t,[...e,l])},set(o,l,a){Rt(n);const[u,h]=Sr(a);return we(t,{type:"SET",path:[...e,l].map(p=>p.toString()),value:u},h).then(Me)},apply(o,l,a){Rt(n);const u=e[e.length-1];if(u===Yn)return we(t,{type:"ENDPOINT"}).then(Me);if(u==="bind")return fr(t,e.slice(0,-1));const[h,p]=br(a);return we(t,{type:"APPLY",path:e.map(f=>f.toString()),argumentList:h},p).then(Me)},construct(o,l){Rt(n);const[a,u]=br(l);return we(t,{type:"CONSTRUCT",path:e.map(h=>h.toString()),argumentList:a},u).then(Me)}});return s}function Jn(t){return Array.prototype.concat.apply([],t)}function br(t){const e=t.map(Sr);return[e.map(r=>r[0]),Jn(e.map(r=>r[1]))]}const vi=new WeakMap;function es(t,e){return vi.set(t,e),t}function ot(t){return Object.assign(t,{[Ri]:!0})}function Sr(t){for(const[e,r]of gi)if(r.canHandle(t)){const[n,s]=r.serialize(t);return[{type:"HANDLER",name:e,value:n},s]}return[{type:"RAW",value:t},vi.get(t)||[]]}function Me(t){switch(t.type){case"HANDLER":return gi.get(t.name).deserialize(t.value);case"RAW":return t.value}}function we(t,e,r){return new Promise(n=>{const s=ts();t.addEventListener("message",function o(l){!l.data||!l.data.id||l.data.id!==s||(t.removeEventListener("message",o),n(l.data))}),t.start&&t.start(),t.postMessage(Object.assign({id:s},e),r)})}function ts(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}var rs=typeof global=="object"&&global&&global.Object===Object&&global;const is=rs;var ns=typeof self=="object"&&self&&self.Object===Object&&self,ss=is||ns||Function("return this")();const Et=ss;var as=Et.Symbol;const Bt=as;var Ni=Object.prototype,os=Ni.hasOwnProperty,ls=Ni.toString,qe=Bt?Bt.toStringTag:void 0;function us(t){var e=os.call(t,qe),r=t[qe];try{t[qe]=void 0;var n=!0}catch{}var s=ls.call(t);return n&&(e?t[qe]=r:delete t[qe]),s}var hs=Object.prototype,cs=hs.toString;function fs(t){return cs.call(t)}var Es="[object Null]",_s="[object Undefined]",Gr=Bt?Bt.toStringTag:void 0;function Ii(t){return t==null?t===void 0?_s:Es:Gr&&Gr in Object(t)?us(t):fs(t)}function ds(t){return t!=null&&typeof t=="object"}var As="[object Symbol]";function Ts(t){return typeof t=="symbol"||ds(t)&&Ii(t)==As}var ms=/\s/;function ps(t){for(var e=t.length;e--&&ms.test(t.charAt(e)););return e}var Rs=/^\s+/;function xs(t){return t&&t.slice(0,ps(t)+1).replace(Rs,"")}function Xe(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}var Hr=0/0,gs=/^[-+]0x[0-9a-f]+$/i,Ss=/^0b[01]+$/i,Cs=/^0o[0-7]+$/i,vs=parseInt;function Vr(t){if(typeof t=="number")return t;if(Ts(t))return Hr;if(Xe(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=Xe(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=xs(t);var r=Ss.test(t);return r||Cs.test(t)?vs(t.slice(2),r?2:8):gs.test(t)?Hr:+t}function ke(t){return t}var Ns="[object AsyncFunction]",Is="[object Function]",Ds="[object GeneratorFunction]",Ps="[object Proxy]";function Fs(t){if(!Xe(t))return!1;var e=Ii(t);return e==Is||e==Ds||e==Ns||e==Ps}var Bs=Et["__core-js_shared__"];const $t=Bs;var Xr=function(){var t=/[^.]+$/.exec($t&&$t.keys&&$t.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}();function ys(t){return!!Xr&&Xr in t}var Ms=Function.prototype,Os=Ms.toString;function Ls(t){if(t!=null){try{return Os.call(t)}catch{}try{return t+""}catch{}}return""}var Us=/[\\^$.*+?()[\]{}|]/g,ws=/^\[object .+?Constructor\]$/,bs=Function.prototype,Gs=Object.prototype,Hs=bs.toString,Vs=Gs.hasOwnProperty,Xs=RegExp("^"+Hs.call(Vs).replace(Us,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function ks(t){if(!Xe(t)||ys(t))return!1;var e=Fs(t)?Xs:ws;return e.test(Ls(t))}function zs(t,e){return t?.[e]}function Cr(t,e){var r=zs(t,e);return ks(r)?r:void 0}function $s(){}function Ks(t,e,r,n){for(var s=t.length,o=r+(n?1:-1);n?o--:++o<s;)if(e(t[o],o,t))return o;return-1}function Ws(t){return t!==t}function Ys(t,e,r){for(var n=r-1,s=t.length;++n<s;)if(t[n]===e)return n;return-1}function js(t,e,r){return e===e?Ys(t,e,r):Ks(t,Ws,r)}function qs(t,e){var r=t==null?0:t.length;return!!r&&js(t,e,0)>-1}function Zs(t,e){return t===e||t!==t&&e!==e}var Qs=Cr(Object,"create");const lt=Qs;function Js(){this.__data__=lt?lt(null):{},this.size=0}function ea(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}var ta="__lodash_hash_undefined__",ra=Object.prototype,ia=ra.hasOwnProperty;function na(t){var e=this.__data__;if(lt){var r=e[t];return r===ta?void 0:r}return ia.call(e,t)?e[t]:void 0}var sa=Object.prototype,aa=sa.hasOwnProperty;function oa(t){var e=this.__data__;return lt?e[t]!==void 0:aa.call(e,t)}var la="__lodash_hash_undefined__";function ua(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=lt&&e===void 0?la:e,this}function Oe(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}Oe.prototype.clear=Js;Oe.prototype.delete=ea;Oe.prototype.get=na;Oe.prototype.has=oa;Oe.prototype.set=ua;function ha(){this.__data__=[],this.size=0}function bt(t,e){for(var r=t.length;r--;)if(Zs(t[r][0],e))return r;return-1}var ca=Array.prototype,fa=ca.splice;function Ea(t){var e=this.__data__,r=bt(e,t);if(r<0)return!1;var n=e.length-1;return r==n?e.pop():fa.call(e,r,1),--this.size,!0}function _a(t){var e=this.__data__,r=bt(e,t);return r<0?void 0:e[r][1]}function da(t){return bt(this.__data__,t)>-1}function Aa(t,e){var r=this.__data__,n=bt(r,t);return n<0?(++this.size,r.push([t,e])):r[n][1]=e,this}function We(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}We.prototype.clear=ha;We.prototype.delete=Ea;We.prototype.get=_a;We.prototype.has=da;We.prototype.set=Aa;var Ta=Cr(Et,"Map");const ma=Ta;function pa(){this.size=0,this.__data__={hash:new Oe,map:new(ma||We),string:new Oe}}function Ra(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}function Gt(t,e){var r=t.__data__;return Ra(e)?r[typeof e=="string"?"string":"hash"]:r.map}function xa(t){var e=Gt(this,t).delete(t);return this.size-=e?1:0,e}function ga(t){return Gt(this,t).get(t)}function Sa(t){return Gt(this,t).has(t)}function Ca(t,e){var r=Gt(this,t),n=r.size;return r.set(t,e),this.size+=r.size==n?0:1,this}function Ye(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}Ye.prototype.clear=pa;Ye.prototype.delete=xa;Ye.prototype.get=ga;Ye.prototype.has=Sa;Ye.prototype.set=Ca;var va=Cr(Et,"Set");const Kt=va;var Na="__lodash_hash_undefined__";function Ia(t){return this.__data__.set(t,Na),this}function Da(t){return this.__data__.has(t)}function yt(t){var e=-1,r=t==null?0:t.length;for(this.__data__=new Ye;++e<r;)this.add(t[e])}yt.prototype.add=yt.prototype.push=Ia;yt.prototype.has=Da;function Pa(t,e){return t.has(e)}function Di(t){var e=-1,r=Array(t.size);return t.forEach(function(n){r[++e]=n}),r}var Fa=function(){return Et.Date.now()};const Wt=Fa;var Ba="Expected a function",ya=Math.max,Ma=Math.min;function Oa(t,e,r){var n,s,o,l,a,u,h=0,p=!1,f=!1,T=!0;if(typeof t!="function")throw new TypeError(Ba);e=Vr(e)||0,Xe(r)&&(p=!!r.leading,f="maxWait"in r,o=f?ya(Vr(r.maxWait)||0,e):o,T="trailing"in r?!!r.trailing:T);function S(k){var Y=n,ee=s;return n=s=void 0,h=k,l=t.apply(ee,Y),l}function v(k){return h=k,a=setTimeout(B,e),p?S(k):l}function O(k){var Y=k-u,ee=k-h,se=e-Y;return f?Ma(se,o-ee):se}function b(k){var Y=k-u,ee=k-h;return u===void 0||Y>=e||Y<0||f&&ee>=o}function B(){var k=Wt();if(b(k))return x(k);a=setTimeout(B,O(k))}function x(k){return a=void 0,T&&n?S(k):(n=s=void 0,l)}function d(){a!==void 0&&clearTimeout(a),h=0,n=u=s=a=void 0}function V(){return a===void 0?l:x(Wt())}function W(){var k=Wt(),Y=b(k);if(n=arguments,s=this,u=k,Y){if(a===void 0)return v(u);if(f)return clearTimeout(a),a=setTimeout(B,e),S(u)}return a===void 0&&(a=setTimeout(B,e)),l}return W.cancel=d,W.flush=V,W}function La(t,e,r){for(var n=-1,s=t==null?0:t.length;++n<s;)if(r(e,t[n]))return!0;return!1}function xt(t){for(var e=-1,r=t==null?0:t.length,n={};++e<r;){var s=t[e];n[s[0]]=s[1]}return n}var Ua="Expected a function";function vr(t,e,r){var n=!0,s=!0;if(typeof t!="function")throw new TypeError(Ua);return Xe(r)&&(n="leading"in r?!!r.leading:n,s="trailing"in r?!!r.trailing:s),Oa(t,e,{leading:n,maxWait:e,trailing:s})}var wa=1/0,ba=Kt&&1/Di(new Kt([,-0]))[1]==wa?function(t){return new Kt(t)}:$s;const Ga=ba;var Ha=200;function Va(t,e,r){var n=-1,s=qs,o=t.length,l=!0,a=[],u=a;if(r)l=!1,s=La;else if(o>=Ha){var h=e?null:Ga(t);if(h)return Di(h);l=!1,s=Pa,u=new yt}else u=e?[]:a;e:for(;++n<o;){var p=t[n],f=e?e(p):p;if(p=r||p!==0?p:0,l&&f===f){for(var T=u.length;T--;)if(u[T]===f)continue e;e&&u.push(f),a.push(p)}else s(u,f,r)||(u!==a&&u.push(f),a.push(p))}return a}function Xa(t,e){return e=typeof e=="function"?e:void 0,t&&t.length?Va(t,void 0,e):[]}const Mt=ne.infinite(()=>re().createUniformBuffer([H.FLOAT_MAT4,H.FLOAT_MAT4,H.FLOAT_MAT4,H.FLOAT_MAT4,H.FLOAT_MAT4,H.FLOAT_MAT4])),ka=ot(vr((t,e,r,n,s,o)=>{Mt().set(0,t).set(1,e).set(2,r).set(3,n).set(4,s).set(5,o).update()},1));var _t={};function za(t){if(typeof t=="object"){if("buttons"in t)return t.buttons;if("which"in t){var e=t.which;if(e===2)return 4;if(e===3)return 2;if(e>0)return 1<<e-1}else if("button"in t){var e=t.button;if(e===1)return 4;if(e===2)return 2;if(e>=0)return 1<<e}}return 0}_t.buttons=za;function Nr(t){return t.target||t.srcElement||window}_t.element=Nr;function $a(t){if(typeof t=="object"){if("offsetX"in t)return t.offsetX;var e=Nr(t),r=e.getBoundingClientRect();return t.clientX-r.left}return 0}_t.x=$a;function Ka(t){if(typeof t=="object"){if("offsetY"in t)return t.offsetY;var e=Nr(t),r=e.getBoundingClientRect();return t.clientY-r.top}return 0}_t.y=Ka;var Wa=Ya,Ze=_t;function Ya(t,e){e||(e=t,t=window);var r=0,n=0,s=0,o={shift:!1,alt:!1,control:!1,meta:!1},l=!1;function a(x){var d=!1;return"altKey"in x&&(d=d||x.altKey!==o.alt,o.alt=!!x.altKey),"shiftKey"in x&&(d=d||x.shiftKey!==o.shift,o.shift=!!x.shiftKey),"ctrlKey"in x&&(d=d||x.ctrlKey!==o.control,o.control=!!x.ctrlKey),"metaKey"in x&&(d=d||x.metaKey!==o.meta,o.meta=!!x.metaKey),d}function u(x,d){var V=Ze.x(d),W=Ze.y(d);"buttons"in d&&(x=d.buttons|0),(x!==r||V!==n||W!==s||a(d))&&(r=x|0,n=V||0,s=W||0,e&&e(r,n,s,o))}function h(x){u(0,x)}function p(){(r||n||s||o.shift||o.alt||o.meta||o.control)&&(n=s=0,r=0,o.shift=o.alt=o.control=o.meta=!1,e&&e(0,0,0,o))}function f(x){a(x)&&e&&e(r,n,s,o)}function T(x){Ze.buttons(x)===0?u(0,x):u(r,x)}function S(x){u(r|Ze.buttons(x),x)}function v(x){u(r&~Ze.buttons(x),x)}function O(){l||(l=!0,t.addEventListener("mousemove",T),t.addEventListener("mousedown",S),t.addEventListener("mouseup",v),t.addEventListener("mouseleave",h),t.addEventListener("mouseenter",h),t.addEventListener("mouseout",h),t.addEventListener("mouseover",h),t.addEventListener("blur",p),t.addEventListener("keyup",f),t.addEventListener("keydown",f),t.addEventListener("keypress",f),t!==window&&(window.addEventListener("blur",p),window.addEventListener("keyup",f),window.addEventListener("keydown",f),window.addEventListener("keypress",f)))}function b(){l&&(l=!1,t.removeEventListener("mousemove",T),t.removeEventListener("mousedown",S),t.removeEventListener("mouseup",v),t.removeEventListener("mouseleave",h),t.removeEventListener("mouseenter",h),t.removeEventListener("mouseout",h),t.removeEventListener("mouseover",h),t.removeEventListener("blur",p),t.removeEventListener("keyup",f),t.removeEventListener("keydown",f),t.removeEventListener("keypress",f),t!==window&&(window.removeEventListener("blur",p),window.removeEventListener("keyup",f),window.removeEventListener("keydown",f),window.removeEventListener("keypress",f)))}O();var B={element:t};return Object.defineProperties(B,{enabled:{get:function(){return l},set:function(x){x?O():b()},enumerable:!0},buttons:{get:function(){return r},enumerable:!0},x:{get:function(){return n},enumerable:!0},y:{get:function(){return s},enumerable:!0},mods:{get:function(){return o},enumerable:!0}}),B}var ja={left:0,top:0},qa=Za;function Za(t,e,r){e=e||t.currentTarget||t.srcElement,Array.isArray(r)||(r=[0,0]);var n=t.clientX||0,s=t.clientY||0,o=Qa(e);return r[0]=n-o.left,r[1]=s-o.top,r}function Qa(t){return t===window||t===document||t===document.body?ja:t.getBoundingClientRect()}var Ot={},Ja={get exports(){return Ot},set exports(t){Ot=t}},Er={},eo={get exports(){return Er},set exports(t){Er=t}},to=void 0,Pi=function(t){return t!==to&&t!==null},ro=Pi,io={object:!0,function:!0,undefined:!0},no=function(t){return ro(t)?hasOwnProperty.call(io,typeof t):!1},so=no,ao=function(t){if(!so(t))return!1;try{return t.constructor?t.constructor.prototype===t:!1}catch{return!1}},oo=ao,lo=function(t){if(typeof t!="function"||!hasOwnProperty.call(t,"length"))return!1;try{if(typeof t.length!="number"||typeof t.call!="function"||typeof t.apply!="function")return!1}catch{return!1}return!oo(t)},uo=lo,ho=/^\s*class[\s{/}]/,co=Function.prototype.toString,fo=function(t){return!(!uo(t)||ho.test(co.call(t)))},Eo=function(){var t=Object.assign,e;return typeof t!="function"?!1:(e={foo:"raz"},t(e,{bar:"dwa"},{trzy:"trzy"}),e.foo+e.bar+e.trzy==="razdwatrzy")},Yt,kr;function _o(){return kr||(kr=1,Yt=function(){try{return Object.keys("primitive"),!0}catch{return!1}}),Yt}var Ao=function(){},To=Ao(),Ir=function(t){return t!==To&&t!==null},jt,zr;function mo(){if(zr)return jt;zr=1;var t=Ir,e=Object.keys;return jt=function(r){return e(t(r)?Object(r):r)},jt}var qt,$r;function po(){return $r||($r=1,qt=_o()()?Object.keys:mo()),qt}var Zt,Kr;function Ro(){if(Kr)return Zt;Kr=1;var t=Ir;return Zt=function(e){if(!t(e))throw new TypeError("Cannot use null or undefined");return e},Zt}var Qt,Wr;function xo(){if(Wr)return Qt;Wr=1;var t=po(),e=Ro(),r=Math.max;return Qt=function(n,s){var o,l,a=r(arguments.length,2),u;for(n=Object(e(n)),u=function(h){try{n[h]=s[h]}catch(p){o||(o=p)}},l=1;l<a;++l)s=arguments[l],t(s).forEach(u);if(o!==void 0)throw o;return n},Qt}var go=Eo()?Object.assign:xo(),So=Ir,Co=Array.prototype.forEach,vo=Object.create,No=function(t,e){var r;for(r in t)e[r]=t[r]},Io=function(t){var e=vo(null);return Co.call(arguments,function(r){So(r)&&No(Object(r),e)}),e},Jt="razdwatrzy",Do=function(){return typeof Jt.contains!="function"?!1:Jt.contains("dwa")===!0&&Jt.contains("foo")===!1},er,Yr;function Po(){if(Yr)return er;Yr=1;var t=String.prototype.indexOf;return er=function(e){return t.call(this,e,arguments[1])>-1},er}var Fo=Do()?String.prototype.contains:Po(),Ct=Pi,jr=fo,Fi=go,Bi=Io,it=Fo,Bo=eo.exports=function(t,e){var r,n,s,o,l;return arguments.length<2||typeof t!="string"?(o=e,e=t,t=null):o=arguments[2],Ct(t)?(r=it.call(t,"c"),n=it.call(t,"e"),s=it.call(t,"w")):(r=s=!0,n=!1),l={value:e,configurable:r,enumerable:n,writable:s},o?Fi(Bi(o),l):l};Bo.gs=function(t,e,r){var n,s,o,l;return typeof t!="string"?(o=r,r=e,e=t,t=null):o=arguments[3],Ct(e)?jr(e)?Ct(r)?jr(r)||(o=r,r=void 0):r=void 0:(o=e,e=r=void 0):e=void 0,Ct(t)?(n=it.call(t,"c"),s=it.call(t,"e")):(n=!0,s=!1),l={get:e,set:r,configurable:n,enumerable:s},o?Fi(Bi(o),l):l};var yo=function(t){if(typeof t!="function")throw new TypeError(t+" is not a function");return t};(function(t,e){var r=Er,n=yo,s=Function.prototype.apply,o=Function.prototype.call,l=Object.create,a=Object.defineProperty,u=Object.defineProperties,h=Object.prototype.hasOwnProperty,p={configurable:!0,enumerable:!1,writable:!0},f,T,S,v,O,b,B;f=function(x,d){var V;return n(d),h.call(this,"__ee__")?V=this.__ee__:(V=p.value=l(null),a(this,"__ee__",p),p.value=null),V[x]?typeof V[x]=="object"?V[x].push(d):V[x]=[V[x],d]:V[x]=d,this},T=function(x,d){var V,W;return n(d),W=this,f.call(this,x,V=function(){S.call(W,x,V),s.call(d,this,arguments)}),V.__eeOnceListener__=d,this},S=function(x,d){var V,W,k,Y;if(n(d),!h.call(this,"__ee__"))return this;if(V=this.__ee__,!V[x])return this;if(W=V[x],typeof W=="object")for(Y=0;k=W[Y];++Y)(k===d||k.__eeOnceListener__===d)&&(W.length===2?V[x]=W[Y?0:1]:W.splice(Y,1));else(W===d||W.__eeOnceListener__===d)&&delete V[x];return this},v=function(x){var d,V,W,k,Y;if(h.call(this,"__ee__")&&(k=this.__ee__[x],!!k))if(typeof k=="object"){for(V=arguments.length,Y=new Array(V-1),d=1;d<V;++d)Y[d-1]=arguments[d];for(k=k.slice(),d=0;W=k[d];++d)s.call(W,this,Y)}else switch(arguments.length){case 1:o.call(k,this);break;case 2:o.call(k,this,arguments[1]);break;case 3:o.call(k,this,arguments[1],arguments[2]);break;default:for(V=arguments.length,Y=new Array(V-1),d=1;d<V;++d)Y[d-1]=arguments[d];s.call(k,this,Y)}},O={on:f,once:T,off:S,emit:v},b={on:r(f),once:r(T),off:r(S),emit:r(v)},B=u({},b),t.exports=e=function(x){return x==null?l(B):u(Object(x),b)},e.methods=O})(Ja,Ot);var _r=Lo,Mo=Wa,be=qa,Oo=Ot;function Lo(t){t=t||window;var e=Oo(),r=[null,null],n=[null,null],s=[null,null],o=[null,null],l=0,a={},u,h,p=t===window?function(){u=window.innerWidth,h=window.innerHeight}:function(){u=t.clientWidth,h=t.clientHeight},f=0,T,S,v={},O=Mo(t,function(N,g,z,X){T=g,S=z,f=N,v=X});function b(N){be(N,t,s),p(),a.buttons=f,a.mods=v,a.x0=a.x=a.x1=2*s[0]/u-1,a.y0=a.y=a.y1=1-2*s[1]/h,a.x2=null,a.y2=null,a.dx=2*N.deltaX/u,a.dy=-2*N.deltaY/h,a.dz=2*N.deltaZ/u,a.active=1,a.zoomx=1,a.zoomy=1,a.theta=0,a.dtheta=0,a.originalEvent=N,e.emit("wheel",a),r[0]=s[0],r[1]=s[1]}var B=null,x=null,d=0;function V(N){be(N,t,s),d=0,p(),a.buttons=f,a.mods=v,a.x=a.x1=2*s[0]/u-1,a.y=a.y1=1-2*s[1]/h,a.x2=null,a.y2=null,a.active=d,a.x0=2*B/u-1,a.y0=1-2*x/h,a.dx=0,a.dy=0,a.dz=0,a.zoomx=1,a.zoomy=1,a.theta=0,a.dtheta=0,a.originalEvent=N,e.emit("mouseup",a),B=x=null,r[0]=s[0],r[1]=s[1]}function W(N){be(N,t,s),d=1,p(),B=T,x=S,a.buttons=f,a.mods=v,a.x=a.x0=a.x1=2*s[0]/u-1,a.y=a.y0=a.y1=1-2*s[1]/h,a.x2=null,a.y2=null,a.active=d,a.dx=0,a.dy=0,a.dz=0,a.zoomx=1,a.zoomy=1,a.theta=0,a.dtheta=0,a.originalEvent=N,e.emit("mousedown",a),r[0]=s[0],r[1]=s[1]}function k(N){be(N,t,s),p(),a.buttons=f,a.mods=v,a.x0=2*B/u-1,a.y0=1-2*x/h,a.x=a.x1=2*s[0]/u-1,a.y=a.y1=1-2*s[1]/h,a.x2=null,a.y2=null,a.dx=2*(s[0]-r[0])/u,a.dy=-2*(s[1]-r[1])/h,a.active=d,a.dz=0,a.zoomx=1,a.zoomy=1,a.theta=0,a.dtheta=0,a.originalEvent=N,e.emit("mousemove",a),r[0]=s[0],r[1]=s[1]}function Y(N){for(var g=N.identifier,z=0;z<o.length;z++)if(o[z]&&o[z].touch&&o[z].touch.identifier===g)return z;return-1}function ee(N){n[0]=null,n[1]=null;for(var g=0;g<N.changedTouches.length;g++){var z=N.changedTouches[g],X=z.identifier,Q=Y(X);if(Q===-1&&l<2){var le=o[0]?1:0,ue=o[0]?0:1,L={position:[0,0],touch:null};o[le]=L,l++,L.touch=z,be(z,t,L.position),o[ue]&&o[ue].touch}}for(var E=0,R=0,I=0,g=0;g<o.length;g++)o[g]&&(E+=o[g].position[0],R+=o[g].position[1],I++);if(E/=I,R/=I,l>0){if(a.theta=0,I>1){var w=o[1].position[0]-o[0].position[0],m=(o[0].position[1]-o[1].position[1])*u/h;a.theta=Math.atan2(m,w)}p(),a.buttons=0,a.mods={},a.active=l,B=E,x=R,a.x0=2*B/u-1,a.y0=1-2*x/h,a.x=2*E/u-1,a.y=1-2*R/h,a.x1=2*o[0].position[0]/u-1,a.y1=1-2*o[0].position[1]/h,l>1&&(a.x2=2*o[1].position[0]/u-1,a.y2=1-2*o[1].position[1]/h),a.active=l,a.dx=0,a.dy=0,a.dz=0,a.zoomx=1,a.zoomy=1,a.dtheta=0,a.originalEvent=N,e.emit(l===1?"touchstart":"pinchstart",a)}}function se(N){for(var g,z=!1,X=0;X<N.changedTouches.length;X++){var Q=N.changedTouches[X];g=Y(Q),g!==-1&&(z=!0,o[g].touch=Q,be(Q,t,o[g].position))}if(z){if(l===1){for(g=0;g<o.length&&!o[g];g++);if(o[g]&&n[g]){var le=o[g].position[0],ue=o[g].position[1],L=le-n[g][0],E=ue-n[g][1];a.buttons=0,a.mods={},a.active=l,a.x=a.x1=2*le/u-1,a.y=a.y1=1-2*ue/h,a.x2=null,a.y2=null,a.x0=2*B/u-1,a.y0=1-2*x/h,a.dx=2*L/u,a.dy=-2*E/h,a.dz=0,a.zoomx=1,a.zoomy=1,a.theta=0,a.dtheta=0,a.originalEvent=N,e.emit("touchmove",a)}}else if(l===2&&n[0]&&n[1]){var R=n[0],I=n[1],w=I[0]-R[0],m=(I[1]-R[1])*u/h,F=o[0].position,U=o[1].position,ie=U[0]-F[0],ae=(F[1]-U[1])*u/h,fe=Math.sqrt(w*w+m*m)*.5,oe=Math.atan2(m,w),K=Math.sqrt(ie*ie+ae*ae)*.5,te=Math.atan2(ae,ie),c=(I[0]+R[0])*.5,_=(I[1]+R[1])*.5,L=.5*(U[0]+F[0]-R[0]-I[0]),E=.5*(U[1]+F[1]-R[1]-I[1]),D=K/fe,C=te-oe;a.buttons=0,a.mods=v,a.active=l,a.x=2*c/u-1,a.y=1-2*_/h,a.x0=2*B/u-1,a.y0=1-2*x/h,a.x1=2*F[0]/u-1,a.y1=1-2*F[1]/h,a.x2=2*U[0]/u-1,a.y2=1-2*U[1]/h,a.dx=2*L/u,a.dy=-2*E/h,a.dz=0,a.zoomx=D,a.zoomy=D,a.theta=te,a.dtheta=C,a.originalEvent=N,e.emit("pinchmove",a)}}o[0]&&(n[0]=o[0].position.slice()),o[1]&&(n[1]=o[1].position.slice())}function _e(N){for(var g,z=0;z<N.changedTouches.length;z++){var X=N.changedTouches[z],Q=Y(X);if(Q!==-1){g=o[Q],o[Q]=null,l--;var le=Q===0?1:0;o[le]&&o[le].touch}}var ue=0,L=0;if(l===0)g&&(ue=g.position[0],L=g.position[1]);else{for(var E=0,z=0;z<o.length;z++)o[z]&&(ue+=o[z].position[0],L+=o[z].position[1],E++);ue/=E,L/=E}l<2&&(a.buttons=0,a.mods=v,a.active=l,a.x=2*ue/u-1,a.y=1-2*L/h,a.x0=2*B/u-1,a.y0=1-2*x/h,a.dx=0,a.dy=0,a.dz=0,a.zoomx=1,a.zoomy=1,a.theta=0,a.dtheta=0,a.originalEvent=N,e.emit(l===0?"touchend":"pinchend",a)),l===0&&(B=x=null)}var A=!1;function G(){A||(A=!0,O.enabled=!0,t.addEventListener("wheel",b,!1),t.addEventListener("mousedown",W,!1),window.addEventListener("mousemove",k,!1),window.addEventListener("mouseup",V,!1),t.addEventListener("touchstart",ee,!1),window.addEventListener("touchmove",se,!1),window.addEventListener("touchend",_e,!1),window.addEventListener("touchcancel",_e,!1))}function $(){A&&(A=!1,O.enabled=!1,t.removeEventListener("wheel",b,!1),t.removeEventListener("mousedown",W,!1),window.removeEventListener("mousemove",k,!1),window.removeEventListener("mouseup",V,!1),t.removeEventListener("touchstart",ee,!1),window.removeEventListener("touchmove",se,!1),window.removeEventListener("touchend",_e,!1),window.removeEventListener("touchcancel",_e,!1))}return G(),e.enable=G,e.disable=$,e}function Uo(){return new Worker("/dat-garden-visualization/assets/graph-db-worker-571b24c8.js",{type:"module"})}function wo(){return new Worker("/dat-garden-visualization/assets/graph-layout-worker-b7703693.js",{type:"module"})}const yi=new Array(128).fill(void 0);yi.push(void 0,null,!0,!1);const bo=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});bo.decode();yi.length;const tr=new TextEncoder("utf-8");tr.encodeInto;var Mi={};(function(t){var e=ve&&ve.__extends||function(){var L=function(E,R){return L=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(I,w){I.__proto__=w}||function(I,w){for(var m in w)Object.prototype.hasOwnProperty.call(w,m)&&(I[m]=w[m])},L(E,R)};return function(E,R){if(typeof R!="function"&&R!==null)throw new TypeError("Class extends value "+String(R)+" is not a constructor or null");L(E,R);function I(){this.constructor=E}E.prototype=R===null?Object.create(R):(I.prototype=R.prototype,new I)}}(),r=ve&&ve.__classPrivateFieldSet||function(L,E,R){if(!E.has(L))throw new TypeError("attempted to set private field on non-instance");return E.set(L,R),R},n=ve&&ve.__classPrivateFieldGet||function(L,E){if(!E.has(L))throw new TypeError("attempted to get private field on non-instance");return E.get(L)},s,o,l,a,u,h,p,f,T,S,v,O,b,B,x,d,V,W,k,Y,ee,se;t.__esModule=!0,t.default=void 0;var _e=function(L){var E=131,R=137,I=0;L+="x";for(var w=Math.floor(9007199254740991/R),m=0;m<L.length;m++)I>w&&(I=Math.floor(I/R)),I=I*E+L.charCodeAt(m);return I},A="0123456789abcdef".split(""),G=[-2147483648,8388608,32768,128],$=[24,16,8,0],N=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],g=[],z=function(){function L(E,R){E===void 0&&(E=!1),R===void 0&&(R=!1),s.set(this,void 0),o.set(this,void 0),l.set(this,void 0),a.set(this,void 0),u.set(this,void 0),h.set(this,void 0),p.set(this,void 0),f.set(this,void 0),T.set(this,void 0),S.set(this,void 0),v.set(this,void 0),O.set(this,void 0),b.set(this,void 0),B.set(this,void 0),x.set(this,void 0),d.set(this,void 0),V.set(this,0),W.set(this,void 0),this.init(E,R)}return L.prototype.init=function(E,R){R?(g[0]=g[16]=g[1]=g[2]=g[3]=g[4]=g[5]=g[6]=g[7]=g[8]=g[9]=g[10]=g[11]=g[12]=g[13]=g[14]=g[15]=0,r(this,o,g)):r(this,o,[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),E?(r(this,h,3238371032),r(this,p,914150663),r(this,f,812702999),r(this,T,4144912697),r(this,S,4290775857),r(this,v,1750603025),r(this,O,1694076839),r(this,b,3204075428)):(r(this,h,1779033703),r(this,p,3144134277),r(this,f,1013904242),r(this,T,2773480762),r(this,S,1359893119),r(this,v,2600822924),r(this,O,528734635),r(this,b,1541459225)),r(this,s,r(this,W,r(this,l,r(this,x,0)))),r(this,a,r(this,B,!1)),r(this,u,!0),r(this,d,E)},L.prototype.update=function(E){if(n(this,a))return this;var R;E instanceof ArrayBuffer?R=new Uint8Array(E):R=E;for(var I=0,w=R.length,m=n(this,o);I<w;){var F=void 0;if(n(this,B)&&(r(this,B,!1),m[0]=n(this,s),m[16]=m[1]=m[2]=m[3]=m[4]=m[5]=m[6]=m[7]=m[8]=m[9]=m[10]=m[11]=m[12]=m[13]=m[14]=m[15]=0),typeof R!="string")for(F=n(this,W);I<w&&F<64;++I)m[F>>2]|=R[I]<<$[F++&3];else for(F=n(this,W);I<w&&F<64;++I){var U=R.charCodeAt(I);U<128?m[F>>2]|=U<<$[F++&3]:U<2048?(m[F>>2]|=(192|U>>6)<<$[F++&3],m[F>>2]|=(128|U&63)<<$[F++&3]):U<55296||U>=57344?(m[F>>2]|=(224|U>>12)<<$[F++&3],m[F>>2]|=(128|U>>6&63)<<$[F++&3],m[F>>2]|=(128|U&63)<<$[F++&3]):(U=65536+((U&1023)<<10|R.charCodeAt(++I)&1023),m[F>>2]|=(240|U>>18)<<$[F++&3],m[F>>2]|=(128|U>>12&63)<<$[F++&3],m[F>>2]|=(128|U>>6&63)<<$[F++&3],m[F>>2]|=(128|U&63)<<$[F++&3])}r(this,V,F),r(this,l,n(this,l)+(F-n(this,W))),F>=64?(r(this,s,m[16]),r(this,W,F-64),this.hash(),r(this,B,!0)):r(this,W,F)}return n(this,l)>4294967295&&(r(this,x,n(this,x)+(n(this,l)/4294967296<<0)),r(this,l,n(this,l)%4294967296)),this},L.prototype.finalize=function(){if(!n(this,a)){r(this,a,!0);var E=n(this,o),R=n(this,V);E[16]=n(this,s),E[R>>2]|=G[R&3],r(this,s,E[16]),R>=56&&(n(this,B)||this.hash(),E[0]=n(this,s),E[16]=E[1]=E[2]=E[3]=E[4]=E[5]=E[6]=E[7]=E[8]=E[9]=E[10]=E[11]=E[12]=E[13]=E[14]=E[15]=0),E[14]=n(this,x)<<3|n(this,l)>>>29,E[15]=n(this,l)<<3,this.hash()}},L.prototype.hash=function(){for(var E=n(this,h),R=n(this,p),I=n(this,f),w=n(this,T),m=n(this,S),F=n(this,v),U=n(this,O),ie=n(this,b),ae=n(this,o),fe,oe,K,te,c,_,D,C,M,P,y=16;y<64;++y)te=ae[y-15],fe=(te>>>7|te<<25)^(te>>>18|te<<14)^te>>>3,te=ae[y-2],oe=(te>>>17|te<<15)^(te>>>19|te<<13)^te>>>10,ae[y]=ae[y-16]+fe+ae[y-7]+oe<<0;P=R&I;for(var j=0;j<64;j+=4)n(this,u)?(n(this,d)?(D=300032,te=ae[0]-1413257819,ie=te-150054599<<0,w=te+24177077<<0):(D=704751109,te=ae[0]-210244248,ie=te-1521486534<<0,w=te+143694565<<0),r(this,u,!1)):(fe=(E>>>2|E<<30)^(E>>>13|E<<19)^(E>>>22|E<<10),oe=(m>>>6|m<<26)^(m>>>11|m<<21)^(m>>>25|m<<7),D=E&R,K=D^E&I^P,_=m&F^~m&U,te=ie+oe+_+N[j]+ae[j],c=fe+K,ie=w+te<<0,w=te+c<<0),fe=(w>>>2|w<<30)^(w>>>13|w<<19)^(w>>>22|w<<10),oe=(ie>>>6|ie<<26)^(ie>>>11|ie<<21)^(ie>>>25|ie<<7),C=w&E,K=C^w&R^D,_=ie&m^~ie&F,te=U+oe+_+N[j+1]+ae[j+1],c=fe+K,U=I+te<<0,I=te+c<<0,fe=(I>>>2|I<<30)^(I>>>13|I<<19)^(I>>>22|I<<10),oe=(U>>>6|U<<26)^(U>>>11|U<<21)^(U>>>25|U<<7),M=I&w,K=M^I&E^C,_=U&ie^~U&m,te=F+oe+_+N[j+2]+ae[j+2],c=fe+K,F=R+te<<0,R=te+c<<0,fe=(R>>>2|R<<30)^(R>>>13|R<<19)^(R>>>22|R<<10),oe=(F>>>6|F<<26)^(F>>>11|F<<21)^(F>>>25|F<<7),P=R&I,K=P^R&w^M,_=F&U^~F&ie,te=m+oe+_+N[j+3]+ae[j+3],c=fe+K,m=E+te<<0,E=te+c<<0;r(this,h,n(this,h)+E<<0),r(this,p,n(this,p)+R<<0),r(this,f,n(this,f)+I<<0),r(this,T,n(this,T)+w<<0),r(this,S,n(this,S)+m<<0),r(this,v,n(this,v)+F<<0),r(this,O,n(this,O)+U<<0),r(this,b,n(this,b)+ie<<0)},L.prototype.hex=function(){this.finalize();var E=n(this,h),R=n(this,p),I=n(this,f),w=n(this,T),m=n(this,S),F=n(this,v),U=n(this,O),ie=n(this,b),ae=A[E>>28&15]+A[E>>24&15]+A[E>>20&15]+A[E>>16&15]+A[E>>12&15]+A[E>>8&15]+A[E>>4&15]+A[E&15]+A[R>>28&15]+A[R>>24&15]+A[R>>20&15]+A[R>>16&15]+A[R>>12&15]+A[R>>8&15]+A[R>>4&15]+A[R&15]+A[I>>28&15]+A[I>>24&15]+A[I>>20&15]+A[I>>16&15]+A[I>>12&15]+A[I>>8&15]+A[I>>4&15]+A[I&15]+A[w>>28&15]+A[w>>24&15]+A[w>>20&15]+A[w>>16&15]+A[w>>12&15]+A[w>>8&15]+A[w>>4&15]+A[w&15]+A[m>>28&15]+A[m>>24&15]+A[m>>20&15]+A[m>>16&15]+A[m>>12&15]+A[m>>8&15]+A[m>>4&15]+A[m&15]+A[F>>28&15]+A[F>>24&15]+A[F>>20&15]+A[F>>16&15]+A[F>>12&15]+A[F>>8&15]+A[F>>4&15]+A[F&15]+A[U>>28&15]+A[U>>24&15]+A[U>>20&15]+A[U>>16&15]+A[U>>12&15]+A[U>>8&15]+A[U>>4&15]+A[U&15];return n(this,d)||(ae+=A[ie>>28&15]+A[ie>>24&15]+A[ie>>20&15]+A[ie>>16&15]+A[ie>>12&15]+A[ie>>8&15]+A[ie>>4&15]+A[ie&15]),ae},L.prototype.toString=function(){return this.hex()},L.prototype.digest=function(){this.finalize();var E=n(this,h),R=n(this,p),I=n(this,f),w=n(this,T),m=n(this,S),F=n(this,v),U=n(this,O),ie=n(this,b),ae=[E>>24&255,E>>16&255,E>>8&255,E&255,R>>24&255,R>>16&255,R>>8&255,R&255,I>>24&255,I>>16&255,I>>8&255,I&255,w>>24&255,w>>16&255,w>>8&255,w&255,m>>24&255,m>>16&255,m>>8&255,m&255,F>>24&255,F>>16&255,F>>8&255,F&255,U>>24&255,U>>16&255,U>>8&255,U&255];return n(this,d)||ae.push(ie>>24&255,ie>>16&255,ie>>8&255,ie&255),ae},L.prototype.array=function(){return this.digest()},L.prototype.arrayBuffer=function(){this.finalize();var E=new ArrayBuffer(n(this,d)?28:32),R=new DataView(E);return R.setUint32(0,n(this,h)),R.setUint32(4,n(this,p)),R.setUint32(8,n(this,f)),R.setUint32(12,n(this,T)),R.setUint32(16,n(this,S)),R.setUint32(20,n(this,v)),R.setUint32(24,n(this,O)),n(this,d)||R.setUint32(28,n(this,b)),E},L}();s=new WeakMap,o=new WeakMap,l=new WeakMap,a=new WeakMap,u=new WeakMap,h=new WeakMap,p=new WeakMap,f=new WeakMap,T=new WeakMap,S=new WeakMap,v=new WeakMap,O=new WeakMap,b=new WeakMap,B=new WeakMap,x=new WeakMap,d=new WeakMap,V=new WeakMap,W=new WeakMap,function(L){e(E,L);function E(R,I,w){I===void 0&&(I=!1),w===void 0&&(w=!1);var m=L.call(this,I,w)||this;k.set(m,void 0),Y.set(m,void 0),ee.set(m,void 0),se.set(m,void 0);var F;if(typeof R=="string"){for(var U=[],ie=R.length,ae=0,fe=0;fe<ie;++fe){var oe=R.charCodeAt(fe);oe<128?U[ae++]=oe:oe<2048?(U[ae++]=192|oe>>6,U[ae++]=128|oe&63):oe<55296||oe>=57344?(U[ae++]=224|oe>>12,U[ae++]=128|oe>>6&63,U[ae++]=128|oe&63):(oe=65536+((oe&1023)<<10|R.charCodeAt(++fe)&1023),U[ae++]=240|oe>>18,U[ae++]=128|oe>>12&63,U[ae++]=128|oe>>6&63,U[ae++]=128|oe&63)}F=U}else R instanceof ArrayBuffer?F=new Uint8Array(R):F=R;F.length>64&&(F=new z(I,!0).update(F).array());for(var K=[],te=[],fe=0;fe<64;++fe){var c=F[fe]||0;K[fe]=92^c,te[fe]=54^c}return m.update(te),r(m,ee,K),r(m,k,!0),r(m,Y,I),r(m,se,w),m}return E.prototype.finalize=function(){if(L.prototype.finalize.call(this),n(this,k)){r(this,k,!1);var R=this.array();L.prototype.init.call(this,n(this,Y),n(this,se)),this.update(n(this,ee)),this.update(R),L.prototype.finalize.call(this)}},E}(z),k=new WeakMap,Y=new WeakMap,ee=new WeakMap,se=new WeakMap;function X(L){var E=new z;return E.update(L),parseInt(E.hex().substring(0,8),16)}var Q=function(L){var E="#";return L.forEach(function(R){R<16&&(E+=0),E+=R.toString(16)}),E},le=function(L,E,R){L/=360;var I=R<.5?R*(1+E):R+E-R*E,w=2*R-I;return[L+1/3,L,L-1/3].map(function(m){return m<0&&m++,m>1&&m--,m<1/6?m=w+(I-w)*6*m:m<.5?m=I:m<2/3?m=w+(I-w)*6*(2/3-m):m=w,Math.round(m*255)})},ue=function(){function L(E){E===void 0&&(E={});var R=[E.lightness,E.saturation].map(function(m){return m=m!==void 0?m:[.35,.5,.65],Array.isArray(m)?m.concat():[m]}),I=R[0],w=R[1];this.L=I,this.S=w,typeof E.hue=="number"&&(E.hue={min:E.hue,max:E.hue}),typeof E.hue=="object"&&!Array.isArray(E.hue)&&(E.hue=[E.hue]),typeof E.hue>"u"&&(E.hue=[]),this.hueRanges=E.hue.map(function(m){return{min:typeof m.min>"u"?0:m.min,max:typeof m.max>"u"?360:m.max}}),this.hash=X,typeof E.hash=="function"&&(this.hash=E.hash),E.hash==="bkdr"&&(this.hash=_e)}return L.prototype.hsl=function(E){var R,I,w,m=this.hash(E),F=727;if(this.hueRanges.length){var U=this.hueRanges[m%this.hueRanges.length];R=m/this.hueRanges.length%F*(U.max-U.min)/F+U.min}else R=m%359;return m=Math.ceil(m/360),I=this.S[m%this.S.length],m=Math.ceil(m/this.S.length),w=this.L[m%this.L.length],[R,I,w]},L.prototype.rgb=function(E){var R=this.hsl(E);return le.apply(this,R)},L.prototype.hex=function(E){var R=this.rgb(E);return Q(R)},L}();t.default=ue})(Mi);const Go=hn(Mi),Ho=new Go({lightness:[.35,.5,.65]}),Vo=async()=>{const t="https://dat-ecosystem.org/dat-garden-rake/",e=await fetch(`${t}index.json`).then(l=>l.json()),r=`${t}${e.latest}`,[n,s,o]=await Promise.all([fetch(r+"/../valuenetwork.json").then(l=>l.json()),fetch(r+"/../projects.json").then(l=>l.json()),fetch(r+"/../organizations.json").then(l=>l.json())]);return{valueNetworkData:n,projectsData:s,organizationsData:o}},dr=ne.promise(Vo),Oi=wt(new Uo),Li=wt(new wo),Xo=t=>Math.max(4*Math.log(2*(t?.length||1)**1.2),2),dt=ne.promise(async()=>{const{valueNetworkData:t,projectsData:e}=await dr();console.log(await dr());const r=Object.entries(t).map(([l,{dependents:a,owner:u,dependencies:h}],p)=>({index:p,project:l,id:l,data:e[l],owner:u,color:[...Ho.rgb(u||l||String(p)).map(f=>f/255),1],size:Xo(a),dependents:a,dependencies:h}));xt(r.map(l=>[l.index,l]));const n=xt(r.map(l=>[l.project,l]));let s=Object.entries(t).flatMap(([l,{dependents:a,dependencies:u}])=>(a||[]).map(h=>({source:h,sourceNode:n[h],sourceIndex:r.find(p=>p.project===h).index,target:l,targetNode:n[l],targetIndex:r.find(p=>p.project===l).index})).concat((u||[]).map(h=>({source:l,sourceNode:n[l],sourceIndex:r.find(p=>p.project===l).index,target:h,targetNode:n[h],targetIndex:r.find(p=>p.project===h).index})))).filter(l=>l);s=Xa(s,(l,a)=>l.sourceIndex===a.sourceIndex&&l.targetIndex===a.targetIndex);const o=s.map(({sourceIndex:l,targetIndex:a})=>[l,a]);return console.log("link count",s.length),xt(o.map(([l,a],u)=>[`${l}-${a}`,u])),xt(o.map(([l,a],u)=>[`${l}-${a}`,s[u]])),{nodes:r,links:s,linkIndexPairs:o,nodesByProject:n}}),ko=async()=>{const t=await dr();return await Oi.buildGraph(t)},zo=async(t,e=Li.useD3ForceSimulator)=>await e(t,ot(vr(r=>Te()?.targetData(r),1e3/60))),$o=t=>{const e=Te().mostRecentData,r=t.index;return[e[r*3],e[r*3+1],e[r*3+2]]},Ko=async t=>await zo(t||await prepareVisualizerData(),Li.useD3ForceSimulator),{doQuery:Wo,buildGraph:$l}=Oi;function Yo(){return new Worker("/dat-garden-visualization/assets/animation-worker-cbdc1318.js",{type:"module"})}const jo=t=>`
  PREFIX dependson: <http://dat-ecosystem.org#dependson>
  SELECT DISTINCT ?dependent ?dependency WHERE {
    ?dependency dependson:* <${t}> .
    ?dependent dependson: ?dependency .
  }
`;var rr;const Lt=window,ze=Lt.trustedTypes,qr=ze?ze.createPolicy("lit-html",{createHTML:t=>t}):void 0,Ar="$lit$",Pe=`lit$${(Math.random()+"").slice(9)}$`,Ui="?"+Pe,qo=`<${Ui}>`,$e=document,ut=()=>$e.createComment(""),ht=t=>t===null||typeof t!="object"&&typeof t!="function",wi=Array.isArray,Zo=t=>wi(t)||typeof t?.[Symbol.iterator]=="function",ir=`[ 	
\f\r]`,Qe=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,Zr=/-->/g,Qr=/>/g,ye=RegExp(`>|${ir}(?:([^\\s"'>=/]+)(${ir}*=${ir}*(?:[^ 	
\f\r"'\`<>=]|("|')|))|$)`,"g"),Jr=/'/g,ei=/"/g,bi=/^(?:script|style|textarea|title)$/i,Qo=t=>(e,...r)=>({_$litType$:t,strings:e,values:r}),Jo=Qo(1),ct=Symbol.for("lit-noChange"),Ae=Symbol.for("lit-nothing"),ti=new WeakMap,He=$e.createTreeWalker($e,129,null,!1),el=(t,e)=>{const r=t.length-1,n=[];let s,o=e===2?"<svg>":"",l=Qe;for(let u=0;u<r;u++){const h=t[u];let p,f,T=-1,S=0;for(;S<h.length&&(l.lastIndex=S,f=l.exec(h),f!==null);)S=l.lastIndex,l===Qe?f[1]==="!--"?l=Zr:f[1]!==void 0?l=Qr:f[2]!==void 0?(bi.test(f[2])&&(s=RegExp("</"+f[2],"g")),l=ye):f[3]!==void 0&&(l=ye):l===ye?f[0]===">"?(l=s??Qe,T=-1):f[1]===void 0?T=-2:(T=l.lastIndex-f[2].length,p=f[1],l=f[3]===void 0?ye:f[3]==='"'?ei:Jr):l===ei||l===Jr?l=ye:l===Zr||l===Qr?l=Qe:(l=ye,s=void 0);const v=l===ye&&t[u+1].startsWith("/>")?" ":"";o+=l===Qe?h+qo:T>=0?(n.push(p),h.slice(0,T)+Ar+h.slice(T)+Pe+v):h+Pe+(T===-2?(n.push(void 0),u):v)}const a=o+(t[r]||"<?>")+(e===2?"</svg>":"");if(!Array.isArray(t)||!t.hasOwnProperty("raw"))throw Error("invalid template strings array");return[qr!==void 0?qr.createHTML(a):a,n]};class ft{constructor({strings:e,_$litType$:r},n){let s;this.parts=[];let o=0,l=0;const a=e.length-1,u=this.parts,[h,p]=el(e,r);if(this.el=ft.createElement(h,n),He.currentNode=this.el.content,r===2){const f=this.el.content,T=f.firstChild;T.remove(),f.append(...T.childNodes)}for(;(s=He.nextNode())!==null&&u.length<a;){if(s.nodeType===1){if(s.hasAttributes()){const f=[];for(const T of s.getAttributeNames())if(T.endsWith(Ar)||T.startsWith(Pe)){const S=p[l++];if(f.push(T),S!==void 0){const v=s.getAttribute(S.toLowerCase()+Ar).split(Pe),O=/([.?@])?(.*)/.exec(S);u.push({type:1,index:o,name:O[2],strings:v,ctor:O[1]==="."?rl:O[1]==="?"?nl:O[1]==="@"?sl:Ht})}else u.push({type:6,index:o})}for(const T of f)s.removeAttribute(T)}if(bi.test(s.tagName)){const f=s.textContent.split(Pe),T=f.length-1;if(T>0){s.textContent=ze?ze.emptyScript:"";for(let S=0;S<T;S++)s.append(f[S],ut()),He.nextNode(),u.push({type:2,index:++o});s.append(f[T],ut())}}}else if(s.nodeType===8)if(s.data===Ui)u.push({type:2,index:o});else{let f=-1;for(;(f=s.data.indexOf(Pe,f+1))!==-1;)u.push({type:7,index:o}),f+=Pe.length-1}o++}}static createElement(e,r){const n=$e.createElement("template");return n.innerHTML=e,n}}function Ke(t,e,r=t,n){var s,o,l,a;if(e===ct)return e;let u=n!==void 0?(s=r._$Co)===null||s===void 0?void 0:s[n]:r._$Cl;const h=ht(e)?void 0:e._$litDirective$;return u?.constructor!==h&&((o=u?._$AO)===null||o===void 0||o.call(u,!1),h===void 0?u=void 0:(u=new h(t),u._$AT(t,r,n)),n!==void 0?((l=(a=r)._$Co)!==null&&l!==void 0?l:a._$Co=[])[n]=u:r._$Cl=u),u!==void 0&&(e=Ke(t,u._$AS(t,e.values),u,n)),e}class tl{constructor(e,r){this._$AV=[],this._$AN=void 0,this._$AD=e,this._$AM=r}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(e){var r;const{el:{content:n},parts:s}=this._$AD,o=((r=e?.creationScope)!==null&&r!==void 0?r:$e).importNode(n,!0);He.currentNode=o;let l=He.nextNode(),a=0,u=0,h=s[0];for(;h!==void 0;){if(a===h.index){let p;h.type===2?p=new At(l,l.nextSibling,this,e):h.type===1?p=new h.ctor(l,h.name,h.strings,this,e):h.type===6&&(p=new al(l,this,e)),this._$AV.push(p),h=s[++u]}a!==h?.index&&(l=He.nextNode(),a++)}return o}v(e){let r=0;for(const n of this._$AV)n!==void 0&&(n.strings!==void 0?(n._$AI(e,n,r),r+=n.strings.length-2):n._$AI(e[r])),r++}}class At{constructor(e,r,n,s){var o;this.type=2,this._$AH=Ae,this._$AN=void 0,this._$AA=e,this._$AB=r,this._$AM=n,this.options=s,this._$Cp=(o=s?.isConnected)===null||o===void 0||o}get _$AU(){var e,r;return(r=(e=this._$AM)===null||e===void 0?void 0:e._$AU)!==null&&r!==void 0?r:this._$Cp}get parentNode(){let e=this._$AA.parentNode;const r=this._$AM;return r!==void 0&&e?.nodeType===11&&(e=r.parentNode),e}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(e,r=this){e=Ke(this,e,r),ht(e)?e===Ae||e==null||e===""?(this._$AH!==Ae&&this._$AR(),this._$AH=Ae):e!==this._$AH&&e!==ct&&this._(e):e._$litType$!==void 0?this.g(e):e.nodeType!==void 0?this.$(e):Zo(e)?this.T(e):this._(e)}k(e){return this._$AA.parentNode.insertBefore(e,this._$AB)}$(e){this._$AH!==e&&(this._$AR(),this._$AH=this.k(e))}_(e){this._$AH!==Ae&&ht(this._$AH)?this._$AA.nextSibling.data=e:this.$($e.createTextNode(e)),this._$AH=e}g(e){var r;const{values:n,_$litType$:s}=e,o=typeof s=="number"?this._$AC(e):(s.el===void 0&&(s.el=ft.createElement(s.h,this.options)),s);if(((r=this._$AH)===null||r===void 0?void 0:r._$AD)===o)this._$AH.v(n);else{const l=new tl(o,this),a=l.u(this.options);l.v(n),this.$(a),this._$AH=l}}_$AC(e){let r=ti.get(e.strings);return r===void 0&&ti.set(e.strings,r=new ft(e)),r}T(e){wi(this._$AH)||(this._$AH=[],this._$AR());const r=this._$AH;let n,s=0;for(const o of e)s===r.length?r.push(n=new At(this.k(ut()),this.k(ut()),this,this.options)):n=r[s],n._$AI(o),s++;s<r.length&&(this._$AR(n&&n._$AB.nextSibling,s),r.length=s)}_$AR(e=this._$AA.nextSibling,r){var n;for((n=this._$AP)===null||n===void 0||n.call(this,!1,!0,r);e&&e!==this._$AB;){const s=e.nextSibling;e.remove(),e=s}}setConnected(e){var r;this._$AM===void 0&&(this._$Cp=e,(r=this._$AP)===null||r===void 0||r.call(this,e))}}class Ht{constructor(e,r,n,s,o){this.type=1,this._$AH=Ae,this._$AN=void 0,this.element=e,this.name=r,this._$AM=s,this.options=o,n.length>2||n[0]!==""||n[1]!==""?(this._$AH=Array(n.length-1).fill(new String),this.strings=n):this._$AH=Ae}get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}_$AI(e,r=this,n,s){const o=this.strings;let l=!1;if(o===void 0)e=Ke(this,e,r,0),l=!ht(e)||e!==this._$AH&&e!==ct,l&&(this._$AH=e);else{const a=e;let u,h;for(e=o[0],u=0;u<o.length-1;u++)h=Ke(this,a[n+u],r,u),h===ct&&(h=this._$AH[u]),l||(l=!ht(h)||h!==this._$AH[u]),h===Ae?e=Ae:e!==Ae&&(e+=(h??"")+o[u+1]),this._$AH[u]=h}l&&!s&&this.j(e)}j(e){e===Ae?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,e??"")}}class rl extends Ht{constructor(){super(...arguments),this.type=3}j(e){this.element[this.name]=e===Ae?void 0:e}}const il=ze?ze.emptyScript:"";class nl extends Ht{constructor(){super(...arguments),this.type=4}j(e){e&&e!==Ae?this.element.setAttribute(this.name,il):this.element.removeAttribute(this.name)}}class sl extends Ht{constructor(e,r,n,s,o){super(e,r,n,s,o),this.type=5}_$AI(e,r=this){var n;if((e=(n=Ke(this,e,r,0))!==null&&n!==void 0?n:Ae)===ct)return;const s=this._$AH,o=e===Ae&&s!==Ae||e.capture!==s.capture||e.once!==s.once||e.passive!==s.passive,l=e!==Ae&&(s===Ae||o);o&&this.element.removeEventListener(this.name,this,s),l&&this.element.addEventListener(this.name,this,e),this._$AH=e}handleEvent(e){var r,n;typeof this._$AH=="function"?this._$AH.call((n=(r=this.options)===null||r===void 0?void 0:r.host)!==null&&n!==void 0?n:this.element,e):this._$AH.handleEvent(e)}}class al{constructor(e,r,n){this.element=e,this.type=6,this._$AN=void 0,this._$AM=r,this.options=n}get _$AU(){return this._$AM._$AU}_$AI(e){Ke(this,e)}}const ri=Lt.litHtmlPolyfillSupport;ri?.(ft,At),((rr=Lt.litHtmlVersions)!==null&&rr!==void 0?rr:Lt.litHtmlVersions=[]).push("2.7.1");const ol=(t,e,r)=>{var n,s;const o=(n=r?.renderBefore)!==null&&n!==void 0?n:e;let l=o._$litPart$;if(l===void 0){const a=(s=r?.renderBefore)!==null&&s!==void 0?s:null;o._$litPart$=l=new At(e.insertBefore(ut(),a),a,void 0,r??{})}return l._$AI(t),l},Gi=({color:t})=>t,ll=ne.infinite(async(t=ke)=>{const{nodes:e,links:r}=await dt();return new Float32Array(e.map(Gi).flatMap(t))}),Hi=({size:t})=>Math.sqrt(t)/40,ul=ne.infinite(async(t=ke)=>{const{nodes:e,links:r}=await dt();return new Float32Array(e.map(Hi).map(t))}),Vi=async({colorMap:t=ke,sizeMap:e=ke,immediate:r=!1}={})=>{const n=pe(),s=Re(),o=Ne(),l=await ll(t),a=await ul(e);n.targetData(l,{immediate:r}),s.targetData(a,{immediate:r}),o.targetData(new Float32Array(o.target.numItems).fill(0),{immediate:r})},nr=async(t,{colorMap:e=ke,sizeMap:r=ke,emphasis:n=0,immediate:s=!1}={})=>{const o=new Float32Array(e(Gi(t))),l=new Float32Array([r(Hi(t))]),a=new Float32Array([n]),u=pe(),h=Re(),p=Ne();u.targetData(o,{offset:t.index,immediate:s}),h.targetData(l,{offset:t.index,immediate:s}),p.targetData(a,{offset:t.index,immediate:s})},Xi=async(t=!1)=>{await Vi({colorMap:e=>{const r=e.slice(0,3).reduce((n,s)=>n+s,0)/3;return[...e.slice(0,3).map(n=>r),.5]},sizeMap:e=>e*.5,immediate:t})},hl=t=>Jo`
  <h3>${t.data.name}</h3>
  <p>${t.data.description}</p>
  <p>${t.data.version}</p>
`,cl=t=>{const e=document.getElementById("selection-info"),r=hl(t);console.log(r),ol(r,e)};window.initializeSelectionVisuals=Xi;const fl=t=>{const n=re().canvas.getBoundingClientRect(),s=(t.clientX-n.left)/n.width,o=(t.clientY-n.top)/n.height;return{x:s*2-1,y:-(o*2-1)}},{globalCamera:vt,updateCameras:El,setCameraCenter:_l,zoomGlobalCamera:ii,panGlobalCamera:ni,startPanning:si,stopPanning:ai,startZooming:dl,stopZooming:Al}=wt(new Yo),me={},oi=new Uint8Array(4);let ki=-1,nt=-1,Nt=0,st=0;const sr=()=>{Nt++},ar=()=>[me.canvasX,me.canvasY],Ut=()=>[me.x,me.y],It=({x:t,y:e})=>{const r=re();me.x=t,me.y=e,me.canvasX=(t+1)/2*r.width,me.canvasY=(e+1)/2*r.height;const n=window.devicePixelRatio||1;me.pickerX=Math.floor(me.canvasX/n),me.pickerY=Math.floor(me.canvasY/n)},Tl=ne.infinite(()=>{const e=re().canvas;_r(e).on("touchmove",It).on("mousemove",It),_r(e).on("touchmove",sr).on("pinchmove",sr).on("mousemove",sr),e.addEventListener("pointerdown",r=>{console.log("pointerdown"),It(fl(r)),Nt=0,st=0}),e.addEventListener("pointerup",()=>{const r=st>.03||Nt>5;console.log("was drag",r,st,Nt),r||(Tr=!0,setTimeout(()=>{nt=ki,xl().then(n=>{e.dispatchEvent(new CustomEvent("selected",{detail:{selectedIndex:nt,info:n}}))}),e.dispatchEvent(new CustomEvent("tap",{detail:{selectedIndex:nt}}))},50))}),e.addEventListener("selected",async r=>{const n=o=>o*2,s=r.detail.info;if(s){const o=$o(s),l=jo(s.project);console.log("the node",s);const{nodesByProject:a,links:u}=await dt();Xi().then(()=>{nr(s,{sizeMap:n,emphasis:1}),Wo(l,ot((h,p)=>{p(["dependent","dependency"]).then(({dependent:f,dependency:T})=>{nr(a[f.value],{sizeMap:n,emphasis:1}),nr(a[T.value],{sizeMap:n,emphasis:1})})}),ot(()=>{console.log("query ended:",l)})),_l(o)}),cl(s)}else console.log("no selection"),Vi()})}),gt=Math.PI/3,ml=()=>{const e=re().canvas;e.addEventListener("wheel",vr(r=>{const n=Math.exp(r.deltaY/e.clientHeight*2)-1,s=Math.sign(n);ii(0,0,s*Math.min(Math.abs(n),.06)),r.preventDefault()},1e3/60),{passive:!1}),_r(e).on("mousemove",function(r){!r.active||r.buttons!==1||(st+=Math.sqrt(Math.pow(r.dx,2)+Math.pow(r.dy,2)),r.mods.shift?(si(),ni(r.dx,r.dy)):r.mods.meta?vt.pivot(r.dx,r.dy):(vt.rotate(-r.dx*gt,-r.dy*gt),ai()),r.originalEvent.preventDefault())}).on("touchmove",function(r){It(r),r.active&&(st+=Math.sqrt(Math.pow(r.dx,2)+Math.pow(r.dy,2)),vt.rotate(-r.dx*gt,-r.dy*gt))}).on("pinchmove",function(r){r.active&&(si(),dl(),ii(0,0,1-r.zoomx),ni(r.dx,r.dy))}).on("touchstart",r=>r.originalEvent.preventDefault()).on("pinchstart",r=>r.originalEvent.preventDefault()).on("pinchend",()=>{ai(),Al()})};let Tr=!1;const pl=t=>t[0]+t[1]*256+t[2]*256*256-1,Rl=()=>{const t=re(),e=Ai(),r=100,n=[ar()[0]-r/2,ar()[1]-r/2,r,r];t.drawFramebuffer(e.current.resize(t.width,t.height)).enable(H.SCISSOR_TEST).scissor(...n);const s=wn().uniformBlock("cameras",Mt()).uniform("mousePosition",Ut()).uniform("selectedIndex",mr());t.defaultViewport().clear(),s.draw(),Tr&&(t.readFramebuffer(e.current).readPixel(...ar(),oi),ki=pl(oi),e.swap(),Tr=!1)},mr=()=>nt,xl=async()=>{const{nodes:t}=await dt();return t[nt]},gl=`#version 300 es
in vec2 position;
in vec2 uv;
out vec2 vUV;

void main() {
  vUV = uv;
  gl_Position = vec4(position, 0.0, 1.0);
}`,Sl=`#version 300 es
precision mediump float;
in vec2 vUV;
uniform sampler2D uTexture;
out vec4 fragColor;

void main() {
  fragColor = texture(uTexture, vUV);
  fragColor.a = 1.0;
}`,Cl=new Float32Array([-1,-1,1,-1,-1,1,1,1]),vl=new Float32Array([0,0,1,0,0,1,1,1]),Nl=ne.infinite(()=>{const t=re(),e=t.createVertexArray().vertexAttributeBuffer(0,t.createVertexBuffer(H.FLOAT,2,Cl)).vertexAttributeBuffer(1,t.createVertexBuffer(H.FLOAT,2,vl)).indexBuffer(t.createIndexBuffer(H.UNSIGNED_SHORT,3,new Uint16Array([0,1,2,2,1,3]))),r=t.createProgram(gl,Sl);return t.createDrawCall(r,e)}),Il=t=>{Nl().texture("uTexture",t).draw()};let pr=!0,Rr=!0;window.addEventListener("keydown",t=>{t.key==="e"&&(pr=!pr),t.key==="n"&&(Rr=!Rr)});const zi=()=>{const t=window.devicePixelRatio||1,e=window.innerWidth,r=window.innerHeight,n=Math.floor(e*t),s=Math.floor(r*t);return{width:n,height:s}},re=ne.infinite(()=>{const t=document.createElement("canvas");document.body.appendChild(t),t.getContext("webgl2")?console.log("WebGL2 initialized"):console.error("WebGL2 failed to initialize");const{width:r,height:n}=zi();return H.createApp(t,{antialias:!0,extensions:["OES_texture_float","EXT_color_buffer_float","ANGLE_instanced_arrays"]}).viewport(0,0,r,n).enable(H.BLEND).blendFunc(H.SRC_ALPHA,H.ONE_MINUS_SRC_ALPHA).enable(H.DEPTH_TEST).depthFunc(H.LEQUAL).clearColor(.1,.1,.1,1)}),Dl=()=>{const t=re(),{width:e,height:r}=zi();t.resize(e,r),vt.resize(e/r);const n=t.canvas;n.style.position="absolute",n.style.top="0px",n.style.left="0px",n.style.height="100vh"},$i=()=>{El(ka,window.innerWidth,window.innerHeight);const t=re();Dl();const e=Bl();t.drawFramebuffer(e).scissor(0,0,e.width,e.height).enable(H.SCISSOR_TEST).viewport(0,0,e.width,e.height).clearColor(0,0,0,1),wl().uniform("uMixRatio",.05).draw(),Rl(),t.defaultDrawFramebuffer().defaultViewport().clearColor(0,0,0,1).disable(H.SCISSOR_TEST);const n=bn().uniformBlock("cameras",Mt()).uniform("mousePosition",Ut()).uniform("selectedIndex",mr()).uniform("time",performance.now()/1e3),s=Wn().uniformBlock("cameras",Mt()).texture("positionTexture",Te().texture).texture("colorTexture",pe().texture).texture("sizeTexture",Re().texture).texture("emphasisTexture",Ne().texture).uniform("textureDimensions",[e.width,e.height]).uniform("mousePosition",Ut()).uniform("selectedIndex",mr()).uniform("time",performance.now()/1e3);t.clear(),Rr&&n.draw(),pr&&s.draw(),window.lolDrawThatThing=o=>{o==="color"&&(window.lolDrawThat=pe().texture),o==="position"&&(window.lolDrawThat=Te().texture),o==="size"&&(window.lolDrawThat=Re().texture),o==="picker"?window.lolDrawThat=Ai().current.colorAttachments[0]:window.lolDrawThat=null},window.lolDrawThat&&Il(window.lolDrawThat),Fl(),requestAnimationFrame($i)},Pl=(t,e)=>{let r;switch(`${t}${e}`){case`${H.FLOAT}4`:r=H.RGBA32F;break;case`${H.FLOAT}3`:r=H.RGBA32F;break;case`${H.FLOAT}2`:r=H.RG32F;break;case`${H.FLOAT}1`:r=H.R32F;break;case`${H.UNSIGNED_BYTE}3`:r=H.RGB8;break;case`${H.UNSIGNED_BYTE}4`:r=H.RGBA8;break;case`${H.UNSIGNED_SHORT}3`:r=H.RGB16UI;break;case`${H.UNSIGNED_SHORT}4`:r=H.RGBA16UI;break;case`${H.UNSIGNED_INT}3`:r=H.RGB32UI;break;case`${H.UNSIGNED_INT}4`:r=H.RGBA32UI;break}return r};class Vt{constructor(e,r,n){this.positionSwap=!1,this.makeBuffer=ne.infinite((s,o)=>re().createVertexBuffer(this._type,this._itemSize,s*this._itemSize)),this.makeTexture=ne.infinite(s=>{const o=re(),l=Math.ceil(Math.sqrt(s+1)),a={width:l,height:l,internalFormat:Pl(this._type,this._itemSize),type:this._type,flipY:!0,minFilter:H.NEAREST,magFilter:H.NEAREST,premultiplyAlpha:!0,wrapY:H.CLAMP_TO_EDGE,wrapX:H.CLAMP_TO_EDGE};return o.createTexture2D(l,l,a)}),this.makeTextureIndicesVertexBuffer=ne.infinite(s=>{const o=re(),l=new Uint32Array(s).map((a,u)=>u);return o.createVertexBuffer(H.UNSIGNED_INT,1,l)}),this.targetData=(s,{offset:o=-1,immediate:l=!1}={})=>{let a;o>-1?a=this._target.numItems:(o=0,a=ArrayBuffer.isView(s)?s.byteLength/this._itemSize/4:s),this._currentA=this.makeBuffer(a,"currentA"),this._currentB=this.makeBuffer(a,"currentB"),this._target=this.makeBuffer(a,"target"),this._texture=this.makeTexture(a),this._texturePixelPositions=this.makeTextureIndicesVertexBuffer(a),ArrayBuffer.isView(s)&&(this._target.data(s,o*this._itemSize*4),this._mostRecentData=s,l&&(this._currentA.data(s,o*this._itemSize*4),this._currentB.data(s,o*this._itemSize*4)))},this._type=e,this._itemSize=r,this.targetData(n)}swap(){this.positionSwap=!this.positionSwap}get current(){return this.positionSwap?this._currentA:this._currentB}get texture(){return this._texture}get texturePixelPositions(){return this._texturePixelPositions}get updated(){return this.positionSwap?this._currentB:this._currentA}get target(){return this._target}get mostRecentData(){return this._mostRecentData}}const Te=ne.infinite(()=>new Vt(H.FLOAT,3,1)),pe=ne.infinite(()=>new Vt(H.FLOAT,4,1)),Re=ne.infinite(()=>new Vt(H.FLOAT,1,1)),Ne=ne.infinite(()=>new Vt(H.FLOAT,1,1)),Fl=()=>{Te().swap(),Re().swap(),pe().swap(),Ne().swap()},xr=ne.infinite(()=>re().createFramebuffer());ne.infinite(t=>re().createTexture2D(t,t,{internalFormat:H.DEPTH_COMPONENT32F}));const Bl=()=>{re();const t=xr(),e=Te().texture,r=pe().texture,n=Re().texture,s=Ne().texture;return t.colorTarget(1,e),t.colorTarget(2,r),t.colorTarget(3,n),t.colorTarget(4,s),t},yl=ne.infinite(()=>re().createProgram(An,Tn,{transformFeedbackVaryings:["vUpdatedPosition","vUpdatedColor","vUpdatedSize","vUpdatedEmphasis"],transformFeedbackMode:H.SEPARATE_ATTRIBS})),Ml=ne.infinite(()=>re().createVertexArray()),Ol=()=>(re(),Ml().vertexAttributeBuffer(0,Te().current).vertexAttributeBuffer(1,pe().current).vertexAttributeBuffer(2,Re().current).vertexAttributeBuffer(3,Ne().current).vertexAttributeBuffer(4,Te().target).vertexAttributeBuffer(5,pe().target).vertexAttributeBuffer(6,Re().target).vertexAttributeBuffer(7,Ne().target).vertexAttributeBuffer(8,Te().texturePixelPositions)),Ll=ne.infinite(()=>re().createTransformFeedback()),Ul=()=>Ll().feedbackBuffer(0,Te().updated).feedbackBuffer(1,pe().updated).feedbackBuffer(2,Re().updated).feedbackBuffer(3,Ne().updated),wl=()=>{const t=re(),e=yl(),r=Ol(),n=Ul();return t.createDrawCall(e,r).primitive(H.POINTS).transformFeedback(n).uniform("mousePosition",Ut()).uniform("bufferDimensions",[xr().width,xr().height])},Fe=document.createElement("div");document.body.appendChild(Fe);Fe.id="fps-indicator";Fe.style.zIndex="1000";Fe.innerHTML=`
<p class="value">FPS: 0</p>
<canvas width="100" height="50" class="graph"></canvas>
`;Fe.style.position="absolute";Fe.style.top="0px";Fe.style.left="0px";Fe.style.color="white";const bl=document.querySelector("#fps-indicator .value"),Ge=document.querySelector("#fps-indicator .graph"),De=Ge.getContext("2d");let or=performance.now(),li=performance.now(),lr=0,et=[];const ui=5,Gl=()=>et.slice(0,ui).reduce((t,e)=>t+e,0)/ui,Dr=()=>{const t=Gl(),e=performance.now();lr++,e>or+100&&(et=[Math.round(lr*1e3/(e-or)/2),...et].slice(0,1e3),De?.clearRect(0,0,Ge.width,Ge.height),De?.beginPath(),De?.moveTo(0,Ge.height),et.forEach((r,n)=>{De?.lineTo(n,Ge.height-r)}),De?.lineTo(et.length,Ge.height),De.fillStyle="rgba(255, 255, 255, 0.5)",De?.fill(),De?.stroke(),or=e,lr=0),e>li+1e3&&(li=e,bl.innerText=`FPS: ${t}`),requestAnimationFrame(Dr)};Dr();const Hl=re();Hl.clear();ml();Tl();let Xt;Xt=await dt();await ko();const{nodes:Se,linkIndexPairs:Ki}=Xt;console.log("nodes",Se);const hi=[Ko],Vl=async()=>{const t=hi[Math.floor(Math.random()*hi.length)];await t(Xt)};await Vl();$n(Ki);const Xl=new Float32Array(Se.flatMap(({color:t})=>t));pe().targetData(Xl);const gr=new Float32Array(Se.length);for(let t=0;t<gr.length;t++)gr[t]=Math.sqrt(Se[t].size)/40;Re().targetData(gr);const ur=40,kl=()=>[Math.random()*ur-1,Math.random()*ur-1,Math.random()*ur-1],zl=new Float32Array(Se.flatMap(kl));Te().targetData(zl);Ne().targetData(new Float32Array(Se.length).fill(0));const je=document.createElement("div");je.style.position="absolute";je.style.top="0";je.style.right="0";je.style.color="white";document.body.appendChild(je);je.innerHTML=`
    <div>Nodes: ${Se.length}</div>
    <div>Edges: ${Ki.length}</div>
`;$i();Dr();window.setNodePositions=t=>{Te().targetData(new Float32Array(new Array(Se.length*3).fill(0).flatMap(t)))};window.setNodeColors=t=>{pe().targetData(new Float32Array(new Array(Se.length*4).fill(0).flatMap(t)))};window.setNodeSizes=t=>{Re().targetData(new Float32Array(new Array(Se.length).fill(0).flatMap(t)))};window.graphData=Xt})();