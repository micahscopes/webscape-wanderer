(async()=>{(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const l of a.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&n(l)}).observe(document,{childList:!0,subtree:!0});function r(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(s){if(s.ep)return;s.ep=!0;const a=r(s);fetch(s.href,a)}})();const i={DEPTH_BUFFER_BIT:256,STENCIL_BUFFER_BIT:1024,COLOR_BUFFER_BIT:16384,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,ZERO:0,ONE:1,SRC_COLOR:768,ONE_MINUS_SRC_COLOR:769,SRC_ALPHA:770,ONE_MINUS_SRC_ALPHA:771,DST_ALPHA:772,ONE_MINUS_DST_ALPHA:773,DST_COLOR:774,ONE_MINUS_DST_COLOR:775,SRC_ALPHA_SATURATE:776,FUNC_ADD:32774,BLEND_EQUATION:32777,BLEND_EQUATION_RGB:32777,BLEND_EQUATION_ALPHA:34877,FUNC_SUBTRACT:32778,FUNC_REVERSE_SUBTRACT:32779,BLEND_DST_RGB:32968,BLEND_SRC_RGB:32969,BLEND_DST_ALPHA:32970,BLEND_SRC_ALPHA:32971,CONSTANT_COLOR:32769,ONE_MINUS_CONSTANT_COLOR:32770,CONSTANT_ALPHA:32771,ONE_MINUS_CONSTANT_ALPHA:32772,BLEND_COLOR:32773,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,ARRAY_BUFFER_BINDING:34964,ELEMENT_ARRAY_BUFFER_BINDING:34965,STREAM_DRAW:35040,STATIC_DRAW:35044,DYNAMIC_DRAW:35048,BUFFER_SIZE:34660,BUFFER_USAGE:34661,CURRENT_VERTEX_ATTRIB:34342,FRONT:1028,BACK:1029,FRONT_AND_BACK:1032,CULL_FACE:2884,BLEND:3042,DITHER:3024,STENCIL_TEST:2960,DEPTH_TEST:2929,SCISSOR_TEST:3089,POLYGON_OFFSET_FILL:32823,SAMPLE_ALPHA_TO_COVERAGE:32926,SAMPLE_COVERAGE:32928,NO_ERROR:0,INVALID_ENUM:1280,INVALID_VALUE:1281,INVALID_OPERATION:1282,OUT_OF_MEMORY:1285,CW:2304,CCW:2305,LINE_WIDTH:2849,ALIASED_POINT_SIZE_RANGE:33901,ALIASED_LINE_WIDTH_RANGE:33902,CULL_FACE_MODE:2885,FRONT_FACE:2886,DEPTH_RANGE:2928,DEPTH_WRITEMASK:2930,DEPTH_CLEAR_VALUE:2931,DEPTH_FUNC:2932,STENCIL_CLEAR_VALUE:2961,STENCIL_FUNC:2962,STENCIL_FAIL:2964,STENCIL_PASS_DEPTH_FAIL:2965,STENCIL_PASS_DEPTH_PASS:2966,STENCIL_REF:2967,STENCIL_VALUE_MASK:2963,STENCIL_WRITEMASK:2968,STENCIL_BACK_FUNC:34816,STENCIL_BACK_FAIL:34817,STENCIL_BACK_PASS_DEPTH_FAIL:34818,STENCIL_BACK_PASS_DEPTH_PASS:34819,STENCIL_BACK_REF:36003,STENCIL_BACK_VALUE_MASK:36004,STENCIL_BACK_WRITEMASK:36005,VIEWPORT:2978,SCISSOR_BOX:3088,COLOR_CLEAR_VALUE:3106,COLOR_WRITEMASK:3107,UNPACK_ALIGNMENT:3317,PACK_ALIGNMENT:3333,MAX_TEXTURE_SIZE:3379,MAX_VIEWPORT_DIMS:3386,SUBPIXEL_BITS:3408,RED_BITS:3410,GREEN_BITS:3411,BLUE_BITS:3412,ALPHA_BITS:3413,DEPTH_BITS:3414,STENCIL_BITS:3415,POLYGON_OFFSET_UNITS:10752,POLYGON_OFFSET_FACTOR:32824,TEXTURE_BINDING_2D:32873,SAMPLE_BUFFERS:32936,SAMPLES:32937,SAMPLE_COVERAGE_VALUE:32938,SAMPLE_COVERAGE_INVERT:32939,COMPRESSED_TEXTURE_FORMATS:34467,DONT_CARE:4352,FASTEST:4353,NICEST:4354,GENERATE_MIPMAP_HINT:33170,BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DEPTH_COMPONENT:6402,ALPHA:6406,RGB:6407,RGBA:6408,LUMINANCE:6409,LUMINANCE_ALPHA:6410,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,FRAGMENT_SHADER:35632,VERTEX_SHADER:35633,MAX_VERTEX_ATTRIBS:34921,MAX_VERTEX_UNIFORM_VECTORS:36347,MAX_VARYING_VECTORS:36348,MAX_COMBINED_TEXTURE_IMAGE_UNITS:35661,MAX_VERTEX_TEXTURE_IMAGE_UNITS:35660,MAX_TEXTURE_IMAGE_UNITS:34930,MAX_FRAGMENT_UNIFORM_VECTORS:36349,SHADER_TYPE:35663,DELETE_STATUS:35712,LINK_STATUS:35714,VALIDATE_STATUS:35715,ATTACHED_SHADERS:35717,ACTIVE_UNIFORMS:35718,ACTIVE_ATTRIBUTES:35721,SHADING_LANGUAGE_VERSION:35724,CURRENT_PROGRAM:35725,NEVER:512,LESS:513,EQUAL:514,LEQUAL:515,GREATER:516,NOTEQUAL:517,GEQUAL:518,ALWAYS:519,KEEP:7680,REPLACE:7681,INCR:7682,DECR:7683,INVERT:5386,INCR_WRAP:34055,DECR_WRAP:34056,VENDOR:7936,RENDERER:7937,VERSION:7938,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987,TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,TEXTURE_2D:3553,TEXTURE:5890,TEXTURE_CUBE_MAP:34067,TEXTURE_BINDING_CUBE_MAP:34068,TEXTURE_CUBE_MAP_POSITIVE_X:34069,TEXTURE_CUBE_MAP_NEGATIVE_X:34070,TEXTURE_CUBE_MAP_POSITIVE_Y:34071,TEXTURE_CUBE_MAP_NEGATIVE_Y:34072,TEXTURE_CUBE_MAP_POSITIVE_Z:34073,TEXTURE_CUBE_MAP_NEGATIVE_Z:34074,MAX_CUBE_MAP_TEXTURE_SIZE:34076,TEXTURE0:33984,TEXTURE1:33985,TEXTURE2:33986,TEXTURE3:33987,TEXTURE4:33988,TEXTURE5:33989,TEXTURE6:33990,TEXTURE7:33991,TEXTURE8:33992,TEXTURE9:33993,TEXTURE10:33994,TEXTURE11:33995,TEXTURE12:33996,TEXTURE13:33997,TEXTURE14:33998,TEXTURE15:33999,TEXTURE16:34e3,TEXTURE17:34001,TEXTURE18:34002,TEXTURE19:34003,TEXTURE20:34004,TEXTURE21:34005,TEXTURE22:34006,TEXTURE23:34007,TEXTURE24:34008,TEXTURE25:34009,TEXTURE26:34010,TEXTURE27:34011,TEXTURE28:34012,TEXTURE29:34013,TEXTURE30:34014,TEXTURE31:34015,ACTIVE_TEXTURE:34016,REPEAT:10497,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,SAMPLER_2D:35678,SAMPLER_CUBE:35680,VERTEX_ATTRIB_ARRAY_ENABLED:34338,VERTEX_ATTRIB_ARRAY_SIZE:34339,VERTEX_ATTRIB_ARRAY_STRIDE:34340,VERTEX_ATTRIB_ARRAY_TYPE:34341,VERTEX_ATTRIB_ARRAY_NORMALIZED:34922,VERTEX_ATTRIB_ARRAY_POINTER:34373,VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:34975,IMPLEMENTATION_COLOR_READ_TYPE:35738,IMPLEMENTATION_COLOR_READ_FORMAT:35739,COMPILE_STATUS:35713,LOW_FLOAT:36336,MEDIUM_FLOAT:36337,HIGH_FLOAT:36338,LOW_INT:36339,MEDIUM_INT:36340,HIGH_INT:36341,FRAMEBUFFER:36160,RENDERBUFFER:36161,RGBA4:32854,RGB5_A1:32855,RGB565:36194,DEPTH_COMPONENT16:33189,STENCIL_INDEX:6401,STENCIL_INDEX8:36168,DEPTH_STENCIL:34041,RENDERBUFFER_WIDTH:36162,RENDERBUFFER_HEIGHT:36163,RENDERBUFFER_INTERNAL_FORMAT:36164,RENDERBUFFER_RED_SIZE:36176,RENDERBUFFER_GREEN_SIZE:36177,RENDERBUFFER_BLUE_SIZE:36178,RENDERBUFFER_ALPHA_SIZE:36179,RENDERBUFFER_DEPTH_SIZE:36180,RENDERBUFFER_STENCIL_SIZE:36181,FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:36048,FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:36049,FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL:36050,FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE:36051,COLOR_ATTACHMENT0:36064,DEPTH_ATTACHMENT:36096,STENCIL_ATTACHMENT:36128,DEPTH_STENCIL_ATTACHMENT:33306,NONE:0,FRAMEBUFFER_COMPLETE:36053,FRAMEBUFFER_INCOMPLETE_ATTACHMENT:36054,FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:36055,FRAMEBUFFER_INCOMPLETE_DIMENSIONS:36057,FRAMEBUFFER_UNSUPPORTED:36061,FRAMEBUFFER_BINDING:36006,RENDERBUFFER_BINDING:36007,MAX_RENDERBUFFER_SIZE:34024,INVALID_FRAMEBUFFER_OPERATION:1286,UNPACK_FLIP_Y_WEBGL:37440,UNPACK_PREMULTIPLY_ALPHA_WEBGL:37441,CONTEXT_LOST_WEBGL:37442,UNPACK_COLORSPACE_CONVERSION_WEBGL:37443,BROWSER_DEFAULT_WEBGL:37444,READ_BUFFER:3074,UNPACK_ROW_LENGTH:3314,UNPACK_SKIP_ROWS:3315,UNPACK_SKIP_PIXELS:3316,PACK_ROW_LENGTH:3330,PACK_SKIP_ROWS:3331,PACK_SKIP_PIXELS:3332,COLOR:6144,DEPTH:6145,STENCIL:6146,RED:6403,RGB8:32849,RGBA8:32856,RGB10_A2:32857,TEXTURE_BINDING_3D:32874,UNPACK_SKIP_IMAGES:32877,UNPACK_IMAGE_HEIGHT:32878,TEXTURE_3D:32879,TEXTURE_WRAP_R:32882,MAX_3D_TEXTURE_SIZE:32883,UNSIGNED_INT_2_10_10_10_REV:33640,MAX_ELEMENTS_VERTICES:33e3,MAX_ELEMENTS_INDICES:33001,TEXTURE_MIN_LOD:33082,TEXTURE_MAX_LOD:33083,TEXTURE_BASE_LEVEL:33084,TEXTURE_MAX_LEVEL:33085,MIN:32775,MAX:32776,DEPTH_COMPONENT24:33190,MAX_TEXTURE_LOD_BIAS:34045,TEXTURE_COMPARE_MODE:34892,TEXTURE_COMPARE_FUNC:34893,CURRENT_QUERY:34917,QUERY_RESULT:34918,QUERY_RESULT_AVAILABLE:34919,STREAM_READ:35041,STREAM_COPY:35042,STATIC_READ:35045,STATIC_COPY:35046,DYNAMIC_READ:35049,DYNAMIC_COPY:35050,MAX_DRAW_BUFFERS:34852,DRAW_BUFFER0:34853,DRAW_BUFFER1:34854,DRAW_BUFFER2:34855,DRAW_BUFFER3:34856,DRAW_BUFFER4:34857,DRAW_BUFFER5:34858,DRAW_BUFFER6:34859,DRAW_BUFFER7:34860,DRAW_BUFFER8:34861,DRAW_BUFFER9:34862,DRAW_BUFFER10:34863,DRAW_BUFFER11:34864,DRAW_BUFFER12:34865,DRAW_BUFFER13:34866,DRAW_BUFFER14:34867,DRAW_BUFFER15:34868,MAX_FRAGMENT_UNIFORM_COMPONENTS:35657,MAX_VERTEX_UNIFORM_COMPONENTS:35658,SAMPLER_3D:35679,SAMPLER_2D_SHADOW:35682,FRAGMENT_SHADER_DERIVATIVE_HINT:35723,PIXEL_PACK_BUFFER:35051,PIXEL_UNPACK_BUFFER:35052,PIXEL_PACK_BUFFER_BINDING:35053,PIXEL_UNPACK_BUFFER_BINDING:35055,FLOAT_MAT2x3:35685,FLOAT_MAT2x4:35686,FLOAT_MAT3x2:35687,FLOAT_MAT3x4:35688,FLOAT_MAT4x2:35689,FLOAT_MAT4x3:35690,SRGB:35904,SRGB8:35905,SRGB8_ALPHA8:35907,COMPARE_REF_TO_TEXTURE:34894,RGBA32F:34836,RGB32F:34837,RGBA16F:34842,RGB16F:34843,VERTEX_ATTRIB_ARRAY_INTEGER:35069,MAX_ARRAY_TEXTURE_LAYERS:35071,MIN_PROGRAM_TEXEL_OFFSET:35076,MAX_PROGRAM_TEXEL_OFFSET:35077,MAX_VARYING_COMPONENTS:35659,TEXTURE_2D_ARRAY:35866,TEXTURE_BINDING_2D_ARRAY:35869,R11F_G11F_B10F:35898,UNSIGNED_INT_10F_11F_11F_REV:35899,RGB9_E5:35901,UNSIGNED_INT_5_9_9_9_REV:35902,TRANSFORM_FEEDBACK_BUFFER_MODE:35967,MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS:35968,TRANSFORM_FEEDBACK_VARYINGS:35971,TRANSFORM_FEEDBACK_BUFFER_START:35972,TRANSFORM_FEEDBACK_BUFFER_SIZE:35973,TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN:35976,RASTERIZER_DISCARD:35977,MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS:35978,MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS:35979,INTERLEAVED_ATTRIBS:35980,SEPARATE_ATTRIBS:35981,TRANSFORM_FEEDBACK_BUFFER:35982,TRANSFORM_FEEDBACK_BUFFER_BINDING:35983,RGBA32UI:36208,RGB32UI:36209,RGBA16UI:36214,RGB16UI:36215,RGBA8UI:36220,RGB8UI:36221,RGBA32I:36226,RGB32I:36227,RGBA16I:36232,RGB16I:36233,RGBA8I:36238,RGB8I:36239,RED_INTEGER:36244,RGB_INTEGER:36248,RGBA_INTEGER:36249,SAMPLER_2D_ARRAY:36289,SAMPLER_2D_ARRAY_SHADOW:36292,SAMPLER_CUBE_SHADOW:36293,UNSIGNED_INT_VEC2:36294,UNSIGNED_INT_VEC3:36295,UNSIGNED_INT_VEC4:36296,INT_SAMPLER_2D:36298,INT_SAMPLER_3D:36299,INT_SAMPLER_CUBE:36300,INT_SAMPLER_2D_ARRAY:36303,UNSIGNED_INT_SAMPLER_2D:36306,UNSIGNED_INT_SAMPLER_3D:36307,UNSIGNED_INT_SAMPLER_CUBE:36308,UNSIGNED_INT_SAMPLER_2D_ARRAY:36311,DEPTH_COMPONENT32F:36012,DEPTH32F_STENCIL8:36013,FLOAT_32_UNSIGNED_INT_24_8_REV:36269,FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING:33296,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE:33297,FRAMEBUFFER_ATTACHMENT_RED_SIZE:33298,FRAMEBUFFER_ATTACHMENT_GREEN_SIZE:33299,FRAMEBUFFER_ATTACHMENT_BLUE_SIZE:33300,FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE:33301,FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE:33302,FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE:33303,FRAMEBUFFER_DEFAULT:33304,UNSIGNED_INT_24_8:34042,DEPTH24_STENCIL8:35056,UNSIGNED_NORMALIZED:35863,DRAW_FRAMEBUFFER_BINDING:36006,READ_FRAMEBUFFER:36008,DRAW_FRAMEBUFFER:36009,READ_FRAMEBUFFER_BINDING:36010,RENDERBUFFER_SAMPLES:36011,FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER:36052,MAX_COLOR_ATTACHMENTS:36063,COLOR_ATTACHMENT1:36065,COLOR_ATTACHMENT2:36066,COLOR_ATTACHMENT3:36067,COLOR_ATTACHMENT4:36068,COLOR_ATTACHMENT5:36069,COLOR_ATTACHMENT6:36070,COLOR_ATTACHMENT7:36071,COLOR_ATTACHMENT8:36072,COLOR_ATTACHMENT9:36073,COLOR_ATTACHMENT10:36074,COLOR_ATTACHMENT11:36075,COLOR_ATTACHMENT12:36076,COLOR_ATTACHMENT13:36077,COLOR_ATTACHMENT14:36078,COLOR_ATTACHMENT15:36079,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE:36182,MAX_SAMPLES:36183,HALF_FLOAT:5131,RG:33319,RG_INTEGER:33320,R8:33321,RG8:33323,R16F:33325,R32F:33326,RG16F:33327,RG32F:33328,R8I:33329,R8UI:33330,R16I:33331,R16UI:33332,R32I:33333,R32UI:33334,RG8I:33335,RG8UI:33336,RG16I:33337,RG16UI:33338,RG32I:33339,RG32UI:33340,VERTEX_ARRAY_BINDING:34229,R8_SNORM:36756,RG8_SNORM:36757,RGB8_SNORM:36758,RGBA8_SNORM:36759,SIGNED_NORMALIZED:36764,COPY_READ_BUFFER:36662,COPY_WRITE_BUFFER:36663,COPY_READ_BUFFER_BINDING:36662,COPY_WRITE_BUFFER_BINDING:36663,UNIFORM_BUFFER:35345,UNIFORM_BUFFER_BINDING:35368,UNIFORM_BUFFER_START:35369,UNIFORM_BUFFER_SIZE:35370,MAX_VERTEX_UNIFORM_BLOCKS:35371,MAX_FRAGMENT_UNIFORM_BLOCKS:35373,MAX_COMBINED_UNIFORM_BLOCKS:35374,MAX_UNIFORM_BUFFER_BINDINGS:35375,MAX_UNIFORM_BLOCK_SIZE:35376,MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS:35377,MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS:35379,UNIFORM_BUFFER_OFFSET_ALIGNMENT:35380,ACTIVE_UNIFORM_BLOCKS:35382,UNIFORM_TYPE:35383,UNIFORM_SIZE:35384,UNIFORM_BLOCK_INDEX:35386,UNIFORM_OFFSET:35387,UNIFORM_ARRAY_STRIDE:35388,UNIFORM_MATRIX_STRIDE:35389,UNIFORM_IS_ROW_MAJOR:35390,UNIFORM_BLOCK_BINDING:35391,UNIFORM_BLOCK_DATA_SIZE:35392,UNIFORM_BLOCK_ACTIVE_UNIFORMS:35394,UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES:35395,UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER:35396,UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER:35398,INVALID_INDEX:4294967295,MAX_VERTEX_OUTPUT_COMPONENTS:37154,MAX_FRAGMENT_INPUT_COMPONENTS:37157,MAX_SERVER_WAIT_TIMEOUT:37137,OBJECT_TYPE:37138,SYNC_CONDITION:37139,SYNC_STATUS:37140,SYNC_FLAGS:37141,SYNC_FENCE:37142,SYNC_GPU_COMMANDS_COMPLETE:37143,UNSIGNALED:37144,SIGNALED:37145,ALREADY_SIGNALED:37146,TIMEOUT_EXPIRED:37147,CONDITION_SATISFIED:37148,WAIT_FAILED:37149,SYNC_FLUSH_COMMANDS_BIT:1,VERTEX_ATTRIB_ARRAY_DIVISOR:35070,ANY_SAMPLES_PASSED:35887,ANY_SAMPLES_PASSED_CONSERVATIVE:36202,SAMPLER_BINDING:35097,RGB10_A2UI:36975,INT_2_10_10_10_REV:36255,TRANSFORM_FEEDBACK:36386,TRANSFORM_FEEDBACK_PAUSED:36387,TRANSFORM_FEEDBACK_ACTIVE:36388,TRANSFORM_FEEDBACK_BINDING:36389,TEXTURE_IMMUTABLE_FORMAT:37167,MAX_ELEMENT_INDEX:36203,TEXTURE_IMMUTABLE_LEVELS:33503,TIMEOUT_IGNORED:-1,MAX_CLIENT_WAIT_TIMEOUT_WEBGL:37447,QUERY_COUNTER_BITS_EXT:34916,TIME_ELAPSED_EXT:35007,TIMESTAMP_EXT:36392,GPU_DISJOINT_EXT:36795,TEXTURE_MAX_ANISOTROPY_EXT:34046,MAX_TEXTURE_MAX_ANISOTROPY_EXT:34047,UNMASKED_VENDOR_WEBGL:37445,UNMASKED_RENDERER_WEBGL:37446,COMPLETION_STATUS_KHR:37297,COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_EXT:33778,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_SRGB_S3TC_DXT1_EXT:35916,COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT:35917,COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT:35918,COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT:35919,COMPRESSED_R11_EAC:37488,COMPRESSED_SIGNED_R11_EAC:37489,COMPRESSED_RG11_EAC:37490,COMPRESSED_SIGNED_RG11_EAC:37491,COMPRESSED_RGB8_ETC2:37492,COMPRESSED_SRGB8_ETC2:37493,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:37494,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:37495,COMPRESSED_RGBA8_ETC2_EAC:37496,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:37497,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGBA_ASTC_4x4_KHR:37808,COMPRESSED_RGBA_ASTC_5x4_KHR:37809,COMPRESSED_RGBA_ASTC_5x5_KHR:37810,COMPRESSED_RGBA_ASTC_6x5_KHR:37811,COMPRESSED_RGBA_ASTC_6x6_KHR:37812,COMPRESSED_RGBA_ASTC_8x5_KHR:37813,COMPRESSED_RGBA_ASTC_8x6_KHR:37814,COMPRESSED_RGBA_ASTC_8x8_KHR:37815,COMPRESSED_RGBA_ASTC_10x5_KHR:37816,COMPRESSED_RGBA_ASTC_10x6_KHR:37817,COMPRESSED_RGBA_ASTC_10x8_KHR:37818,COMPRESSED_RGBA_ASTC_10x10_KHR:37819,COMPRESSED_RGBA_ASTC_12x10_KHR:37820,COMPRESSED_RGBA_ASTC_12x12_KHR:37821,COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:37840,COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:37841,COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:37842,COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:37843,COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:37844,COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:37845,COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:37846,COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:37847,COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:37848,COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:37849,COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:37850,COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:37851,COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:37852,COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:37853},Bt={[i.BYTE]:1,[i.UNSIGNED_BYTE]:1,[i.SHORT]:2,[i.UNSIGNED_SHORT]:2,[i.INT]:4,[i.UNSIGNED_INT]:4,[i.FLOAT]:4},kn={[i.R8]:[i.RED,i.UNSIGNED_BYTE],[i.R8_SNORM]:[i.RED,i.BYTE],[i.R16F]:[i.RED,i.FLOAT],[i.R32F]:[i.RED,i.FLOAT],[i.R8UI]:[i.RED_INTEGER,i.UNSIGNED_BYTE],[i.R8I]:[i.RED_INTEGER,i.BYTE],[i.R16UI]:[i.RED_INTEGER,i.UNSIGNED_SHORT],[i.R16I]:[i.RED_INTEGER,i.SHORT],[i.R32UI]:[i.RED_INTEGER,i.UNSIGNED_INT],[i.R32I]:[i.RED_INTEGER,i.INT],[i.RG8]:[i.RG,i.UNSIGNED_BYTE],[i.RG8_SNORM]:[i.RG,i.BYTE],[i.RG16F]:[i.RG,i.FLOAT],[i.RG32F]:[i.RG,i.FLOAT],[i.RG8UI]:[i.RG_INTEGER,i.UNSIGNED_BYTE],[i.RG8I]:[i.RG_INTEGER,i.BYTE],[i.RG16UI]:[i.RG_INTEGER,i.UNSIGNED_SHORT],[i.RG16I]:[i.RG_INTEGER,i.SHORT],[i.RG32UI]:[i.RG_INTEGER,i.UNSIGNED_INT],[i.RG32I]:[i.RG_INTEGER,i.INT],[i.RGB8]:[i.RGB,i.UNSIGNED_BYTE],[i.SRGB8]:[i.RGB,i.UNSIGNED_BYTE],[i.RGB565]:[i.RGB,i.UNSIGNED_SHORT_5_6_5],[i.RGB8_SNORM]:[i.RGB,i.BYTE],[i.R11F_G11F_B10F]:[i.RGB,i.UNSIGNED_INT_10F_11F_11F_REV],[i.RGB9_E5]:[i.RGB,i.UNSIGNED_INT_5_9_9_9_REV],[i.RGB16F]:[i.RGB,i.FLOAT],[i.RGB32F]:[i.RGB,i.FLOAT],[i.RGB8UI]:[i.RGB_INTEGER,i.UNSIGNED_BYTE],[i.RGB8I]:[i.RGB_INTEGER,i.BYTE],[i.RGB16UI]:[i.RGB_INTEGER,i.UNSIGNED_SHORT],[i.RGB16I]:[i.RGB_INTEGER,i.SHORT],[i.RGB32UI]:[i.RGB_INTEGER,i.UNSIGNED_INT],[i.RGB32I]:[i.RGB_INTEGER,i.INT],[i.RGBA8]:[i.RGBA,i.UNSIGNED_BYTE],[i.SRGB8_ALPHA8]:[i.RGBA,i.UNSIGNED_BYTE],[i.RGBA8_SNORM]:[i.RGBA,i.BYTE],[i.RGB5_A1]:[i.RGBA,i.UNSIGNED_SHORT_5_5_5_1],[i.RGBA4]:[i.RGBA,i.UNSIGNED_SHORT_4_4_4_4],[i.RGB10_A2]:[i.RGBA,i.UNSIGNED_INT_2_10_10_10_REV],[i.RGBA16F]:[i.RGBA,i.FLOAT],[i.RGBA32F]:[i.RGBA,i.FLOAT],[i.RGBA8UI]:[i.RGBA_INTEGER,i.UNSIGNED_BYTE],[i.RGBA8I]:[i.RGBA_INTEGER,i.BYTE],[i.RGB10_A2UI]:[i.RGBA_INTEGER,i.UNSIGNED_INT_2_10_10_10_REV],[i.RGBA16UI]:[i.RGBA_INTEGER,i.UNSIGNED_SHORT],[i.RGBA16I]:[i.RGBA_INTEGER,i.SHORT],[i.RGBA32I]:[i.RGBA_INTEGER,i.INT],[i.RGBA32UI]:[i.RGBA_INTEGER,i.UNSIGNED_INT],[i.DEPTH_COMPONENT16]:[i.DEPTH_COMPONENT,i.UNSIGNED_SHORT],[i.DEPTH_COMPONENT24]:[i.DEPTH_COMPONENT,i.UNSIGNED_INT],[i.DEPTH_COMPONENT32F]:[i.DEPTH_COMPONENT,i.FLOAT],[i.DEPTH24_STENCIL8]:[i.DEPTH_STENCIL,i.UNSIGNED_INT_24_8],[i.DEPTH32F_STENCIL8]:[i.DEPTH_STENCIL,i.FLOAT_32_UNSIGNED_INT_24_8_REV]},wt={[i.COMPRESSED_RGB_S3TC_DXT1_EXT]:!0,[i.COMPRESSED_RGBA_S3TC_DXT1_EXT]:!0,[i.COMPRESSED_RGBA_S3TC_DXT3_EXT]:!0,[i.COMPRESSED_RGBA_S3TC_DXT5_EXT]:!0,[i.COMPRESSED_SRGB_S3TC_DXT1_EXT]:!0,[i.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT]:!0,[i.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT]:!0,[i.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT]:!0,[i.COMPRESSED_R11_EAC]:!0,[i.COMPRESSED_SIGNED_R11_EAC]:!0,[i.COMPRESSED_RG11_EAC]:!0,[i.COMPRESSED_SIGNED_RG11_EAC]:!0,[i.COMPRESSED_RGB8_ETC2]:!0,[i.COMPRESSED_SRGB8_ETC2]:!0,[i.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2]:!0,[i.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2]:!0,[i.COMPRESSED_RGBA8_ETC2_EAC]:!0,[i.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC]:!0,[i.COMPRESSED_RGBA_ASTC_4x4_KHR]:!0,[i.COMPRESSED_RGBA_ASTC_5x4_KHR]:!0,[i.COMPRESSED_RGBA_ASTC_5x5_KHR]:!0,[i.COMPRESSED_RGBA_ASTC_6x5_KHR]:!0,[i.COMPRESSED_RGBA_ASTC_6x6_KHR]:!0,[i.COMPRESSED_RGBA_ASTC_8x5_KHR]:!0,[i.COMPRESSED_RGBA_ASTC_8x6_KHR]:!0,[i.COMPRESSED_RGBA_ASTC_8x8_KHR]:!0,[i.COMPRESSED_RGBA_ASTC_10x5_KHR]:!0,[i.COMPRESSED_RGBA_ASTC_10x6_KHR]:!0,[i.COMPRESSED_RGBA_ASTC_10x8_KHR]:!0,[i.COMPRESSED_RGBA_ASTC_10x10_KHR]:!0,[i.COMPRESSED_RGBA_ASTC_12x10_KHR]:!0,[i.COMPRESSED_RGBA_ASTC_12x12_KHR]:!0,[i.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR]:!0,[i.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR]:!0,[i.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR]:!0,[i.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR]:!0,[i.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR]:!0,[i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR]:!0,[i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR]:!0,[i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR]:!0,[i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR]:!0,[i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR]:!0,[i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR]:!0,[i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR]:!0,[i.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR]:!0,[i.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR]:!0,[i.COMPRESSED_RGB_PVRTC_4BPPV1_IMG]:!0,[i.COMPRESSED_RGB_PVRTC_2BPPV1_IMG]:!0,[i.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG]:!0,[i.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG]:!0},q={},Ut=new Array(1),je={},zn={[i.UNSIGNED_BYTE]:{[i.RED]:i.R8,[i.RG]:i.RG8,[i.RGB]:i.RGB8,[i.RGBA]:i.RGBA8},[i.UNSIGNED_SHORT]:{[i.DEPTH_COMPONENT]:i.DEPTH_COMPONENT16},[i.FLOAT]:{[i.RED]:i.R16F,[i.RG]:i.RG16F,[i.RGB]:i.RGB16F,[i.RGBA]:i.RGBA16F,[i.DEPTH_COMPONENT]:i.DEPTH_COMPONENT32F}};class Xi{constructor(e,r,n){if(this.gl=e,this.texture=null,this.appState=r,this.compressed=wt[n.internalFormat],n.format!==void 0&&(console.warn("Cubemap option 'format' is deprecated and will be removed. Use 'internalFormat' with a sized format instead."),this.compressed=!!wt[n.format],n.type===void 0&&(n.type=n.format===i.DEPTH_COMPONENT?i.UNSIGNED_SHORT:i.UNSIGNED_BYTE),n.internalFormat===void 0&&(this.compressed?n.internalFormat=n.format:n.internalFormat=zn[n.type][n.format])),this.compressed)this.internalFormat=n.internalFormat,this.format=n.internalFormat,this.type=i.UNSIGNED_BYTE;else{this.internalFormat=n.internalFormat!==void 0?n.internalFormat:i.RGBA8;let W=kn[this.internalFormat];this.format=W[0],this.type=n.type!==void 0?n.type:W[1]}this.currentUnit=-1;let s=Array.isArray(n.negX),a=s?n.negX[0]:n.negX,{width:l=a.width,height:o=a.height,flipY:h=!1,premultiplyAlpha:u=!1,minFilter:m=a?i.LINEAR_MIPMAP_NEAREST:i.NEAREST,magFilter:f=a?i.LINEAR:i.NEAREST,wrapS:A=i.REPEAT,wrapT:x=i.REPEAT,compareMode:C=i.NONE,compareFunc:O=i.LEQUAL,minLOD:U=null,maxLOD:F=null,baseLevel:R=null,maxLevel:d=null,maxAnisotropy:V=1}=n;this.width=l,this.height=o,this.flipY=h,this.premultiplyAlpha=u,this.minFilter=m,this.magFilter=f,this.wrapS=A,this.wrapT=x,this.compareMode=C,this.compareFunc=O,this.minLOD=U,this.maxLOD=F,this.baseLevel=R,this.maxLevel=d,this.maxAnisotropy=Math.min(V,q.MAX_TEXTURE_ANISOTROPY),this.mipmaps=m===i.LINEAR_MIPMAP_NEAREST||m===i.LINEAR_MIPMAP_LINEAR,this.miplevelsProvided=s&&n.negX.length>1,this.levels=this.mipmaps?Math.floor(Math.log2(Math.min(this.width,this.height)))+1:1,this.restore(n)}restore(e=je){this.texture=this.gl.createTexture(),this.currentUnit!==-1&&(this.appState.textures[this.currentUnit]=null),this.bind(0),this.gl.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_MAG_FILTER,this.magFilter),this.gl.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_MIN_FILTER,this.minFilter),this.gl.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_WRAP_S,this.wrapS),this.gl.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_WRAP_T,this.wrapT),this.gl.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_COMPARE_FUNC,this.compareFunc),this.gl.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_COMPARE_MODE,this.compareMode),this.baseLevel!==null&&this.gl.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_BASE_LEVEL,this.baseLevel),this.maxLevel!==null&&this.gl.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_MAX_LEVEL,this.maxLevel),this.minLOD!==null&&this.gl.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_MIN_LOD,this.minLOD),this.maxLOD!==null&&this.gl.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_MAX_LOD,this.maxLOD),this.maxAnisotropy>1&&this.gl.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_MAX_ANISOTROPY_EXT,this.maxAnisotropy),this.gl.texStorage2D(i.TEXTURE_CUBE_MAP,this.levels,this.internalFormat,this.width,this.height);let{negX:r,posX:n,negY:s,posY:a,negZ:l,posZ:o}=e;return r&&(this.faceData(i.TEXTURE_CUBE_MAP_NEGATIVE_X,r),this.faceData(i.TEXTURE_CUBE_MAP_POSITIVE_X,n),this.faceData(i.TEXTURE_CUBE_MAP_NEGATIVE_Y,s),this.faceData(i.TEXTURE_CUBE_MAP_POSITIVE_Y,a),this.faceData(i.TEXTURE_CUBE_MAP_NEGATIVE_Z,l),this.faceData(i.TEXTURE_CUBE_MAP_POSITIVE_Z,o)),this.mipmaps&&!this.miplevelsProvided&&this.gl.generateMipmap(i.TEXTURE_CUBE_MAP),this}delete(){return this.texture&&(this.gl.deleteTexture(this.texture),this.texture=null,this.appState.textures[this.currentUnit]=null,this.currentUnit=-1),this}faceData(e,r){Array.isArray(r)||(Ut[0]=r,r=Ut);let n=this.mipmaps?r.length:1,s=this.width,a=this.height,l;if(this.gl.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,this.flipY),this.gl.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.premultiplyAlpha),this.compressed)for(l=0;l<n;++l)this.gl.compressedTexSubImage2D(e,l,0,0,s,a,this.format,r[l]),s=Math.max(s>>1,1),a=Math.max(a>>1,1);else for(l=0;l<n;++l)this.gl.texSubImage2D(e,l,0,0,s,a,this.format,this.type,r[l]),s=Math.max(s>>1,1),a=Math.max(a>>1,1);return this}bind(e){let r=this.appState.textures[e];return this.appState.activeTexture!==e&&(this.gl.activeTexture(i.TEXTURE0+e),this.appState.activeTexture=e),r!==this&&(r&&(r.currentUnit=-1),this.currentUnit!==-1&&(this.appState.textures[this.currentUnit]=null),this.gl.bindTexture(i.TEXTURE_CUBE_MAP,this.texture),this.appState.textures[e]=this,this.currentUnit=e),this}}class ki{constructor(e,r,n,s=null,a){this.gl=e,this.currentProgram=n,this.drawPrimitive=i.TRIANGLES,this.currentVertexArray=s,this.currentTransformFeedback=null,this.appState=r,this.uniformIndices={},this.uniformNames=new Array(q.MAX_UNIFORMS),this.uniformValues=new Array(q.MAX_UNIFORMS),this.uniformCount=0,this.uniformBuffers=new Array(q.MAX_UNIFORM_BUFFERS),this.uniformBlockNames=new Array(q.MAX_UNIFORM_BUFFERS),this.uniformBlockCount=0,this.textures=new Array(q.MAX_TEXTURE_UNITS),this.textureCount=0,this.offsets=new Int32Array(1),this.numElements=new Int32Array(1),this.numInstances=new Int32Array(1),this.baseVertices=new Int32Array(1),this.baseInstances=new Uint32Array(1),this.hasBaseInstancesOrBaseVertices=!1,this.missingExtensionWarningDispatched=!1,this.numDraws=1,this.drawCountsFromVertexArray=!0,a!==void 0&&(console.warn("Primitive argument to 'App.createDrawCall' is deprecated and will be removed. Use 'DrawCall.primitive' instead."),this.primitive(a))}primitive(e){return this.drawPrimitive=e,this}transformFeedback(e){return this.currentTransformFeedback=e,this}uniform(e,r){let n=this.uniformIndices[e];return n===void 0&&(n=this.uniformCount++,this.uniformIndices[e]=n,this.uniformNames[n]=e),this.uniformValues[n]=r,this}texture(e,r){let n=this.currentProgram.samplers[e];return this.textures[n]=r,this}uniformBlock(e,r){let n=this.currentProgram.uniformBlocks[e];return this.uniformBuffers[n]=r,this}drawRanges(...e){this.numDraws=e.length,this.offsets.length<this.numDraws&&(this.offsets=new Int32Array(this.numDraws)),this.numElements.length<this.numDraws&&(this.numElements=new Int32Array(this.numDraws)),this.numInstances.length<this.numDraws&&(this.numInstances=new Int32Array(this.numDraws)),this.baseInstances.length<this.numDraws&&(this.baseInstances=new Uint32Array(this.numDraws)),this.baseVertices.length<this.numDraws&&(this.baseVertices=new Int32Array(this.numDraws));for(let r=0;r<this.numDraws;++r){let n=e[r];this.offsets[r]=n[0],this.numElements[r]=n[1],this.numInstances[r]=n[2]||1,this.baseInstances[r]=n[3]||0,this.baseVertices[r]=n[4]||0,this.hasBaseVertices=this.hasBaseVertices||this.baseVertices[r],this.hasBaseInstances=this.hasBaseInstances||this.baseInstances[r],this.hasBaseInstancesOrBaseVertices=this.hasBaseInstances||this.hasBaseVertices}return this.drawCountsFromVertexArray=!1,this}draw(){let e=this.uniformNames,r=this.uniformValues,n=this.uniformBuffers,s=this.currentProgram.uniformBlockCount,a=this.textures,l=this.currentProgram.samplerCount,o=!1;this.currentProgram.bind(),this.currentVertexArray&&(this.currentVertexArray.bind(),o=this.currentVertexArray.indexed,this.drawCountsFromVertexArray&&(this.numElements[0]=this.currentVertexArray.numElements,this.numInstances[0]=this.currentVertexArray.numInstances));for(let h=0;h<this.uniformCount;++h)this.currentProgram.uniform(e[h],r[h]);for(let h=0;h<s;++h)n[h].bind(h);for(let h=0;h<l;++h)a[h].bind(h);if(this.currentTransformFeedback?(this.currentTransformFeedback.bind(),this.gl.beginTransformFeedback(this.drawPrimitive)):this.appState.transformFeedback&&(this.gl.bindTransformFeedback(i.TRANSFORM_FEEDBACK,null),this.appState.transformFeedback=null),this.hasBaseInstancesOrBaseVertices&&!(q.DRAW_INSTANCED_BASE_VERTEX_BASE_INSTANCE||q.MULTI_DRAW_INSTANCED_BASE_VERTEX_BASE_INSTANCE)&&!this.missingExtensionWarningDispatched&&(console.warn("DrawCall.draw 'baseInstances' or 'baseVertices' have been set but supporting WebGL extensions are not available; Without 'WEBGL_multidraw_instanced_base_vertex_base_instance' or 'WEBGL_draw_instanced_base_vertex_base_instance' are needed for optimal performance."),this.missingExtensionWarningDispatched=!0),q.MULTI_DRAW_INSTANCED_BASE_VERTEX_BASE_INSTANCE){let h=this.appState.extensions.multiDrawInstancedBaseVertexBaseInstance;o?h.multiDrawElementsInstancedBaseVertexBaseInstanceWEBGL(this.drawPrimitive,this.numElements,0,this.currentVertexArray.indexType,this.offsets,0,this.numInstances,0,this.baseVertices,0,this.baseInstances,0,this.numDraws):h.multiDrawArraysInstancedBaseInstanceWEBGL(this.drawPrimitive,this.offsets,0,this.numElements,0,this.numInstances,0,this.baseInstances,0,this.numDraws)}else if(this.hasBaseInstancesOrBaseVertices&&q.DRAW_INSTANCED_BASE_VERTEX_BASE_INSTANCE){let h=this.appState.extensions.drawInstancedBaseVertexBaseInstance;if(o)for(let u=0;u<this.numDraws;++u)h.drawElementsInstancedBaseVertexBaseInstanceWEBGL(this.drawPrimitive,this.numElements[u],this.currentVertexArray.indexType,this.offsets[u],this.numInstances[u],this.baseVertices[u],this.baseInstances[u]);else for(let u=0;u<this.numDraws;++u)h.drawArraysInstancedBaseInstanceWEBGL(this.drawPrimitive,this.offsets[u],this.numElements[u],this.numInstances[u],this.baseInstances[u])}else if(q.MULTI_DRAW_INSTANCED&&!this.hasBaseInstancesOrBaseVertices){let h=this.appState.extensions.multiDrawInstanced;o?h.multiDrawElementsInstancedWEBGL(this.drawPrimitive,this.numElements,0,this.currentVertexArray.indexType,this.offsets,0,this.numInstances,0,this.numDraws):h.multiDrawArraysInstancedWEBGL(this.drawPrimitive,this.offsets,0,this.numElements,0,this.numInstances,0,this.numDraws)}else if(o)for(let h=0;h<this.numDraws;++h)this.hasBaseInstances&&this.currentVertexArray&&this.currentVertexArray.baseOffsetInstanceAttributeBuffers(this.baseInstances[h]),this.gl.drawElementsInstanced(this.drawPrimitive,this.numElements[h],this.currentVertexArray.indexType,this.offsets[h],this.numInstances[h]);else for(let h=0;h<this.numDraws;++h)this.hasBaseInstances&&this.currentVertexArray&&this.currentVertexArray.baseOffsetInstanceAttributeBuffers(this.baseInstances[h]),this.gl.drawArraysInstanced(this.drawPrimitive,this.offsets[h],this.numElements[h],this.numInstances[h]);return this.currentTransformFeedback&&this.gl.endTransformFeedback(),this}}class ft{constructor(e,r,n,s,a=s.width,l=s.height,o,h,u=je){if(this.gl=e,this.binding=n,this.texture=null,this.width=a||0,this.height=l||0,this.depth=o||0,this.is3D=h,this.appState=r,this.compressed=!!wt[u.internalFormat],u.format!==void 0&&(console.warn("Texture option 'format' is deprecated and will be removed. Use 'internalFormat' with a sized format instead."),this.compressed=!!wt[u.format],u.type===void 0&&(u.type=u.format===i.DEPTH_COMPONENT?i.UNSIGNED_SHORT:i.UNSIGNED_BYTE),u.internalFormat===void 0&&(this.compressed?u.internalFormat=u.format:u.internalFormat=zn[u.type][u.format])),this.compressed)this.internalFormat=u.internalFormat,this.format=this.internalFormat,this.type=i.UNSIGNED_BYTE;else{this.internalFormat=u.internalFormat!==void 0?u.internalFormat:i.RGBA8;let ee=kn[this.internalFormat];this.format=ee[0],this.type=u.type!==void 0?u.type:ee[1]}this.currentUnit=-1;let{minFilter:m=s?i.LINEAR_MIPMAP_NEAREST:i.NEAREST,magFilter:f=s?i.LINEAR:i.NEAREST,wrapS:A=i.REPEAT,wrapT:x=i.REPEAT,wrapR:C=i.REPEAT,compareMode:O=i.NONE,compareFunc:U=i.LEQUAL,minLOD:F=null,maxLOD:R=null,baseLevel:d=null,maxLevel:V=null,maxAnisotropy:W=1,flipY:k=!1,premultiplyAlpha:Y=!1}=u;this.minFilter=m,this.magFilter=f,this.wrapS=A,this.wrapT=x,this.wrapR=C,this.compareMode=O,this.compareFunc=U,this.minLOD=F,this.maxLOD=R,this.baseLevel=d,this.maxLevel=V,this.maxAnisotropy=Math.min(W,q.MAX_TEXTURE_ANISOTROPY),this.flipY=k,this.premultiplyAlpha=Y,this.mipmaps=m===i.LINEAR_MIPMAP_NEAREST||m===i.LINEAR_MIPMAP_LINEAR,this.restore(s)}restore(e){return this.texture=null,this.resize(this.width,this.height,this.depth),e&&this.data(e),this}resize(e,r,n){if(n=n||0,this.texture&&e===this.width&&r===this.height&&n===this.depth)return this;this.gl.deleteTexture(this.texture),this.currentUnit!==-1&&(this.appState.textures[this.currentUnit]=null),this.texture=this.gl.createTexture(),this.bind(Math.max(this.currentUnit,0)),this.width=e,this.height=r,this.depth=n,this.gl.texParameteri(this.binding,i.TEXTURE_MIN_FILTER,this.minFilter),this.gl.texParameteri(this.binding,i.TEXTURE_MAG_FILTER,this.magFilter),this.gl.texParameteri(this.binding,i.TEXTURE_WRAP_S,this.wrapS),this.gl.texParameteri(this.binding,i.TEXTURE_WRAP_T,this.wrapT),this.gl.texParameteri(this.binding,i.TEXTURE_WRAP_R,this.wrapR),this.gl.texParameteri(this.binding,i.TEXTURE_COMPARE_FUNC,this.compareFunc),this.gl.texParameteri(this.binding,i.TEXTURE_COMPARE_MODE,this.compareMode),this.minLOD!==null&&this.gl.texParameterf(this.binding,i.TEXTURE_MIN_LOD,this.minLOD),this.maxLOD!==null&&this.gl.texParameterf(this.binding,i.TEXTURE_MAX_LOD,this.maxLOD),this.baseLevel!==null&&this.gl.texParameteri(this.binding,i.TEXTURE_BASE_LEVEL,this.baseLevel),this.maxLevel!==null&&this.gl.texParameteri(this.binding,i.TEXTURE_MAX_LEVEL,this.maxLevel),this.maxAnisotropy>1&&this.gl.texParameteri(this.binding,i.TEXTURE_MAX_ANISOTROPY_EXT,this.maxAnisotropy);let s;return this.is3D?(this.mipmaps?s=Math.floor(Math.log2(Math.max(Math.max(this.width,this.height),this.depth)))+1:s=1,this.gl.texStorage3D(this.binding,s,this.internalFormat,this.width,this.height,this.depth)):(this.mipmaps?s=Math.floor(Math.log2(Math.max(this.width,this.height)))+1:s=1,this.gl.texStorage2D(this.binding,s,this.internalFormat,this.width,this.height)),this}data(e){Array.isArray(e)||(Ut[0]=e,e=Ut);let r=this.mipmaps?e.length:1,n=this.width,s=this.height,a=this.depth,l=this.mipmaps&&e.length===1,o;if(this.bind(Math.max(this.currentUnit,0)),this.gl.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,this.flipY),this.gl.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.premultiplyAlpha),this.compressed)if(this.is3D)for(o=0;o<r;++o)this.gl.compressedTexSubImage3D(this.binding,o,0,0,0,n,s,a,this.format,e[o]),n=Math.max(n>>1,1),s=Math.max(s>>1,1),a=Math.max(a>>1,1);else for(o=0;o<r;++o)this.gl.compressedTexSubImage2D(this.binding,o,0,0,n,s,this.format,e[o]),n=Math.max(n>>1,1),s=Math.max(s>>1,1);else if(this.is3D)for(o=0;o<r;++o)this.gl.texSubImage3D(this.binding,o,0,0,0,n,s,a,this.format,this.type,e[o]),n=Math.max(n>>1,1),s=Math.max(s>>1,1),a=Math.max(a>>1,1);else for(o=0;o<r;++o)this.gl.texSubImage2D(this.binding,o,0,0,n,s,this.format,this.type,e[o]),n=Math.max(n>>1,1),s=Math.max(s>>1,1);return l&&this.gl.generateMipmap(this.binding),this}delete(){return this.texture&&(this.gl.deleteTexture(this.texture),this.texture=null,this.currentUnit!==-1&&this.appState.textures[this.currentUnit]===this&&(this.appState.textures[this.currentUnit]=null,this.currentUnit=-1)),this}bind(e){let r=this.appState.textures[e];return this.appState.activeTexture!==e&&(this.gl.activeTexture(i.TEXTURE0+e),this.appState.activeTexture=e),r!==this&&(r&&(r.currentUnit=-1),this.currentUnit!==-1&&(this.appState.textures[this.currentUnit]=null),this.gl.bindTexture(this.binding,this.texture),this.appState.textures[e]=this,this.currentUnit=e),this}}class vr{constructor(e,r,n,s,a=0){this.gl=e,this.renderbuffer=null,this.width=r,this.height=n,this.internalFormat=s,this.samples=a,this.restore()}restore(){return this.renderbuffer=this.gl.createRenderbuffer(),this.resize(this.width,this.height),this}resize(e,r){return this.width=e,this.height=r,this.gl.bindRenderbuffer(i.RENDERBUFFER,this.renderbuffer),this.gl.renderbufferStorageMultisample(i.RENDERBUFFER,this.samples,this.internalFormat,this.width,this.height),this.gl.bindRenderbuffer(i.RENDERBUFFER,null),this}delete(){return this.gl.deleteRenderbuffer(this.renderbuffer),this.renderbuffer=null,this}}class zi{constructor(e,r){this.gl=e,this.framebuffer=null,this.appState=r,this.numColorTargets=0,this.colorAttachments=[],this.colorAttachmentEnums=[],this.colorAttachmentTargets=[],this.depthAttachment=null,this.depthAttachmentTarget=null,this.width=0,this.height=0,this.restore()}restore(){let e=this.appState.framebuffers;for(let r in e)e[r]===this&&(e[r]=null);return this.framebuffer=this.gl.createFramebuffer(),this}colorTarget(e,r,n=r.is3D?0:i.TEXTURE_2D){if(e>=this.numColorTargets){let l=e+1;this.colorAttachmentEnums.length=l,this.colorAttachments.length=l,this.colorAttachmentTargets.length=l;for(let o=this.numColorTargets;o<l-1;++o)this.colorAttachmentEnums[o]=i.NONE,this.colorAttachments[o]=null,this.colorAttachmentTargets[o]=0;this.numColorTargets=l}this.colorAttachmentEnums[e]=i.COLOR_ATTACHMENT0+e,this.colorAttachments[e]=r,this.colorAttachmentTargets[e]=n;let s=this.bindAndCaptureState(),a=this.appState.drawFramebufferBinding;return r instanceof vr?this.gl.framebufferRenderbuffer(a,this.colorAttachmentEnums[e],i.RENDERBUFFER,r.renderbuffer):r.is3D?this.gl.framebufferTextureLayer(a,this.colorAttachmentEnums[e],r.texture,0,n):this.gl.framebufferTexture2D(a,this.colorAttachmentEnums[e],n,r.texture,0),this.gl.drawBuffers(this.colorAttachmentEnums),this.width=r.width,this.height=r.height,this.restoreState(s),this}depthTarget(e,r=e.is3D?0:i.TEXTURE_2D){let n=this.bindAndCaptureState(),s=this.appState.drawFramebufferBinding;return this.depthAttachment=e,this.depthAttachmentTarget=r,e instanceof vr?this.gl.framebufferRenderbuffer(s,i.DEPTH_ATTACHMENT,i.RENDERBUFFER,e.renderbuffer):e.is3D?this.gl.framebufferTextureLayer(s,i.DEPTH_ATTACHMENT,e.texture,0,r):this.gl.framebufferTexture2D(s,i.DEPTH_ATTACHMENT,r,e.texture,0),this.width=e.width,this.height=e.height,this.restoreState(n),this}resize(e=this.gl.drawingBufferWidth,r=this.gl.drawingBufferHeight){let n=this.bindAndCaptureState(),s=this.appState.drawFramebufferBinding;for(let a=0;a<this.numColorTargets;++a){let l=this.colorAttachments[a];l&&(l.resize(e,r),l instanceof ft&&(l.is3D?this.gl.framebufferTextureLayer(s,this.colorAttachmentEnums[a],l.texture,0,this.colorAttachmentTargets[a]):this.gl.framebufferTexture2D(s,this.colorAttachmentEnums[a],this.colorAttachmentTargets[a],l.texture,0)))}return this.depthAttachment&&(this.depthAttachment.resize(e,r),this.depthAttachment instanceof ft&&(this.depthAttachment.is3D?this.gl.framebufferTextureLayer(s,i.DEPTH_ATTACHMENT,this.depthAttachment.texture,0,this.depthAttachmentTarget):this.gl.framebufferTexture2D(s,i.DEPTH_ATTACHMENT,this.depthAttachmentTarget,this.depthAttachment.texture,0))),this.width=e,this.height=r,this.restoreState(n),this}delete(){if(this.framebuffer){this.gl.deleteFramebuffer(this.framebuffer),this.framebuffer=null;let e=this.appState.framebuffers;for(let r in e)e[r]===this&&(this.gl.bindFramebuffer(r,null),e[r]=null)}return this}getStatus(){let e=this.bindAndCaptureState(),r=this.appState.drawFramebufferBinding,n=this.gl.checkFramebufferStatus(r);return this.restoreState(e),n}bindForDraw(){let e=this.appState.drawFramebufferBinding,r=this.appState.framebuffers;return r[e]!==this&&(this.gl.bindFramebuffer(e,this.framebuffer),r[e]=this),this}bindForRead(){let e=this.appState.readFramebufferBinding,r=this.appState.framebuffers;return r[e]!==this&&(this.gl.bindFramebuffer(e,this.framebuffer),r[e]=this),this}bindAndCaptureState(){let e=this.appState.drawFramebufferBinding,r=this.appState.framebuffers[e];return r!==this&&this.gl.bindFramebuffer(e,this.framebuffer),r}restoreState(e){if(e!==this){let r=this.appState.drawFramebufferBinding;this.gl.bindFramebuffer(r,e?e.framebuffer:null)}return this}get colorTextures(){return console.error("Framebuffer.colorTextures is deprecated and will be removed. Please use Framebuffer.colorAttachments."),this.colorAttachments}get depthTexture(){return console.error("Framebuffer.depthTexture is deprecated and will be removed. Please use Framebuffer.depthAttachment."),this.depthAttachment}}class ht{constructor(e,r,n,s){this.gl=e,this.appState=r,this.shader=null,this.type=n,this.source=s.trim(),this.restore()}restore(){return this.shader=this.gl.createShader(this.type),this.gl.shaderSource(this.shader,this.source),this.gl.compileShader(this.shader),this}translatedSource(){return q.DEBUG_SHADERS?this.appState.extensions.debugShaders.getTranslatedShaderSource(this.shader):"(Unavailable)"}delete(){return this.shader&&(this.gl.deleteShader(this.shader),this.shader=null),this}checkCompilation(){if(!this.gl.getShaderParameter(this.shader,i.COMPILE_STATUS)){let e,r;for(console.error(this.gl.getShaderInfoLog(this.shader)),r=this.source.split(`
`),e=0;e<r.length;++e)console.error(`${e+1}: ${r[e]}`)}return this}}const Z={};Z[i.BOOL]="uniform1i";Z[i.INT]="uniform1i";Z[i.SAMPLER_2D]="uniform1i";Z[i.INT_SAMPLER_2D]="uniform1i";Z[i.UNSIGNED_INT_SAMPLER_2D]="uniform1i";Z[i.SAMPLER_2D_SHADOW]="uniform1i";Z[i.SAMPLER_2D_ARRAY]="uniform1i";Z[i.INT_SAMPLER_2D_ARRAY]="uniform1i";Z[i.UNSIGNED_INT_SAMPLER_2D_ARRAY]="uniform1i";Z[i.SAMPLER_2D_ARRAY_SHADOW]="uniform1i";Z[i.SAMPLER_CUBE]="uniform1i";Z[i.INT_SAMPLER_CUBE]="uniform1i";Z[i.UNSIGNED_INT_SAMPLER_CUBE]="uniform1i";Z[i.SAMPLER_CUBE_SHADOW]="uniform1i";Z[i.SAMPLER_3D]="uniform1i";Z[i.INT_SAMPLER_3D]="uniform1i";Z[i.UNSIGNED_INT_SAMPLER_3D]="uniform1i";Z[i.UNSIGNED_INT]="uniform1ui";Z[i.FLOAT]="uniform1f";Z[i.FLOAT_VEC2]="uniform2f";Z[i.FLOAT_VEC3]="uniform3f";Z[i.FLOAT_VEC4]="uniform4f";Z[i.INT_VEC2]="uniform2i";Z[i.INT_VEC3]="uniform3i";Z[i.INT_VEC4]="uniform4i";Z[i.UNSIGNED_INT_VEC2]="uniform2ui";Z[i.UNSIGNED_INT_VEC3]="uniform3ui";Z[i.UNSIGNED_INT_VEC4]="uniform4ui";Z[i.BOOL_VEC2]="uniform2i";Z[i.BOOL_VEC3]="uniform3i";Z[i.BOOL_VEC4]="uniform4i";Z[i.FLOAT_MAT2]="uniformMatrix2fv";Z[i.FLOAT_MAT3]="uniformMatrix3fv";Z[i.FLOAT_MAT4]="uniformMatrix4fv";Z[i.FLOAT_MAT2x3]="uniformMatrix2x3fv";Z[i.FLOAT_MAT2x4]="uniformMatrix2x4fv";Z[i.FLOAT_MAT3x2]="uniformMatrix3x2fv";Z[i.FLOAT_MAT3x4]="uniformMatrix3x4fv";Z[i.FLOAT_MAT4x2]="uniformMatrix4x2fv";Z[i.FLOAT_MAT4x3]="uniformMatrix4x3fv";const J={};J[i.BOOL]=1;J[i.INT]=1;J[i.SAMPLER_2D]=1;J[i.INT_SAMPLER_2D]=1;J[i.UNSIGNED_INT_SAMPLER_2D]=1;J[i.SAMPLER_2D_SHADOW]=1;J[i.SAMPLER_2D_ARRAY]=1;J[i.INT_SAMPLER_2D_ARRAY]=1;J[i.UNSIGNED_INT_SAMPLER_2D_ARRAY]=1;J[i.SAMPLER_2D_ARRAY_SHADOW]=1;J[i.SAMPLER_CUBE]=1;J[i.INT_SAMPLER_CUBE]=1;J[i.UNSIGNED_INT_SAMPLER_CUBE]=1;J[i.SAMPLER_CUBE_SHADOW]=1;J[i.SAMPLER_3D]=1;J[i.INT_SAMPLER_3D]=1;J[i.UNSIGNED_INT_SAMPLER_3D]=1;J[i.UNSIGNED_INT]=1;J[i.FLOAT]=1;J[i.FLOAT_VEC2]=2;J[i.FLOAT_VEC3]=3;J[i.FLOAT_VEC4]=4;J[i.INT_VEC2]=2;J[i.INT_VEC3]=3;J[i.INT_VEC4]=4;J[i.UNSIGNED_INT_VEC2]=2;J[i.UNSIGNED_INT_VEC3]=3;J[i.UNSIGNED_INT_VEC4]=4;J[i.BOOL_VEC2]=2;J[i.BOOL_VEC3]=3;J[i.BOOL_VEC4]=4;J[i.FLOAT_MAT2]=4;J[i.FLOAT_MAT3]=9;J[i.FLOAT_MAT4]=16;J[i.FLOAT_MAT2x3]=6;J[i.FLOAT_MAT2x4]=8;J[i.FLOAT_MAT3x2]=6;J[i.FLOAT_MAT3x4]=12;J[i.FLOAT_MAT4x2]=8;J[i.FLOAT_MAT4x3]=12;const ce={};ce[i.INT]=Int32Array;ce[i.SAMPLER_2D]=Int32Array;ce[i.INT_SAMPLER_2D]=Int32Array;ce[i.UNSIGNED_INT_SAMPLER_2D]=Int32Array;ce[i.SAMPLER_2D_SHADOW]=Int32Array;ce[i.SAMPLER_2D_ARRAY]=Int32Array;ce[i.INT_SAMPLER_2D_ARRAY]=Int32Array;ce[i.UNSIGNED_INT_SAMPLER_2D_ARRAY]=Int32Array;ce[i.SAMPLER_2D_ARRAY_SHADOW]=Int32Array;ce[i.SAMPLER_CUBE]=Int32Array;ce[i.INT_SAMPLER_CUBE]=Int32Array;ce[i.UNSIGNED_INT_SAMPLER_CUBE]=Int32Array;ce[i.SAMPLER_CUBE_SHADOW]=Int32Array;ce[i.SAMPLER_3D]=Int32Array;ce[i.INT_SAMPLER_3D]=Int32Array;ce[i.UNSIGNED_INT_SAMPLER_3D]=Int32Array;ce[i.UNSIGNED_INT]=Uint32Array;ce[i.FLOAT]=Float32Array;ce[i.FLOAT_VEC2]=Float32Array;ce[i.FLOAT_VEC3]=Float32Array;ce[i.FLOAT_VEC4]=Float32Array;ce[i.INT_VEC2]=Int32Array;ce[i.INT_VEC3]=Int32Array;ce[i.INT_VEC4]=Int32Array;ce[i.UNSIGNED_INT_VEC2]=Uint32Array;ce[i.UNSIGNED_INT_VEC3]=Uint32Array;ce[i.UNSIGNED_INT_VEC4]=Uint32Array;class $r{constructor(e,r,n){this.gl=e,this.handle=r,this.glFuncName=Z[n],this.cache=n===i.BOOL?!1:0}set(e){this.cache!==e&&(this.gl[this.glFuncName](this.handle,e),this.cache=e)}}class Kr{constructor(e,r,n,s){this.gl=e,this.handle=r,this.glFuncName=Z[n]+"v",this.count=s,this.cache=new ce[n](J[n]*s)}set(e){for(let r=0,n=e.length;r<n;++r)if(this.cache[r]!==e[r]){this.gl[this.glFuncName](this.handle,e),this.cache.set(e);return}}}class Wr{constructor(e,r,n,s){this.gl=e,this.handle=r,this.glFuncName=Z[n]+"v",this.count=s,this.cache=new Array(J[n]*s).fill(!1)}set(e){for(let r=0,n=e.length;r<n;++r)if(this.cache[r]!==e[r]){this.gl[this.glFuncName](this.handle,e);for(let s=r;s<n;s++)this.cache[s]=e[s];return}}}class $i{constructor(e,r,n,s){this.gl=e,this.handle=r,this.glFuncName=Z[n],this.count=s,this.cache=new Float32Array(J[n]*s)}set(e){for(let r=0,n=e.length;r<n;++r)if(this.cache[r]!==e[r]){this.gl[this.glFuncName](this.handle,!1,e),this.cache.set(e);return}}}class Yr{constructor(e,r,n,s,a,l,o){this.gl=e,this.appState=r,this.program=null,this.transformFeedbackVaryings=a||null,this.transformFeedbackMode=o||i.SEPARATE_ATTRIBS,this.attributeLocations=l||null,this.uniforms={},this.uniformBlocks={},this.uniformBlockCount=0,this.samplers={},this.samplerCount=0,this.vertexSource=null,this.vertexShader=null,this.fragmentSource=null,this.fragmentShader=null,this.linked=!1,typeof n=="string"?this.vertexSource=n:this.vertexShader=n,typeof s=="string"?this.fragmentSource=s:this.fragmentShader=s,this.initialize()}restore(){return this.initialize(),this.link(),this.checkLinkage(),this}translatedVertexSource(){if(this.vertexShader)return this.vertexShader.translatedSource();{let e=new ht(this.gl,this.appState,i.VERTEX_SHADER,this.vertexSource),r=e.translatedSource();return e.delete(),r}}translatedFragmentSource(){if(this.fragmentShader)return this.fragmentShader.translatedSource();{let e=new ht(this.gl,this.appState,i.FRAGMENT_SHADER,this.fragmentSource),r=e.translatedSource();return e.delete(),r}}delete(){return this.program&&(this.gl.deleteProgram(this.program),this.program=null,this.appState.program===this&&(this.gl.useProgram(null),this.appState.program=null)),this}initialize(){return this.appState.program===this&&(this.gl.useProgram(null),this.appState.program=null),this.linked=!1,this.uniformBlockCount=0,this.samplerCount=0,this.vertexSource&&(this.vertexShader=new ht(this.gl,this.appState,i.VERTEX_SHADER,this.vertexSource)),this.fragmentSource&&(this.fragmentShader=new ht(this.gl,this.appState,i.FRAGMENT_SHADER,this.fragmentSource)),this.program=this.gl.createProgram(),this}link(){if(this.gl.attachShader(this.program,this.vertexShader.shader),this.gl.attachShader(this.program,this.fragmentShader.shader),this.transformFeedbackVaryings&&this.gl.transformFeedbackVaryings(this.program,this.transformFeedbackVaryings,this.transformFeedbackMode),this.attributeLocations)for(let e in this.attributeLocations)this.gl.bindAttribLocation(this.program,this.attributeLocations[e],e);return this.gl.linkProgram(this.program),this}checkCompletion(){return q.PARALLEL_SHADER_COMPILE?this.gl.getProgramParameter(this.program,i.COMPLETION_STATUS_KHR):!0}checkLinkage(){return this.linked?this:(this.gl.getProgramParameter(this.program,i.LINK_STATUS)?(this.linked=!0,this.initVariables()):(console.error(this.gl.getProgramInfoLog(this.program)),this.vertexShader.checkCompilation(),this.fragmentShader.checkCompilation()),this.vertexSource&&(this.vertexShader.delete(),this.vertexShader=null),this.fragmentSource&&(this.fragmentShader.delete(),this.fragmentShader=null),this)}initVariables(){this.bind();let e=this.gl.getProgramParameter(this.program,i.ACTIVE_UNIFORMS),r;for(let s=0;s<e;++s){let a=this.gl.getActiveUniform(this.program,s),l=this.gl.getUniformLocation(this.program,a.name),o=null,h=a.type,u=a.size;switch(h){case i.SAMPLER_2D:case i.INT_SAMPLER_2D:case i.UNSIGNED_INT_SAMPLER_2D:case i.SAMPLER_2D_SHADOW:case i.SAMPLER_2D_ARRAY:case i.INT_SAMPLER_2D_ARRAY:case i.UNSIGNED_INT_SAMPLER_2D_ARRAY:case i.SAMPLER_2D_ARRAY_SHADOW:case i.SAMPLER_CUBE:case i.INT_SAMPLER_CUBE:case i.UNSIGNED_INT_SAMPLER_CUBE:case i.SAMPLER_CUBE_SHADOW:case i.SAMPLER_3D:case i.INT_SAMPLER_3D:case i.UNSIGNED_INT_SAMPLER_3D:r=this.samplerCount++,this.samplers[a.name]=r,this.gl.uniform1i(l,r);break;case i.INT:case i.UNSIGNED_INT:case i.FLOAT:o=u>1?Kr:$r;break;case i.BOOL:o=u>1?Wr:$r;break;case i.FLOAT_VEC2:case i.INT_VEC2:case i.UNSIGNED_INT_VEC2:case i.FLOAT_VEC3:case i.INT_VEC3:case i.UNSIGNED_INT_VEC3:case i.FLOAT_VEC4:case i.INT_VEC4:case i.UNSIGNED_INT_VEC4:o=Kr;break;case i.BOOL_VEC2:case i.BOOL_VEC3:case i.BOOL_VEC4:o=Wr;break;case i.FLOAT_MAT2:case i.FLOAT_MAT3:case i.FLOAT_MAT4:case i.FLOAT_MAT2x3:case i.FLOAT_MAT2x4:case i.FLOAT_MAT3x2:case i.FLOAT_MAT3x4:case i.FLOAT_MAT4x2:case i.FLOAT_MAT4x3:o=$i;break;default:console.error("Unrecognized type for uniform ",a.name);break}o&&(this.uniforms[a.name]=new o(this.gl,l,h,u))}let n=this.gl.getProgramParameter(this.program,i.ACTIVE_UNIFORM_BLOCKS);for(let s=0;s<n;++s){let a=this.gl.getActiveUniformBlockName(this.program,s),l=this.gl.getUniformBlockIndex(this.program,a),o=this.uniformBlockCount++;this.gl.uniformBlockBinding(this.program,l,o),this.uniformBlocks[a]=o}}uniform(e,r){return this.uniforms[e]&&this.uniforms[e].set(r),this}bind(){return this.appState.program!==this&&(this.gl.useProgram(this.program),this.appState.program=this),this}}class $n{constructor(e,r){this.gl=e,this.query=null,this.target=r,this.active=!1,this.result=null,this.restore()}restore(){return this.query=this.gl.createQuery(),this.active=!1,this.result=null,this}begin(){return this.active||(this.gl.beginQuery(this.target,this.query),this.result=null),this}end(){return this.active||(this.gl.endQuery(this.target),this.active=!0),this}ready(){return this.active&&this.gl.getQueryParameter(this.query,i.QUERY_RESULT_AVAILABLE)?(this.active=!1,this.result=Number(this.gl.getQueryParameter(this.query,i.QUERY_RESULT)),!0):!1}delete(){return this.query&&(this.gl.deleteQuery(this.query),this.query=null),this}}class Ki{constructor(e){this.gl=e,this.cpuTimer=window.performance||window.Date,this.gpuTimerQuery=null,this.cpuStartTime=0,this.cpuTime=0,this.gpuTime=0,this.restore()}restore(){return q.GPU_TIMER&&(this.gpuTimerQuery?this.gpuTimerQuery.restore():this.gpuTimerQuery=new $n(this.gl,i.TIME_ELAPSED_EXT)),this.cpuStartTime=0,this.cpuTime=0,this.gpuTime=0,this}start(){return q.GPU_TIMER?this.gpuTimerQuery.active||(this.gpuTimerQuery.begin(),this.cpuStartTime=this.cpuTimer.now()):this.cpuStartTime=this.cpuTimer.now(),this}end(){return q.GPU_TIMER?this.gpuTimerQuery.active||(this.gpuTimerQuery.end(),this.cpuTime=this.cpuTimer.now()-this.cpuStartTime):this.cpuTime=this.cpuTimer.now()-this.cpuStartTime,this}ready(){if(q.GPU_TIMER){if(!this.gpuTimerQuery.active)return!1;var e=this.gpuTimerQuery.ready(),r=this.gl.getParameter(i.GPU_DISJOINT_EXT);return e&&!r?(this.gpuTime=this.gpuTimerQuery.result/1e6,!0):!1}else return!!this.cpuStartTime}delete(){return this.gpuTimerQuery&&(this.gpuTimerQuery.delete(),this.gpuTimerQuery=null),this}}class Wi{constructor(e,r){this.gl=e,this.appState=r,this.transformFeedback=null,this.restore()}restore(){return this.appState.transformFeedback===this&&(this.appState.transformFeedback=null),this.transformFeedback=this.gl.createTransformFeedback(),this}feedbackBuffer(e,r){return this.gl.bindTransformFeedback(i.TRANSFORM_FEEDBACK,this.transformFeedback),this.gl.bindBufferBase(i.TRANSFORM_FEEDBACK_BUFFER,e,r.buffer),this.gl.bindTransformFeedback(i.TRANSFORM_FEEDBACK,null),this.gl.bindBufferBase(i.TRANSFORM_FEEDBACK_BUFFER,e,null),this}delete(){return this.transformFeedback&&(this.gl.deleteTransformFeedback(this.transformFeedback),this.transformFeedback=null,this.appState.transformFeedback===this&&(this.gl.bindTransformFeedback(i.TRANSFORM_FEEDBACK,null),this.appState.transformFeedback=null)),this}bind(){return this.appState.transformFeedback!==this&&(this.gl.bindTransformFeedback(i.TRANSFORM_FEEDBACK,this.transformFeedback),this.appState.transformFeedback=this),this}}class Yi{constructor(e,r,n,s=e.DYNAMIC_DRAW){this.gl=e,this.buffer=null,this.dataViews={},this.offsets=new Array(n.length),this.sizes=new Array(n.length),this.types=new Array(n.length),this.size=0,this.usage=s,this.appState=r,this.currentBase=-1;for(let a=0,l=n.length;a<l;++a){let o=n[a];switch(o){case i.FLOAT:case i.INT:case i.UNSIGNED_INT:case i.BOOL:this.offsets[a]=this.size,this.sizes[a]=1,o===i.INT?this.types[a]=i.INT:o===i.UNSIGNED_INT?this.types[a]=i.UNSIGNED_INT:this.types[a]=i.FLOAT,this.size++;break;case i.FLOAT_VEC2:case i.INT_VEC2:case i.UNSIGNED_INT_VEC2:case i.BOOL_VEC2:this.size+=this.size%2,this.offsets[a]=this.size,this.sizes[a]=2,o===i.INT_VEC2?this.types[a]=i.INT:o===i.UNSIGNED_INT_VEC2?this.types[a]=i.UNSIGNED_INT:this.types[a]=i.FLOAT,this.size+=2;break;case i.FLOAT_VEC3:case i.INT_VEC3:case i.UNSIGNED_INT_VEC3:case i.BOOL_VEC3:case i.FLOAT_VEC4:case i.INT_VEC4:case i.UNSIGNED_INT_VEC4:case i.BOOL_VEC4:this.size+=(4-this.size%4)%4,this.offsets[a]=this.size,this.sizes[a]=4,o===i.INT_VEC4||o===i.INT_VEC3?this.types[a]=i.INT:o===i.UNSIGNED_INT_VEC4||o===i.UNSIGNED_INT_VEC3?this.types[a]=i.UNSIGNED_INT:this.types[a]=i.FLOAT,this.size+=4;break;case i.FLOAT_MAT2:case i.FLOAT_MAT2x3:case i.FLOAT_MAT2x4:this.size+=(4-this.size%4)%4,this.offsets[a]=this.size,this.sizes[a]=8,this.types[a]=i.FLOAT,this.size+=8;break;case i.FLOAT_MAT3:case i.FLOAT_MAT3x2:case i.FLOAT_MAT3x4:this.size+=(4-this.size%4)%4,this.offsets[a]=this.size,this.sizes[a]=12,this.types[a]=i.FLOAT,this.size+=12;break;case i.FLOAT_MAT4:case i.FLOAT_MAT4x2:case i.FLOAT_MAT4x3:this.size+=(4-this.size%4)%4,this.offsets[a]=this.size,this.sizes[a]=16,this.types[a]=i.FLOAT,this.size+=16;break;default:console.error("Unsupported type for uniform buffer.")}}this.size+=(4-this.size%4)%4,this.data=new Float32Array(this.size),this.dataViews[i.FLOAT]=this.data,this.dataViews[i.INT]=new Int32Array(this.data.buffer),this.dataViews[i.UNSIGNED_INT]=new Uint32Array(this.data.buffer),this.dirtyStart=this.size,this.dirtyEnd=0,this.restore()}restore(){return this.currentBase!==-1&&this.appState.uniformBuffers[this.currentBase]===this&&(this.appState.uniformBuffers[this.currentBase]=null),this.buffer=this.gl.createBuffer(),this.gl.bindBuffer(i.UNIFORM_BUFFER,this.buffer),this.gl.bufferData(i.UNIFORM_BUFFER,this.size*4,this.usage),this.gl.bindBuffer(i.UNIFORM_BUFFER,null),this}set(e,r){let n=this.dataViews[this.types[e]],s=this.offsets[e],a=this.sizes[e];return this.sizes[e]===1?n[s]=r:n.set(r,s),s<this.dirtyStart&&(this.dirtyStart=s),this.dirtyEnd<s+a&&(this.dirtyEnd=s+a),this}update(){if(this.dirtyStart>=this.dirtyEnd)return this;let e=this.data.subarray(this.dirtyStart,this.dirtyEnd),r=this.dirtyStart*4;return this.gl.bindBuffer(this.gl.UNIFORM_BUFFER,this.buffer),this.gl.bufferSubData(this.gl.UNIFORM_BUFFER,r,e),this.gl.bindBuffer(this.gl.UNIFORM_BUFFER,null),this.dirtyStart=this.size,this.dirtyEnd=0,this}delete(){return this.buffer&&(this.gl.deleteBuffer(this.buffer),this.buffer=null,this.currentBase!==-1&&this.appState.uniformBuffers[this.currentBase]===this&&(this.appState.uniformBuffers[this.currentBase]=null),this.currentBase=-1),this}bind(e){let r=this.appState.uniformBuffers[e];return r!==this&&(r&&(r.currentBase=-1),this.currentBase!==-1&&(this.appState.uniformBuffers[this.currentBase]=null),this.gl.bindBufferBase(this.gl.UNIFORM_BUFFER,e,this.buffer),this.appState.uniformBuffers[e]=this,this.currentBase=e),this}}class ji{constructor(e,r){this.gl=e,this.appState=r,this.vertexArray=null,this.indexType=null,this.indexed=!1,this.numElements=0,this.numInstances=1,this.offsets=0,this.numDraws=1,this.instanceAttributeBuffers={}}restore(){return this.appState.vertexArray===this&&(this.appState.vertexArray=null),this.vertexArray!==null&&(this.vertexArray=this.gl.createVertexArray()),this}vertexAttributeBuffer(e,r,n=je){return this.attributeBuffer(e,r,n,!1),this}instanceAttributeBuffer(e,r,n=je){return this.attributeBuffer(e,r,n,!0),this.instanceAttributeBuffers[e]={vertexBuffer:r,options:n},this}baseOffsetInstanceAttributeBuffers(e=0){Object.entries(this.instanceAttributeBuffers).forEach(([r,{vertexBuffer:n,options:s}])=>{this.attributeBuffer(Number(r),n,s,!0,e)})}indexBuffer(e){return this.vertexArray===null&&(this.vertexArray=this.gl.createVertexArray()),this.bind(),this.gl.bindBuffer(i.ELEMENT_ARRAY_BUFFER,e.buffer),this.numElements=e.numItems*3,this.indexType=e.type,this.indexed=!0,this}delete(){return this.vertexArray&&(this.gl.deleteVertexArray(this.vertexArray),this.vertexArray=null,this.appState.vertexArray===this&&(this.gl.bindVertexArray(null),this.appState.vertexArray=null)),this}bind(){return this.appState.vertexArray!==this&&(this.gl.bindVertexArray(this.vertexArray),this.appState.vertexArray=this),this}attributeBuffer(e,r,n={},s,a=0){this.vertexArray===null&&(this.vertexArray=this.gl.createVertexArray()),this.bind(),this.gl.bindBuffer(i.ARRAY_BUFFER,r.buffer);let{type:l=r.type,size:o=r.itemSize,stride:h=0,offset:u=0,normalized:m=!1,integer:f=!!(r.integer&&!m)}=n,A=r.numColumns;h===0&&(h=A*o*Bt[l]);let x=Math.ceil((r.byteLength-u)/h);for(let C=0;C<A;++C)f?this.gl.vertexAttribIPointer(e+C,o,l,h,u+C*o*Bt[l]+a*h):this.gl.vertexAttribPointer(e+C,o,l,m,h,u+C*o*Bt[l]+a*h),s&&this.gl.vertexAttribDivisor(e+C,1),this.gl.enableVertexAttribArray(e+C);return this.numDraws===1&&(s?this.numInstances=x:this.indexed||(this.numElements=x)),this.gl.bindBuffer(i.ARRAY_BUFFER,null),this}}const qi={[i.BYTE]:!0,[i.UNSIGNED_BYTE]:!0,[i.SHORT]:!0,[i.UNSIGNED_SHORT]:!0,[i.INT]:!0,[i.UNSIGNED_INT]:!0};class Dt{constructor(e,r,n,s,a,l=e.STATIC_DRAW,o){let h;switch(n){case i.FLOAT_MAT4:case i.FLOAT_MAT4x2:case i.FLOAT_MAT4x3:h=4;break;case i.FLOAT_MAT3:case i.FLOAT_MAT3x2:case i.FLOAT_MAT3x4:h=3;break;case i.FLOAT_MAT2:case i.FLOAT_MAT2x3:case i.FLOAT_MAT2x4:h=2;break;default:h=1}switch(n){case i.FLOAT_MAT4:case i.FLOAT_MAT3x4:case i.FLOAT_MAT2x4:s=4,n=i.FLOAT;break;case i.FLOAT_MAT3:case i.FLOAT_MAT4x3:case i.FLOAT_MAT2x3:s=3,n=i.FLOAT;break;case i.FLOAT_MAT2:case i.FLOAT_MAT3x2:case i.FLOAT_MAT4x2:s=2,n=i.FLOAT;break}let u,m;typeof a=="number"?(u=a,n&&(a*=Bt[n]),m=a):(u=a.length,m=a.byteLength),this.gl=e,this.buffer=null,this.appState=r,this.type=n,this.itemSize=s,this.numItems=n?u/(s*h):m/s,this.numColumns=h,this.byteLength=m,this.usage=l,this.indexArray=!!o,this.integer=!!qi[this.type],this.binding=this.indexArray?i.ELEMENT_ARRAY_BUFFER:i.ARRAY_BUFFER,this.restore(a)}restore(e){return e||(e=this.byteLength),this.appState.vertexArray&&(this.gl.bindVertexArray(null),this.appState.vertexArray=null),this.buffer=this.gl.createBuffer(),this.gl.bindBuffer(this.binding,this.buffer),this.gl.bufferData(this.binding,e,this.usage),this.gl.bindBuffer(this.binding,null),this}data(e,r=0){return this.appState.vertexArray&&(this.gl.bindVertexArray(null),this.appState.vertexArray=null),this.gl.bindBuffer(this.binding,this.buffer),this.gl.bufferSubData(this.binding,r,e),this.gl.bindBuffer(this.binding,null),this}delete(){return this.buffer&&(this.gl.deleteBuffer(this.buffer),this.buffer=null),this}}class Zi{constructor(e){this.gl=e,this.canvas=e.canvas,this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this.viewportX=0,this.viewportY=0,this.viewportWidth=0,this.viewportHeight=0,this.currentDrawCalls=null,this.emptyFragmentShader=null,this.state={program:null,vertexArray:null,transformFeedback:null,activeTexture:-1,textures:new Array(q.MAX_TEXTURE_UNITS),uniformBuffers:new Array(q.MAX_UNIFORM_BUFFERS),freeUniformBufferBases:[],framebuffers:{},drawFramebufferBinding:i.DRAW_FRAMEBUFFER,readFramebufferBinding:i.READ_FRAMEBUFFER,extensions:{}},this.clearBits=this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT|this.gl.STENCIL_BUFFER_BIT,this.cpuTime=0,this.gpuTime=0,this.viewport(0,0,this.width,this.height),this.contextLostExt=null,this.contextLostListener=null,this.contextRestoredListener=null,this.contextRestoredHandler=null,this.initExtensions()}loseContext(){return this.contextLostExt&&this.contextLostExt.loseContext(),this}restoreContext(){return this.contextLostExt&&this.contextLostExt.restoreContext(),this}onContextRestored(e){return this.contextRestoredHandler=e,this.initContextListeners(),this}enable(e){return this.gl.enable(e),this}disable(e){return this.gl.disable(e),this}colorMask(e,r,n,s){return this.gl.colorMask(e,r,n,s),this}clearColor(e,r,n,s){return this.gl.clearColor(e,r,n,s),this}clearMask(e){return this.clearBits=e,this}clear(){return this.gl.clear(this.clearBits),this}drawFramebuffer(e){return e.bindForDraw(),this}readFramebuffer(e){return e.bindForRead(),this}defaultDrawFramebuffer(){let e=this.state.drawFramebufferBinding;return this.state.framebuffers[e]!==null&&(this.gl.bindFramebuffer(e,null),this.state.framebuffers[e]=null),this}defaultReadFramebuffer(){let e=this.state.readFramebufferBinding;return this.state.framebuffers[e]!==null&&(this.gl.bindFramebuffer(e,null),this.state.framebuffers[e]=null),this}blitFramebuffer(e,r=je){let n=this.state.readFramebufferBinding,s=this.state.drawFramebufferBinding,a=this.state.framebuffers[n],l=this.state.framebuffers[s],o=a?a.width:this.width,h=a?a.height:this.height,u=l?l.width:this.width,m=l?l.height:this.height,{srcStartX:f=0,srcStartY:A=0,srcEndX:x=o,srcEndY:C=h,dstStartX:O=0,dstStartY:U=0,dstEndX:F=u,dstEndY:R=m,filter:d=i.NEAREST}=r;return this.gl.blitFramebuffer(f,A,x,C,O,U,F,R,e,d),this}depthRange(e,r){return this.gl.depthRange(e,r),this}depthMask(e){return this.gl.depthMask(e),this}depthFunc(e){return this.gl.depthFunc(e),this}blendFunc(e,r){return this.gl.blendFunc(e,r),this}blendFuncSeparate(e,r,n,s){return this.gl.blendFuncSeparate(e,r,n,s),this}blendEquation(e){return this.gl.blendEquation(e),this}stencilMask(e){return this.gl.stencilMask(e),this}stencilMaskSeparate(e,r){return this.gl.stencilMaskSeparate(e,r),this}stencilFunc(e,r,n){return this.gl.stencilFunc(e,r,n),this}stencilFuncSeparate(e,r,n,s){return this.gl.stencilFuncSeparate(e,r,n,s),this}stencilOp(e,r,n){return this.gl.stencilOp(e,r,n),this}stencilOpSeparate(e,r,n,s){return this.gl.stencilOpSeparate(e,r,n,s),this}scissor(e,r,n,s){return this.gl.scissor(e,r,n,s),this}polygonOffset(e,r){return this.gl.polygonOffset(e,r),this}readPixel(e,r,n,s=je){let{format:a=i.RGBA,type:l=i.UNSIGNED_BYTE}=s;return this.gl.readPixels(e,r,1,1,a,l,n),this}viewport(e,r,n,s){return(this.viewportWidth!==n||this.viewportHeight!==s||this.viewportX!==e||this.viewportY!==r)&&(this.viewportX=e,this.viewportY=r,this.viewportWidth=n,this.viewportHeight=s,this.gl.viewport(e,r,this.viewportWidth,this.viewportHeight)),this}defaultViewport(){return this.viewport(0,0,this.width,this.height),this}resize(e,r){return this.canvas.width=e,this.canvas.height=r,this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this.viewport(0,0,this.width,this.height),this}createProgram(e,r,n={}){let{transformFeedbackVaryings:s,attributeLocations:a,transformFeedbackMode:l}=n;return new Yr(this.gl,this.state,e,r,s,a,l).link().checkLinkage()}createPrograms(...e){return new Promise((r,n)=>{let s=e.length,a=new Array(s),l=new Array(s),o=s;for(let u=0;u<s;++u){let m=e[u],f=m[0],A=m[1],x=m[2]||{},{transformFeedbackVaryings:C,attributeLocations:O,transformFeedbackMode:U}=x;a[u]=new Yr(this.gl,this.state,f,A,C,O,U),l[u]=a[u]}for(let u=0;u<s;++u)a[u].link();let h=()=>{let u=0;for(let m=0;m<o;++m)if(l[m].checkCompletion())if(l[m].checkLinkage(),l[m].linked)++u;else{n(new Error("Program linkage failed"));return}else l[m-u]=l[m];o-=u,o===0?r(a):requestAnimationFrame(h)};h()})}restorePrograms(...e){return new Promise((r,n)=>{let s=e.length,a=e.slice(),l=s;for(let h=0;h<s;++h)e[h].initialize();for(let h=0;h<s;++h)e[h].link();for(let h=0;h<s;++h)e[h].checkCompletion();let o=()=>{let h=0;for(let u=0;u<l;++u)if(a[u].checkCompletion())if(a[u].checkLinkage(),a[u].linked)++h;else{n(new Error("Program linkage failed"));return}else a[u-h]=a[u];l-=h,l===0?r():requestAnimationFrame(o)};o()})}createShader(e,r){return new ht(this.gl,this.state,e,r)}createVertexArray(){return new ji(this.gl,this.state)}createTransformFeedback(){return new Wi(this.gl,this.state)}createVertexBuffer(e,r,n,s){return new Dt(this.gl,this.state,e,r,n,s)}createMatrixBuffer(e,r,n){return new Dt(this.gl,this.state,e,0,r,n)}createInterleavedBuffer(e,r,n){return new Dt(this.gl,this.state,null,e,r,n)}createIndexBuffer(e,r,n,s){return ArrayBuffer.isView(r)&&(s=n,n=r,r=3),new Dt(this.gl,this.state,e,r,n,s,!0)}createUniformBuffer(e,r){return new Yi(this.gl,this.state,e,r)}createTexture2D(e,r,n,s){return typeof e=="number"?(s=n,n=r,r=e,e=null):n===void 0&&(s=r,r=e.width,n=e.height),new ft(this.gl,this.state,this.gl.TEXTURE_2D,e,r,n,void 0,!1,s)}createTextureArray(e,r,n,s,a){return typeof e=="number"&&(a=s,s=n,n=r,r=e,e=null),new ft(this.gl,this.state,this.gl.TEXTURE_2D_ARRAY,e,r,n,s,!0,a)}createTexture3D(e,r,n,s,a){return typeof e=="number"&&(a=s,s=n,n=r,r=e,e=null),new ft(this.gl,this.state,this.gl.TEXTURE_3D,e,r,n,s,!0,a)}createCubemap(e){return new Xi(this.gl,this.state,e)}createRenderbuffer(e,r,n,s=0){return new vr(this.gl,e,r,n,s)}createFramebuffer(){return new zi(this.gl,this.state)}createQuery(e){return new $n(this.gl,e)}createTimer(){return new Ki(this.gl)}createDrawCall(e,r,n){return new ki(this.gl,this.state,e,r,n)}initExtensions(){this.gl.getExtension("EXT_color_buffer_float"),this.gl.getExtension("OES_texture_float_linear"),this.gl.getExtension("WEBGL_compressed_texture_s3tc"),this.gl.getExtension("WEBGL_compressed_texture_s3tc_srgb"),this.gl.getExtension("WEBGL_compressed_texture_etc"),this.gl.getExtension("WEBGL_compressed_texture_astc"),this.gl.getExtension("WEBGL_compressed_texture_pvrtc"),this.gl.getExtension("EXT_disjoint_timer_query_webgl2"),this.gl.getExtension("EXT_disjoint_timer_query"),this.gl.getExtension("EXT_texture_filter_anisotropic"),this.state.extensions.debugShaders=this.gl.getExtension("WEBGL_debug_shaders"),this.contextLostExt=this.gl.getExtension("WEBGL_lose_context"),this.gl.getExtension("KHR_parallel_shader_compile"),this.state.extensions.multiDrawInstanced=this.gl.getExtension("WEBGL_multi_draw_instanced"),this.state.extensions.drawInstancedBaseVertexBaseInstance=this.gl.getExtension("WEBGL_draw_instanced_base_vertex_base_instance"),this.state.extensions.multiDrawInstancedBaseVertexBaseInstance=this.gl.getExtension("WEBGL_multi_draw_instanced_base_vertex_base_instance")}initContextListeners(){this.contextRestoredHandler?(this.contextLostListener=e=>{e.preventDefault()},this.contextRestoredListener=()=>{this.initExtensions(),this.contextRestoredHandler()},this.canvas.addEventListener("webglcontextlost",this.contextLostListener),this.canvas.addEventListener("webglcontextrestored",this.contextRestoredListener)):(this.canvas.removeEventListener("webglcontextlost",this.contextLostListener),this.canvas.removeEventListener("webglcontextrestored",this.contextRestoredListener),this.contextLostListener=null,this.contextRestoredListener=null)}depthTest(){return console.warn("App.depthTest is deprecated. Use App.enable(PicoGL.DEPTH_TEST) instead."),this.enable(i.DEPTH_TEST),this}noDepthTest(){return console.warn("App.noDepthTest is deprecated. Use App.disable(PicoGL.DEPTH_TEST) instead."),this.disable(i.DEPTH_TEST),this}blend(){return console.warn("App.blend is deprecated. Use App.enable(PicoGL.BLEND) instead."),this.enable(i.BLEND),this}noBlend(){return console.warn("App.noBlend is deprecated. Use App.disable(PicoGL.BLEND) instead."),this.disable(i.BLEND),this}stencilTest(){return console.warn("App.stencilTest is deprecated. Use App.enable(PicoGL.STENCIL_TEST) instead."),this.enable(i.STENCIL_TEST),this}noStencilTest(){return console.warn("App.noStencilTest is deprecated. Use App.disable(PicoGL.STENCIL_TEST) instead."),this.disable(i.STENCIL_TEST),this}scissorTest(){return console.warn("App.scissorTest is deprecated. Use App.enable(PicoGL.SCISSOR_TEST) instead."),this.enable(i.SCISSOR_TEST),this}noScissorTest(){return console.warn("App.noScissorTest is deprecated. Use App.disable(PicoGL.SCISSOR_TEST) instead."),this.disable(i.SCISSOR_TEST),this}rasterize(){return console.warn("App.noRasterize is deprecated. Use App.disable(PicoGL.RASTERIZER_DISCARD) instead."),this.disable(i.RASTERIZER_DISCARD),this}noRasterize(){return console.warn("App.rasterize is deprecated. Use App.enable(PicoGL.RASTERIZER_DISCARD) instead."),this.enable(i.RASTERIZER_DISCARD),this}cullBackfaces(){return console.warn("App.cullBackfaces is deprecated. Use App.enable(PicoGL.CULL_FACE) instead."),this.enable(i.CULL_FACE),this}drawBackfaces(){return console.warn("App.drawBackfaces is deprecated. Use App.disable(PicoGL.CULL_FACE) instead."),this.disable(i.CULL_FACE),this}}let jr=!1;const G=Object.assign({version:"0.17.9",WEBGL_INFO:q,createApp(t,e){return t.tagName==="CANVAS"&&(t=t.getContext("webgl2",e)),jr||(q.MAX_TEXTURE_UNITS=t.getParameter(i.MAX_COMBINED_TEXTURE_IMAGE_UNITS),q.MAX_UNIFORM_BUFFERS=t.getParameter(i.MAX_UNIFORM_BUFFER_BINDINGS),q.MAX_UNIFORMS=Math.min(t.getParameter(i.MAX_VERTEX_UNIFORM_VECTORS),t.getParameter(i.MAX_FRAGMENT_UNIFORM_VECTORS)),q.SAMPLES=t.getParameter(i.SAMPLES),q.VENDOR="(Unknown)",q.RENDERER="(Unknown)",q.FLOAT_RENDER_TARGETS=!!t.getExtension("EXT_color_buffer_float"),q.LINEAR_FLOAT_TEXTURES=!!t.getExtension("OES_texture_float_linear"),q.S3TC_TEXTURES=!!t.getExtension("WEBGL_compressed_texture_s3tc"),q.S3TC_SRGB_TEXTURES=!!t.getExtension("WEBGL_compressed_texture_s3tc_srgb"),q.ETC_TEXTURES=!!t.getExtension("WEBGL_compressed_texture_etc"),q.ASTC_TEXTURES=!!t.getExtension("WEBGL_compressed_texture_astc"),q.PVRTC_TEXTURES=!!t.getExtension("WEBGL_compressed_texture_pvrtc"),q.LOSE_CONTEXT=!!t.getExtension("WEBGL_lose_context"),q.DEBUG_SHADERS=!!t.getExtension("WEBGL_debug_shaders"),q.GPU_TIMER=!!(t.getExtension("EXT_disjoint_timer_query_webgl2")||t.getExtension("EXT_disjoint_timer_query")),q.TEXTURE_ANISOTROPY=!!t.getExtension("EXT_texture_filter_anisotropic"),q.MAX_TEXTURE_ANISOTROPY=q.TEXTURE_ANISOTROPY?t.getParameter(i.MAX_TEXTURE_MAX_ANISOTROPY_EXT):1,q.DEBUG_RENDERER_INFO=!!t.getExtension("WEBGL_debug_renderer_info"),q.DEBUG_RENDERER_INFO&&(q.VENDOR=t.getParameter(i.UNMASKED_VENDOR_WEBGL),q.RENDERER=t.getParameter(i.UNMASKED_RENDERER_WEBGL)),q.PARALLEL_SHADER_COMPILE=!!t.getExtension("KHR_parallel_shader_compile"),q.MULTI_DRAW_INSTANCED=!!t.getExtension("WEBGL_multi_draw_instanced"),q.DRAW_INSTANCED_BASE_VERTEX_BASE_INSTANCE=!!t.getExtension("WEBGL_draw_instanced_base_vertex_base_instance"),q.MULTI_DRAW_INSTANCED_BASE_VERTEX_BASE_INSTANCE=!!t.getExtension("WEBGL_multi_draw_instanced_base_vertex_base_instance"),jr=!0),new Zi(t)}},i);var Pe=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Qi(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var ie={},Ji={get exports(){return ie},set exports(t){ie=t}},Gt={},es={get exports(){return Gt},set exports(t){Gt=t}},qr;function ts(){return qr||(qr=1,function(t,e){(function(r,n){t.exports=n()})(Pe,function(){var r={isEqual:!0,isMatchingKey:!0,isPromise:!0,maxSize:!0,onCacheAdd:!0,onCacheChange:!0,onCacheHit:!0,transformKey:!0},n=Array.prototype.slice;function s(f){var A=f.length;return A?A===1?[f[0]]:A===2?[f[0],f[1]]:A===3?[f[0],f[1],f[2]]:n.call(f,0):[]}function a(f){var A={};for(var x in f)r[x]||(A[x]=f[x]);return A}function l(f){return typeof f=="function"&&f.isMemoized}function o(f,A){return f===A||f!==f&&A!==A}function h(f,A){var x={};for(var C in f)x[C]=f[C];for(var C in A)x[C]=A[C];return x}var u=function(){function f(A){this.keys=[],this.values=[],this.options=A;var x=typeof A.isMatchingKey=="function";x?this.getKeyIndex=this._getKeyIndexFromMatchingKey:A.maxSize>1?this.getKeyIndex=this._getKeyIndexForMany:this.getKeyIndex=this._getKeyIndexForSingle,this.canTransformKey=typeof A.transformKey=="function",this.shouldCloneArguments=this.canTransformKey||x,this.shouldUpdateOnAdd=typeof A.onCacheAdd=="function",this.shouldUpdateOnChange=typeof A.onCacheChange=="function",this.shouldUpdateOnHit=typeof A.onCacheHit=="function"}return Object.defineProperty(f.prototype,"size",{get:function(){return this.keys.length},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"snapshot",{get:function(){return{keys:s(this.keys),size:this.size,values:s(this.values)}},enumerable:!1,configurable:!0}),f.prototype._getKeyIndexFromMatchingKey=function(A){var x=this.options,C=x.isMatchingKey,O=x.maxSize,U=this.keys,F=U.length;if(!F)return-1;if(C(U[0],A))return 0;if(O>1){for(var R=1;R<F;R++)if(C(U[R],A))return R}return-1},f.prototype._getKeyIndexForMany=function(A){var x=this.options.isEqual,C=this.keys,O=C.length;if(!O)return-1;if(O===1)return this._getKeyIndexForSingle(A);var U=A.length,F,R;if(U>1){for(var d=0;d<O;d++)if(F=C[d],F.length===U){for(R=0;R<U&&x(F[R],A[R]);R++);if(R===U)return d}}else for(var d=0;d<O;d++)if(F=C[d],F.length===U&&x(F[0],A[0]))return d;return-1},f.prototype._getKeyIndexForSingle=function(A){var x=this.keys;if(!x.length)return-1;var C=x[0],O=C.length;if(A.length!==O)return-1;var U=this.options.isEqual;if(O>1){for(var F=0;F<O;F++)if(!U(C[F],A[F]))return-1;return 0}return U(C[0],A[0])?0:-1},f.prototype.orderByLru=function(A,x,C){for(var O=this.keys,U=this.values,F=O.length,R=C;R--;)O[R+1]=O[R],U[R+1]=U[R];O[0]=A,U[0]=x;var d=this.options.maxSize;F===d&&C===F?(O.pop(),U.pop()):C>=d&&(O.length=U.length=d)},f.prototype.updateAsyncCache=function(A){var x=this,C=this.options,O=C.onCacheChange,U=C.onCacheHit,F=this.keys[0],R=this.values[0];this.values[0]=R.then(function(d){return x.shouldUpdateOnHit&&U(x,x.options,A),x.shouldUpdateOnChange&&O(x,x.options,A),d},function(d){var V=x.getKeyIndex(F);throw V!==-1&&(x.keys.splice(V,1),x.values.splice(V,1)),d})},f}();function m(f,A){if(A===void 0&&(A={}),l(f))return m(f.fn,h(f.options,A));if(typeof f!="function")throw new TypeError("You must pass a function to `memoize`.");var x=A.isEqual,C=x===void 0?o:x,O=A.isMatchingKey,U=A.isPromise,F=U===void 0?!1:U,R=A.maxSize,d=R===void 0?1:R,V=A.onCacheAdd,W=A.onCacheChange,k=A.onCacheHit,Y=A.transformKey,ee=h({isEqual:C,isMatchingKey:O,isPromise:F,maxSize:d,onCacheAdd:V,onCacheChange:W,onCacheHit:k,transformKey:Y},a(A)),se=new u(ee),_e=se.keys,T=se.values,H=se.canTransformKey,$=se.shouldCloneArguments,N=se.shouldUpdateOnAdd,S=se.shouldUpdateOnChange,z=se.shouldUpdateOnHit,X=function(){var Q=$?s(arguments):arguments;H&&(Q=Y(Q));var le=_e.length?se.getKeyIndex(Q):-1;if(le!==-1)z&&k(se,ee,X),le&&(se.orderByLru(_e[le],T[le],le),S&&W(se,ee,X));else{var ue=f.apply(this,arguments),b=$?Q:s(arguments);se.orderByLru(b,ue,_e.length),F&&se.updateAsyncCache(X),N&&V(se,ee,X),S&&W(se,ee,X)}return T[0]};return X.cache=se,X.fn=f,X.isMemoized=!0,X.options=ee,X}return m})}(es)),Gt}var Et={},rs={get exports(){return Et},set exports(t){Et=t}},Zr;function ns(){return Zr||(Zr=1,function(t,e){(function(r,n){n(e)})(Pe,function(r){var n=typeof WeakMap=="function",s=Object.keys;function a(T,H){return T===H||T!==T&&H!==H}function l(T){return T.constructor===Object||T.constructor==null}function o(T){return!!T&&typeof T.then=="function"}function h(T){return!!(T&&T.$$typeof)}function u(){var T=[];return{delete:function(H){for(var $=0;$<T.length;++$)if(T[$][0]===H){T.splice($,1);return}},get:function(H){for(var $=0;$<T.length;++$)if(T[$][0]===H)return T[$][1]},set:function(H,$){for(var N=0;N<T.length;++N)if(T[N][0]===H){T[N][1]=$;return}T.push([H,$])}}}var m=function(T){return T?function(){return new WeakMap}:u}(n);function f(T){return function($){var N=T||$;return function(z,X,Q,le,ue,b,E){E===void 0&&(E=m());var g=!!z&&typeof z=="object",I=!!X&&typeof X=="object";if(g!==I)return!1;if(!g&&!I)return N(z,X,E);var w=E.get(z);if(w&&E.get(X))return w===X;E.set(z,X),E.set(X,z);var p=N(z,X,E);return E.delete(z),E.delete(X),p}}}function A(T,H,$,N){var S=T.length;if(H.length!==S)return!1;for(;S-- >0;)if(!$(T[S],H[S],S,S,T,H,N))return!1;return!0}function x(T,H,$,N){var S=T.size===H.size;if(S&&T.size){var z={},X=0;T.forEach(function(Q,le){if(S){var ue=!1,b=0;H.forEach(function(E,g){!ue&&!z[b]&&(ue=$(le,g,X,b,T,H,N)&&$(Q,E,le,g,T,H,N),ue&&(z[b]=!0)),b++}),X++,S=ue}})}return S}var C="_owner",O=Function.prototype.bind.call(Function.prototype.call,Object.prototype.hasOwnProperty);function U(T,H,$,N){var S=s(T),z=S.length;if(s(H).length!==z)return!1;if(z)for(var X=void 0;z-- >0;){if(X=S[z],X===C){var Q=h(T),le=h(H);if((Q||le)&&Q!==le)return!1}if(!O(H,X)||!$(T[X],H[X],X,X,T,H,N))return!1}return!0}var F=function(){return/foo/g.flags==="g"?function(H,$){return H.source===$.source&&H.flags===$.flags}:function(H,$){return H.source===$.source&&H.global===$.global&&H.ignoreCase===$.ignoreCase&&H.multiline===$.multiline&&H.unicode===$.unicode&&H.sticky===$.sticky&&H.lastIndex===$.lastIndex}}();function R(T,H,$,N){var S=T.size===H.size;if(S&&T.size){var z={};T.forEach(function(X,Q){if(S){var le=!1,ue=0;H.forEach(function(b,E){!le&&!z[ue]&&(le=$(X,b,Q,E,T,H,N),le&&(z[ue]=!0)),ue++}),S=le}})}return S}var d=typeof Map=="function",V=typeof Set=="function",W=Object.prototype.valueOf;function k(T){var H=typeof T=="function"?T($):function(N,S,z,X,Q,le,ue){return $(N,S,ue)};function $(N,S,z){if(N===S)return!0;if(N&&S&&typeof N=="object"&&typeof S=="object"){if(l(N)&&l(S))return U(N,S,H,z);var X=Array.isArray(N),Q=Array.isArray(S);return X||Q?X===Q&&A(N,S,H,z):(X=N instanceof Date,Q=S instanceof Date,X||Q?X===Q&&a(N.getTime(),S.getTime()):(X=N instanceof RegExp,Q=S instanceof RegExp,X||Q?X===Q&&F(N,S):o(N)||o(S)?N===S:d&&(X=N instanceof Map,Q=S instanceof Map,X||Q)?X===Q&&x(N,S,H,z):V&&(X=N instanceof Set,Q=S instanceof Set,X||Q)?X===Q&&R(N,S,H,z):N.valueOf!==W||S.valueOf!==W?a(N.valueOf(),S.valueOf()):U(N,S,H,z)))}return N!==N&&S!==S}return $}var Y=k(),ee=k(function(){return a}),se=k(f()),_e=k(f(a));r.circularDeepEqual=se,r.circularShallowEqual=_e,r.createCustomEqual=k,r.deepEqual=Y,r.sameValueZeroEqual=a,r.shallowEqual=ee,Object.defineProperty(r,"__esModule",{value:!0})})}(rs,Et)),Et}(function(t,e){(function(r,n){t.exports=n(ts(),ns())})(Pe,function(r,n){function s(){return s=Object.assign?Object.assign.bind():function(c){for(var _=1;_<arguments.length;_++){var D=arguments[_];for(var v in D)Object.prototype.hasOwnProperty.call(D,v)&&(c[v]=D[v])}return c},s.apply(this,arguments)}function a(c,_){if(c==null)return{};var D={},v=Object.keys(c),M,P;for(P=0;P<v.length;P++)M=v[P],!(_.indexOf(M)>=0)&&(D[M]=c[M]);return D}var l={isDeepEqual:!1,isPromise:!1,isReact:!1,isSerialized:!1,isShallowEqual:!1,matchesArg:void 0,matchesKey:void 0,maxAge:void 0,maxArgs:void 0,maxSize:1,onExpire:void 0,profileName:void 0,serializer:void 0,updateCacheForKey:void 0,transformArgs:void 0,updateExpire:!1};function o(){for(var c=arguments.length,_=new Array(c),D=0;D<c;D++)_[D]=arguments[D];return _.reduce(function(v,M){if(typeof v=="function")return typeof M=="function"?function(){v.apply(this,arguments),M.apply(this,arguments)}:v;if(typeof M=="function")return M})}function h(){for(var c=arguments.length,_=new Array(c),D=0;D<c;D++)_[D]=arguments[D];return _.reduce(function(v,M){if(typeof v=="function")return typeof M=="function"?function(){return v(M.apply(this,arguments))}:v;if(typeof M=="function")return M})}function u(c,_){for(var D=0;D<c.length;D++)if(c[D].key===_)return D;return-1}function m(c,_){var D=typeof _=="function"?_:function(v,M){for(var P=0;P<M.length;P++)if(!c(v[P],M[P]))return!1;return!0};return function(v,M){for(var P=0;P<v.length;P++)if(v[P].length===M.length&&D(v[P],M))return P;return-1}}function f(c,_){return!_||_===l?c:s({},c,_,{onCacheAdd:o(c.onCacheAdd,_.onCacheAdd),onCacheChange:o(c.onCacheChange,_.onCacheChange),onCacheHit:o(c.onCacheHit,_.onCacheHit),transformArgs:h(c.transformArgs,_.transformArgs)})}function A(c){return typeof c=="function"&&c.isMoized}function x(c,_,D){try{var v=D||_||"anonymous";Object.defineProperty(c,"name",{configurable:!0,enumerable:!1,value:"moized("+v+")",writable:!0})}catch{}}function C(c,_,D){var v=u(c,_);v!==-1&&(clearTimeout(c[v].timeoutId),D&&c.splice(v,1))}function O(c,_){var D=setTimeout(c,_);return typeof D.unref=="function"&&D.unref(),D}function U(c,_,D,v){var M=_.maxAge;return function P(B,j,Ee){var he=B.keys[0];if(u(c,he)===-1){var de=function(){var ve=m(D,v),Ie=ve(B.keys,he),He=B.values[Ie];~Ie&&(B.keys.splice(Ie,1),B.values.splice(Ie,1),typeof _.onCacheChange=="function"&&_.onCacheChange(B,j,Ee)),C(c,he,!0),typeof _.onExpire=="function"&&_.onExpire(he)===!1&&(B.keys.unshift(he),B.values.unshift(He),P(B,j,Ee),typeof _.onCacheChange=="function"&&_.onCacheChange(B,j,Ee))};c.push({expirationMethod:de,key:he,timeoutId:O(de,M)})}}}function F(c,_){return function(v){var M=v.keys[0],P=u(c,M);~P&&(C(c,M,!1),c[P].timeoutId=O(c[P].expirationMethod,_.maxAge))}}function R(c,_,D,v){var M=typeof _.maxAge=="number"&&isFinite(_.maxAge)?U(c,_,D,v):void 0;return{onCacheAdd:M,onCacheHit:M&&_.updateExpire?F(c,_):void 0}}var d={anonymousProfileNameCounter:1,isCollectingStats:!1,profiles:{}},V=!1;function W(c){c?delete d.profiles[c]:d.profiles={}}function k(c){c===void 0&&(c=!0),d.isCollectingStats=c}function Y(c){var _=c.profileName;return function(){_&&!d.profiles[_]&&(d.profiles[_]={calls:0,hits:0}),d.profiles[_].calls++}}function ee(c){return function(){var _=d.profiles,D=c.profileName;_[D]||(_[D]={calls:0,hits:0}),_[D].calls++,_[D].hits++}}function se(c){return c.displayName||c.name||"Anonymous "+d.anonymousProfileNameCounter++}function _e(c,_){return c?(_/c*100).toFixed(4)+"%":"0.0000%"}function T(c){!d.isCollectingStats&&!V&&(console.warn('Stats are not currently being collected, please run "collectStats" to enable them.'),V=!0);var _=d.profiles;if(c){if(!_[c])return{calls:0,hits:0,usage:"0.0000%"};var D=_[c];return s({},D,{usage:_e(D.calls,D.hits)})}var v=Object.keys(d.profiles).reduce(function(M,P){return M.calls+=_[P].calls,M.hits+=_[P].hits,M},{calls:0,hits:0});return s({},v,{profiles:Object.keys(_).reduce(function(M,P){return M[P]=T(P),M},{}),usage:_e(v.calls,v.hits)})}function H(c){return d.isCollectingStats?{onCacheAdd:Y(c),onCacheHit:ee(c)}:{}}var $={arguments:!0,callee:!0,caller:!0,constructor:!0,length:!0,name:!0,prototype:!0};function N(c,_,D){D===void 0&&(D=[]),Object.getOwnPropertyNames(c).forEach(function(v){if(!$[v]&&D.indexOf(v)===-1){var M=Object.getOwnPropertyDescriptor(c,v);M.get||M.set?Object.defineProperty(_,v,M):_[v]=c[v]}})}function S(c,_){var D=_.expirations,v=c.options,M=m(v.isEqual,v.isMatchingKey),P=c;P.clear=function(){var B=P._microMemoizeOptions.onCacheChange,j=P.cache;return j.keys.length=0,j.values.length=0,B&&B(j,P.options,P),!0},P.clearStats=function(){W(P.options.profileName)},P.get=function(B){var j=P._microMemoizeOptions.transformKey,Ee=P.cache,he=j?j(B):B,de=M(Ee.keys,he);return de!==-1?P.apply(this,B):void 0},P.getStats=function(){return T(P.options.profileName)},P.has=function(B){var j=P._microMemoizeOptions.transformKey,Ee=j?j(B):B;return M(P.cache.keys,Ee)!==-1},P.keys=function(){return P.cacheSnapshot.keys},P.remove=function(B){var j=P._microMemoizeOptions,Ee=j.onCacheChange,he=j.transformKey,de=P.cache,Se=M(de.keys,he?he(B):B);if(Se===-1)return!1;var ve=de.keys[Se];return de.keys.splice(Se,1),de.values.splice(Se,1),Ee&&Ee(de,P.options,P),C(D,ve,!0),!0},P.set=function(B,j){var Ee=P._microMemoizeOptions,he=P.cache,de=P.options,Se=Ee.onCacheAdd,ve=Ee.onCacheChange,Ie=Ee.transformKey,He=Ie?Ie(B):B,Be=M(he.keys,He);if(Be===-1){var Ve=de.maxSize-1;he.size>Ve&&(he.keys.length=Ve,he.values.length=Ve),he.keys.unshift(He),he.values.unshift(j),de.isPromise&&he.updateAsyncCache(P),Se&&Se(he,de,P),ve&&ve(he,de,P)}else{var Nt=he.keys[Be];he.values[Be]=j,Be>0&&he.orderByLru(Nt,j,Be),de.isPromise&&he.updateAsyncCache(P),typeof ve=="function"&&ve(he,de,P)}},P.values=function(){return P.cacheSnapshot.values}}function z(c,_){var D=_.expirations,v=_.options,M=_.originalFunction,P=c.options;Object.defineProperties(c,{_microMemoizeOptions:{configurable:!0,get:function(){return P}},cacheSnapshot:{configurable:!0,get:function(){var Ee=c.cache;return{keys:Ee.keys.slice(0),size:Ee.size,values:Ee.values.slice(0)}}},expirations:{configurable:!0,get:function(){return D}},expirationsSnapshot:{configurable:!0,get:function(){return D.slice(0)}},isMoized:{configurable:!0,get:function(){return!0}},options:{configurable:!0,get:function(){return v}},originalFunction:{configurable:!0,get:function(){return M}}});var B=c;N(M,B)}function X(c,_){return S(c,_),z(c,_),c}var Q=typeof Symbol=="function"&&Symbol.for?Symbol.for("react.element"):60103;function le(c,_,D){var v=c(s({maxArgs:2,isShallowEqual:!0},D,{isReact:!1}));_.displayName||(_.displayName=_.name||"Component");function M(P,B,j){this.props=P,this.context=B,this.updater=j,this.MoizedComponent=v(_)}return M.prototype.isReactComponent={},M.prototype.render=function(){return{$$typeof:Q,type:this.MoizedComponent,props:this.props,ref:null,key:null,_owner:null}},N(_,M,["contextType","contextTypes"]),M.displayName="Moized("+(_.displayName||_.name||"Component")+")",x(M,_.name,D.profileName),M}function ue(c){return function(_){if(c>=_.length)return _;if(c===0)return[];if(c===1)return[_[0]];if(c===2)return[_[0],_[1]];if(c===3)return[_[0],_[1],_[2]];for(var D=[],v=0;v<c;v++)D[v]=_[v];return D}}function b(c,_){for(var D=c.length,v=0;v<D;++v)if(c[v]===_)return v+1;return 0}function E(){var c=[],_=[];return function(v,M){var P=typeof M;if(P==="function"||P==="symbol")return M.toString();if(typeof M=="object"){if(c.length){var B=b(c,this);B===0?c[c.length]=this:(c.splice(B),_.splice(B)),_[_.length]=v;var j=b(c,M);if(j!==0)return"[ref="+(_.slice(0,j).join(".")||".")+"]"}else c[0]=M,_[0]=v;return M}return""+M}}function g(c){var _=typeof c;return c&&(_==="object"||_==="function")?JSON.stringify(c,E()):c}function I(c){for(var _="|",D=0;D<c.length;D++)_+=g(c[D])+"|";return[_]}function w(c){return typeof c.serializer=="function"?c.serializer:I}function p(c,_){return c[0]===_[0]}function y(c){if(typeof c=="function")return function(_,D,v){return c(v.cache,v.options,v)}}function L(c){return c.matchesArg||c.isDeepEqual&&n.deepEqual||c.isShallowEqual&&n.shallowEqual||n.sameValueZeroEqual}function ne(c){return c.matchesKey||c.isSerialized&&p||void 0}function ae(c){return h(c.isSerialized&&w(c),typeof c.transformArgs=="function"&&c.transformArgs,typeof c.maxArgs=="number"&&ue(c.maxArgs))}function fe(c){var _=c.options.updateCacheForKey,D=function(){for(var M=arguments.length,P=new Array(M),B=0;B<M;B++)P[B]=arguments[B];if(!_(P))return c.apply(this,P);var j=c.fn.apply(this,P);return c.set(P,j),j};return N(c,D),D}var oe=["matchesArg","isDeepEqual","isPromise","isReact","isSerialized","isShallowEqual","matchesKey","maxAge","maxArgs","maxSize","onCacheAdd","onCacheChange","onCacheHit","onExpire","profileName","serializer","updateCacheForKey","transformArgs","updateExpire"],K=function c(_,D){var v=D||l;if(A(_)){var M=_.originalFunction,P=f(_.options,v);return c(M,P)}if(typeof _=="object")return function(Jt,Gi){if(typeof Jt=="function"){var Hi=f(_,Gi);return c(Jt,Hi)}var Vi=f(_,Jt);return c(Vi)};if(v.isReact)return le(c,_,v);var B=s({},l,v,{maxAge:typeof v.maxAge=="number"&&v.maxAge>=0?v.maxAge:l.maxAge,maxArgs:typeof v.maxArgs=="number"&&v.maxArgs>=0?v.maxArgs:l.maxArgs,maxSize:typeof v.maxSize=="number"&&v.maxSize>=0?v.maxSize:l.maxSize,profileName:v.profileName||se(_)}),j=[];B.matchesArg,B.isDeepEqual;var Ee=B.isPromise;B.isReact,B.isSerialized,B.isShallowEqual,B.matchesKey,B.maxAge,B.maxArgs;var he=B.maxSize,de=B.onCacheAdd,Se=B.onCacheChange,ve=B.onCacheHit;B.onExpire,B.profileName,B.serializer;var Ie=B.updateCacheForKey;B.transformArgs,B.updateExpire;var He=a(B,oe),Be=L(B),Ve=ne(B),Nt=R(j,B,Be,Ve),zr=H(B),Li=ae(B),wi=s({},He,{isEqual:Be,isMatchingKey:Ve,isPromise:Ee,maxSize:he,onCacheAdd:y(o(de,Nt.onCacheAdd,zr.onCacheAdd)),onCacheChange:y(Se),onCacheHit:y(o(ve,Nt.onCacheHit,zr.onCacheHit)),transformKey:Li}),Ui=r(_,wi),It=X(Ui,{expirations:j,options:B,originalFunction:_});return Ie&&(It=fe(It)),x(It,_.name,v.profileName),It};K.clearStats=W,K.collectStats=k,K.compose=function(){return h.apply(void 0,arguments)||K},K.deep=K({isDeepEqual:!0}),K.getStats=T,K.infinite=K({maxSize:1/0}),K.isCollectingStats=function(){return d.isCollectingStats},K.isMoized=function(_){return typeof _=="function"&&!!_.isMoized},K.matchesArg=function(c){return K({matchesArg:c})},K.matchesKey=function(c){return K({matchesKey:c})};function te(c,_){if(_===!0)return K({maxAge:c,updateExpire:_});if(typeof _=="object"){var D=_.onExpire,v=_.updateExpire;return K({maxAge:c,onExpire:D,updateExpire:v})}return K(typeof _=="function"?{maxAge:c,onExpire:_,updateExpire:!0}:{maxAge:c})}return K.maxAge=te,K.maxArgs=function(c){return K({maxArgs:c})},K.maxSize=function(c){return K({maxSize:c})},K.profile=function(c){return K({profileName:c})},K.promise=K({isPromise:!0,updateExpire:!0}),K.react=K({isReact:!0}),K.serialize=K({isSerialized:!0}),K.serializeWith=function(c){return K({isSerialized:!0,serializer:c})},K.shallow=K({isShallowEqual:!0}),K.transformArgs=function(c){return K({transformArgs:c})},K.updateCacheForKey=function(c){return K({updateCacheForKey:c})},Object.defineProperty(K,"default",{configurable:!1,enumerable:!1,value:K,writable:!1}),K})})(Ji);var is=`#version 300 es
precision highp float;
precision highp int;

layout(location=0) in vec3 currentPosition;
layout(location=1) in vec4 currentColor;
layout(location=2) in float currentSize;
layout(location=3) in float currentEmphasis;
layout(location=4) in vec3 targetPosition;
layout(location=5) in vec4 targetColor;
layout(location=6) in float targetSize;
layout(location=7) in float targetEmphasis;

layout(location=8) in uint vertexPosition;

out vec3 vTargetPosition;
out vec3 vUpdatedPosition;
out vec4 vUpdatedColor;
out float vUpdatedSize;
out float vUpdatedEmphasis;

uniform float uMixRatio;
uniform vec2 mousePosition;
uniform vec2 bufferDimensions;

flat out int vertexID;
flat out vec2 uv;

float bump(float x, float q, float w) {
  float clamped_x = clamp(x/w, -0.5, 0.5);
  float y = pow(exp(1.0 - 1.0 / (1.0 - pow(2.0*clamped_x, 2.0))), q);
  return y;
}

void main() {
  vTargetPosition = targetPosition;
  float nearness = bump(length(mousePosition - currentPosition.xy), 100.0, 20.0);
  float mixRatio = uMixRatio;
  vUpdatedSize = mix(currentSize, targetSize, mixRatio);

  
  vec3 delta = targetPosition - currentPosition;
  float distance = length(delta);

  vUpdatedPosition = currentPosition + normalize(delta)*min(0.005, distance/200.0);
  vUpdatedPosition = mix(currentPosition, targetPosition, mixRatio);
  vUpdatedColor = mix(currentColor, targetColor, mixRatio);
  vUpdatedEmphasis = mix(currentEmphasis, targetEmphasis, mixRatio);

  uint v = uint(gl_VertexID);
  
  vertexID = int(v);
  
  uv = vec2(
    float(int(v) % int(bufferDimensions.x)),
    float(int(v) / int(bufferDimensions.x))
  );
  
  uv = uv / float(bufferDimensions);
  uv += vec2(0.5/bufferDimensions.x, 0.5/bufferDimensions.y);
  
  
  
  
  gl_Position = vec4(uv*2.0 - 1.0, 0.0, 1.0);
  gl_PointSize = 1.0;
  
}`,ss=`#version 300 es
precision highp float;
precision highp int;

in vec3 vUpdatedPosition;
in vec3 vTargetPosition;
in vec4 vUpdatedColor;
in float vUpdatedSize;
in float vUpdatedEmphasis;

flat in int vertexID;

layout(location = 1) out vec4 position;
layout(location = 2) out vec4 color;
layout(location = 3) out vec4 size;
layout(location = 4) out vec4 emphasis;

uniform vec2 bufferDimensions;

void main() {
  position = vec4(vUpdatedPosition, 1.0);
  
  
  
  

  color = vUpdatedColor;
  size = vec4(vUpdatedSize,0,0,1);
  emphasis = vec4(vUpdatedEmphasis,0,0,1);
}`,as=`#version 300 es
precision highp float;
precision highp int;

layout(location=0) in ivec2 edgeIndices;
layout(location=1) in vec3 segmentOffset;
layout(location=2) in lowp uint segmentParameter;

out vec4 color;
flat out vec4 sourceColor;
flat out vec4 targetColor;
out vec4 position;
out float size;
flat out vec2 edgeDirection;
flat out float edgeLength;
flat out float edgeLength2D;
out float isSource;
out float isTarget;
out float emphasis;
out float v;
out float y;

uniform vec2 mousePosition;

uniform cameras {
  mat4 projection;
  mat4 view;
  mat4 orthoFixedProjection;
  mat4 orthoFixedView;
  mat4 orthoZoomedProjection;
  mat4 orthoZoomedView;
};

struct CameraMatrices {
  mat4 projection;
  mat4 view;
  mat4 orthoFixedProjection;
  mat4 orthoFixedView;
  mat4 orthoZoomedProjection;
  mat4 orthoZoomedView;
};

struct NodeGeometryBundle {
  vec3 globalNDC;
  vec4 globalClipPosition;
  vec4 orthoFixedClipPosition;
  vec4 orthoZoomedClipPosition;
  vec4 orthographicClipPosition;
};

NodeGeometryBundle nodeGeometry(
  in vec3 nodePosition,
  in vec3 vertexPosition,
  float scale,
  in CameraMatrices cam
) {
  vec4 globalClipPosition = cam.projection * cam.view * vec4(nodePosition, 1.0);
  vec3 globalNDC = globalClipPosition.xyz / globalClipPosition.w;

  vec4 orthoFixedClipPosition = cam.orthoFixedProjection * cam.orthoFixedView * vec4(vertexPosition*scale, 1.0);
  vec3 orthoFixedNDC = orthoFixedClipPosition.xyz / orthoFixedClipPosition.w;
  
  vec4 orthoZoomedClipPosition = cam.orthoZoomedProjection * cam.orthoZoomedView * vec4(vertexPosition*scale, 1.0)*0.5;
  vec3 orthoZoomedNDC = orthoZoomedClipPosition.xyz / orthoZoomedClipPosition.w;

  vec3 localNDC = mix(orthoZoomedNDC, orthoFixedNDC, 0.5);

  
  vec3 orthographicNDC = vec3(localNDC.xy + globalNDC.xy, globalNDC.z + (localNDC.z - 0.99)*0.2 );
  
  vec4 orthographicClipPosition = vec4(orthographicNDC * globalClipPosition.w, globalClipPosition.w);
  
  return NodeGeometryBundle(
    globalNDC,
    globalClipPosition,
    orthoFixedClipPosition,
    orthoZoomedClipPosition,
    orthographicClipPosition
  );
}

uniform sampler2D positionTexture;
uniform sampler2D colorTexture;
uniform sampler2D sizeTexture;
uniform sampler2D emphasisTexture;
uniform ivec2 textureDimensions;

uniform bool selected;
uniform bool hovered;

vec3 desaturate(vec3 color, float amount) {
  float average = (color.r + color.g + color.b) / 3.0;
  return mix(color, vec3(average), amount);
}

ivec2 getTextureIndex(int index, ivec2 textureDimensions) {
  int textureLength = textureDimensions.x * textureDimensions.y;
  

  
  int x = index % textureDimensions.x;
  int y = index / textureDimensions.x;

  return ivec2(x,y);
}

vec4 edgeGeometry(
  in vec3 nodePosition,
  in vec3 vertexPosition,
  in vec2 edgeDirection,
  float scale,
  float flatness,
  in CameraMatrices cam
) {
  vec2 edgePerpendicular = vec2(-edgeDirection.y, edgeDirection.x)*scale/3.0;
  vec4 position = cam.projection * cam.view * vec4(nodePosition, 1.0);
  vec4 positionNDC = position / position.w;
  
  

  vec4 positionClip = vec4(position.xy + vertexPosition.y*1.0 * edgePerpendicular, position.zw);

  vec4 positionFixedStrokeNDC = positionNDC + vec4(vertexPosition.y * edgePerpendicular, 0.0, 0.0);
  vec4 positionFixedStrokeClip = positionFixedStrokeNDC * position.w;

  
  return mix(positionFixedStrokeClip, positionClip, 1.0-flatness);
}

float bump(float x, float q, float w) {
  float clamped_x = clamp(x/w, -0.5, 0.5);
  float y = pow(exp(1.0 - 1.0 / (1.0 - pow(2.0*clamped_x, 2.0))), q);
  return y;
}

void main() {
  isSource = segmentOffset.x;
  isTarget = 1.0-segmentOffset.x;
  
  float sourceEmphasis = texelFetch(emphasisTexture, getTextureIndex(edgeIndices.x, textureDimensions), 0).r;
  float targetEmphasis = texelFetch(emphasisTexture, getTextureIndex(edgeIndices.y, textureDimensions), 0).r;

  emphasis = max(sourceEmphasis, targetEmphasis);
  
  position = vec4(0);
  vec3 vertexOffset = segmentOffset + vec3(0.0, -0.5, 0.0);

  vec3 sourceNodePosition = texelFetch(positionTexture, getTextureIndex(edgeIndices.x, textureDimensions), 0).xyz;
  vec3 targetNodePosition = texelFetch(positionTexture, getTextureIndex(edgeIndices.y, textureDimensions), 0).xyz;
  vec3 nodePosition = sourceNodePosition*isSource + targetNodePosition*isTarget;
  
  float sourceSize = texelFetch(sizeTexture, getTextureIndex(edgeIndices.x, textureDimensions), 0).r;
  float targetSize = texelFetch(sizeTexture, getTextureIndex(edgeIndices.y, textureDimensions), 0).r;

  size = sourceSize*isSource + targetSize*isTarget;
  size *= mix(0.3, 0.1, emphasis);
  
  vec4 targetPositionClip = projection * view * vec4(targetNodePosition, 1.0);
  vec4 sourcePositionClip = projection * view * vec4(sourceNodePosition, 1.0);
  
  edgeDirection = normalize(targetPositionClip.xyz/targetPositionClip.w - sourcePositionClip.xyz/sourcePositionClip.w).xy;
  edgeLength = length(targetNodePosition.xyz - sourceNodePosition.xyz);
  edgeLength2D = length((targetPositionClip.xy/targetPositionClip.w - sourcePositionClip.xy/sourcePositionClip.w));

  position = edgeGeometry(
    nodePosition,
    vertexOffset,
    edgeDirection,
    size,
    mix(0.5, 1.0, emphasis),
    CameraMatrices(
      projection,
      view,
      orthoFixedProjection,
      orthoFixedView,
      orthoZoomedProjection,
      orthoZoomedView
    )
  );

  
  position.z += 0.01 * position.w * bump(vertexOffset.x, 4.0, 0.125);

  vec4 sourceColor = texelFetch(colorTexture, getTextureIndex(edgeIndices.x, textureDimensions), 0);
  vec4 targetColor = texelFetch(colorTexture, getTextureIndex(edgeIndices.y, textureDimensions), 0);
  color += sourceColor*isSource;
  color += targetColor*isTarget;

  
  color.rgb = desaturate(color.rgb, 1.0-emphasis);
  color.a *= mix(0.25, 1.0, emphasis);

  
  
  
  

  
  

  gl_Position = position;
  y = vertexOffset.y;
  v = segmentOffset.y;

  float distance = length(mousePosition - position.xy);
  
}`,os=`#version 300 es
precision highp float;

in vec4 color;
in vec4 position;
in float emphasis;
in float size;
flat in vec2 edgeDirection;
flat in float edgeLength;
flat in float edgeLength2D;
in float isTarget;
in float isSource;
in float y;

out vec4 fragColor;

const float PI = 3.1415926535897932384626433832795;
const float freq = 1.0;

uniform float time;

float bump(float x, float q, float w) {
  float clamped_x = clamp(x/w, -0.5, 0.5);
  float y = pow(exp(1.0 - 1.0 / (1.0 - pow(2.0*clamped_x, 2.0))), q);
  return y;
}
float sdEgg( in vec2 p, in float ra, in float rb )
{
    const float k = sqrt(3.0);
    p.x = abs(p.x);
    float r = ra - rb;
    return ((p.y<0.0)       ? length(vec2(p.x,  p.y    )) - r :
            (k*(p.x+r)<p.y) ? length(vec2(p.x,  p.y-k*r)) :
                              length(vec2(p.x+r,p.y    )) - 2.0*r) - rb;
}

float sdEquilateralTriangle( in vec2 p )
{
    const float k = sqrt(3.0);
    p.x = abs(p.x) - 1.0;
    p.y = p.y + 1.0/k;
    if( p.x+k*p.y>0.0 ) p = vec2(p.x-k*p.y,-k*p.x-p.y)/2.0;
    p.x -= clamp( p.x, -2.0, 0.0 );
    return -length(p)*sign(p.y);
}

float wave(float t, float freq){ return pow(sin(t * freq * PI), 2.0); }
void main() {
  float u = isTarget;
  
  
  
  float d = sdEquilateralTriangle(vec2(y*4.0, (isSource-0.5)*edgeLength2D*10.0/size));
  float triangle = d < 0.0 ? 1.0 : 0.0;

  fragColor = color;
  
  
  
  
  
  
  fragColor.a *= bump(y, 1.0, 1.0);

  
  fragColor.a *= mix(1.0, wave(u + time/20.0, 50.0), mix(0.1, 1.0, emphasis));
  
  
  

  
  fragColor.a = min(1.0-triangle/3.0, fragColor.a);
  
  fragColor.a *= mix(0.5, 1.0, emphasis);
  
  
  fragColor.rgb *= mix(1.0, bump(position.x/position.w, 2.0, 1.0), 0.5);

  
  
}`,ls=`#version 300 es
precision highp float;
precision highp int;

layout(location=0) in vec3 nodePosition;
layout(location=1) in vec4 nodeColor;
layout(location=2) in float nodeSize;

layout(location=3) in vec3 vertexPosition;
layout(location=4) in vec3 vertexNormal;

uniform cameras {
  mat4 projection;
  mat4 view;
  mat4 orthoFixedProjection;
  mat4 orthoFixedView;
  mat4 orthoZoomedProjection;
  mat4 orthoZoomedView;
};

struct CameraMatrices {
  mat4 projection;
  mat4 view;
  mat4 orthoFixedProjection;
  mat4 orthoFixedView;
  mat4 orthoZoomedProjection;
  mat4 orthoZoomedView;
};

struct NodeGeometryBundle {
  vec3 globalNDC;
  vec4 globalClipPosition;
  vec4 orthoFixedClipPosition;
  vec4 orthoZoomedClipPosition;
  vec4 orthographicClipPosition;
};

NodeGeometryBundle nodeGeometry(
  in vec3 nodePosition,
  in vec3 vertexPosition,
  float scale,
  in CameraMatrices cam
) {
  vec4 globalClipPosition = cam.projection * cam.view * vec4(nodePosition, 1.0);
  vec3 globalNDC = globalClipPosition.xyz / globalClipPosition.w;

  vec4 orthoFixedClipPosition = cam.orthoFixedProjection * cam.orthoFixedView * vec4(vertexPosition*scale, 1.0);
  vec3 orthoFixedNDC = orthoFixedClipPosition.xyz / orthoFixedClipPosition.w;
  
  vec4 orthoZoomedClipPosition = cam.orthoZoomedProjection * cam.orthoZoomedView * vec4(vertexPosition*scale, 1.0)*0.5;
  vec3 orthoZoomedNDC = orthoZoomedClipPosition.xyz / orthoZoomedClipPosition.w;

  vec3 localNDC = mix(orthoZoomedNDC, orthoFixedNDC, 0.5);

  
  vec3 orthographicNDC = vec3(localNDC.xy + globalNDC.xy, globalNDC.z + (localNDC.z - 0.99)*0.2 );
  
  vec4 orthographicClipPosition = vec4(orthographicNDC * globalClipPosition.w, globalClipPosition.w);
  
  return NodeGeometryBundle(
    globalNDC,
    globalClipPosition,
    orthoFixedClipPosition,
    orthoZoomedClipPosition,
    orthographicClipPosition
  );
}

uniform vec2 mousePosition;

uniform int selectedIndex;

#ifdef PICKER
  flat out vec4 color;
#else
  out vec4 color;
#endif

out vec3 position;
out vec3 normal;

float bump(float x, float q, float w) {
  float clamped_x = clamp(x/w, -0.5, 0.5);
  float y = pow(exp(1.0 - 1.0 / (1.0 - pow(2.0*clamped_x, 2.0))), q);
  return y;
}

void main() {
  float scale = nodeSize;

  #ifdef PICKER
    scale *= 1.25;
  #endif

  NodeGeometryBundle geo = nodeGeometry(
    nodePosition,
    vertexPosition,
    scale,
    CameraMatrices(
      projection,
      view,
      orthoFixedProjection,
      orthoFixedView,
      orthoZoomedProjection,
      orthoZoomedView
    )
  );
  
  
  float distance = length(geo.globalNDC.xy - mousePosition);
  float nearness = bump(distance, 2.0, 1.0);

  vec4 clipPosition = geo.orthographicClipPosition;
  
  vec4 selectedColor = vec4(1.0, 1.0, 1.0, 1.0);
  
  #ifdef PICKER
    color = instanceIdToColor();
  #else
    color = mix(nodeColor, selectedColor, float(gl_InstanceID == selectedIndex));
  #endif

  normal = mat3(orthoFixedView) * vertexNormal;
  gl_Position = clipPosition;
}`,us=`#version 300 es
precision highp float;
in vec4 color;
in vec3 normal;

in vec3 position;
out vec4 fragColor;

void main() {
  
  
  const vec3 lightDirection = normalize(vec3(0.0, 0.0, 1.0));
  float light = dot(normal, lightDirection);
  

  
  fragColor = vec4(color.xyz*light, color.a);
  
}`,hs=`#version 300 es
precision lowp float;

vec4 instanceIdToColor() {
  int instanceId = gl_InstanceID+1;
  float r = float(instanceId & 0x0000FF) / 255.0;
  float g = float((instanceId & 0x00FF00) >> 8) / 255.0;
  float b = float((instanceId & 0xFF0000) >> 16) / 255.0;

  return vec4(r, g, b, 1.0);
}

#define PICKER
layout(location=0) in vec3 nodePosition;
layout(location=1) in vec4 nodeColor;
layout(location=2) in float nodeSize;

layout(location=3) in vec3 vertexPosition;
layout(location=4) in vec3 vertexNormal;

uniform cameras {
  mat4 projection;
  mat4 view;
  mat4 orthoFixedProjection;
  mat4 orthoFixedView;
  mat4 orthoZoomedProjection;
  mat4 orthoZoomedView;
};

struct CameraMatrices {
  mat4 projection;
  mat4 view;
  mat4 orthoFixedProjection;
  mat4 orthoFixedView;
  mat4 orthoZoomedProjection;
  mat4 orthoZoomedView;
};

struct NodeGeometryBundle {
  vec3 globalNDC;
  vec4 globalClipPosition;
  vec4 orthoFixedClipPosition;
  vec4 orthoZoomedClipPosition;
  vec4 orthographicClipPosition;
};

NodeGeometryBundle nodeGeometry(
  in vec3 nodePosition,
  in vec3 vertexPosition,
  float scale,
  in CameraMatrices cam
) {
  vec4 globalClipPosition = cam.projection * cam.view * vec4(nodePosition, 1.0);
  vec3 globalNDC = globalClipPosition.xyz / globalClipPosition.w;

  vec4 orthoFixedClipPosition = cam.orthoFixedProjection * cam.orthoFixedView * vec4(vertexPosition*scale, 1.0);
  vec3 orthoFixedNDC = orthoFixedClipPosition.xyz / orthoFixedClipPosition.w;
  
  vec4 orthoZoomedClipPosition = cam.orthoZoomedProjection * cam.orthoZoomedView * vec4(vertexPosition*scale, 1.0)*0.5;
  vec3 orthoZoomedNDC = orthoZoomedClipPosition.xyz / orthoZoomedClipPosition.w;

  vec3 localNDC = mix(orthoZoomedNDC, orthoFixedNDC, 0.5);

  
  vec3 orthographicNDC = vec3(localNDC.xy + globalNDC.xy, globalNDC.z + (localNDC.z - 0.99)*0.2 );
  
  vec4 orthographicClipPosition = vec4(orthographicNDC * globalClipPosition.w, globalClipPosition.w);
  
  return NodeGeometryBundle(
    globalNDC,
    globalClipPosition,
    orthoFixedClipPosition,
    orthoZoomedClipPosition,
    orthographicClipPosition
  );
}

uniform vec2 mousePosition;

uniform int selectedIndex;

#ifdef PICKER
  flat out vec4 color;
#else
  out vec4 color;
#endif

out vec3 position;
out vec3 normal;

float bump(float x, float q, float w) {
  float clamped_x = clamp(x/w, -0.5, 0.5);
  float y = pow(exp(1.0 - 1.0 / (1.0 - pow(2.0*clamped_x, 2.0))), q);
  return y;
}

void main() {
  float scale = nodeSize;

  #ifdef PICKER
    scale *= 1.25;
  #endif

  NodeGeometryBundle geo = nodeGeometry(
    nodePosition,
    vertexPosition,
    scale,
    CameraMatrices(
      projection,
      view,
      orthoFixedProjection,
      orthoFixedView,
      orthoZoomedProjection,
      orthoZoomedView
    )
  );
  
  
  float distance = length(geo.globalNDC.xy - mousePosition);
  float nearness = bump(distance, 2.0, 1.0);

  vec4 clipPosition = geo.orthographicClipPosition;
  
  vec4 selectedColor = vec4(1.0, 1.0, 1.0, 1.0);
  
  #ifdef PICKER
    color = instanceIdToColor();
  #else
    color = mix(nodeColor, selectedColor, float(gl_InstanceID == selectedIndex));
  #endif

  normal = mat3(orthoFixedView) * vertexNormal;
  gl_Position = clipPosition;
}`,cs=`#version 300 es
precision lowp float;

flat in vec4 color;
out vec4 fragColor;

void main() {
  fragColor = color;
}`;function fs(t,e,r,n,s,a){t===void 0&&(t=1),e===void 0&&(e=t),r===void 0&&(r=t),n===void 0&&(n=1),s===void 0&&(s=n),a===void 0&&(a=n);var l=0,o=[],h=[],u=[],m=[];function f(A,x,C,O,U,F,R,d,V,W){for(var k=l,Y=0;Y<=R;Y++)for(var ee=0;ee<=F;ee++){var se=o[l]=[0,0,0];se[A]=(-O/2+ee*O/F)*V,se[x]=(-U/2+Y*U/R)*W,se[C]=d;var _e=h[l]=[0,0,0];_e[A]=0,_e[x]=0,_e[C]=d/Math.abs(d);var T=u[l]=[0,0];T[0]=ee/F,T[1]=1-Y/R,++l}for(var Y=0;Y<R;Y++)for(var ee=0;ee<F;ee++){var H=k+Y*(F+1)+ee;m.push([H,H+F+1,H+F+2]),m.push([H,H+F+2,H+1])}}return f(0,1,2,t,e,n,s,r/2,1,-1),f(0,1,2,t,e,n,s,-r/2,-1,-1),f(2,1,0,r,e,a,s,-t/2,1,-1),f(2,1,0,r,e,a,s,t/2,-1,-1),f(0,2,1,t,r,n,a,e/2,1,1),f(0,2,1,t,r,n,a,-e/2,1,-1),{positions:o,normals:h,uvs:u,cells:m}}var Es=fs,_s=1e-6,ds=function(t,e,r){for(var n=e.length,s=new Array(n),a=r===void 0?_s:r,l=0;l<n;++l)s[l]=[0,0,0];for(var l=0;l<t.length;++l)for(var o=t[l],h=0,u=o[o.length-1],m=o[0],f=0;f<o.length;++f){h=u,u=m,m=o[(f+1)%o.length];for(var A=e[h],x=e[u],C=e[m],O=new Array(3),U=0,F=new Array(3),R=0,d=0;d<3;++d)O[d]=A[d]-x[d],U+=O[d]*O[d],F[d]=C[d]-x[d],R+=F[d]*F[d];if(U*R>a)for(var V=s[u],W=1/Math.sqrt(U*R),d=0;d<3;++d){var k=(d+1)%3,Y=(d+2)%3;V[d]+=W*(F[k]*O[Y]-F[Y]*O[k])}}for(var l=0;l<n;++l){for(var V=s[l],ee=0,d=0;d<3;++d)ee+=V[d]*V[d];if(ee>a)for(var W=1/Math.sqrt(ee),d=0;d<3;++d)V[d]*=W;else for(var d=0;d<3;++d)V[d]=0}return s};function Kn(t,e,r){var n=t[r]|0;if(n<=0)return[];var s=new Array(n),a;if(r===t.length-1)for(a=0;a<n;++a)s[a]=e;else for(a=0;a<n;++a)s[a]=Kn(t,e,r+1);return s}function As(t,e){var r,n;for(r=new Array(t),n=0;n<t;++n)r[n]=e;return r}function Ts(t,e){switch(typeof e>"u"&&(e=0),typeof t){case"number":if(t>0)return As(t|0,e);break;case"object":if(typeof t.length=="number")return Kn(t,e,0);break}return[]}var ms=Ts,er=ms;function Le(t,e,r){return t+(r+1)*e}function ps(t,e,r,n,s){r=r||[0,0],(!n||n.length<r.length)&&(n=er(r.length),r.length>0&&(n[0]=1)),(!s||s.length<r.length)&&(s=er(r.length),r.length>1&&(s[1]=1));var a=[],l=er([(t+1)*(e+1),r.length]),o,h,u,m,f=r.length;for(h=0;h<e;++h)for(o=0;o<t;++o)a.push([Le(o,h,t),Le(o+1,h,t),Le(o,h+1,t)]),a.push([Le(o+1,h,t),Le(o+1,h+1,t),Le(o,h+1,t)]);for(h=0;h<=e;++h)for(o=0;o<=t;++o)for(m=l[Le(o,h,t)],u=0;u<f;++u)m[u]=r[u]+n[u]*o+s[u]*h;return{positions:l,cells:a}}var gs=ps;const Rs=ie(()=>re().createProgram(ls,us)),xs=ie(()=>re().createProgram(hs,cs)),Ss=ie.infinite(()=>{const t=Es(1);console.log(t.positions.length,"bunny tris");const e=t.positions,r=t.cells,n=ds(r,e),s=re().createVertexBuffer(G.FLOAT,3,new Float32Array(e.flat())),a=re().createIndexBuffer(G.UNSIGNED_SHORT,new Uint16Array(r.flat())),l=re().createVertexBuffer(G.FLOAT,3,new Float32Array(n.flat()));return re().createVertexArray().vertexAttributeBuffer(3,s).vertexAttributeBuffer(4,l).indexBuffer(a)}),Wn=()=>{const t=Ss(),e=me().current,r=Re().current,n=xe().current;return t.instanceAttributeBuffer(0,e).instanceAttributeBuffer(1,r).instanceAttributeBuffer(2,n)},Qr=ie.infinite(t=>{const e=re(),r=e.width,n=e.height;let s=e.createTexture2D(r,n,{internalFormat:G.RGBA8,minFilter:G.NEAREST,magFilter:G.NEAREST}),a=e.createRenderbuffer(r,n,G.DEPTH_COMPONENT16);return e.createFramebuffer().colorTarget(0,s).depthTarget(a)});class vs{constructor(e,r){this.A=e,this.B=r,this._current=e}swap(){this._current=this.current===this.A?this.B:this.A}get current(){return this._current}get other(){return this._current===this.A?this.B:this.A}}const Yn=ie.infinite(()=>{re();const t=Qr("A"),e=Qr("B");return new vs(t,e)}),Cs=ie.infinite(()=>{const t=xs(),e=Wn();return re().createDrawCall(t,e).primitive(G.TRIANGLES)}),Ns=ie.infinite(()=>{const t=Rs(),e=Wn();return re().createDrawCall(t,e).primitive(G.TRIANGLES)}),Is=ie(()=>re().createProgram(as,os)),jn=20,qn=1,Tt=gs(jn,qn);Tt.positions=Tt.positions.map(([t,e])=>[t/jn,e/qn]);ie.infinite(t=>{const e=new Uint32Array(t.flat());return re().createIndexBuffer(G.UNSIGNED_INT,e)});const Ds=ie.infinite(t=>{const e=new Int32Array(t.flat());return re().createVertexBuffer(G.INT,2,e)}),Ps=ie.infinite(()=>{const t=re().createVertexBuffer(G.FLOAT,2,new Float32Array(Tt.positions.flat()));return console.log(Tt),t}),ys=ie.infinite(()=>re().createIndexBuffer(G.UNSIGNED_SHORT,new Uint16Array(Tt.cells.flat()))),Fs=ie.infinite(()=>re().createVertexArray()),Bs=ie.infinite(t=>{const e=Fs(),r=Ds(t),n=Ps(),s=ys();return e.instanceAttributeBuffer(0,r).vertexAttributeBuffer(1,n).indexBuffer(s)});let Zn;const Ms=t=>{Zn=t},Os=()=>Bs(Zn),bs=ie.infinite(()=>{const t=Is(),e=Os();return re().createDrawCall(t,e).primitive(G.TRIANGLES)}),Qn=Symbol("Comlink.proxy"),Ls=Symbol("Comlink.endpoint"),ws=Symbol("Comlink.releaseProxy"),Cr=Symbol("Comlink.thrown"),Jn=t=>typeof t=="object"&&t!==null||typeof t=="function",Us={canHandle:t=>Jn(t)&&t[Qn],serialize(t){const{port1:e,port2:r}=new MessageChannel;return ti(t,e),[r,[r]]},deserialize(t){return t.start(),Kt(t)}},Gs={canHandle:t=>Jn(t)&&Cr in t,serialize({value:t}){let e;return t instanceof Error?e={isError:!0,value:{message:t.message,name:t.name,stack:t.stack}}:e={isError:!1,value:t},[e,[]]},deserialize(t){throw t.isError?Object.assign(new Error(t.value.message),t.value):t.value}},ei=new Map([["proxy",Us],["throw",Gs]]);function ti(t,e=self){e.addEventListener("message",function r(n){if(!n||!n.data)return;const{id:s,type:a,path:l}=Object.assign({path:[]},n.data),o=(n.data.argumentList||[]).map(Ue);let h;try{const u=l.slice(0,-1).reduce((f,A)=>f[A],t),m=l.reduce((f,A)=>f[A],t);switch(a){case"GET":h=m;break;case"SET":u[l.slice(-1)[0]]=Ue(n.data.value),h=!0;break;case"APPLY":h=m.apply(u,o);break;case"CONSTRUCT":{const f=new m(...o);h=mt(f)}break;case"ENDPOINT":{const{port1:f,port2:A}=new MessageChannel;ti(t,A),h=Xs(f,[f])}break;case"RELEASE":h=void 0;break;default:return}}catch(u){h={value:u,[Cr]:0}}Promise.resolve(h).catch(u=>({value:u,[Cr]:0})).then(u=>{const[m,f]=Ur(u);e.postMessage(Object.assign(Object.assign({},m),{id:s}),f),a==="RELEASE"&&(e.removeEventListener("message",r),ri(e))})}),e.start&&e.start()}function Hs(t){return t.constructor.name==="MessagePort"}function ri(t){Hs(t)&&t.close()}function Kt(t,e){return Nr(t,[],e)}function Pt(t){if(t)throw new Error("Proxy has been released and is not useable")}function Nr(t,e=[],r=function(){}){let n=!1;const s=new Proxy(r,{get(a,l){if(Pt(n),l===ws)return()=>Xe(t,{type:"RELEASE",path:e.map(o=>o.toString())}).then(()=>{ri(t),n=!0});if(l==="then"){if(e.length===0)return{then:()=>s};const o=Xe(t,{type:"GET",path:e.map(h=>h.toString())}).then(Ue);return o.then.bind(o)}return Nr(t,[...e,l])},set(a,l,o){Pt(n);const[h,u]=Ur(o);return Xe(t,{type:"SET",path:[...e,l].map(m=>m.toString()),value:h},u).then(Ue)},apply(a,l,o){Pt(n);const h=e[e.length-1];if(h===Ls)return Xe(t,{type:"ENDPOINT"}).then(Ue);if(h==="bind")return Nr(t,e.slice(0,-1));const[u,m]=Jr(o);return Xe(t,{type:"APPLY",path:e.map(f=>f.toString()),argumentList:u},m).then(Ue)},construct(a,l){Pt(n);const[o,h]=Jr(l);return Xe(t,{type:"CONSTRUCT",path:e.map(u=>u.toString()),argumentList:o},h).then(Ue)}});return s}function Vs(t){return Array.prototype.concat.apply([],t)}function Jr(t){const e=t.map(Ur);return[e.map(r=>r[0]),Vs(e.map(r=>r[1]))]}const ni=new WeakMap;function Xs(t,e){return ni.set(t,e),t}function mt(t){return Object.assign(t,{[Qn]:!0})}function Ur(t){for(const[e,r]of ei)if(r.canHandle(t)){const[n,s]=r.serialize(t);return[{type:"HANDLER",name:e,value:n},s]}return[{type:"RAW",value:t},ni.get(t)||[]]}function Ue(t){switch(t.type){case"HANDLER":return ei.get(t.name).deserialize(t.value);case"RAW":return t.value}}function Xe(t,e,r){return new Promise(n=>{const s=ks();t.addEventListener("message",function a(l){!l.data||!l.data.id||l.data.id!==s||(t.removeEventListener("message",a),n(l.data))}),t.start&&t.start(),t.postMessage(Object.assign({id:s},e),r)})}function ks(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}var zs=typeof global=="object"&&global&&global.Object===Object&&global;const $s=zs;var Ks=typeof self=="object"&&self&&self.Object===Object&&self,Ws=$s||Ks||Function("return this")();const vt=Ws;var Ys=vt.Symbol;const Ht=Ys;var ii=Object.prototype,js=ii.hasOwnProperty,qs=ii.toString,at=Ht?Ht.toStringTag:void 0;function Zs(t){var e=js.call(t,at),r=t[at];try{t[at]=void 0;var n=!0}catch{}var s=qs.call(t);return n&&(e?t[at]=r:delete t[at]),s}var Qs=Object.prototype,Js=Qs.toString;function ea(t){return Js.call(t)}var ta="[object Null]",ra="[object Undefined]",en=Ht?Ht.toStringTag:void 0;function si(t){return t==null?t===void 0?ra:ta:en&&en in Object(t)?Zs(t):ea(t)}function na(t){return t!=null&&typeof t=="object"}var ia="[object Symbol]";function sa(t){return typeof t=="symbol"||na(t)&&si(t)==ia}var aa=/\s/;function oa(t){for(var e=t.length;e--&&aa.test(t.charAt(e)););return e}var la=/^\s+/;function ua(t){return t&&t.slice(0,oa(t)+1).replace(la,"")}function qe(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}var tn=0/0,ha=/^[-+]0x[0-9a-f]+$/i,ca=/^0b[01]+$/i,fa=/^0o[0-7]+$/i,Ea=parseInt;function rn(t){if(typeof t=="number")return t;if(sa(t))return tn;if(qe(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=qe(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=ua(t);var r=ca.test(t);return r||fa.test(t)?Ea(t.slice(2),r?2:8):ha.test(t)?tn:+t}function Ze(t){return t}var _a="[object AsyncFunction]",da="[object Function]",Aa="[object GeneratorFunction]",Ta="[object Proxy]";function ma(t){if(!qe(t))return!1;var e=si(t);return e==da||e==Aa||e==_a||e==Ta}var pa=vt["__core-js_shared__"];const tr=pa;var nn=function(){var t=/[^.]+$/.exec(tr&&tr.keys&&tr.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}();function ga(t){return!!nn&&nn in t}var Ra=Function.prototype,xa=Ra.toString;function Sa(t){if(t!=null){try{return xa.call(t)}catch{}try{return t+""}catch{}}return""}var va=/[\\^$.*+?()[\]{}|]/g,Ca=/^\[object .+?Constructor\]$/,Na=Function.prototype,Ia=Object.prototype,Da=Na.toString,Pa=Ia.hasOwnProperty,ya=RegExp("^"+Da.call(Pa).replace(va,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function Fa(t){if(!qe(t)||ga(t))return!1;var e=ma(t)?ya:Ca;return e.test(Sa(t))}function Ba(t,e){return t?.[e]}function Gr(t,e){var r=Ba(t,e);return Fa(r)?r:void 0}function Ma(){}function Oa(t,e,r,n){for(var s=t.length,a=r+(n?1:-1);n?a--:++a<s;)if(e(t[a],a,t))return a;return-1}function ba(t){return t!==t}function La(t,e,r){for(var n=r-1,s=t.length;++n<s;)if(t[n]===e)return n;return-1}function wa(t,e,r){return e===e?La(t,e,r):Oa(t,ba,r)}function Ua(t,e){var r=t==null?0:t.length;return!!r&&wa(t,e,0)>-1}function Ga(t,e){return t===e||t!==t&&e!==e}var Ha=Gr(Object,"create");const pt=Ha;function Va(){this.__data__=pt?pt(null):{},this.size=0}function Xa(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}var ka="__lodash_hash_undefined__",za=Object.prototype,$a=za.hasOwnProperty;function Ka(t){var e=this.__data__;if(pt){var r=e[t];return r===ka?void 0:r}return $a.call(e,t)?e[t]:void 0}var Wa=Object.prototype,Ya=Wa.hasOwnProperty;function ja(t){var e=this.__data__;return pt?e[t]!==void 0:Ya.call(e,t)}var qa="__lodash_hash_undefined__";function Za(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=pt&&e===void 0?qa:e,this}function Ge(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}Ge.prototype.clear=Va;Ge.prototype.delete=Xa;Ge.prototype.get=Ka;Ge.prototype.has=ja;Ge.prototype.set=Za;function Qa(){this.__data__=[],this.size=0}function Wt(t,e){for(var r=t.length;r--;)if(Ga(t[r][0],e))return r;return-1}var Ja=Array.prototype,eo=Ja.splice;function to(t){var e=this.__data__,r=Wt(e,t);if(r<0)return!1;var n=e.length-1;return r==n?e.pop():eo.call(e,r,1),--this.size,!0}function ro(t){var e=this.__data__,r=Wt(e,t);return r<0?void 0:e[r][1]}function no(t){return Wt(this.__data__,t)>-1}function io(t,e){var r=this.__data__,n=Wt(r,t);return n<0?(++this.size,r.push([t,e])):r[n][1]=e,this}function rt(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}rt.prototype.clear=Qa;rt.prototype.delete=to;rt.prototype.get=ro;rt.prototype.has=no;rt.prototype.set=io;var so=Gr(vt,"Map");const ao=so;function oo(){this.size=0,this.__data__={hash:new Ge,map:new(ao||rt),string:new Ge}}function lo(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}function Yt(t,e){var r=t.__data__;return lo(e)?r[typeof e=="string"?"string":"hash"]:r.map}function uo(t){var e=Yt(this,t).delete(t);return this.size-=e?1:0,e}function ho(t){return Yt(this,t).get(t)}function co(t){return Yt(this,t).has(t)}function fo(t,e){var r=Yt(this,t),n=r.size;return r.set(t,e),this.size+=r.size==n?0:1,this}function nt(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}nt.prototype.clear=oo;nt.prototype.delete=uo;nt.prototype.get=ho;nt.prototype.has=co;nt.prototype.set=fo;var Eo=Gr(vt,"Set");const rr=Eo;var _o="__lodash_hash_undefined__";function Ao(t){return this.__data__.set(t,_o),this}function To(t){return this.__data__.has(t)}function Vt(t){var e=-1,r=t==null?0:t.length;for(this.__data__=new nt;++e<r;)this.add(t[e])}Vt.prototype.add=Vt.prototype.push=Ao;Vt.prototype.has=To;function mo(t,e){return t.has(e)}function ai(t){var e=-1,r=Array(t.size);return t.forEach(function(n){r[++e]=n}),r}var po=function(){return vt.Date.now()};const nr=po;var go="Expected a function",Ro=Math.max,xo=Math.min;function So(t,e,r){var n,s,a,l,o,h,u=0,m=!1,f=!1,A=!0;if(typeof t!="function")throw new TypeError(go);e=rn(e)||0,qe(r)&&(m=!!r.leading,f="maxWait"in r,a=f?Ro(rn(r.maxWait)||0,e):a,A="trailing"in r?!!r.trailing:A);function x(k){var Y=n,ee=s;return n=s=void 0,u=k,l=t.apply(ee,Y),l}function C(k){return u=k,o=setTimeout(F,e),m?x(k):l}function O(k){var Y=k-h,ee=k-u,se=e-Y;return f?xo(se,a-ee):se}function U(k){var Y=k-h,ee=k-u;return h===void 0||Y>=e||Y<0||f&&ee>=a}function F(){var k=nr();if(U(k))return R(k);o=setTimeout(F,O(k))}function R(k){return o=void 0,A&&n?x(k):(n=s=void 0,l)}function d(){o!==void 0&&clearTimeout(o),u=0,n=h=s=o=void 0}function V(){return o===void 0?l:R(nr())}function W(){var k=nr(),Y=U(k);if(n=arguments,s=this,h=k,Y){if(o===void 0)return C(h);if(f)return clearTimeout(o),o=setTimeout(F,e),x(h)}return o===void 0&&(o=setTimeout(F,e)),l}return W.cancel=d,W.flush=V,W}function vo(t,e,r){for(var n=-1,s=t==null?0:t.length;++n<s;)if(r(e,t[n]))return!0;return!1}function ke(t){for(var e=-1,r=t==null?0:t.length,n={};++e<r;){var s=t[e];n[s[0]]=s[1]}return n}var Co="Expected a function";function No(t,e,r){var n=!0,s=!0;if(typeof t!="function")throw new TypeError(Co);return qe(r)&&(n="leading"in r?!!r.leading:n,s="trailing"in r?!!r.trailing:s),So(t,e,{leading:n,maxWait:e,trailing:s})}var Io=1/0,Do=rr&&1/ai(new rr([,-0]))[1]==Io?function(t){return new rr(t)}:Ma;const Po=Do;var yo=200;function Fo(t,e,r){var n=-1,s=Ua,a=t.length,l=!0,o=[],h=o;if(r)l=!1,s=vo;else if(a>=yo){var u=e?null:Po(t);if(u)return ai(u);l=!1,s=mo,h=new Vt}else h=e?[]:o;e:for(;++n<a;){var m=t[n],f=e?e(m):m;if(m=r||m!==0?m:0,l&&f===f){for(var A=h.length;A--;)if(h[A]===f)continue e;e&&h.push(f),o.push(m)}else s(h,f,r)||(h!==o&&h.push(f),o.push(m))}return o}function Bo(t,e){return e=typeof e=="function"?e:void 0,t&&t.length?Fo(t,void 0,e):[]}const Xt=ie.infinite(()=>re().createUniformBuffer([G.FLOAT_MAT4,G.FLOAT_MAT4,G.FLOAT_MAT4,G.FLOAT_MAT4,G.FLOAT_MAT4,G.FLOAT_MAT4,G.UNSIGNED_INT])),Mo=mt(No((t,e,r,n,s,a)=>{Xt().set(0,t).set(1,e).set(2,r).set(3,n).set(4,s).set(5,a).update()},1));var Ct={};function Oo(t){if(typeof t=="object"){if("buttons"in t)return t.buttons;if("which"in t){var e=t.which;if(e===2)return 4;if(e===3)return 2;if(e>0)return 1<<e-1}else if("button"in t){var e=t.button;if(e===1)return 4;if(e===2)return 2;if(e>=0)return 1<<e}}return 0}Ct.buttons=Oo;function Hr(t){return t.target||t.srcElement||window}Ct.element=Hr;function bo(t){if(typeof t=="object"){if("offsetX"in t)return t.offsetX;var e=Hr(t),r=e.getBoundingClientRect();return t.clientX-r.left}return 0}Ct.x=bo;function Lo(t){if(typeof t=="object"){if("offsetY"in t)return t.offsetY;var e=Hr(t),r=e.getBoundingClientRect();return t.clientY-r.top}return 0}Ct.y=Lo;var wo=Uo,ot=Ct;function Uo(t,e){e||(e=t,t=window);var r=0,n=0,s=0,a={shift:!1,alt:!1,control:!1,meta:!1},l=!1;function o(R){var d=!1;return"altKey"in R&&(d=d||R.altKey!==a.alt,a.alt=!!R.altKey),"shiftKey"in R&&(d=d||R.shiftKey!==a.shift,a.shift=!!R.shiftKey),"ctrlKey"in R&&(d=d||R.ctrlKey!==a.control,a.control=!!R.ctrlKey),"metaKey"in R&&(d=d||R.metaKey!==a.meta,a.meta=!!R.metaKey),d}function h(R,d){var V=ot.x(d),W=ot.y(d);"buttons"in d&&(R=d.buttons|0),(R!==r||V!==n||W!==s||o(d))&&(r=R|0,n=V||0,s=W||0,e&&e(r,n,s,a))}function u(R){h(0,R)}function m(){(r||n||s||a.shift||a.alt||a.meta||a.control)&&(n=s=0,r=0,a.shift=a.alt=a.control=a.meta=!1,e&&e(0,0,0,a))}function f(R){o(R)&&e&&e(r,n,s,a)}function A(R){ot.buttons(R)===0?h(0,R):h(r,R)}function x(R){h(r|ot.buttons(R),R)}function C(R){h(r&~ot.buttons(R),R)}function O(){l||(l=!0,t.addEventListener("mousemove",A),t.addEventListener("mousedown",x),t.addEventListener("mouseup",C),t.addEventListener("mouseleave",u),t.addEventListener("mouseenter",u),t.addEventListener("mouseout",u),t.addEventListener("mouseover",u),t.addEventListener("blur",m),t.addEventListener("keyup",f),t.addEventListener("keydown",f),t.addEventListener("keypress",f),t!==window&&(window.addEventListener("blur",m),window.addEventListener("keyup",f),window.addEventListener("keydown",f),window.addEventListener("keypress",f)))}function U(){l&&(l=!1,t.removeEventListener("mousemove",A),t.removeEventListener("mousedown",x),t.removeEventListener("mouseup",C),t.removeEventListener("mouseleave",u),t.removeEventListener("mouseenter",u),t.removeEventListener("mouseout",u),t.removeEventListener("mouseover",u),t.removeEventListener("blur",m),t.removeEventListener("keyup",f),t.removeEventListener("keydown",f),t.removeEventListener("keypress",f),t!==window&&(window.removeEventListener("blur",m),window.removeEventListener("keyup",f),window.removeEventListener("keydown",f),window.removeEventListener("keypress",f)))}O();var F={element:t};return Object.defineProperties(F,{enabled:{get:function(){return l},set:function(R){R?O():U()},enumerable:!0},buttons:{get:function(){return r},enumerable:!0},x:{get:function(){return n},enumerable:!0},y:{get:function(){return s},enumerable:!0},mods:{get:function(){return a},enumerable:!0}}),F}var Go={left:0,top:0},Ho=Vo;function Vo(t,e,r){e=e||t.currentTarget||t.srcElement,Array.isArray(r)||(r=[0,0]);var n=t.clientX||0,s=t.clientY||0,a=Xo(e);return r[0]=n-a.left,r[1]=s-a.top,r}function Xo(t){return t===window||t===document||t===document.body?Go:t.getBoundingClientRect()}var kt={},ko={get exports(){return kt},set exports(t){kt=t}},Ir={},zo={get exports(){return Ir},set exports(t){Ir=t}},$o=void 0,oi=function(t){return t!==$o&&t!==null},Ko=oi,Wo={object:!0,function:!0,undefined:!0},Yo=function(t){return Ko(t)?hasOwnProperty.call(Wo,typeof t):!1},jo=Yo,qo=function(t){if(!jo(t))return!1;try{return t.constructor?t.constructor.prototype===t:!1}catch{return!1}},Zo=qo,Qo=function(t){if(typeof t!="function"||!hasOwnProperty.call(t,"length"))return!1;try{if(typeof t.length!="number"||typeof t.call!="function"||typeof t.apply!="function")return!1}catch{return!1}return!Zo(t)},Jo=Qo,el=/^\s*class[\s{/}]/,tl=Function.prototype.toString,rl=function(t){return!(!Jo(t)||el.test(tl.call(t)))},nl=function(){var t=Object.assign,e;return typeof t!="function"?!1:(e={foo:"raz"},t(e,{bar:"dwa"},{trzy:"trzy"}),e.foo+e.bar+e.trzy==="razdwatrzy")},ir,sn;function il(){return sn||(sn=1,ir=function(){try{return Object.keys("primitive"),!0}catch{return!1}}),ir}var sl=function(){},al=sl(),Vr=function(t){return t!==al&&t!==null},sr,an;function ol(){if(an)return sr;an=1;var t=Vr,e=Object.keys;return sr=function(r){return e(t(r)?Object(r):r)},sr}var ar,on;function ll(){return on||(on=1,ar=il()()?Object.keys:ol()),ar}var or,ln;function ul(){if(ln)return or;ln=1;var t=Vr;return or=function(e){if(!t(e))throw new TypeError("Cannot use null or undefined");return e},or}var lr,un;function hl(){if(un)return lr;un=1;var t=ll(),e=ul(),r=Math.max;return lr=function(n,s){var a,l,o=r(arguments.length,2),h;for(n=Object(e(n)),h=function(u){try{n[u]=s[u]}catch(m){a||(a=m)}},l=1;l<o;++l)s=arguments[l],t(s).forEach(h);if(a!==void 0)throw a;return n},lr}var cl=nl()?Object.assign:hl(),fl=Vr,El=Array.prototype.forEach,_l=Object.create,dl=function(t,e){var r;for(r in t)e[r]=t[r]},Al=function(t){var e=_l(null);return El.call(arguments,function(r){fl(r)&&dl(Object(r),e)}),e},ur="razdwatrzy",Tl=function(){return typeof ur.contains!="function"?!1:ur.contains("dwa")===!0&&ur.contains("foo")===!1},hr,hn;function ml(){if(hn)return hr;hn=1;var t=String.prototype.indexOf;return hr=function(e){return t.call(this,e,arguments[1])>-1},hr}var pl=Tl()?String.prototype.contains:ml(),Mt=oi,cn=rl,li=cl,ui=Al,_t=pl,gl=zo.exports=function(t,e){var r,n,s,a,l;return arguments.length<2||typeof t!="string"?(a=e,e=t,t=null):a=arguments[2],Mt(t)?(r=_t.call(t,"c"),n=_t.call(t,"e"),s=_t.call(t,"w")):(r=s=!0,n=!1),l={value:e,configurable:r,enumerable:n,writable:s},a?li(ui(a),l):l};gl.gs=function(t,e,r){var n,s,a,l;return typeof t!="string"?(a=r,r=e,e=t,t=null):a=arguments[3],Mt(e)?cn(e)?Mt(r)?cn(r)||(a=r,r=void 0):r=void 0:(a=e,e=r=void 0):e=void 0,Mt(t)?(n=_t.call(t,"c"),s=_t.call(t,"e")):(n=!0,s=!1),l={get:e,set:r,configurable:n,enumerable:s},a?li(ui(a),l):l};var Rl=function(t){if(typeof t!="function")throw new TypeError(t+" is not a function");return t};(function(t,e){var r=Ir,n=Rl,s=Function.prototype.apply,a=Function.prototype.call,l=Object.create,o=Object.defineProperty,h=Object.defineProperties,u=Object.prototype.hasOwnProperty,m={configurable:!0,enumerable:!1,writable:!0},f,A,x,C,O,U,F;f=function(R,d){var V;return n(d),u.call(this,"__ee__")?V=this.__ee__:(V=m.value=l(null),o(this,"__ee__",m),m.value=null),V[R]?typeof V[R]=="object"?V[R].push(d):V[R]=[V[R],d]:V[R]=d,this},A=function(R,d){var V,W;return n(d),W=this,f.call(this,R,V=function(){x.call(W,R,V),s.call(d,this,arguments)}),V.__eeOnceListener__=d,this},x=function(R,d){var V,W,k,Y;if(n(d),!u.call(this,"__ee__"))return this;if(V=this.__ee__,!V[R])return this;if(W=V[R],typeof W=="object")for(Y=0;k=W[Y];++Y)(k===d||k.__eeOnceListener__===d)&&(W.length===2?V[R]=W[Y?0:1]:W.splice(Y,1));else(W===d||W.__eeOnceListener__===d)&&delete V[R];return this},C=function(R){var d,V,W,k,Y;if(u.call(this,"__ee__")&&(k=this.__ee__[R],!!k))if(typeof k=="object"){for(V=arguments.length,Y=new Array(V-1),d=1;d<V;++d)Y[d-1]=arguments[d];for(k=k.slice(),d=0;W=k[d];++d)s.call(W,this,Y)}else switch(arguments.length){case 1:a.call(k,this);break;case 2:a.call(k,this,arguments[1]);break;case 3:a.call(k,this,arguments[1],arguments[2]);break;default:for(V=arguments.length,Y=new Array(V-1),d=1;d<V;++d)Y[d-1]=arguments[d];s.call(k,this,Y)}},O={on:f,once:A,off:x,emit:C},U={on:r(f),once:r(A),off:r(x),emit:r(C)},F=h({},U),t.exports=e=function(R){return R==null?l(F):h(Object(R),U)},e.methods=O})(ko,kt);var Dr=vl,xl=wo,ze=Ho,Sl=kt;function vl(t){t=t||window;var e=Sl(),r=[null,null],n=[null,null],s=[null,null],a=[null,null],l=0,o={},h,u,m=t===window?function(){h=window.innerWidth,u=window.innerHeight}:function(){h=t.clientWidth,u=t.clientHeight},f=0,A,x,C={},O=xl(t,function(N,S,z,X){A=S,x=z,f=N,C=X});function U(N){ze(N,t,s),m(),o.buttons=f,o.mods=C,o.x0=o.x=o.x1=2*s[0]/h-1,o.y0=o.y=o.y1=1-2*s[1]/u,o.x2=null,o.y2=null,o.dx=2*N.deltaX/h,o.dy=-2*N.deltaY/u,o.dz=2*N.deltaZ/h,o.active=1,o.zoomx=1,o.zoomy=1,o.theta=0,o.dtheta=0,o.originalEvent=N,e.emit("wheel",o),r[0]=s[0],r[1]=s[1]}var F=null,R=null,d=0;function V(N){ze(N,t,s),d=0,m(),o.buttons=f,o.mods=C,o.x=o.x1=2*s[0]/h-1,o.y=o.y1=1-2*s[1]/u,o.x2=null,o.y2=null,o.active=d,o.x0=2*F/h-1,o.y0=1-2*R/u,o.dx=0,o.dy=0,o.dz=0,o.zoomx=1,o.zoomy=1,o.theta=0,o.dtheta=0,o.originalEvent=N,e.emit("mouseup",o),F=R=null,r[0]=s[0],r[1]=s[1]}function W(N){ze(N,t,s),d=1,m(),F=A,R=x,o.buttons=f,o.mods=C,o.x=o.x0=o.x1=2*s[0]/h-1,o.y=o.y0=o.y1=1-2*s[1]/u,o.x2=null,o.y2=null,o.active=d,o.dx=0,o.dy=0,o.dz=0,o.zoomx=1,o.zoomy=1,o.theta=0,o.dtheta=0,o.originalEvent=N,e.emit("mousedown",o),r[0]=s[0],r[1]=s[1]}function k(N){ze(N,t,s),m(),o.buttons=f,o.mods=C,o.x0=2*F/h-1,o.y0=1-2*R/u,o.x=o.x1=2*s[0]/h-1,o.y=o.y1=1-2*s[1]/u,o.x2=null,o.y2=null,o.dx=2*(s[0]-r[0])/h,o.dy=-2*(s[1]-r[1])/u,o.active=d,o.dz=0,o.zoomx=1,o.zoomy=1,o.theta=0,o.dtheta=0,o.originalEvent=N,e.emit("mousemove",o),r[0]=s[0],r[1]=s[1]}function Y(N){for(var S=N.identifier,z=0;z<a.length;z++)if(a[z]&&a[z].touch&&a[z].touch.identifier===S)return z;return-1}function ee(N){n[0]=null,n[1]=null;for(var S=0;S<N.changedTouches.length;S++){var z=N.changedTouches[S],X=z.identifier,Q=Y(X);if(Q===-1&&l<2){var le=a[0]?1:0,ue=a[0]?0:1,b={position:[0,0],touch:null};a[le]=b,l++,b.touch=z,ze(z,t,b.position),a[ue]&&a[ue].touch}}for(var E=0,g=0,I=0,S=0;S<a.length;S++)a[S]&&(E+=a[S].position[0],g+=a[S].position[1],I++);if(E/=I,g/=I,l>0){if(o.theta=0,I>1){var w=a[1].position[0]-a[0].position[0],p=(a[0].position[1]-a[1].position[1])*h/u;o.theta=Math.atan2(p,w)}m(),o.buttons=0,o.mods={},o.active=l,F=E,R=g,o.x0=2*F/h-1,o.y0=1-2*R/u,o.x=2*E/h-1,o.y=1-2*g/u,o.x1=2*a[0].position[0]/h-1,o.y1=1-2*a[0].position[1]/u,l>1&&(o.x2=2*a[1].position[0]/h-1,o.y2=1-2*a[1].position[1]/u),o.active=l,o.dx=0,o.dy=0,o.dz=0,o.zoomx=1,o.zoomy=1,o.dtheta=0,o.originalEvent=N,e.emit(l===1?"touchstart":"pinchstart",o)}}function se(N){for(var S,z=!1,X=0;X<N.changedTouches.length;X++){var Q=N.changedTouches[X];S=Y(Q),S!==-1&&(z=!0,a[S].touch=Q,ze(Q,t,a[S].position))}if(z){if(l===1){for(S=0;S<a.length&&!a[S];S++);if(a[S]&&n[S]){var le=a[S].position[0],ue=a[S].position[1],b=le-n[S][0],E=ue-n[S][1];o.buttons=0,o.mods={},o.active=l,o.x=o.x1=2*le/h-1,o.y=o.y1=1-2*ue/u,o.x2=null,o.y2=null,o.x0=2*F/h-1,o.y0=1-2*R/u,o.dx=2*b/h,o.dy=-2*E/u,o.dz=0,o.zoomx=1,o.zoomy=1,o.theta=0,o.dtheta=0,o.originalEvent=N,e.emit("touchmove",o)}}else if(l===2&&n[0]&&n[1]){var g=n[0],I=n[1],w=I[0]-g[0],p=(I[1]-g[1])*h/u,y=a[0].position,L=a[1].position,ne=L[0]-y[0],ae=(y[1]-L[1])*h/u,fe=Math.sqrt(w*w+p*p)*.5,oe=Math.atan2(p,w),K=Math.sqrt(ne*ne+ae*ae)*.5,te=Math.atan2(ae,ne),c=(I[0]+g[0])*.5,_=(I[1]+g[1])*.5,b=.5*(L[0]+y[0]-g[0]-I[0]),E=.5*(L[1]+y[1]-g[1]-I[1]),D=K/fe,v=te-oe;o.buttons=0,o.mods=C,o.active=l,o.x=2*c/h-1,o.y=1-2*_/u,o.x0=2*F/h-1,o.y0=1-2*R/u,o.x1=2*y[0]/h-1,o.y1=1-2*y[1]/u,o.x2=2*L[0]/h-1,o.y2=1-2*L[1]/u,o.dx=2*b/h,o.dy=-2*E/u,o.dz=0,o.zoomx=D,o.zoomy=D,o.theta=te,o.dtheta=v,o.originalEvent=N,e.emit("pinchmove",o)}}a[0]&&(n[0]=a[0].position.slice()),a[1]&&(n[1]=a[1].position.slice())}function _e(N){for(var S,z=0;z<N.changedTouches.length;z++){var X=N.changedTouches[z],Q=Y(X);if(Q!==-1){S=a[Q],a[Q]=null,l--;var le=Q===0?1:0;a[le]&&a[le].touch}}var ue=0,b=0;if(l===0)S&&(ue=S.position[0],b=S.position[1]);else{for(var E=0,z=0;z<a.length;z++)a[z]&&(ue+=a[z].position[0],b+=a[z].position[1],E++);ue/=E,b/=E}l<2&&(o.buttons=0,o.mods=C,o.active=l,o.x=2*ue/h-1,o.y=1-2*b/u,o.x0=2*F/h-1,o.y0=1-2*R/u,o.dx=0,o.dy=0,o.dz=0,o.zoomx=1,o.zoomy=1,o.theta=0,o.dtheta=0,o.originalEvent=N,e.emit(l===0?"touchend":"pinchend",o)),l===0&&(F=R=null)}var T=!1;function H(){T||(T=!0,O.enabled=!0,t.addEventListener("wheel",U,!1),t.addEventListener("mousedown",W,!1),window.addEventListener("mousemove",k,!1),window.addEventListener("mouseup",V,!1),t.addEventListener("touchstart",ee,!1),window.addEventListener("touchmove",se,!1),window.addEventListener("touchend",_e,!1),window.addEventListener("touchcancel",_e,!1))}function $(){T&&(T=!1,O.enabled=!1,t.removeEventListener("wheel",U,!1),t.removeEventListener("mousedown",W,!1),window.removeEventListener("mousemove",k,!1),window.removeEventListener("mouseup",V,!1),t.removeEventListener("touchstart",ee,!1),window.removeEventListener("touchmove",se,!1),window.removeEventListener("touchend",_e,!1),window.removeEventListener("touchcancel",_e,!1))}return H(),e.enable=H,e.disable=$,e}function Cl(){return new Worker("/dat-garden-visualization/assets/graph-db-worker-681e3e3d.js",{type:"module"})}function Nl(){return new Worker("/dat-garden-visualization/assets/graph-layout-worker-b7703693.js",{type:"module"})}const hi=new Array(128).fill(void 0);hi.push(void 0,null,!0,!1);const Il=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});Il.decode();hi.length;const cr=new TextEncoder("utf-8");cr.encodeInto;var ci={};(function(t){var e=Pe&&Pe.__extends||function(){var b=function(E,g){return b=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(I,w){I.__proto__=w}||function(I,w){for(var p in w)Object.prototype.hasOwnProperty.call(w,p)&&(I[p]=w[p])},b(E,g)};return function(E,g){if(typeof g!="function"&&g!==null)throw new TypeError("Class extends value "+String(g)+" is not a constructor or null");b(E,g);function I(){this.constructor=E}E.prototype=g===null?Object.create(g):(I.prototype=g.prototype,new I)}}(),r=Pe&&Pe.__classPrivateFieldSet||function(b,E,g){if(!E.has(b))throw new TypeError("attempted to set private field on non-instance");return E.set(b,g),g},n=Pe&&Pe.__classPrivateFieldGet||function(b,E){if(!E.has(b))throw new TypeError("attempted to get private field on non-instance");return E.get(b)},s,a,l,o,h,u,m,f,A,x,C,O,U,F,R,d,V,W,k,Y,ee,se;t.__esModule=!0,t.default=void 0;var _e=function(b){var E=131,g=137,I=0;b+="x";for(var w=Math.floor(9007199254740991/g),p=0;p<b.length;p++)I>w&&(I=Math.floor(I/g)),I=I*E+b.charCodeAt(p);return I},T="0123456789abcdef".split(""),H=[-2147483648,8388608,32768,128],$=[24,16,8,0],N=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],S=[],z=function(){function b(E,g){E===void 0&&(E=!1),g===void 0&&(g=!1),s.set(this,void 0),a.set(this,void 0),l.set(this,void 0),o.set(this,void 0),h.set(this,void 0),u.set(this,void 0),m.set(this,void 0),f.set(this,void 0),A.set(this,void 0),x.set(this,void 0),C.set(this,void 0),O.set(this,void 0),U.set(this,void 0),F.set(this,void 0),R.set(this,void 0),d.set(this,void 0),V.set(this,0),W.set(this,void 0),this.init(E,g)}return b.prototype.init=function(E,g){g?(S[0]=S[16]=S[1]=S[2]=S[3]=S[4]=S[5]=S[6]=S[7]=S[8]=S[9]=S[10]=S[11]=S[12]=S[13]=S[14]=S[15]=0,r(this,a,S)):r(this,a,[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),E?(r(this,u,3238371032),r(this,m,914150663),r(this,f,812702999),r(this,A,4144912697),r(this,x,4290775857),r(this,C,1750603025),r(this,O,1694076839),r(this,U,3204075428)):(r(this,u,1779033703),r(this,m,3144134277),r(this,f,1013904242),r(this,A,2773480762),r(this,x,1359893119),r(this,C,2600822924),r(this,O,528734635),r(this,U,1541459225)),r(this,s,r(this,W,r(this,l,r(this,R,0)))),r(this,o,r(this,F,!1)),r(this,h,!0),r(this,d,E)},b.prototype.update=function(E){if(n(this,o))return this;var g;E instanceof ArrayBuffer?g=new Uint8Array(E):g=E;for(var I=0,w=g.length,p=n(this,a);I<w;){var y=void 0;if(n(this,F)&&(r(this,F,!1),p[0]=n(this,s),p[16]=p[1]=p[2]=p[3]=p[4]=p[5]=p[6]=p[7]=p[8]=p[9]=p[10]=p[11]=p[12]=p[13]=p[14]=p[15]=0),typeof g!="string")for(y=n(this,W);I<w&&y<64;++I)p[y>>2]|=g[I]<<$[y++&3];else for(y=n(this,W);I<w&&y<64;++I){var L=g.charCodeAt(I);L<128?p[y>>2]|=L<<$[y++&3]:L<2048?(p[y>>2]|=(192|L>>6)<<$[y++&3],p[y>>2]|=(128|L&63)<<$[y++&3]):L<55296||L>=57344?(p[y>>2]|=(224|L>>12)<<$[y++&3],p[y>>2]|=(128|L>>6&63)<<$[y++&3],p[y>>2]|=(128|L&63)<<$[y++&3]):(L=65536+((L&1023)<<10|g.charCodeAt(++I)&1023),p[y>>2]|=(240|L>>18)<<$[y++&3],p[y>>2]|=(128|L>>12&63)<<$[y++&3],p[y>>2]|=(128|L>>6&63)<<$[y++&3],p[y>>2]|=(128|L&63)<<$[y++&3])}r(this,V,y),r(this,l,n(this,l)+(y-n(this,W))),y>=64?(r(this,s,p[16]),r(this,W,y-64),this.hash(),r(this,F,!0)):r(this,W,y)}return n(this,l)>4294967295&&(r(this,R,n(this,R)+(n(this,l)/4294967296<<0)),r(this,l,n(this,l)%4294967296)),this},b.prototype.finalize=function(){if(!n(this,o)){r(this,o,!0);var E=n(this,a),g=n(this,V);E[16]=n(this,s),E[g>>2]|=H[g&3],r(this,s,E[16]),g>=56&&(n(this,F)||this.hash(),E[0]=n(this,s),E[16]=E[1]=E[2]=E[3]=E[4]=E[5]=E[6]=E[7]=E[8]=E[9]=E[10]=E[11]=E[12]=E[13]=E[14]=E[15]=0),E[14]=n(this,R)<<3|n(this,l)>>>29,E[15]=n(this,l)<<3,this.hash()}},b.prototype.hash=function(){for(var E=n(this,u),g=n(this,m),I=n(this,f),w=n(this,A),p=n(this,x),y=n(this,C),L=n(this,O),ne=n(this,U),ae=n(this,a),fe,oe,K,te,c,_,D,v,M,P,B=16;B<64;++B)te=ae[B-15],fe=(te>>>7|te<<25)^(te>>>18|te<<14)^te>>>3,te=ae[B-2],oe=(te>>>17|te<<15)^(te>>>19|te<<13)^te>>>10,ae[B]=ae[B-16]+fe+ae[B-7]+oe<<0;P=g&I;for(var j=0;j<64;j+=4)n(this,h)?(n(this,d)?(D=300032,te=ae[0]-1413257819,ne=te-150054599<<0,w=te+24177077<<0):(D=704751109,te=ae[0]-210244248,ne=te-1521486534<<0,w=te+143694565<<0),r(this,h,!1)):(fe=(E>>>2|E<<30)^(E>>>13|E<<19)^(E>>>22|E<<10),oe=(p>>>6|p<<26)^(p>>>11|p<<21)^(p>>>25|p<<7),D=E&g,K=D^E&I^P,_=p&y^~p&L,te=ne+oe+_+N[j]+ae[j],c=fe+K,ne=w+te<<0,w=te+c<<0),fe=(w>>>2|w<<30)^(w>>>13|w<<19)^(w>>>22|w<<10),oe=(ne>>>6|ne<<26)^(ne>>>11|ne<<21)^(ne>>>25|ne<<7),v=w&E,K=v^w&g^D,_=ne&p^~ne&y,te=L+oe+_+N[j+1]+ae[j+1],c=fe+K,L=I+te<<0,I=te+c<<0,fe=(I>>>2|I<<30)^(I>>>13|I<<19)^(I>>>22|I<<10),oe=(L>>>6|L<<26)^(L>>>11|L<<21)^(L>>>25|L<<7),M=I&w,K=M^I&E^v,_=L&ne^~L&p,te=y+oe+_+N[j+2]+ae[j+2],c=fe+K,y=g+te<<0,g=te+c<<0,fe=(g>>>2|g<<30)^(g>>>13|g<<19)^(g>>>22|g<<10),oe=(y>>>6|y<<26)^(y>>>11|y<<21)^(y>>>25|y<<7),P=g&I,K=P^g&w^M,_=y&L^~y&ne,te=p+oe+_+N[j+3]+ae[j+3],c=fe+K,p=E+te<<0,E=te+c<<0;r(this,u,n(this,u)+E<<0),r(this,m,n(this,m)+g<<0),r(this,f,n(this,f)+I<<0),r(this,A,n(this,A)+w<<0),r(this,x,n(this,x)+p<<0),r(this,C,n(this,C)+y<<0),r(this,O,n(this,O)+L<<0),r(this,U,n(this,U)+ne<<0)},b.prototype.hex=function(){this.finalize();var E=n(this,u),g=n(this,m),I=n(this,f),w=n(this,A),p=n(this,x),y=n(this,C),L=n(this,O),ne=n(this,U),ae=T[E>>28&15]+T[E>>24&15]+T[E>>20&15]+T[E>>16&15]+T[E>>12&15]+T[E>>8&15]+T[E>>4&15]+T[E&15]+T[g>>28&15]+T[g>>24&15]+T[g>>20&15]+T[g>>16&15]+T[g>>12&15]+T[g>>8&15]+T[g>>4&15]+T[g&15]+T[I>>28&15]+T[I>>24&15]+T[I>>20&15]+T[I>>16&15]+T[I>>12&15]+T[I>>8&15]+T[I>>4&15]+T[I&15]+T[w>>28&15]+T[w>>24&15]+T[w>>20&15]+T[w>>16&15]+T[w>>12&15]+T[w>>8&15]+T[w>>4&15]+T[w&15]+T[p>>28&15]+T[p>>24&15]+T[p>>20&15]+T[p>>16&15]+T[p>>12&15]+T[p>>8&15]+T[p>>4&15]+T[p&15]+T[y>>28&15]+T[y>>24&15]+T[y>>20&15]+T[y>>16&15]+T[y>>12&15]+T[y>>8&15]+T[y>>4&15]+T[y&15]+T[L>>28&15]+T[L>>24&15]+T[L>>20&15]+T[L>>16&15]+T[L>>12&15]+T[L>>8&15]+T[L>>4&15]+T[L&15];return n(this,d)||(ae+=T[ne>>28&15]+T[ne>>24&15]+T[ne>>20&15]+T[ne>>16&15]+T[ne>>12&15]+T[ne>>8&15]+T[ne>>4&15]+T[ne&15]),ae},b.prototype.toString=function(){return this.hex()},b.prototype.digest=function(){this.finalize();var E=n(this,u),g=n(this,m),I=n(this,f),w=n(this,A),p=n(this,x),y=n(this,C),L=n(this,O),ne=n(this,U),ae=[E>>24&255,E>>16&255,E>>8&255,E&255,g>>24&255,g>>16&255,g>>8&255,g&255,I>>24&255,I>>16&255,I>>8&255,I&255,w>>24&255,w>>16&255,w>>8&255,w&255,p>>24&255,p>>16&255,p>>8&255,p&255,y>>24&255,y>>16&255,y>>8&255,y&255,L>>24&255,L>>16&255,L>>8&255,L&255];return n(this,d)||ae.push(ne>>24&255,ne>>16&255,ne>>8&255,ne&255),ae},b.prototype.array=function(){return this.digest()},b.prototype.arrayBuffer=function(){this.finalize();var E=new ArrayBuffer(n(this,d)?28:32),g=new DataView(E);return g.setUint32(0,n(this,u)),g.setUint32(4,n(this,m)),g.setUint32(8,n(this,f)),g.setUint32(12,n(this,A)),g.setUint32(16,n(this,x)),g.setUint32(20,n(this,C)),g.setUint32(24,n(this,O)),n(this,d)||g.setUint32(28,n(this,U)),E},b}();s=new WeakMap,a=new WeakMap,l=new WeakMap,o=new WeakMap,h=new WeakMap,u=new WeakMap,m=new WeakMap,f=new WeakMap,A=new WeakMap,x=new WeakMap,C=new WeakMap,O=new WeakMap,U=new WeakMap,F=new WeakMap,R=new WeakMap,d=new WeakMap,V=new WeakMap,W=new WeakMap,function(b){e(E,b);function E(g,I,w){I===void 0&&(I=!1),w===void 0&&(w=!1);var p=b.call(this,I,w)||this;k.set(p,void 0),Y.set(p,void 0),ee.set(p,void 0),se.set(p,void 0);var y;if(typeof g=="string"){for(var L=[],ne=g.length,ae=0,fe=0;fe<ne;++fe){var oe=g.charCodeAt(fe);oe<128?L[ae++]=oe:oe<2048?(L[ae++]=192|oe>>6,L[ae++]=128|oe&63):oe<55296||oe>=57344?(L[ae++]=224|oe>>12,L[ae++]=128|oe>>6&63,L[ae++]=128|oe&63):(oe=65536+((oe&1023)<<10|g.charCodeAt(++fe)&1023),L[ae++]=240|oe>>18,L[ae++]=128|oe>>12&63,L[ae++]=128|oe>>6&63,L[ae++]=128|oe&63)}y=L}else g instanceof ArrayBuffer?y=new Uint8Array(g):y=g;y.length>64&&(y=new z(I,!0).update(y).array());for(var K=[],te=[],fe=0;fe<64;++fe){var c=y[fe]||0;K[fe]=92^c,te[fe]=54^c}return p.update(te),r(p,ee,K),r(p,k,!0),r(p,Y,I),r(p,se,w),p}return E.prototype.finalize=function(){if(b.prototype.finalize.call(this),n(this,k)){r(this,k,!1);var g=this.array();b.prototype.init.call(this,n(this,Y),n(this,se)),this.update(n(this,ee)),this.update(g),b.prototype.finalize.call(this)}},E}(z),k=new WeakMap,Y=new WeakMap,ee=new WeakMap,se=new WeakMap;function X(b){var E=new z;return E.update(b),parseInt(E.hex().substring(0,8),16)}var Q=function(b){var E="#";return b.forEach(function(g){g<16&&(E+=0),E+=g.toString(16)}),E},le=function(b,E,g){b/=360;var I=g<.5?g*(1+E):g+E-g*E,w=2*g-I;return[b+1/3,b,b-1/3].map(function(p){return p<0&&p++,p>1&&p--,p<1/6?p=w+(I-w)*6*p:p<.5?p=I:p<2/3?p=w+(I-w)*6*(2/3-p):p=w,Math.round(p*255)})},ue=function(){function b(E){E===void 0&&(E={});var g=[E.lightness,E.saturation].map(function(p){return p=p!==void 0?p:[.35,.5,.65],Array.isArray(p)?p.concat():[p]}),I=g[0],w=g[1];this.L=I,this.S=w,typeof E.hue=="number"&&(E.hue={min:E.hue,max:E.hue}),typeof E.hue=="object"&&!Array.isArray(E.hue)&&(E.hue=[E.hue]),typeof E.hue>"u"&&(E.hue=[]),this.hueRanges=E.hue.map(function(p){return{min:typeof p.min>"u"?0:p.min,max:typeof p.max>"u"?360:p.max}}),this.hash=X,typeof E.hash=="function"&&(this.hash=E.hash),E.hash==="bkdr"&&(this.hash=_e)}return b.prototype.hsl=function(E){var g,I,w,p=this.hash(E),y=727;if(this.hueRanges.length){var L=this.hueRanges[p%this.hueRanges.length];g=p/this.hueRanges.length%y*(L.max-L.min)/y+L.min}else g=p%359;return p=Math.ceil(p/360),I=this.S[p%this.S.length],p=Math.ceil(p/this.S.length),w=this.L[p%this.L.length],[g,I,w]},b.prototype.rgb=function(E){var g=this.hsl(E);return le.apply(this,g)},b.prototype.hex=function(E){var g=this.rgb(E);return Q(g)},b}();t.default=ue})(ci);const Dl=Qi(ci),Pl=new Dl({saturation:.7,lightness:.6}),yl=async()=>{const t="https://dat-ecosystem.org/dat-garden-rake/",e=await fetch(`${t}index.json`).then(l=>l.json()),r=`${t}${e.latest}`,[n,s,a]=await Promise.all([fetch(r+"/../valuenetwork.json").then(l=>l.json()),fetch(r+"/../projects.json").then(l=>l.json()),fetch(r+"/../organizations.json").then(l=>l.json())]);return{valueNetworkData:n,projectsData:s,organizationsData:a}},Pr=ie.promise(yl),fi=Kt(new Cl),Ei=Kt(new Nl),Fl=t=>Math.max(4*Math.log(2*(t?.length||1)**1.2),2),Bl=t=>t.replace(/^(https?:\/\/)?(www\.)?([a-z0-9-]+\.)+[a-z0-9-]+/i,"").replace(/\/$/,"").replace(/^\//,"").replace(/[^A-Za-z0-9\.]/gi,"-").replace(/-+/g,"-").replace(/^package-/,"").replace(/-v-/,"-"),it=ie.promise(async()=>{const{valueNetworkData:t,projectsData:e,organizationsData:r}=await Pr();console.log(await Pr());const n=Object.entries(t).map(([u,{dependents:m,owner:f,dependencies:A}],x)=>({index:x,project:u,id:u,data:e[u],navId:Bl(u),owner:f,ownerData:r[f],color:[...Pl.rgb(f||u||String(x)).map(C=>C/255),1],size:Fl(m),dependents:m,dependencies:A}));ke(n.map(u=>[u.index,u]));const s=ke(n.map(u=>[u.project,u])),a=ke(n.map(u=>[u.data.name,u])),l=ke(n.map(u=>[u.navId,u]));let o=Object.entries(t).flatMap(([u,{dependents:m,dependencies:f}])=>(m||[]).map(A=>({source:A,sourceNode:s[A],sourceIndex:n.find(x=>x.project===A).index,target:u,targetNode:s[u],targetIndex:n.find(x=>x.project===u).index})).concat((f||[]).map(A=>({source:u,sourceNode:s[u],sourceIndex:n.find(x=>x.project===u).index,target:A,targetNode:s[A],targetIndex:n.find(x=>x.project===A).index})))).filter(u=>u);o=Bo(o,(u,m)=>u.sourceIndex===m.sourceIndex&&u.targetIndex===m.targetIndex);const h=o.map(({sourceIndex:u,targetIndex:m})=>[u,m]);return console.log("link count",o.length),ke(h.map(([u,m],f)=>[`${u}-${m}`,f])),ke(h.map(([u,m],f)=>[`${u}-${m}`,o[f]])),{nodes:n,links:o,linkIndexPairs:h,nodesByNavId:l,nodesByProject:s,nodesByProjectName:a}}),Ml=async()=>{const t=await Pr();return await fi.buildGraph(t)},Ol=async(t,e=Ei.useD3ForceSimulator)=>await e(t,mt(r=>me()?.targetData(r))),bl=t=>{const e=me().mostRecentData,r=t.index;return[e[r*3],e[r*3+1],e[r*3+2]]},Ll=async t=>await Ol(t||await prepareVisualizerData(),Ei.useD3ForceSimulator),{doQuery:wl,buildGraph:zu}=fi;function Ul(){return new Worker("/dat-garden-visualization/assets/animation-worker-27b3455f.js",{type:"module"})}var fr;const zt=window,Qe=zt.trustedTypes,fn=Qe?Qe.createPolicy("lit-html",{createHTML:t=>t}):void 0,yr="$lit$",be=`lit$${(Math.random()+"").slice(9)}$`,_i="?"+be,Gl=`<${_i}>`,Je=document,gt=()=>Je.createComment(""),Rt=t=>t===null||typeof t!="object"&&typeof t!="function",di=Array.isArray,Hl=t=>di(t)||typeof t?.[Symbol.iterator]=="function",Er=`[ 	
\f\r]`,lt=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,En=/-->/g,_n=/>/g,we=RegExp(`>|${Er}(?:([^\\s"'>=/]+)(${Er}*=${Er}*(?:[^ 	
\f\r"'\`<>=]|("|')|))|$)`,"g"),dn=/'/g,An=/"/g,Ai=/^(?:script|style|textarea|title)$/i,Vl=t=>(e,...r)=>({_$litType$:t,strings:e,values:r}),Oe=Vl(1),xt=Symbol.for("lit-noChange"),Te=Symbol.for("lit-nothing"),Tn=new WeakMap,We=Je.createTreeWalker(Je,129,null,!1),Xl=(t,e)=>{const r=t.length-1,n=[];let s,a=e===2?"<svg>":"",l=lt;for(let h=0;h<r;h++){const u=t[h];let m,f,A=-1,x=0;for(;x<u.length&&(l.lastIndex=x,f=l.exec(u),f!==null);)x=l.lastIndex,l===lt?f[1]==="!--"?l=En:f[1]!==void 0?l=_n:f[2]!==void 0?(Ai.test(f[2])&&(s=RegExp("</"+f[2],"g")),l=we):f[3]!==void 0&&(l=we):l===we?f[0]===">"?(l=s??lt,A=-1):f[1]===void 0?A=-2:(A=l.lastIndex-f[2].length,m=f[1],l=f[3]===void 0?we:f[3]==='"'?An:dn):l===An||l===dn?l=we:l===En||l===_n?l=lt:(l=we,s=void 0);const C=l===we&&t[h+1].startsWith("/>")?" ":"";a+=l===lt?u+Gl:A>=0?(n.push(m),u.slice(0,A)+yr+u.slice(A)+be+C):u+be+(A===-2?(n.push(void 0),h):C)}const o=a+(t[r]||"<?>")+(e===2?"</svg>":"");if(!Array.isArray(t)||!t.hasOwnProperty("raw"))throw Error("invalid template strings array");return[fn!==void 0?fn.createHTML(o):o,n]};class St{constructor({strings:e,_$litType$:r},n){let s;this.parts=[];let a=0,l=0;const o=e.length-1,h=this.parts,[u,m]=Xl(e,r);if(this.el=St.createElement(u,n),We.currentNode=this.el.content,r===2){const f=this.el.content,A=f.firstChild;A.remove(),f.append(...A.childNodes)}for(;(s=We.nextNode())!==null&&h.length<o;){if(s.nodeType===1){if(s.hasAttributes()){const f=[];for(const A of s.getAttributeNames())if(A.endsWith(yr)||A.startsWith(be)){const x=m[l++];if(f.push(A),x!==void 0){const C=s.getAttribute(x.toLowerCase()+yr).split(be),O=/([.?@])?(.*)/.exec(x);h.push({type:1,index:a,name:O[2],strings:C,ctor:O[1]==="."?zl:O[1]==="?"?Kl:O[1]==="@"?Wl:jt})}else h.push({type:6,index:a})}for(const A of f)s.removeAttribute(A)}if(Ai.test(s.tagName)){const f=s.textContent.split(be),A=f.length-1;if(A>0){s.textContent=Qe?Qe.emptyScript:"";for(let x=0;x<A;x++)s.append(f[x],gt()),We.nextNode(),h.push({type:2,index:++a});s.append(f[A],gt())}}}else if(s.nodeType===8)if(s.data===_i)h.push({type:2,index:a});else{let f=-1;for(;(f=s.data.indexOf(be,f+1))!==-1;)h.push({type:7,index:a}),f+=be.length-1}a++}}static createElement(e,r){const n=Je.createElement("template");return n.innerHTML=e,n}}function et(t,e,r=t,n){var s,a,l,o;if(e===xt)return e;let h=n!==void 0?(s=r._$Co)===null||s===void 0?void 0:s[n]:r._$Cl;const u=Rt(e)?void 0:e._$litDirective$;return h?.constructor!==u&&((a=h?._$AO)===null||a===void 0||a.call(h,!1),u===void 0?h=void 0:(h=new u(t),h._$AT(t,r,n)),n!==void 0?((l=(o=r)._$Co)!==null&&l!==void 0?l:o._$Co=[])[n]=h:r._$Cl=h),h!==void 0&&(e=et(t,h._$AS(t,e.values),h,n)),e}class kl{constructor(e,r){this._$AV=[],this._$AN=void 0,this._$AD=e,this._$AM=r}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(e){var r;const{el:{content:n},parts:s}=this._$AD,a=((r=e?.creationScope)!==null&&r!==void 0?r:Je).importNode(n,!0);We.currentNode=a;let l=We.nextNode(),o=0,h=0,u=s[0];for(;u!==void 0;){if(o===u.index){let m;u.type===2?m=new Xr(l,l.nextSibling,this,e):u.type===1?m=new u.ctor(l,u.name,u.strings,this,e):u.type===6&&(m=new Yl(l,this,e)),this._$AV.push(m),u=s[++h]}o!==u?.index&&(l=We.nextNode(),o++)}return a}v(e){let r=0;for(const n of this._$AV)n!==void 0&&(n.strings!==void 0?(n._$AI(e,n,r),r+=n.strings.length-2):n._$AI(e[r])),r++}}let Xr=class Ti{constructor(e,r,n,s){var a;this.type=2,this._$AH=Te,this._$AN=void 0,this._$AA=e,this._$AB=r,this._$AM=n,this.options=s,this._$Cp=(a=s?.isConnected)===null||a===void 0||a}get _$AU(){var e,r;return(r=(e=this._$AM)===null||e===void 0?void 0:e._$AU)!==null&&r!==void 0?r:this._$Cp}get parentNode(){let e=this._$AA.parentNode;const r=this._$AM;return r!==void 0&&e?.nodeType===11&&(e=r.parentNode),e}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(e,r=this){e=et(this,e,r),Rt(e)?e===Te||e==null||e===""?(this._$AH!==Te&&this._$AR(),this._$AH=Te):e!==this._$AH&&e!==xt&&this._(e):e._$litType$!==void 0?this.g(e):e.nodeType!==void 0?this.$(e):Hl(e)?this.T(e):this._(e)}k(e){return this._$AA.parentNode.insertBefore(e,this._$AB)}$(e){this._$AH!==e&&(this._$AR(),this._$AH=this.k(e))}_(e){this._$AH!==Te&&Rt(this._$AH)?this._$AA.nextSibling.data=e:this.$(Je.createTextNode(e)),this._$AH=e}g(e){var r;const{values:n,_$litType$:s}=e,a=typeof s=="number"?this._$AC(e):(s.el===void 0&&(s.el=St.createElement(s.h,this.options)),s);if(((r=this._$AH)===null||r===void 0?void 0:r._$AD)===a)this._$AH.v(n);else{const l=new kl(a,this),o=l.u(this.options);l.v(n),this.$(o),this._$AH=l}}_$AC(e){let r=Tn.get(e.strings);return r===void 0&&Tn.set(e.strings,r=new St(e)),r}T(e){di(this._$AH)||(this._$AH=[],this._$AR());const r=this._$AH;let n,s=0;for(const a of e)s===r.length?r.push(n=new Ti(this.k(gt()),this.k(gt()),this,this.options)):n=r[s],n._$AI(a),s++;s<r.length&&(this._$AR(n&&n._$AB.nextSibling,s),r.length=s)}_$AR(e=this._$AA.nextSibling,r){var n;for((n=this._$AP)===null||n===void 0||n.call(this,!1,!0,r);e&&e!==this._$AB;){const s=e.nextSibling;e.remove(),e=s}}setConnected(e){var r;this._$AM===void 0&&(this._$Cp=e,(r=this._$AP)===null||r===void 0||r.call(this,e))}};class jt{constructor(e,r,n,s,a){this.type=1,this._$AH=Te,this._$AN=void 0,this.element=e,this.name=r,this._$AM=s,this.options=a,n.length>2||n[0]!==""||n[1]!==""?(this._$AH=Array(n.length-1).fill(new String),this.strings=n):this._$AH=Te}get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}_$AI(e,r=this,n,s){const a=this.strings;let l=!1;if(a===void 0)e=et(this,e,r,0),l=!Rt(e)||e!==this._$AH&&e!==xt,l&&(this._$AH=e);else{const o=e;let h,u;for(e=a[0],h=0;h<a.length-1;h++)u=et(this,o[n+h],r,h),u===xt&&(u=this._$AH[h]),l||(l=!Rt(u)||u!==this._$AH[h]),u===Te?e=Te:e!==Te&&(e+=(u??"")+a[h+1]),this._$AH[h]=u}l&&!s&&this.j(e)}j(e){e===Te?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,e??"")}}class zl extends jt{constructor(){super(...arguments),this.type=3}j(e){this.element[this.name]=e===Te?void 0:e}}const $l=Qe?Qe.emptyScript:"";class Kl extends jt{constructor(){super(...arguments),this.type=4}j(e){e&&e!==Te?this.element.setAttribute(this.name,$l):this.element.removeAttribute(this.name)}}class Wl extends jt{constructor(e,r,n,s,a){super(e,r,n,s,a),this.type=5}_$AI(e,r=this){var n;if((e=(n=et(this,e,r,0))!==null&&n!==void 0?n:Te)===xt)return;const s=this._$AH,a=e===Te&&s!==Te||e.capture!==s.capture||e.once!==s.once||e.passive!==s.passive,l=e!==Te&&(s===Te||a);a&&this.element.removeEventListener(this.name,this,s),l&&this.element.addEventListener(this.name,this,e),this._$AH=e}handleEvent(e){var r,n;typeof this._$AH=="function"?this._$AH.call((n=(r=this.options)===null||r===void 0?void 0:r.host)!==null&&n!==void 0?n:this.element,e):this._$AH.handleEvent(e)}}class Yl{constructor(e,r,n){this.element=e,this.type=6,this._$AN=void 0,this._$AM=r,this.options=n}get _$AU(){return this._$AM._$AU}_$AI(e){et(this,e)}}const mn=zt.litHtmlPolyfillSupport;mn?.(St,Xr),((fr=zt.litHtmlVersions)!==null&&fr!==void 0?fr:zt.litHtmlVersions=[]).push("2.7.1");const pn=(t,e,r)=>{var n,s;const a=(n=r?.renderBefore)!==null&&n!==void 0?n:e;let l=a._$litPart$;if(l===void 0){const o=(s=r?.renderBefore)!==null&&s!==void 0?s:null;a._$litPart$=l=new Xr(e.insertBefore(gt(),o),o,void 0,r??{})}return l._$AI(t),l},jl=t=>`
  PREFIX dependson: <http://dat-ecosystem.org#dependson>
  SELECT DISTINCT ?dependent ?dependency WHERE {
    ?dependency dependson:* <${t}> .
    ?dependent dependson: ?dependency .
  }
`,mi=({color:t})=>t,ql=ie.infinite(async(t=Ze)=>{const{nodes:e,links:r}=await it();return new Float32Array(e.map(mi).flatMap(t))}),pi=({size:t})=>Math.sqrt(t)/40,Zl=ie.infinite(async(t=Ze)=>{const{nodes:e,links:r}=await it();return new Float32Array(e.map(pi).map(t))}),gi=async({colorMap:t=Ze,sizeMap:e=Ze,immediate:r=!1}={})=>{const n=Re(),s=xe(),a=ye(),l=await ql(t),o=await Zl(e);n.targetData(l,{immediate:r}),s.targetData(o,{immediate:r}),a.targetData(new Float32Array(a.target.numItems).fill(0),{immediate:r})},_r=async(t,{colorMap:e=Ze,sizeMap:r=Ze,emphasis:n=0,immediate:s=!1}={})=>{const a=new Float32Array(e(mi(t))),l=new Float32Array([r(pi(t))]),o=new Float32Array([n]),h=Re(),u=xe(),m=ye();h.targetData(a,{offset:t.index,immediate:s}),u.targetData(l,{offset:t.index,immediate:s}),m.targetData(o,{offset:t.index,immediate:s})},Ri=async(t=!1)=>{await gi({colorMap:e=>{const r=e.slice(0,3).reduce((n,s)=>n+s,0)/3;return[...e.slice(0,3).map(n=>r),.5]},sizeMap:e=>e*.5,immediate:t})},gn="this.parentNode.style.display='none'",Rn="this.parentNode.style.display='initial'",Ql=t=>Oe`
  <div class="project">
    <h3><a target="_blank" href="${t.data?.homepage}">${t.data.name}</a></h3>
    <div class="description">${t.data.description}</div>
    <div class="links">
      <span class="owner">
        <div class="owner-name-container">
          ${t.ownerData.html_url?Oe`<a target="_blank" href="${t.ownerData.html_url}">${t.ownerData.name}</a>`:Oe`<span>${t.ownerData.name}</span>`}
        </div>
        <div class="avatar-container">
          <img class="avatar-stroke" src="${t.ownerData?.avatar_url}" onerror=${gn} onload=${Rn} alt="">
          <img class="avatar" src="${t.ownerData?.avatar_url}" onerror=${gn} onload=${Rn} alt="${t.ownerData?.name}">
        </div>
      </span>
      <span><a target="_blank" href="${t.project}">NPM</a></span>
      ${t.data?.repository?Oe`<span><a target="_blank" href="${t.data.repository}">Git</a></span>`:Oe``}
      ${t.data?.bugs?Oe`<span><a target="_blank" href="${t.data.bugs}">Issues</a></span>`:Oe``}
      <!-- <a href="${t.ownerData.html_url}">Owner Profile</a> -->
    </div>
  </div>

`,Jl=t=>{const e=document.getElementById("selection-info");if(t){const r=Ql(t);console.log(r),pn(r,e)}else pn(Oe``,e)},xi=async(t,e=!0)=>{const r=n=>n*2;if(t){vi(t.index);const n=bl(t),s=jl(t.project);console.log("the node",t);const{nodesByProject:a,links:l}=await it();Ri().then(()=>{_r(t,{sizeMap:r,emphasis:1}),wl(s,mt((o,h)=>{h(["dependent","dependency"]).then(({dependent:u,dependency:m})=>{_r(a[u.value],{sizeMap:r,emphasis:1}),_r(a[m.value],{sizeMap:r,emphasis:1})})}),mt(()=>{console.log("query ended:",s)})),e&&Sn(n),e&&vn(Ni||75)})}else console.log("no selection"),e&&vn(Ii||1500),e&&Sn([0,0,0],4e3),gi();Jl(t)},eu=()=>{xi(null)};window.initializeSelectionVisuals=Ri;let Si=-1;const tt=()=>Si,vi=t=>{Si=t};var Ye={},tu=(t,e)=>{Ye[t]??(Ye[t]=[]),Ye[t].push(e)},ru=(t,e)=>{var r;(r=Ye[t])==null||r.splice(Ye[t].indexOf(e),1)},xn=async(t,e,r)=>{for(const n of Ye[t]??[])await n(e,r)},dr=t=>t.length>1&&t.endsWith("/")?t.slice(0,-1):t,nu=t=>{var e;const r=(e=t.match(/(:[^/]+)/g))==null?void 0:e.map(n=>n.substring(1));return r&&{keys:r,regExp:new RegExp("^"+t.replace(/(:[^/]+)/g,"([^/]+)")+"$")}},iu=(t,e)=>Object.fromEntries(e.map((r,n)=>[r,t[n+1]])),Ci=[],$e,su=t=>{for(const e of Ci){const{pattern:r,regExp:n,keys:s}=e,a=n?t.match(n):r==="*"||r===t;if(a){const l=Array.isArray(a)?iu(a,s):void 0;return{definition:e,params:l}}}},ut=async(t,e)=>{const r=su(t),n=!!r,s=r?.params??{},a=$e;$e={path:t,params:s,matches:n,trigger:e},await xn("before-route",$e,a),await r?.definition.action(s,$e,a),await xn("route",$e,a)},qt={get currentRoute(){return $e},on:tu,off:ru,start({handleInitial:t=!0}={}){const e=window.location.hash!=""&&window.location.hash;t&&ut(e||window.location.pathname||"/","init"),window.addEventListener("popstate",()=>ut(window.location.pathname,"popstate")),window.addEventListener("hashchange",()=>{ut(window.location.hash,"hashchange")})},route(t,e){const r=dr(t),{regExp:n,keys:s=[]}=nu(t)||{};Ci.push({pattern:r,action:e,regExp:n,keys:s})},push(t){window.history.pushState(null,"",dr(t)),ut(t,"push")},replace(t){window.history.replaceState(null,"",dr(t)),ut(t,"replace")}};qt.route("#-",()=>{eu()});qt.route("#project/:id",async(t,{trigger:e})=>{const{nodesByNavId:r}=await it(),n=r[t.id];xi(n,e!=="init")});const au=t=>{const n=re().canvas.getBoundingClientRect(),s=(t.clientX-n.left)/n.width,a=(t.clientY-n.top)/n.height;return{x:s*2-1,y:-(a*2-1)}},Fr=Kt(new Ul),{globalCamera:Ot,updateCameras:ou,setCameraCenter:Sn,setCameraDistance:vn,zoomGlobalCamera:Cn,panGlobalCamera:Nn,startZooming:In,startPanning:Dn,stopPanning:Pn}=Fr;let Ni,Ii;const Di=500,lu=Di,yn=async()=>{Fr.stopZooming();const t=tt(),e=(await Fr.getGlobalCameraParams()).distance;t>-1?Ni=Math.min(e,Di):Ii=Math.max(e,lu)},pe={},Fn=new Uint8Array(4).fill(0);let Br=-1,bt=0,dt=0;const Ar=()=>{bt++},Tr=()=>[pe.canvasX,pe.canvasY],$t=()=>[pe.x,pe.y],Lt=({x:t,y:e})=>{const r=re();pe.x=t,pe.y=e,pe.canvasX=(t+1)/2*r.width,pe.canvasY=(e+1)/2*r.height;const n=window.devicePixelRatio||1;pe.pickerX=Math.floor(pe.canvasX/n),pe.pickerY=Math.floor(pe.canvasY/n)},uu=ie.infinite(()=>{const e=re().canvas;Dr(e).on("touchmove",Lt).on("mousemove",Lt),Dr(e).on("touchmove",Ar).on("pinchmove",Ar).on("mousemove",Ar),e.addEventListener("pointerdown",r=>{console.log("pointerdown"),Lt(au(r)),bt=0,dt=0}),e.addEventListener("pointerup",()=>{const r=dt>.03||bt>5;console.log("was drag",r,dt,bt),r||(Mr=!0,setTimeout(()=>{const n=tt();vi(Br===n?-1:Br),Eu().then(s=>{e.dispatchEvent(new CustomEvent("selected",{detail:{selectedIndex:n,info:s}}))}),e.dispatchEvent(new CustomEvent("tap",{detail:{selectedIndex:n}}))},50))}),e.addEventListener("selected",r=>{const n=r.detail.info;console.log("preparing to navigate:",n),qt.push(n?`#project/${n?.navId}`:"#-")})}),yt=Math.PI/3,hu=()=>{const e=re().canvas;e.addEventListener("wheel",r=>{const n=Math.exp(r.deltaY/e.clientHeight*2)-1,s=Math.sign(n);In(),Cn(0,0,s*Math.min(Math.abs(n),.06)),r.preventDefault(),yn()},{passive:!1}),Dr(e).on("mousemove",function(r){!r.active||r.buttons!==1||(dt+=Math.sqrt(Math.pow(r.dx,2)+Math.pow(r.dy,2)),r.mods.shift?(Dn(),Nn(r.dx,r.dy)):r.mods.meta?Ot.pivot(r.dx,r.dy):(Ot.rotate(-r.dx*yt,-r.dy*yt),Pn()),r.originalEvent.preventDefault())}).on("touchmove",function(r){Lt(r),r.active&&(dt+=Math.sqrt(Math.pow(r.dx,2)+Math.pow(r.dy,2)),Ot.rotate(-r.dx*yt,-r.dy*yt))}).on("pinchmove",function(r){r.active&&(Dn(),In(),Cn(0,0,1-r.zoomx),Nn(r.dx,r.dy))}).on("touchstart",r=>r.originalEvent.preventDefault()).on("pinchstart",r=>r.originalEvent.preventDefault()).on("pinchend",()=>{Pn(),yn()})};let Mr=!0;const cu=t=>t[0]+t[1]*256+t[2]*256*256-1,fu=()=>{const t=re(),e=Yn(),r=100,n=[Tr()[0]-r/2,Tr()[1]-r/2,r,r];t.drawFramebuffer(e.current.resize(t.width,t.height)).enable(G.SCISSOR_TEST).scissor(...n);const s=Cs().uniformBlock("cameras",Xt()).uniform("mousePosition",$t()).uniform("selectedIndex",tt());t.defaultViewport().clear(),s.draw(),t.readFramebuffer(e.other).readPixel(...Tr(),Fn),Br=cu(Fn),e.swap(),Mr=!1},Eu=async()=>{const{nodes:t}=await it();return t[tt()]},_u=`#version 300 es
in vec2 position;
in vec2 uv;
out vec2 vUV;

void main() {
  vUV = uv;
  gl_Position = vec4(position, 0.0, 1.0);
}`,du=`#version 300 es
precision mediump float;
in vec2 vUV;
uniform sampler2D uTexture;
out vec4 fragColor;

void main() {
  fragColor = texture(uTexture, vUV);
  fragColor.a = 1.0;
}`,Au=new Float32Array([-1,-1,1,-1,-1,1,1,1]),Tu=new Float32Array([0,0,1,0,0,1,1,1]),mu=ie.infinite(()=>{const t=re(),e=t.createVertexArray().vertexAttributeBuffer(0,t.createVertexBuffer(G.FLOAT,2,Au)).vertexAttributeBuffer(1,t.createVertexBuffer(G.FLOAT,2,Tu)).indexBuffer(t.createIndexBuffer(G.UNSIGNED_SHORT,3,new Uint16Array([0,1,2,2,1,3]))),r=t.createProgram(_u,du);return t.createDrawCall(r,e)}),pu=t=>{mu().texture("uTexture",t).draw()};var gu={grad:.9,turn:360,rad:360/(2*Math.PI)},De=function(t){return typeof t=="string"?t.length>0:typeof t=="number"},Ae=function(t,e,r){return e===void 0&&(e=0),r===void 0&&(r=Math.pow(10,e)),Math.round(r*t)/r+0},ge=function(t,e,r){return e===void 0&&(e=0),r===void 0&&(r=1),t>r?r:t>e?t:e},Pi=function(t){return(t=isFinite(t)?t%360:0)>0?t:t+360},Bn=function(t){return{r:ge(t.r,0,255),g:ge(t.g,0,255),b:ge(t.b,0,255),a:ge(t.a)}},mr=function(t){return{r:Ae(t.r),g:Ae(t.g),b:Ae(t.b),a:Ae(t.a,3)}},Ru=/^#([0-9a-f]{3,8})$/i,Ft=function(t){var e=t.toString(16);return e.length<2?"0"+e:e},yi=function(t){var e=t.r,r=t.g,n=t.b,s=t.a,a=Math.max(e,r,n),l=a-Math.min(e,r,n),o=l?a===e?(r-n)/l:a===r?2+(n-e)/l:4+(e-r)/l:0;return{h:60*(o<0?o+6:o),s:a?l/a*100:0,v:a/255*100,a:s}},Fi=function(t){var e=t.h,r=t.s,n=t.v,s=t.a;e=e/360*6,r/=100,n/=100;var a=Math.floor(e),l=n*(1-r),o=n*(1-(e-a)*r),h=n*(1-(1-e+a)*r),u=a%6;return{r:255*[n,o,l,l,h,n][u],g:255*[h,n,n,o,l,l][u],b:255*[l,l,h,n,n,o][u],a:s}},Mn=function(t){return{h:Pi(t.h),s:ge(t.s,0,100),l:ge(t.l,0,100),a:ge(t.a)}},On=function(t){return{h:Ae(t.h),s:Ae(t.s),l:Ae(t.l),a:Ae(t.a,3)}},bn=function(t){return Fi((r=(e=t).s,{h:e.h,s:(r*=((n=e.l)<50?n:100-n)/100)>0?2*r/(n+r)*100:0,v:n+r,a:e.a}));var e,r,n},At=function(t){return{h:(e=yi(t)).h,s:(s=(200-(r=e.s))*(n=e.v)/100)>0&&s<200?r*n/100/(s<=100?s:200-s)*100:0,l:s/2,a:e.a};var e,r,n,s},xu=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s*,\s*([+-]?\d*\.?\d+)%\s*,\s*([+-]?\d*\.?\d+)%\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Su=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s+([+-]?\d*\.?\d+)%\s+([+-]?\d*\.?\d+)%\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,vu=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Cu=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Ln={string:[[function(t){var e=Ru.exec(t);return e?(t=e[1]).length<=4?{r:parseInt(t[0]+t[0],16),g:parseInt(t[1]+t[1],16),b:parseInt(t[2]+t[2],16),a:t.length===4?Ae(parseInt(t[3]+t[3],16)/255,2):1}:t.length===6||t.length===8?{r:parseInt(t.substr(0,2),16),g:parseInt(t.substr(2,2),16),b:parseInt(t.substr(4,2),16),a:t.length===8?Ae(parseInt(t.substr(6,2),16)/255,2):1}:null:null},"hex"],[function(t){var e=vu.exec(t)||Cu.exec(t);return e?e[2]!==e[4]||e[4]!==e[6]?null:Bn({r:Number(e[1])/(e[2]?100/255:1),g:Number(e[3])/(e[4]?100/255:1),b:Number(e[5])/(e[6]?100/255:1),a:e[7]===void 0?1:Number(e[7])/(e[8]?100:1)}):null},"rgb"],[function(t){var e=xu.exec(t)||Su.exec(t);if(!e)return null;var r,n,s=Mn({h:(r=e[1],n=e[2],n===void 0&&(n="deg"),Number(r)*(gu[n]||1)),s:Number(e[3]),l:Number(e[4]),a:e[5]===void 0?1:Number(e[5])/(e[6]?100:1)});return bn(s)},"hsl"]],object:[[function(t){var e=t.r,r=t.g,n=t.b,s=t.a,a=s===void 0?1:s;return De(e)&&De(r)&&De(n)?Bn({r:Number(e),g:Number(r),b:Number(n),a:Number(a)}):null},"rgb"],[function(t){var e=t.h,r=t.s,n=t.l,s=t.a,a=s===void 0?1:s;if(!De(e)||!De(r)||!De(n))return null;var l=Mn({h:Number(e),s:Number(r),l:Number(n),a:Number(a)});return bn(l)},"hsl"],[function(t){var e=t.h,r=t.s,n=t.v,s=t.a,a=s===void 0?1:s;if(!De(e)||!De(r)||!De(n))return null;var l=function(o){return{h:Pi(o.h),s:ge(o.s,0,100),v:ge(o.v,0,100),a:ge(o.a)}}({h:Number(e),s:Number(r),v:Number(n),a:Number(a)});return Fi(l)},"hsv"]]},wn=function(t,e){for(var r=0;r<e.length;r++){var n=e[r][0](t);if(n)return[n,e[r][1]]}return[null,void 0]},Nu=function(t){return typeof t=="string"?wn(t.trim(),Ln.string):typeof t=="object"&&t!==null?wn(t,Ln.object):[null,void 0]},pr=function(t,e){var r=At(t);return{h:r.h,s:ge(r.s+100*e,0,100),l:r.l,a:r.a}},gr=function(t){return(299*t.r+587*t.g+114*t.b)/1e3/255},Un=function(t,e){var r=At(t);return{h:r.h,s:r.s,l:ge(r.l+100*e,0,100),a:r.a}},Gn=function(){function t(e){this.parsed=Nu(e)[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return t.prototype.isValid=function(){return this.parsed!==null},t.prototype.brightness=function(){return Ae(gr(this.rgba),2)},t.prototype.isDark=function(){return gr(this.rgba)<.5},t.prototype.isLight=function(){return gr(this.rgba)>=.5},t.prototype.toHex=function(){return e=mr(this.rgba),r=e.r,n=e.g,s=e.b,l=(a=e.a)<1?Ft(Ae(255*a)):"","#"+Ft(r)+Ft(n)+Ft(s)+l;var e,r,n,s,a,l},t.prototype.toRgb=function(){return mr(this.rgba)},t.prototype.toRgbString=function(){return e=mr(this.rgba),r=e.r,n=e.g,s=e.b,(a=e.a)<1?"rgba("+r+", "+n+", "+s+", "+a+")":"rgb("+r+", "+n+", "+s+")";var e,r,n,s,a},t.prototype.toHsl=function(){return On(At(this.rgba))},t.prototype.toHslString=function(){return e=On(At(this.rgba)),r=e.h,n=e.s,s=e.l,(a=e.a)<1?"hsla("+r+", "+n+"%, "+s+"%, "+a+")":"hsl("+r+", "+n+"%, "+s+"%)";var e,r,n,s,a},t.prototype.toHsv=function(){return e=yi(this.rgba),{h:Ae(e.h),s:Ae(e.s),v:Ae(e.v),a:Ae(e.a,3)};var e},t.prototype.invert=function(){return Ce({r:255-(e=this.rgba).r,g:255-e.g,b:255-e.b,a:e.a});var e},t.prototype.saturate=function(e){return e===void 0&&(e=.1),Ce(pr(this.rgba,e))},t.prototype.desaturate=function(e){return e===void 0&&(e=.1),Ce(pr(this.rgba,-e))},t.prototype.grayscale=function(){return Ce(pr(this.rgba,-1))},t.prototype.lighten=function(e){return e===void 0&&(e=.1),Ce(Un(this.rgba,e))},t.prototype.darken=function(e){return e===void 0&&(e=.1),Ce(Un(this.rgba,-e))},t.prototype.rotate=function(e){return e===void 0&&(e=15),this.hue(this.hue()+e)},t.prototype.alpha=function(e){return typeof e=="number"?Ce({r:(r=this.rgba).r,g:r.g,b:r.b,a:e}):Ae(this.rgba.a,3);var r},t.prototype.hue=function(e){var r=At(this.rgba);return typeof e=="number"?Ce({h:e,s:r.s,l:r.l,a:r.a}):Ae(r.h)},t.prototype.isEqual=function(e){return this.toHex()===Ce(e).toHex()},t}(),Ce=function(t){return t instanceof Gn?t:new Gn(t)};let Or=!0,br=!0;window.addEventListener("keydown",t=>{t.key==="e"&&(Or=!Or),t.key==="n"&&(br=!br)});const Bi=()=>[Ce(document.body.style.backgroundColor).toRgb()].flatMap(({r:t,g:e,b:r,a:n})=>[t,e,r,n].map(s=>s/255)),Mi=()=>{const t=window.devicePixelRatio||1,e=window.innerWidth,r=window.innerHeight,n=Math.floor(e*t),s=Math.floor(r*t);return{width:n,height:s}},re=ie.infinite(()=>{const t=document.createElement("canvas");document.body.appendChild(t),t.getContext("webgl2")?console.log("WebGL2 initialized"):console.error("WebGL2 failed to initialize");const{width:r,height:n}=Mi();return G.createApp(t,{antialias:!0,extensions:["OES_texture_float","EXT_color_buffer_float","ANGLE_instanced_arrays"]}).viewport(0,0,r,n).enable(G.BLEND).blendFunc(G.SRC_ALPHA,G.ONE_MINUS_SRC_ALPHA).enable(G.DEPTH_TEST).depthFunc(G.LEQUAL).clearColor(...Bi())}),Iu=()=>{const t=re(),{width:e,height:r}=Mi();t.resize(e,r),Ot.resize(e/r);const n=t.canvas;n.style.position="absolute",n.style.top="0px",n.style.left="0px",n.style.height="100vh"},Oi=()=>{ou(Mo,window.innerWidth,window.innerHeight);const t=re();Iu();const e=yu();t.drawFramebuffer(e).scissor(0,0,e.width,e.height).enable(G.SCISSOR_TEST).viewport(0,0,e.width,e.height).clearColor(0,0,0,1),Lu().uniform("uMixRatio",.05).draw(),fu(),t.defaultDrawFramebuffer().defaultViewport().clearColor(...Bi()).disable(G.SCISSOR_TEST);const n=Ns().uniformBlock("cameras",Xt()).uniform("mousePosition",$t()).uniform("selectedIndex",tt()).uniform("time",performance.now()/1e3),s=bs().uniformBlock("cameras",Xt()).texture("positionTexture",me().texture).texture("colorTexture",Re().texture).texture("sizeTexture",xe().texture).texture("emphasisTexture",ye().texture).uniform("textureDimensions",[e.width,e.height]).uniform("mousePosition",$t()).uniform("selectedIndex",tt()).uniform("time",performance.now()/1e3);t.clear(),br&&n.draw(),Or&&s.draw(),window.lolDrawThatThing=a=>{a==="color"&&(window.lolDrawThat=Re().texture),a==="position"&&(window.lolDrawThat=me().texture),a==="size"&&(window.lolDrawThat=xe().texture),a==="picker"?window.lolDrawThat=Yn().current.colorAttachments[0]:window.lolDrawThat=null},window.lolDrawThat&&pu(window.lolDrawThat),Pu(),requestAnimationFrame(Oi)},Du=(t,e)=>{let r;switch(`${t}${e}`){case`${G.FLOAT}4`:r=G.RGBA32F;break;case`${G.FLOAT}3`:r=G.RGBA32F;break;case`${G.FLOAT}2`:r=G.RG32F;break;case`${G.FLOAT}1`:r=G.R32F;break;case`${G.UNSIGNED_BYTE}3`:r=G.RGB8;break;case`${G.UNSIGNED_BYTE}4`:r=G.RGBA8;break;case`${G.UNSIGNED_SHORT}3`:r=G.RGB16UI;break;case`${G.UNSIGNED_SHORT}4`:r=G.RGBA16UI;break;case`${G.UNSIGNED_INT}3`:r=G.RGB32UI;break;case`${G.UNSIGNED_INT}4`:r=G.RGBA32UI;break}return r};class Zt{constructor(e,r,n){this.positionSwap=!1,this.makeBuffer=ie.infinite((s,a)=>re().createVertexBuffer(this._type,this._itemSize,s*this._itemSize)),this.makeTexture=ie.infinite(s=>{const a=re(),l=Math.ceil(Math.sqrt(s+1)),o={width:l,height:l,internalFormat:Du(this._type,this._itemSize),type:this._type,flipY:!0,minFilter:G.NEAREST,magFilter:G.NEAREST,premultiplyAlpha:!0,wrapY:G.CLAMP_TO_EDGE,wrapX:G.CLAMP_TO_EDGE};return a.createTexture2D(l,l,o)}),this.makeTextureIndicesVertexBuffer=ie.infinite(s=>{const a=re(),l=new Uint32Array(s).map((o,h)=>h);return a.createVertexBuffer(G.UNSIGNED_INT,1,l)}),this.targetData=(s,{offset:a=-1,immediate:l=!1}={})=>{let o;a>-1?o=this._target.numItems:(a=0,o=ArrayBuffer.isView(s)?s.byteLength/this._itemSize/4:s),this._currentA=this.makeBuffer(o,"currentA"),this._currentB=this.makeBuffer(o,"currentB"),this._target=this.makeBuffer(o,"target"),this._texture=this.makeTexture(o),this._texturePixelPositions=this.makeTextureIndicesVertexBuffer(o),ArrayBuffer.isView(s)&&(this._target.data(s,a*this._itemSize*4),this._mostRecentData=s,l&&(this._currentA.data(s,a*this._itemSize*4),this._currentB.data(s,a*this._itemSize*4)))},this._type=e,this._itemSize=r,this.targetData(n)}swap(){this.positionSwap=!this.positionSwap}get current(){return this.positionSwap?this._currentA:this._currentB}get texture(){return this._texture}get texturePixelPositions(){return this._texturePixelPositions}get updated(){return this.positionSwap?this._currentB:this._currentA}get target(){return this._target}get mostRecentData(){return this._mostRecentData}}const me=ie.infinite(()=>new Zt(G.FLOAT,3,1)),Re=ie.infinite(()=>new Zt(G.FLOAT,4,1)),xe=ie.infinite(()=>new Zt(G.FLOAT,1,1)),ye=ie.infinite(()=>new Zt(G.FLOAT,1,1)),Pu=()=>{me().swap(),xe().swap(),Re().swap(),ye().swap()},Lr=ie.infinite(()=>re().createFramebuffer());ie.infinite(t=>re().createTexture2D(t,t,{internalFormat:G.DEPTH_COMPONENT32F}));const yu=()=>{re();const t=Lr(),e=me().texture,r=Re().texture,n=xe().texture,s=ye().texture;return t.colorTarget(1,e),t.colorTarget(2,r),t.colorTarget(3,n),t.colorTarget(4,s),t},Fu=ie.infinite(()=>re().createProgram(is,ss,{transformFeedbackVaryings:["vUpdatedPosition","vUpdatedColor","vUpdatedSize","vUpdatedEmphasis"],transformFeedbackMode:G.SEPARATE_ATTRIBS})),Bu=ie.infinite(()=>re().createVertexArray()),Mu=()=>(re(),Bu().vertexAttributeBuffer(0,me().current).vertexAttributeBuffer(1,Re().current).vertexAttributeBuffer(2,xe().current).vertexAttributeBuffer(3,ye().current).vertexAttributeBuffer(4,me().target).vertexAttributeBuffer(5,Re().target).vertexAttributeBuffer(6,xe().target).vertexAttributeBuffer(7,ye().target).vertexAttributeBuffer(8,me().texturePixelPositions)),Ou=ie.infinite(()=>re().createTransformFeedback()),bu=()=>Ou().feedbackBuffer(0,me().updated).feedbackBuffer(1,Re().updated).feedbackBuffer(2,xe().updated).feedbackBuffer(3,ye().updated),Lu=()=>{const t=re(),e=Fu(),r=Mu(),n=bu();return t.createDrawCall(e,r).primitive(G.POINTS).transformFeedback(n).uniform("mousePosition",$t()).uniform("bufferDimensions",[Lr().width,Lr().height])},Fe=document.createElement("div");document.body.appendChild(Fe);Fe.id="fps-indicator";Fe.classList.add("overlay");Fe.classList.add("debug");Fe.innerHTML=`
<div class="value">FPS: 0</div>
<canvas width="60" height="20" class="graph"></canvas>
`;Fe.style.position="absolute";Fe.style.top="0px";Fe.style.left="0px";Fe.style.color="white";const wu=document.querySelector("#fps-indicator .value"),Ke=document.querySelector("#fps-indicator .graph"),Me=Ke.getContext("2d");let Rr=performance.now(),Hn=performance.now(),xr=0,ct=[];const Vn=5,Uu=()=>ct.slice(0,Vn).reduce((t,e)=>t+e,0)/Vn,kr=()=>{const t=Uu(),e=performance.now();xr++,e>Rr+100&&(ct=[Math.round(xr*1e3/(e-Rr)/2),...ct].slice(0,1e3),Me?.clearRect(0,0,Ke.width,Ke.height),Me?.beginPath(),Me?.moveTo(0,Ke.height),ct.forEach((r,n)=>{Me?.lineTo(n,Ke.height-r)}),Me?.lineTo(ct.length,Ke.height),Me.fillStyle="rgba(255, 255, 255, 0.5)",Me?.fill(),Me?.stroke(),Rr=e,xr=0),e>Hn+1e3&&(Hn=e,wu.innerText=`FPS: ${t}`),requestAnimationFrame(kr)};kr();const Gu=re();Gu.clear();hu();uu();let Qt;Qt=await it();await Ml();const{nodes:Ne,linkIndexPairs:bi}=Qt;console.log("nodes",Ne);const Xn=[Ll],Hu=async()=>{const t=Xn[Math.floor(Math.random()*Xn.length)];await t(Qt)};await Hu();Ms(bi);const Vu=new Float32Array(Ne.flatMap(({color:t})=>t));Re().targetData(Vu);const wr=new Float32Array(Ne.length);for(let t=0;t<wr.length;t++)wr[t]=Math.sqrt(Ne[t].size)/40;xe().targetData(wr);const Sr=40,Xu=()=>[Math.random()*Sr-1,Math.random()*Sr-1,Math.random()*Sr-1],ku=new Float32Array(Ne.flatMap(Xu));me().targetData(ku);ye().targetData(new Float32Array(Ne.length).fill(0));const st=document.createElement("div");st.classList.add("overlay");st.classList.add("debug");st.style.top="0";st.style.right="0";document.body.appendChild(st);st.innerHTML=`
    <div>Nodes: ${Ne.length}</div>
    <div>Edges: ${bi.length}</div>
`;Oi();kr();qt.start();window.setNodePositions=t=>{me().targetData(new Float32Array(new Array(Ne.length*3).fill(0).flatMap(t)))};window.setNodeColors=t=>{Re().targetData(new Float32Array(new Array(Ne.length*4).fill(0).flatMap(t)))};window.setNodeSizes=t=>{xe().targetData(new Float32Array(new Array(Ne.length).fill(0).flatMap(t)))};window.graphData=Qt;window.addEventListener("keydown",t=>{const e=document.querySelector("#debug-style").sheet,r=e.cssRules[0].styleMap.get("display").value!=="none";t.key==="d"&&e.cssRules[0].styleMap.set("display",r?"none":"block")})})();